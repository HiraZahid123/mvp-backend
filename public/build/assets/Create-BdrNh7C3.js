import{a as o,j as e,b as P,u as O,H as R,c as G,r as T}from"./app-QnVUizLf.js";import{A as q}from"./AuthenticatedLayout-BiYnB1-m.js";import{u as L}from"./useTranslation-x70bPv3T.js";import{T as F}from"./TextInput-DdDBk4UH.js";import{I as h}from"./InputLabel-Dz7dSTSW.js";import{I as b}from"./InputError-ChJ8MzTF.js";import{u as H,a as W,G as $,A as K}from"./AdvancedMarker-DvaqfVld.js";import{F as U}from"./MapPinIcon-ns8Y2KQG.js";import{h as Y}from"./Header-Bh-tmRrQ.js";import{c as Q}from"./createLucideIcon-ouguqvvq.js";import{S as B}from"./sparkles-BSG92yTY.js";import{L as Z}from"./lock-IB9XE9E8.js";import{R as J}from"./rocket-Ba-LvXvd.js";import{S as V}from"./shield-check-BpUHihE0.js";import"./Footer-BK0BU5M7.js";import"./transition-DT5QNeAT.js";import"./circle-user-CKxVRQcr.js";const X=[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]],ee=Q("chevron-right",X);function te({title:c,titleId:m,...s},i){return o.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:i,"aria-labelledby":m},s),c?o.createElement("title",{id:m},c):null,o.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m21 21-5.197-5.197m0 0A7.5 7.5 0 1 0 5.196 5.196a7.5 7.5 0 0 0 10.607 10.607Z"}))}const se=o.forwardRef(te),ae=["places"];function re({onLocationSelect:c,initialLocation:m=null,initialAddress:s=""}){const{t:i}=L(),[y,A]=o.useState(m),[u,p]=o.useState(s),[M,j]=o.useState(m||{lat:46.8182,lng:8.2275}),[x,I]=o.useState(null),{isLoaded:v,loadError:N}=H({googleMapsApiKey:"AIzaSyAaeyO3ffYCdUpAHU0kQx3TsHGhlbaIgkA",libraries:ae}),f=o.useCallback((t,n)=>{window.google&&window.google.maps&&new window.google.maps.Geocoder().geocode({location:{lat:t,lng:n}},(l,E)=>{if(E==="OK"&&l[0]){const w=l[0].formatted_address;p(w);let C="";for(const S of l[0].address_components)if(S.types.includes("locality")){C=S.long_name;break}c({lat:t,lng:n,address:w,city:C||w.split(",")[0]})}})},[c]),k=o.useCallback(t=>{const n=t.latLng.lat(),d=t.latLng.lng();A({lat:n,lng:d}),f(n,d)},[f]),D=t=>{I(t)},_=()=>{if(x!==null){const t=x.getPlace();if(t.geometry){const n={lat:t.geometry.location.lat(),lng:t.geometry.location.lng()};A(n),j(n),p(t.formatted_address);let d="";if(t.address_components){for(const l of t.address_components)if(l.types.includes("locality")){d=l.long_name;break}}c({lat:n.lat,lng:n.lng,address:t.formatted_address,city:d||t.formatted_address.split(",")[0]})}}},r={width:"100%",height:"300px",borderRadius:"24px"};return N?e.jsx("div",{className:"p-4 bg-red-50 text-red-500 rounded-[24px]",children:i("Error loading Google Maps")}):v?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"relative group",children:[e.jsx("div",{className:"absolute left-5 top-1/2 -translate-y-1/2 text-gray-muted group-focus-within:text-oflem-terracotta transition-colors",children:e.jsx(se,{className:"w-5 h-5"})}),e.jsx(W,{onLoad:D,onPlaceChanged:_,options:{componentRestrictions:{country:"ch"}},children:e.jsx("input",{type:"text",placeholder:i("Search for a location..."),className:"w-full pl-14 pr-6 py-4 bg-oflem-cream border-gray-border rounded-full text-sm font-bold focus:border-oflem-terracotta focus:ring-0 transition-all shadow-sm",value:u,onChange:t=>p(t.target.value),onKeyDown:t=>t.key==="Enter"&&t.preventDefault()})})]}),e.jsx("div",{className:"rounded-[24px] overflow-hidden border border-gray-border shadow-sm",children:e.jsx($,{mapContainerStyle:r,center:M,zoom:y?15:8,onClick:k,options:{disableDefaultUI:!0,zoomControl:!0,mapId:"DEMO_MAP_ID",styles:[{featureType:"all",elementType:"geometry",stylers:[{color:"#f5f5f5"}]},{featureType:"water",elementType:"geometry",stylers:[{color:"#e9e9e9"}]}]},children:y&&e.jsx(K,{position:y})})}),y&&e.jsxs("div",{className:"flex items-center gap-2 p-4 bg-gradient-to-br from-oflem-terracotta to-oflem-terracotta-light/5 rounded-[20px] border border-oflem-terracotta/10",children:[e.jsx(U,{className:"w-5 h-5 text-oflem-terracotta flex-shrink-0"}),e.jsx("p",{className:"text-xs font-bold text-gray-muted truncate",children:u})]})]}):e.jsx("div",{className:"h-[300px] w-full bg-gray-100 animate-pulse rounded-[24px] flex items-center justify-center text-gray-400 font-bold",children:i("Loading maps...")})}function ve({prefillTitle:c="",aiTitle:m=null}){const{t:s}=L(),{auth:i}=P().props,[y,A]=o.useState(!1),[u,p]=o.useState(!1),[M,j]=o.useState(""),[x,I]=o.useState(!1),[v,N]=o.useState(!1),[f,k]=o.useState("quick"),[D,_]=o.useState(""),{data:r,setData:t,post:n,processing:d,errors:l,reset:E}=O({title:m||c,description:"",location:i.user?.location_address||"",lat:i.user?.location_lat||"",lng:i.user?.location_lng||"",exact_address:"",date_time:"",budget:"",price_type:"fixed",additional_details:""}),w=async()=>{if(r.title){N(!0),_("");try{const a=await G.post(route("api.missions.ai-rewrite"),{title:r.title,description:r.description});t(g=>({...g,description:a.data.improved_description||""}))}catch(a){console.error("AI Description Generation Error:",a),_(s("Could not generate description. Please try again."))}finally{N(!1)}}},C=async a=>{p(!0),j("");try{return(await G.post(route("api.moderation.check"),{content:a})).data.is_clean?!0:(j(s("Content violates moderation rules.")),!1)}catch{return!0}finally{p(!1)}},S=async a=>{if(a.preventDefault(),!r.location&&!r.lat&&!r.lng){j(s("Please select a location for your mission."));return}if(await C(r.title+" "+r.description)){if(!i.user){T.post(route("api.missions.store"),r);return}n(route("api.missions.store"),{onSuccess:()=>E()})}},z=[10,20,30];return e.jsxs(q,{header:s("Post a Mission"),maxWidth:"max-w-2xl",showFooter:!0,children:[e.jsx(R,{title:s("Create Mission")}),e.jsxs("div",{className:"bg-white rounded-[40px] p-8 md:p-12 shadow-sm border border-gray-border",children:[e.jsx("div",{className:"mb-8 text-center",children:e.jsx("p",{className:"text-gray-muted font-medium",children:s("Quick and simple.")})}),e.jsxs("form",{onSubmit:S,className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx(h,{htmlFor:"title",value:s("What do you need help with?"),className:"text-sm font-bold mb-3"}),e.jsx(F,{id:"title",type:"text",value:r.title,className:"w-full text-lg",onChange:a=>t("title",a.target.value),placeholder:s("e.g. Take out my trash"),required:!0}),e.jsx(b,{message:l.title||M,className:"mt-2"})]}),e.jsxs("div",{children:[e.jsx(h,{value:s("How much are you offering?"),className:"text-sm font-bold mb-3"}),e.jsxs("div",{className:"flex flex-wrap gap-3 mb-4",children:[z.map(a=>e.jsxs("button",{type:"button",onClick:()=>{t("budget",a.toString()),k("quick")},className:`px-6 py-3 rounded-full text-sm font-bold transition-all border-2 ${r.budget===a.toString()&&f==="quick"?"border-oflem-charcoal bg-oflem-charcoal text-white shadow-md scale-105":"border-gray-border bg-white text-gray-700 hover:border-gray-400"}`,children:[a," CHF"]},a)),e.jsx("button",{type:"button",onClick:()=>{k("custom")},className:`px-6 py-3 rounded-full text-sm font-bold transition-all border-2 ${f==="custom"?"border-oflem-charcoal bg-oflem-charcoal text-white shadow-md scale-105":"border-gray-border bg-white text-gray-700 hover:border-gray-400"}`,children:s("Other")})]}),f==="custom"&&e.jsxs("div",{className:"relative max-w-xs",children:[e.jsx("input",{id:"budget",type:"number",value:r.budget,className:"w-full bg-white border-2 border-gray-border rounded-2xl py-3 pl-14 pr-6 text-lg font-bold text-oflem-charcoal focus:border-oflem-charcoal focus:ring-0 transition-all",onChange:a=>t("budget",a.target.value),placeholder:"0",required:!0}),e.jsx("span",{className:"absolute left-5 top-1/2 -translate-y-1/2 font-bold text-gray-muted text-sm",children:"CHF"})]}),e.jsx(b,{message:l.budget,className:"mt-2"})]}),e.jsxs("div",{children:[e.jsx(h,{value:s("Where?"),className:"text-sm font-bold mb-3"}),e.jsx(re,{onLocationSelect:a=>{t(g=>({...g,location:a.city,lat:a.lat,lng:a.lng,exact_address:a.address}))},initialAddress:r.exact_address||r.location}),e.jsx(b,{message:l.location||l.lat||l.lng,className:"mt-2"})]}),e.jsxs("div",{className:"pt-4",children:[e.jsxs("button",{type:"button",onClick:()=>I(!x),className:"text-sm font-bold text-zinc-500 hover:text-oflem-charcoal transition-colors flex items-center gap-2 group",children:[e.jsx("span",{className:"group-hover:translate-y-0.5 transition-transform",children:x?e.jsx(Y,{size:16}):e.jsx(ee,{size:16})}),s("More options")]}),x&&e.jsxs("div",{className:"mt-6 space-y-6 p-6 bg-gray-50 rounded-3xl",children:[e.jsxs("div",{children:[e.jsx(h,{htmlFor:"description",value:s("Description (optional)"),className:"text-sm font-bold mb-3"}),e.jsxs("div",{className:"relative",children:[e.jsx("textarea",{id:"description",value:r.description,className:"w-full bg-white border-gray-border rounded-2xl p-4 text-sm font-medium focus:border-oflem-charcoal focus:ring-0 min-h-[120px] transition-all",onChange:a=>t("description",a.target.value),placeholder:s("Add more details if needed...")}),e.jsx("button",{type:"button",onClick:w,disabled:v||!r.title,className:"absolute bottom-3 right-3 text-xs bg-gray-100 hover:bg-gray-200 text-gray-700 px-3 py-1.5 rounded-full font-bold transition-all flex items-center gap-2 border border-gray-200",title:s("Generate description with AI"),children:v?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"w-3 h-3 border-2 border-gray-400 border-t-oflem-charcoal rounded-full animate-spin"}),s("Generating...")]}):e.jsxs(e.Fragment,{children:[e.jsx(B,{size:14,className:"text-oflem-terracotta"})," ",s("Auto-fill")]})})]}),e.jsx(b,{message:l.description,className:"mt-2"})]}),e.jsxs("div",{children:[e.jsx(h,{htmlFor:"date_time",value:s("When? (optional)"),className:"text-sm font-bold mb-3"}),e.jsx(F,{id:"date_time",type:"datetime-local",value:r.date_time,className:"w-full",min:new Date().toISOString().slice(0,16),onChange:a=>t("date_time",a.target.value)}),e.jsx(b,{message:l.date_time,className:"mt-2"})]}),e.jsxs("div",{children:[e.jsx(h,{htmlFor:"exact_address",value:s("Exact address (optional)"),className:"text-sm font-bold mb-3"}),e.jsx(F,{id:"exact_address",type:"text",value:r.exact_address,className:"w-full",onChange:a=>t("exact_address",a.target.value),placeholder:s("Street, number, apartment...")}),e.jsxs("p",{className:"mt-2 text-xs text-zinc-400 font-bold flex items-center gap-1.5",children:[e.jsx(Z,{size:12,className:"text-oflem-terracotta"})," ",s("Only shared with your Provider after confirmation")]}),e.jsx(b,{message:l.exact_address,className:"mt-2"})]})]})]}),e.jsxs("div",{className:"pt-6",children:[e.jsx("button",{type:"submit",disabled:d||u||!r.title.trim()||!r.budget,className:`w-full py-5 font-black rounded-full transition-all shadow-xl text-lg flex items-center justify-center gap-3 active:scale-[0.98] ${!r.title.trim()||!r.budget||d||u?"bg-gray-200 text-gray-400 cursor-not-allowed shadow-none":"bg-oflem-charcoal text-white hover:bg-black"}`,children:d||u?e.jsx("span",{className:"w-6 h-6 border-4 border-oflem-terracotta border-t-white rounded-full animate-spin"}):e.jsxs(e.Fragment,{children:[e.jsx("span",{children:s("Find a Provider")}),e.jsx(J,{size:20,className:"group-hover:translate-x-1 group-hover:-translate-y-1 transition-transform"})]})}),e.jsxs("p",{className:"mt-4 text-center text-xs text-zinc-400 font-bold flex items-center justify-center gap-1.5",children:[e.jsx(V,{size:14,className:"text-oflem-green"})," ",s("Your payment is protected. You only pay when the job is done.")]})]})]})]})]})}export{ve as default};
