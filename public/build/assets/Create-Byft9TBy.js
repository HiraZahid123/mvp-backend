import{a as o,j as e,b as P,u as O,H as R,c as D,r as T}from"./app-DGZpcoEf.js";import{A as H}from"./AuthenticatedLayout-QvHA3J9k.js";import{u as G}from"./useTranslation-B70rtC_o.js";import{T as F}from"./TextInput-Dtb4ArT_.js";import{I as h}from"./InputLabel-DPaDfknu.js";import{I as b}from"./InputError-BL3f_Rmu.js";import{u as q,A as W,G as $}from"./esm-PJUcMXuc.js";import{A as K}from"./AdvancedMarker-RD1c-I7G.js";import{F as U}from"./MapPinIcon-DUyI8BoR.js";import{i as Y}from"./Header-BmoeIyjT.js";import{C as B}from"./chevron-right-Lv4YjZSw.js";import{S as Q}from"./sparkles-Zrygu5RS.js";import{L as Z}from"./lock-CwqiprT_.js";import{R as J}from"./rocket-D8gTntlO.js";import{S as V}from"./shield-check-BjONaAKk.js";import"./Footer-B6M1zDSw.js";import"./createLucideIcon-Jm3AEVgt.js";import"./transition-x_x8a0JL.js";import"./circle-user-B8B-okVQ.js";function X({title:c,titleId:m,...s},n){return o.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:n,"aria-labelledby":m},s),c?o.createElement("title",{id:m},c):null,o.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m21 21-5.197-5.197m0 0A7.5 7.5 0 1 0 5.196 5.196a7.5 7.5 0 0 0 10.607 10.607Z"}))}const ee=o.forwardRef(X),te=["places"];function se({onLocationSelect:c,initialLocation:m=null,initialAddress:s=""}){const{t:n}=G(),[y,v]=o.useState(m),[p,u]=o.useState(s),[M,j]=o.useState(m||{lat:46.8182,lng:8.2275}),[x,I]=o.useState(null),{isLoaded:N,loadError:k}=q({googleMapsApiKey:"AIzaSyAaeyO3ffYCdUpAHU0kQx3TsHGhlbaIgkA",libraries:te}),f=o.useCallback((t,i)=>{window.google&&window.google.maps&&new window.google.maps.Geocoder().geocode({location:{lat:t,lng:i}},(l,E)=>{if(E==="OK"&&l[0]){const w=l[0].formatted_address;u(w);let S="";for(const A of l[0].address_components)if(A.types.includes("locality")){S=A.long_name;break}c({lat:t,lng:i,address:w,city:S||w.split(",")[0]})}})},[c]),C=o.useCallback(t=>{const i=t.latLng.lat(),d=t.latLng.lng();v({lat:i,lng:d}),f(i,d)},[f]),L=t=>{I(t)},_=()=>{if(x!==null){const t=x.getPlace();if(t.geometry){const i={lat:t.geometry.location.lat(),lng:t.geometry.location.lng()};v(i),j(i),u(t.formatted_address);let d="";if(t.address_components){for(const l of t.address_components)if(l.types.includes("locality")){d=l.long_name;break}}c({lat:i.lat,lng:i.lng,address:t.formatted_address,city:d||t.formatted_address.split(",")[0]})}}},a={width:"100%",height:"300px",borderRadius:"24px"};return k?e.jsx("div",{className:"p-4 bg-red-50 text-red-500 rounded-[24px]",children:n("Error loading Google Maps")}):N?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"relative group",children:[e.jsx("div",{className:"absolute left-5 top-1/2 -translate-y-1/2 text-gray-muted group-focus-within:text-oflem-terracotta transition-colors",children:e.jsx(ee,{className:"w-5 h-5"})}),e.jsx(W,{onLoad:L,onPlaceChanged:_,options:{componentRestrictions:{country:"ch"}},children:e.jsx("input",{type:"text",placeholder:n("Search for a location..."),className:"w-full pl-14 pr-6 py-4 bg-oflem-cream border-gray-border rounded-full text-sm font-bold focus:border-oflem-terracotta focus:ring-0 transition-all shadow-sm",value:p,onChange:t=>u(t.target.value),onKeyDown:t=>t.key==="Enter"&&t.preventDefault()})})]}),e.jsx("div",{className:"rounded-[24px] overflow-hidden border border-gray-border shadow-sm",children:e.jsx($,{mapContainerStyle:a,center:M,zoom:y?15:8,onClick:C,options:{disableDefaultUI:!0,zoomControl:!0,mapId:"DEMO_MAP_ID",styles:[{featureType:"all",elementType:"geometry",stylers:[{color:"#f5f5f5"}]},{featureType:"water",elementType:"geometry",stylers:[{color:"#e9e9e9"}]}]},children:y&&e.jsx(K,{position:y})})}),y&&e.jsxs("div",{className:"flex items-center gap-3 p-4 bg-oflem-charcoal rounded-[24px] border border-oflem-charcoal/10 shadow-elegant-glow group/address transition-all hover:scale-[1.01] animate-in fade-in slide-in-from-bottom-2 duration-500",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-oflem-terracotta/20 flex items-center justify-center flex-shrink-0 group-hover/address:bg-oflem-terracotta/30 transition-colors",children:e.jsx(U,{className:"w-5 h-5 text-oflem-terracotta"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-[10px] font-black uppercase tracking-wider text-oflem-terracotta mb-0.5",children:n("Selected Location")}),e.jsx("p",{className:"text-sm font-bold text-white truncate leading-tight",children:p})]}),e.jsx("button",{onClick:()=>{v(null),u(""),c({lat:null,lng:null,address:"",city:""})},className:"p-2 hover:bg-white/10 rounded-full transition-colors",title:n("Clear location"),children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 text-white/40",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]})]}):e.jsx("div",{className:"h-[300px] w-full bg-gray-100 animate-pulse rounded-[24px] flex items-center justify-center text-gray-400 font-bold",children:n("Loading maps...")})}function ve({prefillTitle:c="",aiTitle:m=null}){const{t:s}=G(),{auth:n}=P().props,[y,v]=o.useState(!1),[p,u]=o.useState(!1),[M,j]=o.useState(""),[x,I]=o.useState(!1),[N,k]=o.useState(!1),[f,C]=o.useState("quick"),[L,_]=o.useState(""),{data:a,setData:t,post:i,processing:d,errors:l,reset:E}=O({title:m||c,description:"",location:n.user?.location_address||"",lat:n.user?.location_lat||"",lng:n.user?.location_lng||"",exact_address:"",date_time:"",budget:"",price_type:"fixed",additional_details:""}),w=async()=>{if(a.title){k(!0),_("");try{const r=await D.post(route("api.missions.ai-rewrite"),{title:a.title,description:a.description});t(g=>({...g,description:r.data.improved_description||""}))}catch(r){console.error("AI Description Generation Error:",r),_(s("Could not generate description. Please try again."))}finally{k(!1)}}},S=async r=>{u(!0),j("");try{return(await D.post(route("api.moderation.check"),{content:r})).data.is_clean?!0:(j(s("Content violates moderation rules.")),!1)}catch{return!0}finally{u(!1)}},A=async r=>{if(r.preventDefault(),!a.location&&!a.lat&&!a.lng){j(s("Please select a location for your mission."));return}if(await S(a.title+" "+a.description)){if(!n.user){T.post(route("api.missions.store"),a);return}i(route("api.missions.store"),{onSuccess:()=>E()})}},z=[10,20,30];return e.jsxs(H,{header:s("Post a Mission"),maxWidth:"max-w-2xl",showFooter:!0,children:[e.jsx(R,{title:s("Create Mission")}),e.jsxs("div",{className:"bg-white rounded-[40px] p-8 md:p-12 shadow-sm border border-gray-border",children:[e.jsx("div",{className:"mb-8 text-center",children:e.jsx("p",{className:"text-gray-muted font-medium",children:s("Quick and simple.")})}),e.jsxs("form",{onSubmit:A,className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx(h,{htmlFor:"title",value:s("What do you need help with?"),className:"text-sm font-bold mb-3"}),e.jsx(F,{id:"title",type:"text",value:a.title,className:"w-full text-lg",onChange:r=>t("title",r.target.value),placeholder:s("e.g. Take out my trash"),required:!0}),e.jsx(b,{message:l.title||M,className:"mt-2"})]}),e.jsxs("div",{children:[e.jsx(h,{value:s("How much are you offering?"),className:"text-sm font-bold mb-3"}),e.jsxs("div",{className:"flex flex-wrap gap-3 mb-4",children:[z.map(r=>e.jsxs("button",{type:"button",onClick:()=>{t("budget",r.toString()),C("quick")},className:`px-6 py-3 rounded-full text-sm font-bold transition-all border-2 ${a.budget===r.toString()&&f==="quick"?"border-oflem-charcoal bg-oflem-charcoal text-white shadow-md scale-105":"border-gray-border bg-white text-gray-700 hover:border-gray-400"}`,children:[r," CHF"]},r)),e.jsx("button",{type:"button",onClick:()=>{C("custom")},className:`px-6 py-3 rounded-full text-sm font-bold transition-all border-2 ${f==="custom"?"border-oflem-charcoal bg-oflem-charcoal text-white shadow-md scale-105":"border-gray-border bg-white text-gray-700 hover:border-gray-400"}`,children:s("Other")})]}),f==="custom"&&e.jsxs("div",{className:"relative max-w-xs",children:[e.jsx("input",{id:"budget",type:"number",value:a.budget,className:"w-full bg-white border-2 border-gray-border rounded-2xl py-3 pl-14 pr-6 text-lg font-bold text-oflem-charcoal focus:border-oflem-charcoal focus:ring-0 transition-all",onChange:r=>t("budget",r.target.value),placeholder:"0",required:!0}),e.jsx("span",{className:"absolute left-5 top-1/2 -translate-y-1/2 font-bold text-gray-muted text-sm",children:"CHF"})]}),e.jsx(b,{message:l.budget,className:"mt-2"})]}),e.jsxs("div",{children:[e.jsx(h,{value:s("Where?"),className:"text-sm font-bold mb-3"}),e.jsx(se,{onLocationSelect:r=>{t(g=>({...g,location:r.city,lat:r.lat,lng:r.lng,exact_address:r.address}))},initialAddress:a.exact_address||a.location}),e.jsx(b,{message:l.location||l.lat||l.lng,className:"mt-2"})]}),e.jsxs("div",{className:"pt-4",children:[e.jsxs("button",{type:"button",onClick:()=>I(!x),className:"text-sm font-bold text-zinc-500 hover:text-oflem-charcoal transition-colors flex items-center gap-2 group",children:[e.jsx("span",{className:"group-hover:translate-y-0.5 transition-transform",children:x?e.jsx(Y,{size:16}):e.jsx(B,{size:16})}),s("More options")]}),x&&e.jsxs("div",{className:"mt-6 space-y-6 p-6 bg-gray-50 rounded-3xl",children:[e.jsxs("div",{children:[e.jsx(h,{htmlFor:"description",value:s("Description (optional)"),className:"text-sm font-bold mb-3"}),e.jsxs("div",{className:"relative",children:[e.jsx("textarea",{id:"description",value:a.description,className:"w-full bg-white border-gray-border rounded-2xl p-4 text-sm font-medium focus:border-oflem-charcoal focus:ring-0 min-h-[120px] transition-all",onChange:r=>t("description",r.target.value),placeholder:s("Add more details if needed...")}),e.jsx("button",{type:"button",onClick:w,disabled:N||!a.title,className:"absolute bottom-3 right-3 text-xs bg-gray-100 hover:bg-gray-200 text-gray-700 px-3 py-1.5 rounded-full font-bold transition-all flex items-center gap-2 border border-gray-200",title:s("Generate description with AI"),children:N?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"w-3 h-3 border-2 border-gray-400 border-t-oflem-charcoal rounded-full animate-spin"}),s("Generating...")]}):e.jsxs(e.Fragment,{children:[e.jsx(Q,{size:14,className:"text-oflem-terracotta"})," ",s("Auto-fill")]})})]}),e.jsx(b,{message:l.description,className:"mt-2"})]}),e.jsxs("div",{children:[e.jsx(h,{htmlFor:"date_time",value:s("When? (optional)"),className:"text-sm font-bold mb-3"}),e.jsx(F,{id:"date_time",type:"datetime-local",value:a.date_time,className:"w-full",min:new Date().toISOString().slice(0,16),onChange:r=>t("date_time",r.target.value)}),e.jsx(b,{message:l.date_time,className:"mt-2"})]}),e.jsxs("div",{children:[e.jsx(h,{htmlFor:"exact_address",value:s("Exact address (optional)"),className:"text-sm font-bold mb-3"}),e.jsx(F,{id:"exact_address",type:"text",value:a.exact_address,className:"w-full",onChange:r=>t("exact_address",r.target.value),placeholder:s("Street, number, apartment...")}),e.jsxs("p",{className:"mt-2 text-xs text-zinc-400 font-bold flex items-center gap-1.5",children:[e.jsx(Z,{size:12,className:"text-oflem-terracotta"})," ",s("Only shared with your Provider after confirmation")]}),e.jsx(b,{message:l.exact_address,className:"mt-2"})]})]})]}),e.jsxs("div",{className:"pt-6",children:[e.jsx("button",{type:"submit",disabled:d||p||!a.title.trim()||!a.budget,className:`w-full py-5 font-black rounded-full transition-all shadow-xl text-lg flex items-center justify-center gap-3 active:scale-[0.98] ${!a.title.trim()||!a.budget||d||p?"bg-gray-200 text-gray-400 cursor-not-allowed shadow-none":"bg-oflem-charcoal text-white hover:bg-black"}`,children:d||p?e.jsx("span",{className:"w-6 h-6 border-4 border-oflem-terracotta border-t-white rounded-full animate-spin"}):e.jsxs(e.Fragment,{children:[e.jsx("span",{children:s("Find a Provider")}),e.jsx(J,{size:20,className:"group-hover:translate-x-1 group-hover:-translate-y-1 transition-transform"})]})}),e.jsxs("p",{className:"mt-4 text-center text-xs text-zinc-400 font-bold flex items-center justify-center gap-1.5",children:[e.jsx(V,{size:14,className:"text-oflem-green"})," ",s("Your payment is protected. You only pay when the job is done.")]})]})]})]})]})}export{ve as default};
