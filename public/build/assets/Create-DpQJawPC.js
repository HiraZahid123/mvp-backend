import{a as o,j as e,b as O,u as T,H,c as D,r as q}from"./app-VuuoFMYi.js";import{A as R}from"./AuthenticatedLayout-CBkajSYM.js";import{u as L}from"./useTranslation-DhCHActQ.js";import{T as F}from"./TextInput-BoRcJBSv.js";import{I as f}from"./InputLabel-BMc0Cw46.js";import{I as h}from"./InputError-DaLsWigP.js";import{u as W,a as $,G as z,A as K}from"./AdvancedMarker-CEx7_f-9.js";import{F as U}from"./MapPinIcon-DDxfKypJ.js";import"./Header-3kHNh44_.js";import"./transition-DXqgghb9.js";import"./Footer-BksMcUE0.js";function Y({title:c,titleId:m,...s},i){return o.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:i,"aria-labelledby":m},s),c?o.createElement("title",{id:m},c):null,o.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m21 21-5.197-5.197m0 0A7.5 7.5 0 1 0 5.196 5.196a7.5 7.5 0 0 0 10.607 10.607Z"}))}const Q=o.forwardRef(Y),B=["places"];function Z({onLocationSelect:c,initialLocation:m=null,initialAddress:s=""}){const{t:i}=L(),[y,A]=o.useState(m),[u,p]=o.useState(s),[S,j]=o.useState(m||{lat:46.8182,lng:8.2275}),[x,I]=o.useState(null),{isLoaded:v,loadError:N}=W({googleMapsApiKey:"AIzaSyAaeyO3ffYCdUpAHU0kQx3TsHGhlbaIgkA",libraries:B}),g=o.useCallback((t,l)=>{window.google&&window.google.maps&&new window.google.maps.Geocoder().geocode({location:{lat:t,lng:l}},(n,E)=>{if(E==="OK"&&n[0]){const w=n[0].formatted_address;p(w);let C="";for(const M of n[0].address_components)if(M.types.includes("locality")){C=M.long_name;break}c({lat:t,lng:l,address:w,city:C||w.split(",")[0]})}})},[c]),k=o.useCallback(t=>{const l=t.latLng.lat(),d=t.latLng.lng();A({lat:l,lng:d}),g(l,d)},[g]),G=t=>{I(t)},_=()=>{if(x!==null){const t=x.getPlace();if(t.geometry){const l={lat:t.geometry.location.lat(),lng:t.geometry.location.lng()};A(l),j(l),p(t.formatted_address);let d="";if(t.address_components){for(const n of t.address_components)if(n.types.includes("locality")){d=n.long_name;break}}c({lat:l.lat,lng:l.lng,address:t.formatted_address,city:d||t.formatted_address.split(",")[0]})}}},r={width:"100%",height:"300px",borderRadius:"24px"};return N?e.jsx("div",{className:"p-4 bg-red-50 text-red-500 rounded-[24px]",children:i("Error loading Google Maps")}):v?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"relative group",children:[e.jsx("div",{className:"absolute left-5 top-1/2 -translate-y-1/2 text-gray-muted group-focus-within:text-gold-accent transition-colors",children:e.jsx(Q,{className:"w-5 h-5"})}),e.jsx($,{onLoad:G,onPlaceChanged:_,options:{componentRestrictions:{country:"ch"}},children:e.jsx("input",{type:"text",placeholder:i("Search for a location..."),className:"w-full pl-14 pr-6 py-4 bg-oflem-cream border-gray-border rounded-full text-sm font-bold focus:border-gold-accent focus:ring-0 transition-all shadow-sm",value:u,onChange:t=>p(t.target.value),onKeyDown:t=>t.key==="Enter"&&t.preventDefault()})})]}),e.jsx("div",{className:"rounded-[24px] overflow-hidden border border-gray-border shadow-sm",children:e.jsx(z,{mapContainerStyle:r,center:S,zoom:y?15:8,onClick:k,options:{disableDefaultUI:!0,zoomControl:!0,mapId:"DEMO_MAP_ID",styles:[{featureType:"all",elementType:"geometry",stylers:[{color:"#f5f5f5"}]},{featureType:"water",elementType:"geometry",stylers:[{color:"#e9e9e9"}]}]},children:y&&e.jsx(K,{position:y})})}),y&&e.jsxs("div",{className:"flex items-center gap-2 p-4 bg-gold-accent/5 rounded-[20px] border border-gold-accent/10",children:[e.jsx(U,{className:"w-5 h-5 text-gold-accent flex-shrink-0"}),e.jsx("p",{className:"text-xs font-bold text-gray-muted truncate",children:u})]})]}):e.jsx("div",{className:"h-[300px] w-full bg-gray-100 animate-pulse rounded-[24px] flex items-center justify-center text-gray-400 font-bold",children:i("Loading maps...")})}function ie({prefillTitle:c="",aiTitle:m=null}){const{t:s}=L(),{auth:i}=O().props,[y,A]=o.useState(!1),[u,p]=o.useState(!1),[S,j]=o.useState(""),[x,I]=o.useState(!1),[v,N]=o.useState(!1),[g,k]=o.useState("quick"),[G,_]=o.useState(""),{data:r,setData:t,post:l,processing:d,errors:n,reset:E}=T({title:m||c,description:"",location:i.user?.location_address||"",lat:i.user?.location_lat||"",lng:i.user?.location_lng||"",exact_address:"",date_time:"",budget:"",price_type:"fixed",additional_details:""}),w=async()=>{if(r.title){N(!0),_("");try{const a=await D.post(route("api.missions.ai-rewrite"),{title:r.title,description:r.description});t(b=>({...b,description:a.data.improved_description||""}))}catch(a){console.error("AI Description Generation Error:",a),_(s("Could not generate description. Please try again."))}finally{N(!1)}}},C=async a=>{p(!0),j("");try{return(await D.post(route("api.moderation.check"),{content:a})).data.is_clean?!0:(j(s("Content violates moderation rules.")),!1)}catch{return!0}finally{p(!1)}},M=async a=>{if(a.preventDefault(),!r.location&&!r.lat&&!r.lng){j(s("Please select a location for your mission."));return}if(await C(r.title+" "+r.description)){if(!i.user){q.post(route("api.missions.store"),r);return}l(route("api.missions.store"),{onSuccess:()=>E()})}},P=[10,20,30];return e.jsxs(R,{header:s("Post a Mission"),maxWidth:"max-w-2xl",showFooter:!0,children:[e.jsx(H,{title:s("Create Mission")}),e.jsxs("div",{className:"bg-white rounded-[40px] p-8 md:p-12 shadow-sm border border-gray-border",children:[e.jsx("div",{className:"mb-8 text-center",children:e.jsx("p",{className:"text-gray-muted font-medium",children:s("Quick and simple.")})}),e.jsxs("form",{onSubmit:M,className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx(f,{htmlFor:"title",value:s("What do you need help with?"),className:"text-sm font-bold mb-3"}),e.jsx(F,{id:"title",type:"text",value:r.title,className:"w-full text-lg",onChange:a=>t("title",a.target.value),placeholder:s("e.g. Take out my trash"),required:!0}),e.jsx(h,{message:n.title||S,className:"mt-2"})]}),e.jsxs("div",{children:[e.jsx(f,{value:s("How much are you offering?"),className:"text-sm font-bold mb-3"}),e.jsxs("div",{className:"flex flex-wrap gap-3 mb-4",children:[P.map(a=>e.jsxs("button",{type:"button",onClick:()=>{t("budget",a.toString()),k("quick")},className:`px-6 py-3 rounded-full text-sm font-bold transition-all border-2 ${r.budget===a.toString()&&g==="quick"?"border-primary-black bg-primary-black text-white shadow-md scale-105":"border-gray-border bg-white text-gray-700 hover:border-gray-400"}`,children:[a," CHF"]},a)),e.jsx("button",{type:"button",onClick:()=>{k("custom")},className:`px-6 py-3 rounded-full text-sm font-bold transition-all border-2 ${g==="custom"?"border-primary-black bg-primary-black text-white shadow-md scale-105":"border-gray-border bg-white text-gray-700 hover:border-gray-400"}`,children:s("Other")})]}),g==="custom"&&e.jsxs("div",{className:"relative max-w-xs",children:[e.jsx("input",{id:"budget",type:"number",value:r.budget,className:"w-full bg-white border-2 border-gray-border rounded-2xl py-3 pl-14 pr-6 text-lg font-bold text-primary-black focus:border-primary-black focus:ring-0 transition-all",onChange:a=>t("budget",a.target.value),placeholder:"0",required:!0}),e.jsx("span",{className:"absolute left-5 top-1/2 -translate-y-1/2 font-bold text-gray-muted text-sm",children:"CHF"})]}),e.jsx(h,{message:n.budget,className:"mt-2"})]}),e.jsxs("div",{children:[e.jsx(f,{value:s("Where?"),className:"text-sm font-bold mb-3"}),e.jsx(Z,{onLocationSelect:a=>{t(b=>({...b,location:a.city,lat:a.lat,lng:a.lng,exact_address:a.address}))},initialAddress:r.exact_address||r.location}),e.jsx(h,{message:n.location||n.lat||n.lng,className:"mt-2"})]}),e.jsxs("div",{className:"pt-4",children:[e.jsxs("button",{type:"button",onClick:()=>I(!x),className:"text-sm font-bold text-gray-600 hover:text-primary-black transition-colors flex items-center gap-2",children:[e.jsx("span",{children:x?"â–¼":"â–¶"}),s("More options")]}),x&&e.jsxs("div",{className:"mt-6 space-y-6 p-6 bg-gray-50 rounded-3xl",children:[e.jsxs("div",{children:[e.jsx(f,{htmlFor:"description",value:s("Description (optional)"),className:"text-sm font-bold mb-3"}),e.jsxs("div",{className:"relative",children:[e.jsx("textarea",{id:"description",value:r.description,className:"w-full bg-white border-gray-border rounded-2xl p-4 text-sm font-medium focus:border-primary-black focus:ring-0 min-h-[120px] transition-all",onChange:a=>t("description",a.target.value),placeholder:s("Add more details if needed...")}),e.jsx("button",{type:"button",onClick:w,disabled:v||!r.title,className:"absolute bottom-3 right-3 text-xs bg-gray-100 hover:bg-gray-200 text-gray-700 px-3 py-1.5 rounded-full font-bold transition-all flex items-center gap-2 border border-gray-200",title:s("Generate description with AI"),children:v?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"w-3 h-3 border-2 border-gray-400 border-t-primary-black rounded-full animate-spin"}),s("Generating...")]}):e.jsxs(e.Fragment,{children:["âœ¨ ",s("Auto-fill")]})})]}),e.jsx(h,{message:n.description,className:"mt-2"})]}),e.jsxs("div",{children:[e.jsx(f,{htmlFor:"date_time",value:s("When? (optional)"),className:"text-sm font-bold mb-3"}),e.jsx(F,{id:"date_time",type:"datetime-local",value:r.date_time,className:"w-full",min:new Date().toISOString().slice(0,16),onChange:a=>t("date_time",a.target.value)}),e.jsx(h,{message:n.date_time,className:"mt-2"})]}),e.jsxs("div",{children:[e.jsx(f,{htmlFor:"exact_address",value:s("Exact address (optional)"),className:"text-sm font-bold mb-3"}),e.jsx(F,{id:"exact_address",type:"text",value:r.exact_address,className:"w-full",onChange:a=>t("exact_address",a.target.value),placeholder:s("Street, number, apartment...")}),e.jsxs("p",{className:"mt-2 text-xs text-gray-500 flex items-center gap-1",children:["ðŸ”’ ",s("Only shared with your MotivÃ© after confirmation")]}),e.jsx(h,{message:n.exact_address,className:"mt-2"})]})]})]}),e.jsxs("div",{className:"pt-6",children:[e.jsx("button",{type:"submit",disabled:d||u||!r.title.trim()||!r.budget,className:`w-full py-5 font-black rounded-full transition-all shadow-xl text-lg flex items-center justify-center gap-3 active:scale-[0.98] ${!r.title.trim()||!r.budget||d||u?"bg-gray-200 text-gray-400 cursor-not-allowed shadow-none":"bg-primary-black text-white hover:bg-black"}`,children:d||u?e.jsx("span",{className:"w-6 h-6 border-4 border-gold-accent border-t-white rounded-full animate-spin"}):e.jsxs(e.Fragment,{children:[s("Find a MotivÃ©")," ðŸš€"]})}),e.jsxs("p",{className:"mt-4 text-center text-xs text-gray-500 font-medium",children:["ðŸ”’ ",s("Your payment is protected. You only pay when the job is done.")]})]})]})]})]})}export{ie as default};
