import{a as t,j as e,u as Z,H as U}from"./app-QnVUizLf.js";import{A as W}from"./AuthSplitLayout-DULam4K7.js";import{u as G}from"./useTranslation-x70bPv3T.js";import{u as Y,G as Q,A as q,C as J}from"./AdvancedMarker-DvaqfVld.js";import{F as X}from"./MapPinIcon-ns8Y2KQG.js";import{I as V}from"./InputError-ChJ8MzTF.js";import{P as ee}from"./PrimaryButton-BLT60-sn.js";import{B as te}from"./BackButton-BQnzIQ-V.js";function oe({title:x,titleId:i,...d},b){return t.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:b,"aria-labelledby":i},d),x?t.createElement("title",{id:i},x):null,t.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 6.75V15m6-6v8.25m.503 3.498 4.875-2.437c.381-.19.622-.58.622-1.006V4.82c0-.836-.88-1.38-1.628-1.006l-3.869 1.934c-.317.159-.69.159-1.006 0L9.503 3.252a1.125 1.125 0 0 0-1.006 0L3.622 5.689C3.24 5.88 3 6.27 3 6.695V19.18c0 .836.88 1.38 1.628 1.006l3.869-1.934c.317-.159.69-.159 1.006 0l4.994 2.497c.317.158.69.158 1.006 0Z"}))}const re=t.forwardRef(oe),ae=["places"];function le({role:x,onLocationSelect:i,defaultMethod:d="zipcode",defaultZipCode:b="",defaultRadius:N=5}){const{t:r}=G(),[l,j]=t.useState(d),[c,g]=t.useState(b),[s,k]=t.useState(N),[n,h]=t.useState(null),[w,E]=t.useState(""),[v,m]=t.useState(!1),[z,f]=t.useState(null),[O,A]=t.useState({lat:48.8566,lng:2.3522}),[C,_]=t.useState(null),[se,ne]=t.useState(null),{isLoaded:P,loadError:F}=Y({googleMapsApiKey:"AIzaSyAaeyO3ffYCdUpAHU0kQx3TsHGhlbaIgkA",libraries:ae}),R={client:"Votre zone de confort ?",provider:"Votre zone d'intervention ?",both:"Votre périmètre d'action ?"},$=R[x]||R.both,L=t.useCallback((o,a)=>{window.google&&window.google.maps&&new window.google.maps.Geocoder().geocode({location:{lat:o,lng:a}},(u,y)=>{if(y==="OK"&&u[0]){const I=u[0].formatted_address;E(I);const K=u[0].address_components;let S="";for(const D of K)if(D.types.includes("postal_code")){S=D.long_name;break}return S&&g(S),I}})},[]),M=t.useCallback(o=>{const a=o.latLng.lat(),p=o.latLng.lng(),u={lat:a,lng:p};_(u),h(u),L(a,p)},[L]);t.useEffect(()=>{n&&i&&i({method:l,zip_code:l==="zipcode"?c:null,location_lat:n.lat,location_lng:n.lng,discovery_radius_km:s,location_address:w})},[w,n,s,l,c,i]);const T=()=>{if(m(!0),f(null),!navigator.geolocation){f(r("La géolocalisation n'est pas supportée par votre navigateur.")),m(!1);return}navigator.geolocation.getCurrentPosition(o=>{const a={lat:o.coords.latitude,lng:o.coords.longitude};h(a),_(a),A(a),L(a.lat,a.lng),m(!1)},o=>{f(r("Impossible d'obtenir votre position. Veuillez réessayer.")),m(!1)})},B=o=>{if(o?.preventDefault(),!c){f(r("Veuillez saisir un code postal."));return}m(!0),f(null),window.google&&window.google.maps?new window.google.maps.Geocoder().geocode({address:c,componentRestrictions:{country:"FR"}},(p,u)=>{if(u==="OK"&&p[0]){const y={lat:p[0].geometry.location.lat(),lng:p[0].geometry.location.lng()};h(y),_(y),A(y),E(p[0].formatted_address),m(!1)}else f(r("Impossible de trouver ce code postal.")),m(!1)}):(m(!1),f(r("Google Maps non chargé.")))},H={width:"100%",height:"300px",borderRadius:"1.5rem",marginTop:"1rem"};return e.jsxs("div",{className:"space-y-6",children:[e.jsx("h2",{className:"text-2xl font-black text-oflem-charcoal text-center",children:r($)}),e.jsxs("div",{className:"grid grid-cols-2 gap-3 lg:gap-4",children:[e.jsxs("button",{type:"button",onClick:()=>j("gps"),className:`
                        p-3 lg:p-4 rounded-[24px] border-2 transition-all duration-300
                        ${l==="gps"?"border-oflem-terracotta bg-gradient-to-br from-oflem-terracotta to-oflem-terracotta-light/10":"border-gray-border/50 bg-white hover:border-oflem-terracotta/50"}
                    `,children:[e.jsx(X,{className:"w-6 h-6 lg:w-8 lg:h-8 mx-auto mb-2 text-oflem-terracotta"}),e.jsx("p",{className:"text-[10px] lg:text-sm font-bold text-oflem-charcoal",children:r("GPS")})]}),e.jsxs("button",{type:"button",onClick:()=>j("zipcode"),className:`
                        p-3 lg:p-4 rounded-[24px] border-2 transition-all duration-300
                        ${l==="zipcode"?"border-oflem-terracotta bg-gradient-to-br from-oflem-terracotta to-oflem-terracotta-light/10":"border-gray-border/50 bg-white hover:border-oflem-terracotta/50"}
                    `,children:[e.jsx(re,{className:"w-6 h-6 lg:w-8 lg:h-8 mx-auto mb-2 text-oflem-terracotta"}),e.jsx("p",{className:"text-[10px] lg:text-sm font-bold text-oflem-charcoal",children:r("Code postal")})]})]}),l==="gps"&&e.jsx("div",{className:"space-y-4",children:e.jsx("button",{type:"button",onClick:T,disabled:v,className:`\r
                            w-full px-6 py-4 \r
                            bg-gradient-to-br from-oflem-terracotta to-oflem-terracotta-light text-white\r
                            rounded-[24px]\r
                            font-bold text-base\r
                            hover:bg-gradient-to-br from-oflem-terracotta to-oflem-terracotta-light/90\r
                            disabled:opacity-50 disabled:cursor-not-allowed\r
                            transition-all duration-300\r
                        `,children:r(v?"Localisation...":"Obtenir ma position")})}),l==="zipcode"&&e.jsxs("div",{className:"space-y-4",children:[e.jsx("input",{type:"text",value:c,onChange:o=>g(o.target.value),onKeyDown:o=>o.key==="Enter"&&B(o),placeholder:r("Ex: 75001"),className:`\r
                            w-full px-4 py-3\r
                            bg-input-bg border border-gray-border/50\r
                            rounded-[24px]\r
                            text-oflem-charcoal text-base\r
                            placeholder:text-gray-muted/60\r
                            focus:outline-none focus:ring-2 focus:ring-oflem-terracotta/30 focus:border-oflem-terracotta\r
                            transition-all duration-200\r
                        `}),e.jsx("button",{type:"button",onClick:B,disabled:v||!c,className:`\r
                            w-full px-6 py-4\r
                            bg-gradient-to-br from-oflem-terracotta to-oflem-terracotta-light text-white\r
                            rounded-[24px]\r
                            font-bold text-base\r
                            hover:bg-gradient-to-br from-oflem-terracotta to-oflem-terracotta-light/90\r
                            disabled:opacity-50 disabled:cursor-not-allowed\r
                            transition-all duration-300\r
                        `,children:r(v?"Recherche...":"Valider")})]}),z&&e.jsx("div",{className:"p-4 bg-red-50 border border-red-200 rounded-[24px]",children:e.jsx("p",{className:"text-sm text-red-600",children:z})}),n&&e.jsxs("div",{className:"space-y-4 p-6 bg-gradient-to-br from-oflem-terracotta to-oflem-terracotta-light/5 rounded-[24px] border border-oflem-terracotta/30",children:[e.jsxs("div",{className:"flex items-center justify-center gap-2 text-green-600",children:[e.jsx("svg",{className:"w-5 h-5",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z",clipRule:"evenodd"})}),e.jsx("span",{className:"text-sm font-bold",children:r("Position confirmée")})]}),w&&e.jsx("div",{className:"w-full px-4 py-3 bg-white border border-gray-border/50 rounded-[16px] text-center",children:e.jsx("p",{className:"text-sm text-gray-700 font-medium",children:w})}),e.jsx("div",{className:"rounded-[24px] overflow-hidden border border-gray-border relative",children:P?e.jsx(Q,{mapContainerStyle:H,center:C||O,zoom:12,onClick:M,options:{disableDefaultUI:!0,zoomControl:!1,mapId:"DEMO_MAP_ID",styles:[{featureType:"all",elementType:"geometry",stylers:[{color:"#f5f5f5"}]}]},children:C&&e.jsxs(e.Fragment,{children:[e.jsx(q,{position:C,draggable:!0,onDragEnd:M}),e.jsx(J,{center:C,radius:s*1e3,options:{strokeColor:"#C57B67",strokeOpacity:1,strokeWeight:3,fillColor:"#C57B67",fillOpacity:.2,clickable:!1,editable:!1,draggable:!1}},`circle-${s}`)]})}):e.jsx("div",{className:"w-full h-[300px] bg-gray-100 flex items-center justify-center italic text-gray-400",children:F?"Error loading maps":"Loading map..."})}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"block text-sm font-bold text-oflem-charcoal",children:[r("Rayon de découverte:")," ",e.jsxs("span",{className:"text-oflem-terracotta",children:[s," km"]})]}),e.jsx("input",{type:"range",min:"5",max:"50",value:s,onChange:o=>k(parseInt(o.target.value)),className:"w-full h-2 bg-gray-200 rounded-full appearance-none cursor-pointer slider",style:{background:`linear-gradient(to right, #C57B67 0%, #C57B67 ${(s-5)/45*100}%, #E5E5E5 ${(s-5)/45*100}%, #E5E5E5 100%)`}}),e.jsxs("div",{className:"flex justify-between text-xs text-gray-muted font-medium",children:[e.jsx("span",{children:"5 km"}),e.jsx("span",{children:"50 km"})]})]})]})]})}function xe({user:x,role:i}){const{t:d}=G(),[b,N]=t.useState(null),{data:r,setData:l,post:j,processing:c,errors:g}=Z({method:"gps",location_lat:null,location_lng:null,zip_code:null,location_address:null,discovery_radius_km:5}),s=t.useCallback(n=>{N(n),l(h=>({...h,...n}))},[l]),k=n=>{n.preventDefault(),j(route("auth.complete-location.store"))};return e.jsxs(W,{heroImage:"/images/illustrations/login-hero.svg",bgAccentClass:"bg-cream-accent",children:[e.jsx(U,{title:d("Location")}),e.jsx("div",{className:"flex items-center mb-8",children:e.jsx(te,{href:route("auth.select-role"),className:"text-sm",children:d("Back")})}),e.jsxs("form",{onSubmit:k,className:"space-y-8",children:[e.jsx(le,{role:i||x?.role_type,onLocationSelect:s,defaultRadius:5}),g.location_lat&&e.jsx(V,{message:g.location_lat}),g.zip_code&&e.jsx(V,{message:g.zip_code}),e.jsx(ee,{type:"submit",className:"w-full",disabled:c||!b,processing:c,children:d("Confirm my area")})]}),e.jsx("div",{className:"mt-6 p-4 bg-gradient-to-br from-oflem-terracotta to-oflem-terracotta-light/5 rounded-[24px] border border-oflem-terracotta/20",children:e.jsx("p",{className:"text-xs text-gray-muted text-center",children:d("Your location is only used to connect you with local opportunities.")})})]})}export{xe as default};
