import{a as p,u as _,j as e,H as C,L as h,c as f}from"./app-Be0iEcFh.js";import{A as E}from"./AuthenticatedLayout-B3Y457RM.js";import{u as F}from"./useTranslation-DrEBiptJ.js";import{T as y}from"./TextInput-ja_45eS9.js";import{I as n}from"./InputLabel-Rgpz2q6s.js";import{I as d}from"./InputError-DzROeIIs.js";import"./Header-D61nqR7k.js";import"./transition-DKONF1vP.js";import"./Footer-_6-fecJP.js";function B({mission:r}){const{t}=F(),[c,x]=p.useState(!1),[j,g]=p.useState(""),{data:a,setData:l,patch:v,processing:m,errors:o}=_({title:r.title||"",description:r.description||"",budget:r.budget||"",date_time:r.date_time?r.date_time.slice(0,16):"",category:r.category||""}),w=async s=>{x(!0),g("");try{return(await f.post(route("api.moderation.check"),{content:s})).data.is_clean?!0:(g(t("Content violates moderation rules.")),!1)}catch{return!0}finally{x(!1)}},[u,b]=p.useState(!1),N=async()=>{if(a.title){b(!0);try{const s=await f.post(route("api.missions.ai-rewrite"),{title:a.title,description:a.description});l(i=>({...i,title:s.data.improved_title||i.title,description:s.data.improved_description||i.description}))}catch(s){console.error("AI Rewrite Error:",s)}finally{b(!1)}}},k=async s=>{s.preventDefault(),await w(a.title+" "+a.description)&&v(route("missions.update",r.id))};return e.jsxs(E,{header:t("Edit Mission"),maxWidth:"max-w-3xl",showFooter:!0,children:[e.jsx(C,{title:t("Edit Mission")}),e.jsxs("div",{className:"bg-white rounded-[40px] p-8 md:p-12 shadow-sm border border-gray-border",children:[e.jsxs("div",{className:"mb-10",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-2xl font-black text-primary-black",children:t("Edit Your Mission")}),e.jsxs(h,{href:route("missions.show",r.id),className:"px-4 py-2 bg-gray-100 text-gray-700 font-bold rounded-full hover:bg-gray-200 transition-all text-sm",children:["← ",t("Back to Details")]})]}),r.offers&&r.offers.length>0&&e.jsx("div",{className:"bg-yellow-50 border-l-4 border-yellow-400 p-4 rounded-lg",children:e.jsxs("p",{className:"text-sm font-bold text-yellow-800",children:["⚠️ ",t("This mission has received offers. Editing may affect existing offers.")]})})]}),e.jsxs("form",{onSubmit:k,className:"space-y-8",children:[e.jsxs("div",{children:[e.jsx(n,{htmlFor:"title",value:t("Mission title"),className:"text-xs uppercase tracking-widest font-black mb-3"}),e.jsx(y,{id:"title",type:"text",value:a.title,className:"w-full",onChange:s=>l("title",s.target.value),placeholder:t("e.g. Need help moving a sofa"),required:!0}),e.jsx(d,{message:o.title||j,className:"mt-2"})]}),e.jsxs("div",{className:"relative group/desc",children:[e.jsxs("div",{className:"flex justify-between items-center mb-3",children:[e.jsx(n,{htmlFor:"description",value:t("Description"),className:"text-xs uppercase tracking-widest font-black"}),a.description&&a.description.length>5&&e.jsxs("button",{type:"button",onClick:N,disabled:u,className:"inline-flex items-center gap-2 px-4 py-2 bg-gradient-to-r from-gold-accent to-[#D4AF37] text-white text-[11px] font-black uppercase tracking-widest rounded-full shadow-[0_4px_15px_rgba(212,175,55,0.3)] hover:shadow-[0_6px_20px_rgba(212,175,55,0.4)] hover:scale-105 active:scale-95 transition-all duration-300",children:[u?e.jsx("span",{className:"w-3 h-3 border-2 border-white/30 border-t-white rounded-full animate-spin"}):e.jsx("span",{className:"text-sm",children:"✨"}),t(u?"Polishing...":"Help me write")]})]}),e.jsx("textarea",{id:"description",value:a.description,className:"w-full bg-oflem-cream border-gray-border rounded-[24px] p-6 text-sm font-medium focus:border-gold-accent focus:ring-0 min-h-[180px] transition-all",onChange:s=>l("description",s.target.value),placeholder:t("Provide more details about your mission...")}),e.jsx(d,{message:o.description,className:"mt-2"})]}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-8",children:[e.jsxs("div",{children:[e.jsx(n,{htmlFor:"budget",value:t("Budget (CHF)"),className:"text-xs uppercase tracking-widest font-black mb-3"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{id:"budget",type:"number",value:a.budget,className:"w-full bg-white border-2 border-gray-border rounded-[20px] py-4 pl-16 pr-6 text-xl font-black text-primary-black focus:border-gold-accent focus:ring-0 transition-all",onChange:s=>l("budget",s.target.value),placeholder:"0"}),e.jsx("span",{className:"absolute left-6 top-1/2 -translate-y-1/2 font-black text-gray-muted text-sm",children:"CHF"})]}),e.jsx(d,{message:o.budget,className:"mt-2"})]}),e.jsxs("div",{children:[e.jsx(n,{htmlFor:"date_time",value:t("Date & Time"),className:"text-xs uppercase tracking-widest font-black mb-3"}),e.jsx(y,{id:"date_time",type:"datetime-local",value:a.date_time,className:"w-full",min:new Date().toISOString().slice(0,16),onChange:s=>l("date_time",s.target.value)}),e.jsx(d,{message:o.date_time,className:"mt-2"})]})]}),e.jsx("div",{className:"bg-blue-50 border-l-4 border-blue-400 p-4 rounded-lg",children:e.jsxs("p",{className:"text-xs font-bold text-blue-800",children:["ℹ️ ",t("Location and price type cannot be changed after mission creation.")]})}),e.jsxs("div",{className:"flex gap-4 pt-6",children:[e.jsx(h,{href:route("missions.show",r.id),className:"flex-1 py-5 bg-gray-100 text-gray-700 font-black rounded-full hover:bg-gray-200 transition-all text-center",children:t("Cancel")}),e.jsx("button",{type:"submit",disabled:m||c||!a.title.trim(),className:`flex-1 py-5 font-black rounded-full transition-all shadow-xl text-lg flex items-center justify-center gap-3 active:scale-[0.98] ${!a.title.trim()||m||c?"bg-gray-200 text-gray-400 cursor-not-allowed shadow-none":"bg-primary-black text-white hover:bg-black"}`,children:m||c?e.jsx("span",{className:"w-6 h-6 border-4 border-gold-accent border-t-white rounded-full animate-spin"}):e.jsxs(e.Fragment,{children:["✅ ",t("Save Changes")]})})]})]})]})]})}export{B as default};
