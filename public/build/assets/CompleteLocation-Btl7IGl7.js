import{a,j as e,u as Q,H as Y}from"./app-DPEtfABQ.js";import{A as J}from"./AuthSplitLayout-DwaMTyxT.js";import{u as B}from"./useTranslation-CHcCtFEc.js";import{u as X,A as ee,G as te,M as oe,C as ae}from"./esm-BKkOlBT-.js";import{F as re,a as se}from"./MapPinIcon-CbQ-1ZqC.js";import{I as $}from"./InputError-1sTZE9hA.js";import{P as le}from"./PrimaryButton-Dgc-1MNe.js";import"./LanguageSwitcher-CcbLJo8v.js";function ne({title:b,titleId:i,...p},h){return a.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:h,"aria-labelledby":i},p),b?a.createElement("title",{id:i},b):null,a.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 6.75V15m6-6v8.25m.503 3.498 4.875-2.437c.381-.19.622-.58.622-1.006V4.82c0-.836-.88-1.38-1.628-1.006l-3.869 1.934c-.317.159-.69.159-1.006 0L9.503 3.252a1.125 1.125 0 0 0-1.006 0L3.622 5.689C3.24 5.88 3 6.27 3 6.695V19.18c0 .836.88 1.38 1.628 1.006l3.869-1.934c.317-.159.69-.159 1.006 0l4.994 2.497c.317.158.69.158 1.006 0Z"}))}const ce=a.forwardRef(ne),de=["places"];function ie({role:b,onLocationSelect:i,defaultMethod:p="gps",defaultZipCode:h="",defaultRadius:k=10}){const{t:o}=B(),[s,y]=a.useState(p),[c,x]=a.useState(h),[l,L]=a.useState(k),[n,f]=a.useState(null),[w,_]=a.useState(""),[v,g]=a.useState(!1),[A,d]=a.useState(null),[O,S]=a.useState({lat:48.8566,lng:2.3522}),[C,N]=a.useState(null),[R,D]=a.useState(null),{isLoaded:M,loadError:F}=X({googleMapsApiKey:"AIzaSyAaeyO3ffYCdUpAHU0kQx3TsHGhlbaIgkA",libraries:de}),V={customer:"Votre zone de confort ?",performer:"Votre zone d'intervention ?",both:"Votre périmètre d'action ?"},T=V[b]||V.both,z=a.useCallback((t,r)=>{window.google&&window.google.maps&&new window.google.maps.Geocoder().geocode({location:{lat:t,lng:r}},(m,j)=>{if(j==="OK"&&m[0]){const P=m[0].formatted_address;_(P);const q=m[0].address_components;let E="";for(const G of q)if(G.types.includes("postal_code")){E=G.long_name;break}return E&&x(E),P}})},[]),I=a.useCallback(t=>{const r=t.latLng.lat(),u=t.latLng.lng(),m={lat:r,lng:u};N(m),f(m),z(r,u)},[z]);a.useEffect(()=>{n&&i&&i({method:s,zip_code:s==="zipcode"?c:null,location_lat:n.lat,location_lng:n.lng,discovery_radius_km:l,location_address:w})},[w,n,l,s,c,i]);const H=()=>{if(g(!0),d(null),!navigator.geolocation){d(o("La géolocalisation n'est pas supportée par votre navigateur.")),g(!1);return}navigator.geolocation.getCurrentPosition(t=>{const r={lat:t.coords.latitude,lng:t.coords.longitude};f(r),N(r),S(r),z(r.lat,r.lng),g(!1)},t=>{d(o("Impossible d'obtenir votre position. Veuillez réessayer.")),g(!1)})},Z=t=>{if(t?.preventDefault(),!c){d(o("Veuillez saisir un code postal."));return}g(!0),d(null),window.google&&window.google.maps?new window.google.maps.Geocoder().geocode({address:c},(u,m)=>{if(m==="OK"&&u[0]){const j={lat:u[0].geometry.location.lat(),lng:u[0].geometry.location.lng()};f(j),N(j),S(j),_(u[0].formatted_address),g(!1)}else d(o("Impossible de trouver ce code postal.")),g(!1)}):(g(!1),d(o("Google Maps non chargé.")))},K=t=>{D(t)},U=()=>{if(R!==null){const t=R.getPlace();if(t.geometry){const r={lat:t.geometry.location.lat(),lng:t.geometry.location.lng()};f(r),N(r),S(r),_(t.formatted_address||""),d(null)}else d(o("Aucun détail disponible pour cette adresse."))}},W={width:"100%",height:"300px",borderRadius:"1.5rem",marginTop:"1rem"};return e.jsxs("div",{className:"space-y-6",children:[e.jsx("h2",{className:"text-2xl font-black text-primary-black text-center",children:o(T)}),e.jsxs("div",{className:"grid grid-cols-3 gap-3 lg:gap-4",children:[e.jsxs("button",{type:"button",onClick:()=>y("gps"),className:`
                        p-3 lg:p-4 rounded-[24px] border-2 transition-all duration-300
                        ${s==="gps"?"border-gold-accent bg-gold-accent/10":"border-gray-border/50 bg-white hover:border-gold-accent/50"}
                    `,children:[e.jsx(re,{className:"w-6 h-6 lg:w-8 lg:h-8 mx-auto mb-2 text-gold-accent"}),e.jsx("p",{className:"text-[10px] lg:text-sm font-bold text-primary-black",children:o("GPS")})]}),e.jsxs("button",{type:"button",onClick:()=>y("address"),className:`
                        p-3 lg:p-4 rounded-[24px] border-2 transition-all duration-300
                        ${s==="address"?"border-gold-accent bg-gold-accent/10":"border-gray-border/50 bg-white hover:border-gold-accent/50"}
                    `,children:[e.jsx(se,{className:"w-6 h-6 lg:w-8 lg:h-8 mx-auto mb-2 text-gold-accent"}),e.jsx("p",{className:"text-[10px] lg:text-sm font-bold text-primary-black",children:o("Adresse")})]}),e.jsxs("button",{type:"button",onClick:()=>y("zipcode"),className:`
                        p-3 lg:p-4 rounded-[24px] border-2 transition-all duration-300
                        ${s==="zipcode"?"border-gold-accent bg-gold-accent/10":"border-gray-border/50 bg-white hover:border-gold-accent/50"}
                    `,children:[e.jsx(ce,{className:"w-6 h-6 lg:w-8 lg:h-8 mx-auto mb-2 text-gold-accent"}),e.jsx("p",{className:"text-[10px] lg:text-sm font-bold text-primary-black",children:o("Code postal")})]})]}),s==="gps"&&e.jsx("div",{className:"space-y-4",children:e.jsx("button",{type:"button",onClick:H,disabled:v,className:`\r
                            w-full px-6 py-4 \r
                            bg-gold-accent text-white\r
                            rounded-[24px]\r
                            font-bold text-base\r
                            hover:bg-gold-accent/90\r
                            disabled:opacity-50 disabled:cursor-not-allowed\r
                            transition-all duration-300\r
                        `,children:o(v?"Localisation...":"Obtenir ma position")})}),s==="address"&&e.jsx("div",{className:"space-y-4",children:M?e.jsx(ee,{onLoad:K,onPlaceChanged:U,children:e.jsx("input",{type:"text",placeholder:o("Saisissez votre adresse..."),className:`\r
                                    w-full px-4 py-3\r
                                    bg-input-bg border border-gray-border/50\r
                                    rounded-[24px]\r
                                    text-primary-black text-base\r
                                    placeholder:text-gray-muted/60\r
                                    focus:outline-none focus:ring-2 focus:ring-gold-accent/30 focus:border-gold-accent\r
                                    transition-all duration-200\r
                                `})}):e.jsx("div",{className:"w-full px-4 py-3 bg-gray-100 rounded-[24px] text-center italic text-gray-400",children:o("Chargement de la recherche...")})}),s==="zipcode"&&e.jsxs("div",{className:"space-y-4",children:[e.jsx("input",{type:"text",value:c,onChange:t=>x(t.target.value),placeholder:o("Ex: 75001"),className:`\r
                            w-full px-4 py-3\r
                            bg-input-bg border border-gray-border/50\r
                            rounded-[24px]\r
                            text-primary-black text-base\r
                            placeholder:text-gray-muted/60\r
                            focus:outline-none focus:ring-2 focus:ring-gold-accent/30 focus:border-gold-accent\r
                            transition-all duration-200\r
                        `}),e.jsx("button",{type:"button",onClick:Z,disabled:v||!c,className:`\r
                            w-full px-6 py-4\r
                            bg-gold-accent text-white\r
                            rounded-[24px]\r
                            font-bold text-base\r
                            hover:bg-gold-accent/90\r
                            disabled:opacity-50 disabled:cursor-not-allowed\r
                            transition-all duration-300\r
                        `,children:o(v?"Recherche...":"Valider")})]}),A&&e.jsx("div",{className:"p-4 bg-red-50 border border-red-200 rounded-[24px]",children:e.jsx("p",{className:"text-sm text-red-600",children:A})}),n&&e.jsxs("div",{className:"space-y-4 p-6 bg-gold-accent/5 rounded-[24px] border border-gold-accent/30",children:[e.jsxs("div",{className:"flex items-center justify-center gap-2 text-green-600",children:[e.jsx("svg",{className:"w-5 h-5",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z",clipRule:"evenodd"})}),e.jsx("span",{className:"text-sm font-bold",children:o("Position confirmée")})]}),w&&e.jsx("div",{className:"w-full px-4 py-3 bg-white border border-gray-border/50 rounded-[16px] text-center",children:e.jsx("p",{className:"text-sm text-gray-700 font-medium",children:w})}),e.jsx("div",{className:"rounded-[24px] overflow-hidden border border-gray-border relative",children:M?e.jsx(te,{mapContainerStyle:W,center:C||O,zoom:12,onClick:I,options:{disableDefaultUI:!0,zoomControl:!1,styles:[{featureType:"all",elementType:"geometry",stylers:[{color:"#f5f5f5"}]}]},children:C&&e.jsxs(e.Fragment,{children:[e.jsx(oe,{position:C,draggable:!0,onDragEnd:I}),e.jsx(ae,{center:C,radius:l*1e3,options:{strokeColor:"#C57B67",strokeOpacity:1,strokeWeight:3,fillColor:"#C57B67",fillOpacity:.2,clickable:!1,editable:!1,draggable:!1}},`circle-${l}`)]})}):e.jsx("div",{className:"w-full h-[300px] bg-gray-100 flex items-center justify-center italic text-gray-400",children:F?"Error loading maps":"Loading map..."})}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"block text-sm font-bold text-primary-black",children:[o("Rayon de découverte:")," ",e.jsxs("span",{className:"text-gold-accent",children:[l," km"]})]}),e.jsx("input",{type:"range",min:"5",max:"50",value:l,onChange:t=>L(parseInt(t.target.value)),className:"w-full h-2 bg-gray-200 rounded-full appearance-none cursor-pointer slider",style:{background:`linear-gradient(to right, #C57B67 0%, #C57B67 ${(l-5)/45*100}%, #E5E5E5 ${(l-5)/45*100}%, #E5E5E5 100%)`}}),e.jsxs("div",{className:"flex justify-between text-xs text-gray-muted font-medium",children:[e.jsx("span",{children:"5 km"}),e.jsx("span",{children:"50 km"})]})]})]})]})}function ye({user:b,role:i}){const{t:p}=B(),[h,k]=a.useState(null),{data:o,setData:s,post:y,processing:c,errors:x}=Q({method:"gps",location_lat:null,location_lng:null,zip_code:null,location_address:null,discovery_radius_km:10}),l=a.useCallback(n=>{k(n),s(f=>({...f,...n}))},[s]),L=n=>{n.preventDefault(),y(route("auth.complete-location.store"))};return e.jsxs(J,{heroImage:"/images/illustrations/login-hero.svg",bgAccentClass:"bg-cream-accent",children:[e.jsx(Y,{title:p("Localisation")}),e.jsxs("form",{onSubmit:L,className:"space-y-8",children:[e.jsx(ie,{role:i||b?.role_type,onLocationSelect:l,defaultRadius:10}),x.location_lat&&e.jsx($,{message:x.location_lat}),x.zip_code&&e.jsx($,{message:x.zip_code}),e.jsx(le,{type:"submit",className:"w-full",disabled:c||!h,children:p(c?"Enregistrement...":"Confirmer ma zone")})]}),e.jsx("div",{className:"mt-6 p-4 bg-gold-accent/5 rounded-[24px] border border-gold-accent/20",children:e.jsx("p",{className:"text-xs text-gray-muted text-center",children:p("Votre position est utilisée uniquement pour vous connecter avec des opportunités locales.")})})]})}export{ye as default};
