import{r as t,j as e,u as K,H as U}from"./app-CSj48lUn.js";import{A as W}from"./AuthSplitLayout-BOFyoxBR.js";import{u as D}from"./useTranslation-CLv7M1vF.js";import{u as q,G as Q,M as Y,C as J}from"./esm-D7gY18XV.js";import{I as O}from"./InputError-CpM9uXzD.js";import{P as X}from"./PrimaryButton-DmQoBXta.js";import"./LanguageSwitcher-Cs8TVv_x.js";function ee({title:d,titleId:n,...c},x){return t.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:x,"aria-labelledby":n},c),d?t.createElement("title",{id:n},d):null,t.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 10.5a3 3 0 1 1-6 0 3 3 0 0 1 6 0Z"}),t.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19.5 10.5c0 7.142-7.5 11.25-7.5 11.25S4.5 17.642 4.5 10.5a7.5 7.5 0 1 1 15 0Z"}))}const te=t.forwardRef(ee);function oe({title:d,titleId:n,...c},x){return t.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:x,"aria-labelledby":n},c),d?t.createElement("title",{id:n},d):null,t.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 6.75V15m6-6v8.25m.503 3.498 4.875-2.437c.381-.19.622-.58.622-1.006V4.82c0-.836-.88-1.38-1.628-1.006l-3.869 1.934c-.317.159-.69.159-1.006 0L9.503 3.252a1.125 1.125 0 0 0-1.006 0L3.622 5.689C3.24 5.88 3 6.27 3 6.695V19.18c0 .836.88 1.38 1.628 1.006l3.869-1.934c.317-.159.69-.159 1.006 0l4.994 2.497c.317.158.69.158 1.006 0Z"}))}const re=t.forwardRef(oe),ae=["places"];function ne({role:d,onLocationSelect:n,defaultMethod:c="gps",defaultZipCode:x="",defaultRadius:N=10}){const{t:o}=D(),[s,v]=t.useState(c),[p,b]=t.useState(x),[l,_]=t.useState(N),[i,w]=t.useState(null),[f,L]=t.useState(""),[k,g]=t.useState(!1),[z,h]=t.useState(null),[S,M]=t.useState({lat:48.8566,lng:2.3522}),[y,C]=t.useState(null),{isLoaded:P,loadError:F}=q({googleMapsApiKey:"AIzaSyAaeyO3ffYCdUpAHU0kQx3TsHGhlbaIgkA",libraries:ae}),A={customer:"Votre zone de confort ?",performer:"Votre zone d'intervention ?",both:"Votre périmètre d'action ?"},B=A[d]||A.both,E=t.useCallback((a,r)=>{window.google&&window.google.maps&&new window.google.maps.Geocoder().geocode({location:{lat:a,lng:r}},(m,j)=>{if(j==="OK"&&m[0]){const V=m[0].formatted_address;L(V);const H=m[0].address_components;for(const I of H)if(I.types.includes("postal_code")){I.long_name;break}return V}})},[s]),R=t.useCallback(a=>{const r=a.latLng.lat(),u=a.latLng.lng(),m={lat:r,lng:u};C(m),w(m),E(r,u),n&&n({method:s,location_lat:r,location_lng:u,discovery_radius_km:l,location_address:f})},[s,l,n,E,f]);t.useEffect(()=>{i&&n&&n({method:s,zip_code:s==="zipcode"?p:null,location_lat:i.lat,location_lng:i.lng,discovery_radius_km:l,location_address:f})},[f,i,l,s,p]);const G=()=>{if(g(!0),h(null),!navigator.geolocation){h(o("La géolocalisation n'est pas supportée par votre navigateur.")),g(!1);return}navigator.geolocation.getCurrentPosition(a=>{const r={lat:a.coords.latitude,lng:a.coords.longitude};w(r),C(r),M(r),E(r.lat,r.lng),g(!1)},a=>{h(o("Impossible d'obtenir votre position. Veuillez réessayer.")),g(!1)})},T=a=>{if(a?.preventDefault(),!p){h(o("Veuillez saisir un code postal."));return}g(!0),h(null),window.google&&window.google.maps?new window.google.maps.Geocoder().geocode({address:p},(u,m)=>{if(m==="OK"&&u[0]){const j={lat:u[0].geometry.location.lat(),lng:u[0].geometry.location.lng()};w(j),C(j),M(j),L(u[0].formatted_address),g(!1)}else h(o("Impossible de trouver ce code postal.")),g(!1)}):setTimeout(()=>{const r={lat:48.8566,lng:2.3522};w(r),C(r),L("Paris, France (Simulated)"),g(!1)},500)},Z={width:"100%",height:"300px",borderRadius:"1.5rem",marginTop:"1rem"},$={strokeColor:"#D4AF37",strokeOpacity:.8,strokeWeight:2,fillColor:"#D4AF37",fillOpacity:.1,clickable:!1,radius:l*1e3,center:y||S};return e.jsxs("div",{className:"space-y-6",children:[e.jsx("h2",{className:"text-2xl font-black text-primary-black text-center",children:o(B)}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("button",{type:"button",onClick:()=>v("gps"),className:`
                        p-4 rounded-[24px] border-2 transition-all duration-300
                        ${s==="gps"?"border-gold-accent bg-gold-accent/10":"border-gray-border/50 bg-white hover:border-gold-accent/50"}
                    `,children:[e.jsx(te,{className:"w-8 h-8 mx-auto mb-2 text-gold-accent"}),e.jsx("p",{className:"text-sm font-bold text-primary-black",children:o("Me géolocaliser")})]}),e.jsxs("button",{type:"button",onClick:()=>v("zipcode"),className:`
                        p-4 rounded-[24px] border-2 transition-all duration-300
                        ${s==="zipcode"?"border-gold-accent bg-gold-accent/10":"border-gray-border/50 bg-white hover:border-gold-accent/50"}
                    `,children:[e.jsx(re,{className:"w-8 h-8 mx-auto mb-2 text-gold-accent"}),e.jsx("p",{className:"text-sm font-bold text-primary-black",children:o("Code postal")})]})]}),s==="gps"&&e.jsx("div",{className:"space-y-4",children:e.jsx("button",{type:"button",onClick:G,disabled:k,className:`\r
                            w-full px-6 py-4 \r
                            bg-gold-accent text-white\r
                            rounded-[24px]\r
                            font-bold text-base\r
                            hover:bg-gold-accent/90\r
                            disabled:opacity-50 disabled:cursor-not-allowed\r
                            transition-all duration-300\r
                        `,children:o(k?"Localisation...":"Obtenir ma position")})}),s==="zipcode"&&e.jsxs("div",{className:"space-y-4",children:[e.jsx("input",{type:"text",value:p,onChange:a=>b(a.target.value),placeholder:o("Ex: 75001"),className:`\r
                            w-full px-4 py-3\r
                            bg-input-bg border border-gray-border/50\r
                            rounded-[24px]\r
                            text-primary-black text-base\r
                            placeholder:text-gray-muted/60\r
                            focus:outline-none focus:ring-2 focus:ring-gold-accent/30 focus:border-gold-accent\r
                            transition-all duration-200\r
                        `}),e.jsx("button",{type:"button",onClick:T,disabled:k||!p,className:`\r
                            w-full px-6 py-4\r
                            bg-gold-accent text-white\r
                            rounded-[24px]\r
                            font-bold text-base\r
                            hover:bg-gold-accent/90\r
                            disabled:opacity-50 disabled:cursor-not-allowed\r
                            transition-all duration-300\r
                        `,children:o(k?"Recherche...":"Valider")})]}),z&&e.jsx("div",{className:"p-4 bg-red-50 border border-red-200 rounded-[24px]",children:e.jsx("p",{className:"text-sm text-red-600",children:z})}),i&&e.jsxs("div",{className:"space-y-4 p-6 bg-gold-accent/5 rounded-[24px] border border-gold-accent/30",children:[e.jsxs("div",{className:"flex items-center justify-center gap-2 text-green-600",children:[e.jsx("svg",{className:"w-5 h-5",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z",clipRule:"evenodd"})}),e.jsx("span",{className:"text-sm font-bold",children:o("Position confirmée")})]}),f&&e.jsx("div",{className:"w-full px-4 py-3 bg-white border border-gray-border/50 rounded-[16px] text-center",children:e.jsx("p",{className:"text-sm text-gray-700 font-medium",children:f})}),e.jsx("div",{className:"rounded-[24px] overflow-hidden border border-gray-border relative",children:P?e.jsx(Q,{mapContainerStyle:Z,center:y||S,zoom:12,onClick:R,options:{disableDefaultUI:!0,zoomControl:!1,styles:[{featureType:"all",elementType:"geometry",stylers:[{color:"#f5f5f5"}]}]},children:y&&e.jsxs(e.Fragment,{children:[e.jsx(Y,{position:y,draggable:!0,onDragEnd:R}),e.jsx(J,{center:y,options:$})]})}):e.jsx("div",{className:"w-full h-[300px] bg-gray-100 flex items-center justify-center italic text-gray-400",children:F?"Error loading maps":"Loading map..."})}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"block text-sm font-bold text-primary-black",children:[o("Rayon de découverte:")," ",e.jsxs("span",{className:"text-gold-accent",children:[l," km"]})]}),e.jsx("input",{type:"range",min:"5",max:"50",value:l,onChange:a=>_(parseInt(a.target.value)),className:"w-full h-2 bg-gray-200 rounded-full appearance-none cursor-pointer slider",style:{background:`linear-gradient(to right, #C57B67 0%, #C57B67 ${(l-5)/45*100}%, #E5E5E5 ${(l-5)/45*100}%, #E5E5E5 100%)`}}),e.jsxs("div",{className:"flex justify-between text-xs text-gray-muted font-medium",children:[e.jsx("span",{children:"5 km"}),e.jsx("span",{children:"50 km"})]})]})]})]})}function ge({user:d,role:n}){const{t:c}=D(),[x,N]=t.useState(null),{data:o,setData:s,post:v,processing:p,errors:b}=K({method:"gps",location_lat:null,location_lng:null,zip_code:null,location_address:null,discovery_radius_km:10}),l=i=>{N(i),s({...o,...i})},_=i=>{i.preventDefault(),v(route("auth.complete-location.store"))};return e.jsxs(W,{heroImage:"/login-page-hero.svg",bgAccentClass:"bg-cream-accent",children:[e.jsx(U,{title:c("Localisation")}),e.jsxs("form",{onSubmit:_,className:"space-y-8",children:[e.jsx(ne,{role:n||d?.role_type,onLocationSelect:l,defaultRadius:10}),b.location_lat&&e.jsx(O,{message:b.location_lat}),b.zip_code&&e.jsx(O,{message:b.zip_code}),e.jsx(X,{className:"w-full",disabled:p||!x,children:c(p?"Enregistrement...":"Confirmer ma zone")})]}),e.jsx("div",{className:"mt-6 p-4 bg-gold-accent/5 rounded-[24px] border border-gold-accent/20",children:e.jsx("p",{className:"text-xs text-gray-muted text-center",children:c("Votre position est utilisée uniquement pour vous connecter avec des opportunités locales.")})})]})}export{ge as default};
