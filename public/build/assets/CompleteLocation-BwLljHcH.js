import{a as t,j as e,u as Z,H as U}from"./app-BCZRSgt0.js";import{A as W}from"./AuthSplitLayout-2gUeGmTu.js";import{u as V}from"./useTranslation-Q6xBOp6d.js";import{u as Y,G as Q,C as q}from"./esm-KT0-0QDn.js";import{A as J}from"./AdvancedMarker-T6nHOPhk.js";import{F as X}from"./MapPinIcon-JaFuHgpY.js";import{I as D}from"./InputError-C_Z71CJH.js";import{P as ee}from"./PrimaryButton-ilKsP_2K.js";import{B as te}from"./BackButton-Db3rJqeC.js";function oe({title:x,titleId:i,...d},h){return t.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:h,"aria-labelledby":i},d),x?t.createElement("title",{id:i},x):null,t.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 6.75V15m6-6v8.25m.503 3.498 4.875-2.437c.381-.19.622-.58.622-1.006V4.82c0-.836-.88-1.38-1.628-1.006l-3.869 1.934c-.317.159-.69.159-1.006 0L9.503 3.252a1.125 1.125 0 0 0-1.006 0L3.622 5.689C3.24 5.88 3 6.27 3 6.695V19.18c0 .836.88 1.38 1.628 1.006l3.869-1.934c.317-.159.69-.159 1.006 0l4.994 2.497c.317.158.69.158 1.006 0Z"}))}const ae=t.forwardRef(oe),re=["places"];function se({role:x,onLocationSelect:i,defaultMethod:d="zipcode",defaultZipCode:h="",defaultRadius:N=5}){const{t:a}=V(),[s,j]=t.useState(d),[c,g]=t.useState(h),[l,C]=t.useState(N),[n,b]=t.useState(null),[w,z]=t.useState(""),[v,m]=t.useState(!1),[A,f]=t.useState(null),[G,E]=t.useState({lat:48.8566,lng:2.3522}),[k,_]=t.useState(null),[le,ne]=t.useState(null),{isLoaded:O,loadError:P}=Y({googleMapsApiKey:"AIzaSyAaeyO3ffYCdUpAHU0kQx3TsHGhlbaIgkA",libraries:re}),F={client:"Votre zone de confort ?",provider:"Votre zone d'intervention ?",both:"Votre périmètre d'action ?"},$=F[x]||F.both,L=t.useCallback((o,r)=>{window.google&&window.google.maps&&new window.google.maps.Geocoder().geocode({location:{lat:o,lng:r}},(u,y)=>{if(y==="OK"&&u[0]){const I=u[0].formatted_address;z(I);const K=u[0].address_components;let S="";for(const R of K)if(R.types.includes("postal_code")){S=R.long_name;break}return S&&g(S),I}})},[]),M=t.useCallback(o=>{const r=o.latLng.lat(),p=o.latLng.lng(),u={lat:r,lng:p};_(u),b(u),L(r,p)},[L]);t.useEffect(()=>{n&&i&&i({method:s,zip_code:s==="zipcode"?c:null,location_lat:n.lat,location_lng:n.lng,discovery_radius_km:l,location_address:w})},[w,n,l,s,c,i]);const T=()=>{if(m(!0),f(null),!navigator.geolocation){f(a("La géolocalisation n'est pas supportée par votre navigateur.")),m(!1);return}navigator.geolocation.getCurrentPosition(o=>{const r={lat:o.coords.latitude,lng:o.coords.longitude};b(r),_(r),E(r),L(r.lat,r.lng),m(!1)},o=>{f(a("Impossible d'obtenir votre position. Veuillez réessayer.")),m(!1)})},B=o=>{if(o?.preventDefault(),!c){f(a("Veuillez saisir un code postal."));return}m(!0),f(null),window.google&&window.google.maps?new window.google.maps.Geocoder().geocode({address:c,componentRestrictions:{country:"FR"}},(p,u)=>{if(u==="OK"&&p[0]){const y={lat:p[0].geometry.location.lat(),lng:p[0].geometry.location.lng()};b(y),_(y),E(y),z(p[0].formatted_address),m(!1)}else f(a("Impossible de trouver ce code postal.")),m(!1)}):(m(!1),f(a("Google Maps non chargé.")))},H={width:"100%",height:"300px",borderRadius:"1.5rem",marginTop:"1rem"};return e.jsxs("div",{className:"space-y-6",children:[e.jsx("h2",{className:"text-2xl font-black text-oflem-charcoal text-center",children:a($)}),e.jsxs("div",{className:"grid grid-cols-2 gap-3 lg:gap-4",children:[e.jsxs("button",{type:"button",onClick:()=>j("gps"),className:`
                        p-3 lg:p-4 rounded-[24px] border-2 transition-all duration-300
                        ${s==="gps"?"border-oflem-terracotta bg-oflem-terracotta/5 shadow-elegant-glow scale-[1.02]":"border-gray-border/50 bg-white hover:border-oflem-terracotta/40 hover:shadow-elegant"}
                    `,children:[e.jsx(X,{className:"w-6 h-6 lg:w-8 lg:h-8 mx-auto mb-2 text-oflem-terracotta"}),e.jsx("p",{className:"text-[10px] lg:text-sm font-bold text-oflem-charcoal",children:a("GPS")})]}),e.jsxs("button",{type:"button",onClick:()=>j("zipcode"),className:`
                        p-3 lg:p-4 rounded-[24px] border-2 transition-all duration-300
                        ${s==="zipcode"?"border-oflem-terracotta bg-oflem-terracotta/5 shadow-elegant-glow scale-[1.02]":"border-gray-border/50 bg-white hover:border-oflem-terracotta/40 hover:shadow-elegant"}
                    `,children:[e.jsx(ae,{className:"w-6 h-6 lg:w-8 lg:h-8 mx-auto mb-2 text-oflem-terracotta"}),e.jsx("p",{className:"text-[10px] lg:text-sm font-bold text-oflem-charcoal",children:a("Code postal")})]})]}),s==="gps"&&e.jsx("div",{className:"space-y-4",children:e.jsx("button",{type:"button",onClick:T,disabled:v,className:`\r
                            w-full px-6 py-4 \r
                            btn-primary\r
                            rounded-[24px]\r
                            disabled:opacity-50 disabled:cursor-not-allowed\r
                            transition-all duration-300\r
                        `,children:a(v?"Localisation...":"Obtenir ma position")})}),s==="zipcode"&&e.jsxs("div",{className:"space-y-4",children:[e.jsx("input",{type:"text",value:c,onChange:o=>g(o.target.value),onKeyDown:o=>o.key==="Enter"&&B(o),placeholder:a("Ex: 75001"),className:`\r
                            w-full px-4 py-3\r
                            bg-input-bg border border-gray-border/50\r
                            rounded-[24px]\r
                            text-oflem-charcoal text-base\r
                            placeholder:text-gray-muted/60\r
                            focus:outline-none focus:ring-2 focus:ring-oflem-terracotta/30 focus:border-oflem-terracotta\r
                            transition-all duration-200\r
                        `}),e.jsx("button",{type:"button",onClick:B,disabled:v||!c,className:`\r
                            w-full px-6 py-4\r
                            btn-primary\r
                            rounded-[24px]\r
                            disabled:opacity-50 disabled:cursor-not-allowed\r
                            transition-all duration-300\r
                        `,children:a(v?"Recherche...":"Valider")})]}),A&&e.jsx("div",{className:"p-4 bg-red-50 border border-red-200 rounded-[24px]",children:e.jsx("p",{className:"text-sm text-red-600",children:A})}),n&&e.jsxs("div",{className:"space-y-6 elegant-capsule !bg-oflem-cream/30 !p-8 !border-oflem-terracotta/10",children:[e.jsxs("div",{className:"flex items-center justify-center gap-3",children:[e.jsx("div",{className:"w-6 h-6 bg-green-500 rounded-full flex items-center justify-center shadow-sm",children:e.jsx("svg",{className:"w-4 h-4 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"4",d:"M5 13l4 4L19 7"})})}),e.jsx("span",{className:"text-sm font-black text-oflem-charcoal uppercase tracking-wider",children:a("Position confirmée")})]}),w&&e.jsx("div",{className:"w-full px-4 py-3 bg-white border border-gray-border/50 rounded-[16px] text-center",children:e.jsx("p",{className:"text-sm text-gray-700 font-medium",children:w})}),e.jsx("div",{className:"rounded-[24px] overflow-hidden border border-gray-border relative",children:O?e.jsx(Q,{mapContainerStyle:H,center:k||G,zoom:12,onClick:M,options:{disableDefaultUI:!0,zoomControl:!1,mapId:"DEMO_MAP_ID",styles:[{featureType:"all",elementType:"geometry",stylers:[{color:"#f5f5f5"}]}]},children:k&&e.jsxs(e.Fragment,{children:[e.jsx(J,{position:k,draggable:!0,onDragEnd:M}),e.jsx(q,{center:k,radius:l*1e3,options:{strokeColor:"#FF6B35",strokeOpacity:.8,strokeWeight:2,fillColor:"#FF6B35",fillOpacity:.15,clickable:!1,editable:!1,draggable:!1}},`circle-${l}`)]})}):e.jsx("div",{className:"w-full h-[300px] bg-gray-100 flex items-center justify-center italic text-gray-400",children:P?"Error loading maps":"Loading map..."})}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"block text-sm font-bold text-oflem-charcoal",children:[a("Rayon de découverte:")," ",e.jsxs("span",{className:"text-oflem-terracotta",children:[l," km"]})]}),e.jsx("input",{type:"range",min:"5",max:"50",value:l,onChange:o=>C(parseInt(o.target.value)),className:"w-full h-2 bg-zinc-100 rounded-full appearance-none cursor-pointer slider",style:{background:`linear-gradient(to right, #FF6B35 0%, #FF6B35 ${(l-5)/45*100}%, #edf2f7 ${(l-5)/45*100}%, #edf2f7 100%)`}}),e.jsxs("div",{className:"flex justify-between text-xs text-gray-muted font-medium",children:[e.jsx("span",{children:"5 km"}),e.jsx("span",{children:"50 km"})]})]})]})]})}function he({user:x,role:i}){const{t:d}=V(),[h,N]=t.useState(null),{data:a,setData:s,post:j,processing:c,errors:g}=Z({method:"gps",location_lat:null,location_lng:null,zip_code:null,location_address:null,discovery_radius_km:5}),l=t.useCallback(n=>{N(n),s(b=>({...b,...n}))},[s]),C=n=>{n.preventDefault(),j(route("auth.complete-location.store"))};return e.jsxs(W,{heroImage:"/images/illustrations/login-hero.svg",bgAccentClass:"bg-cream-accent",children:[e.jsx(U,{title:d("Location")}),e.jsx("div",{className:"flex items-center mb-8",children:e.jsx(te,{href:route("auth.select-role"),className:"text-sm",children:d("Back")})}),e.jsxs("form",{onSubmit:C,className:"space-y-8",children:[e.jsx(se,{role:i||x?.role_type,onLocationSelect:l,defaultRadius:5}),g.location_lat&&e.jsx(D,{message:g.location_lat}),g.zip_code&&e.jsx(D,{message:g.zip_code}),e.jsx(ee,{type:"submit",className:"w-full",disabled:c||!h,processing:c,children:d("Confirm my area")})]}),e.jsx("div",{className:"elegant-capsule mt-6",children:e.jsx("p",{className:"text-xs text-oflem-charcoal font-medium text-center",children:d("Your location is only used to connect you with local opportunities.")})})]})}export{he as default};
