import{a as t,j as e,u as Z,H as U}from"./app-DD0FtuOd.js";import{A as W}from"./AuthSplitLayout-C5YyCNoI.js";import{u as D}from"./useTranslation-wqa5UC8L.js";import{u as q,G as Q,M as Y,C as J}from"./esm-DGjSOwMt.js";import{F as X}from"./MapPinIcon-GF-PEHWA.js";import{I}from"./InputError-CDMqZeRr.js";import{P as ee}from"./PrimaryButton-D-A2Or-B.js";import{B as te}from"./BackButton-DiLgEib8.js";function oe({title:x,titleId:d,...p},b){return t.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:b,"aria-labelledby":d},p),x?t.createElement("title",{id:d},x):null,t.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 6.75V15m6-6v8.25m.503 3.498 4.875-2.437c.381-.19.622-.58.622-1.006V4.82c0-.836-.88-1.38-1.628-1.006l-3.869 1.934c-.317.159-.69.159-1.006 0L9.503 3.252a1.125 1.125 0 0 0-1.006 0L3.622 5.689C3.24 5.88 3 6.27 3 6.695V19.18c0 .836.88 1.38 1.628 1.006l3.869-1.934c.317-.159.69-.159 1.006 0l4.994 2.497c.317.158.69.158 1.006 0Z"}))}const ae=t.forwardRef(oe),re=["places"];function se({role:x,onLocationSelect:d,defaultMethod:p="zipcode",defaultZipCode:b="",defaultRadius:k=10}){const{t:a}=D(),[s,y]=t.useState(p),[i,g]=t.useState(b),[n,C]=t.useState(k),[l,f]=t.useState(null),[j,S]=t.useState(""),[v,u]=t.useState(!1),[z,m]=t.useState(null),[G,E]=t.useState({lat:48.8566,lng:2.3522}),[w,N]=t.useState(null),[ne,le]=t.useState(null),{isLoaded:O,loadError:P}=q({googleMapsApiKey:"AIzaSyAaeyO3ffYCdUpAHU0kQx3TsHGhlbaIgkA",libraries:re}),R={customer:"Votre zone de confort ?",performer:"Votre zone d'intervention ?",both:"Votre périmètre d'action ?"},F=R[x]||R.both,_=t.useCallback((o,r)=>{window.google&&window.google.maps&&new window.google.maps.Geocoder().geocode({location:{lat:o,lng:r}},(c,H)=>{if(H==="OK"&&c[0]){const M=c[0].formatted_address;S(M);const K=c[0].address_components;let L="";for(const V of K)if(V.types.includes("postal_code")){L=V.long_name;break}return L&&g(L),M}})},[]),A=t.useCallback(o=>{const r=o.latLng.lat(),h=o.latLng.lng(),c={lat:r,lng:h};N(c),f(c),_(r,h)},[_]);t.useEffect(()=>{l&&d&&d({method:s,zip_code:s==="zipcode"?i:null,location_lat:l.lat,location_lng:l.lng,discovery_radius_km:n,location_address:j})},[j,l,n,s,i,d]);const $=()=>{if(u(!0),m(null),!navigator.geolocation){m(a("La géolocalisation n'est pas supportée par votre navigateur.")),u(!1);return}navigator.geolocation.getCurrentPosition(o=>{const r={lat:o.coords.latitude,lng:o.coords.longitude};f(r),N(r),E(r),_(r.lat,r.lng),u(!1)},o=>{m(a("Impossible d'obtenir votre position. Veuillez réessayer.")),u(!1)})},B=o=>{if(o?.preventDefault(),!i){m(a("Veuillez saisir un code postal."));return}u(!0),m(null),window.google&&window.google.maps?geocoder.geocode({address:i,componentRestrictions:{country:"FR"}},(r,h)=>{if(h==="OK"&&r[0]){const c={lat:r[0].geometry.location.lat(),lng:r[0].geometry.location.lng()};f(c),N(c),E(c),S(r[0].formatted_address),u(!1)}else m(a("Impossible de trouver ce code postal.")),u(!1)}):(u(!1),m(a("Google Maps non chargé.")))},T={width:"100%",height:"300px",borderRadius:"1.5rem",marginTop:"1rem"};return e.jsxs("div",{className:"space-y-6",children:[e.jsx("h2",{className:"text-2xl font-black text-primary-black text-center",children:a(F)}),e.jsxs("div",{className:"grid grid-cols-2 gap-3 lg:gap-4",children:[e.jsxs("button",{type:"button",onClick:()=>y("gps"),className:`
                        p-3 lg:p-4 rounded-[24px] border-2 transition-all duration-300
                        ${s==="gps"?"border-gold-accent bg-gold-accent/10":"border-gray-border/50 bg-white hover:border-gold-accent/50"}
                    `,children:[e.jsx(X,{className:"w-6 h-6 lg:w-8 lg:h-8 mx-auto mb-2 text-gold-accent"}),e.jsx("p",{className:"text-[10px] lg:text-sm font-bold text-primary-black",children:a("GPS")})]}),e.jsxs("button",{type:"button",onClick:()=>y("zipcode"),className:`
                        p-3 lg:p-4 rounded-[24px] border-2 transition-all duration-300
                        ${s==="zipcode"?"border-gold-accent bg-gold-accent/10":"border-gray-border/50 bg-white hover:border-gold-accent/50"}
                    `,children:[e.jsx(ae,{className:"w-6 h-6 lg:w-8 lg:h-8 mx-auto mb-2 text-gold-accent"}),e.jsx("p",{className:"text-[10px] lg:text-sm font-bold text-primary-black",children:a("Code postal")})]})]}),s==="gps"&&e.jsx("div",{className:"space-y-4",children:e.jsx("button",{type:"button",onClick:$,disabled:v,className:`\r
                            w-full px-6 py-4 \r
                            bg-gold-accent text-white\r
                            rounded-[24px]\r
                            font-bold text-base\r
                            hover:bg-gold-accent/90\r
                            disabled:opacity-50 disabled:cursor-not-allowed\r
                            transition-all duration-300\r
                        `,children:a(v?"Localisation...":"Obtenir ma position")})}),s==="zipcode"&&e.jsxs("div",{className:"space-y-4",children:[e.jsx("input",{type:"text",value:i,onChange:o=>g(o.target.value),onKeyDown:o=>o.key==="Enter"&&B(o),placeholder:a("Ex: 75001"),className:`\r
                            w-full px-4 py-3\r
                            bg-input-bg border border-gray-border/50\r
                            rounded-[24px]\r
                            text-primary-black text-base\r
                            placeholder:text-gray-muted/60\r
                            focus:outline-none focus:ring-2 focus:ring-gold-accent/30 focus:border-gold-accent\r
                            transition-all duration-200\r
                        `}),e.jsx("button",{type:"button",onClick:B,disabled:v||!i,className:`\r
                            w-full px-6 py-4\r
                            bg-gold-accent text-white\r
                            rounded-[24px]\r
                            font-bold text-base\r
                            hover:bg-gold-accent/90\r
                            disabled:opacity-50 disabled:cursor-not-allowed\r
                            transition-all duration-300\r
                        `,children:a(v?"Recherche...":"Valider")})]}),z&&e.jsx("div",{className:"p-4 bg-red-50 border border-red-200 rounded-[24px]",children:e.jsx("p",{className:"text-sm text-red-600",children:z})}),l&&e.jsxs("div",{className:"space-y-4 p-6 bg-gold-accent/5 rounded-[24px] border border-gold-accent/30",children:[e.jsxs("div",{className:"flex items-center justify-center gap-2 text-green-600",children:[e.jsx("svg",{className:"w-5 h-5",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z",clipRule:"evenodd"})}),e.jsx("span",{className:"text-sm font-bold",children:a("Position confirmée")})]}),j&&e.jsx("div",{className:"w-full px-4 py-3 bg-white border border-gray-border/50 rounded-[16px] text-center",children:e.jsx("p",{className:"text-sm text-gray-700 font-medium",children:j})}),e.jsx("div",{className:"rounded-[24px] overflow-hidden border border-gray-border relative",children:O?e.jsx(Q,{mapContainerStyle:T,center:w||G,zoom:12,onClick:A,options:{disableDefaultUI:!0,zoomControl:!1,styles:[{featureType:"all",elementType:"geometry",stylers:[{color:"#f5f5f5"}]}]},children:w&&e.jsxs(e.Fragment,{children:[e.jsx(Y,{position:w,draggable:!0,onDragEnd:A}),e.jsx(J,{center:w,radius:n*1e3,options:{strokeColor:"#C57B67",strokeOpacity:1,strokeWeight:3,fillColor:"#C57B67",fillOpacity:.2,clickable:!1,editable:!1,draggable:!1}},`circle-${n}`)]})}):e.jsx("div",{className:"w-full h-[300px] bg-gray-100 flex items-center justify-center italic text-gray-400",children:P?"Error loading maps":"Loading map..."})}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"block text-sm font-bold text-primary-black",children:[a("Rayon de découverte:")," ",e.jsxs("span",{className:"text-gold-accent",children:[n," km"]})]}),e.jsx("input",{type:"range",min:"5",max:"50",value:n,onChange:o=>C(parseInt(o.target.value)),className:"w-full h-2 bg-gray-200 rounded-full appearance-none cursor-pointer slider",style:{background:`linear-gradient(to right, #C57B67 0%, #C57B67 ${(n-5)/45*100}%, #E5E5E5 ${(n-5)/45*100}%, #E5E5E5 100%)`}}),e.jsxs("div",{className:"flex justify-between text-xs text-gray-muted font-medium",children:[e.jsx("span",{children:"5 km"}),e.jsx("span",{children:"50 km"})]})]})]})]})}function be({user:x,role:d}){const{t:p}=D(),[b,k]=t.useState(null),{data:a,setData:s,post:y,processing:i,errors:g}=Z({method:"gps",location_lat:null,location_lng:null,zip_code:null,location_address:null,discovery_radius_km:10}),n=t.useCallback(l=>{k(l),s(f=>({...f,...l}))},[s]),C=l=>{l.preventDefault(),y(route("auth.complete-location.store"))};return e.jsxs(W,{heroImage:"/images/illustrations/login-hero.svg",bgAccentClass:"bg-cream-accent",children:[e.jsx(U,{title:p("Localisation")}),e.jsx("div",{className:"flex items-center mb-8",children:e.jsx(te,{href:route("auth.select-role"),className:"text-sm",children:p("Back")})}),e.jsxs("form",{onSubmit:C,className:"space-y-8",children:[e.jsx(se,{role:d||x?.role_type,onLocationSelect:n,defaultRadius:10}),g.location_lat&&e.jsx(I,{message:g.location_lat}),g.zip_code&&e.jsx(I,{message:g.zip_code}),e.jsx(ee,{type:"submit",className:"w-full",disabled:i||!b,processing:i,children:p("Confirmer ma zone")})]}),e.jsx("div",{className:"mt-6 p-4 bg-gold-accent/5 rounded-[24px] border border-gold-accent/20",children:e.jsx("p",{className:"text-xs text-gray-muted text-center",children:p("Votre position est utilisée uniquement pour vous connecter avec des opportunités locales.")})})]})}export{be as default};
