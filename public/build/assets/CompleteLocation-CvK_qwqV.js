import{a as t,j as e,u as Z,H as U}from"./app-Be0iEcFh.js";import{A as W}from"./AuthSplitLayout-KQMbAjGe.js";import{u as D}from"./useTranslation-DrEBiptJ.js";import{u as q,G as Q,M as Y,C as J}from"./esm-DrsOG8iC.js";import{F as X}from"./MapPinIcon-BW-U1DG4.js";import{I as G}from"./InputError-DzROeIIs.js";import{P as ee}from"./PrimaryButton-DtMex5xl.js";import{B as te}from"./BackButton-CPlQCDhq.js";function oe({title:b,titleId:d,...i},f){return t.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:f,"aria-labelledby":d},i),b?t.createElement("title",{id:d},b):null,t.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 6.75V15m6-6v8.25m.503 3.498 4.875-2.437c.381-.19.622-.58.622-1.006V4.82c0-.836-.88-1.38-1.628-1.006l-3.869 1.934c-.317.159-.69.159-1.006 0L9.503 3.252a1.125 1.125 0 0 0-1.006 0L3.622 5.689C3.24 5.88 3 6.27 3 6.695V19.18c0 .836.88 1.38 1.628 1.006l3.869-1.934c.317-.159.69-.159 1.006 0l4.994 2.497c.317.158.69.158 1.006 0Z"}))}const ae=t.forwardRef(oe),re=["places"];function se({role:b,onLocationSelect:d,defaultMethod:i="zipcode",defaultZipCode:f="",defaultRadius:C=10}){const{t:a}=D(),[s,j]=t.useState(i),[c,m]=t.useState(f),[n,N]=t.useState(C),[l,h]=t.useState(null),[v,z]=t.useState(""),[w,p]=t.useState(!1),[E,x]=t.useState(null),[O,R]=t.useState({lat:48.8566,lng:2.3522}),[k,_]=t.useState(null),[ne,le]=t.useState(null),{isLoaded:P,loadError:F}=q({googleMapsApiKey:"AIzaSyAaeyO3ffYCdUpAHU0kQx3TsHGhlbaIgkA",libraries:re}),A={customer:"Votre zone de confort ?",performer:"Votre zone d'intervention ?",both:"Votre périmètre d'action ?"},$=A[b]||A.both,L=t.useCallback((o,r)=>{window.google&&window.google.maps&&new window.google.maps.Geocoder().geocode({location:{lat:o,lng:r}},(g,y)=>{if(y==="OK"&&g[0]){const V=g[0].formatted_address;z(V);const K=g[0].address_components;let S="";for(const I of K)if(I.types.includes("postal_code")){S=I.long_name;break}return S&&m(S),V}})},[]),B=t.useCallback(o=>{const r=o.latLng.lat(),u=o.latLng.lng(),g={lat:r,lng:u};_(g),h(g),L(r,u)},[L]);t.useEffect(()=>{l&&d&&d({method:s,zip_code:s==="zipcode"?c:null,location_lat:l.lat,location_lng:l.lng,discovery_radius_km:n,location_address:v})},[v,l,n,s,c,d]);const T=()=>{if(p(!0),x(null),!navigator.geolocation){x(a("La géolocalisation n'est pas supportée par votre navigateur.")),p(!1);return}navigator.geolocation.getCurrentPosition(o=>{const r={lat:o.coords.latitude,lng:o.coords.longitude};h(r),_(r),R(r),L(r.lat,r.lng),p(!1)},o=>{x(a("Impossible d'obtenir votre position. Veuillez réessayer.")),p(!1)})},M=o=>{if(o?.preventDefault(),!c){x(a("Veuillez saisir un code postal."));return}p(!0),x(null),window.google&&window.google.maps?new window.google.maps.Geocoder().geocode({address:c,componentRestrictions:{country:"FR"}},(u,g)=>{if(g==="OK"&&u[0]){const y={lat:u[0].geometry.location.lat(),lng:u[0].geometry.location.lng()};h(y),_(y),R(y),z(u[0].formatted_address),p(!1)}else x(a("Impossible de trouver ce code postal.")),p(!1)}):(p(!1),x(a("Google Maps non chargé.")))},H={width:"100%",height:"300px",borderRadius:"1.5rem",marginTop:"1rem"};return e.jsxs("div",{className:"space-y-6",children:[e.jsx("h2",{className:"text-2xl font-black text-primary-black text-center",children:a($)}),e.jsxs("div",{className:"grid grid-cols-2 gap-3 lg:gap-4",children:[e.jsxs("button",{type:"button",onClick:()=>j("gps"),className:`
                        p-3 lg:p-4 rounded-[24px] border-2 transition-all duration-300
                        ${s==="gps"?"border-gold-accent bg-gold-accent/10":"border-gray-border/50 bg-white hover:border-gold-accent/50"}
                    `,children:[e.jsx(X,{className:"w-6 h-6 lg:w-8 lg:h-8 mx-auto mb-2 text-gold-accent"}),e.jsx("p",{className:"text-[10px] lg:text-sm font-bold text-primary-black",children:a("GPS")})]}),e.jsxs("button",{type:"button",onClick:()=>j("zipcode"),className:`
                        p-3 lg:p-4 rounded-[24px] border-2 transition-all duration-300
                        ${s==="zipcode"?"border-gold-accent bg-gold-accent/10":"border-gray-border/50 bg-white hover:border-gold-accent/50"}
                    `,children:[e.jsx(ae,{className:"w-6 h-6 lg:w-8 lg:h-8 mx-auto mb-2 text-gold-accent"}),e.jsx("p",{className:"text-[10px] lg:text-sm font-bold text-primary-black",children:a("Code postal")})]})]}),s==="gps"&&e.jsx("div",{className:"space-y-4",children:e.jsx("button",{type:"button",onClick:T,disabled:w,className:`\r
                            w-full px-6 py-4 \r
                            bg-gold-accent text-white\r
                            rounded-[24px]\r
                            font-bold text-base\r
                            hover:bg-gold-accent/90\r
                            disabled:opacity-50 disabled:cursor-not-allowed\r
                            transition-all duration-300\r
                        `,children:a(w?"Localisation...":"Obtenir ma position")})}),s==="zipcode"&&e.jsxs("div",{className:"space-y-4",children:[e.jsx("input",{type:"text",value:c,onChange:o=>m(o.target.value),onKeyDown:o=>o.key==="Enter"&&M(o),placeholder:a("Ex: 75001"),className:`\r
                            w-full px-4 py-3\r
                            bg-input-bg border border-gray-border/50\r
                            rounded-[24px]\r
                            text-primary-black text-base\r
                            placeholder:text-gray-muted/60\r
                            focus:outline-none focus:ring-2 focus:ring-gold-accent/30 focus:border-gold-accent\r
                            transition-all duration-200\r
                        `}),e.jsx("button",{type:"button",onClick:M,disabled:w||!c,className:`\r
                            w-full px-6 py-4\r
                            bg-gold-accent text-white\r
                            rounded-[24px]\r
                            font-bold text-base\r
                            hover:bg-gold-accent/90\r
                            disabled:opacity-50 disabled:cursor-not-allowed\r
                            transition-all duration-300\r
                        `,children:a(w?"Recherche...":"Valider")})]}),E&&e.jsx("div",{className:"p-4 bg-red-50 border border-red-200 rounded-[24px]",children:e.jsx("p",{className:"text-sm text-red-600",children:E})}),l&&e.jsxs("div",{className:"space-y-4 p-6 bg-gold-accent/5 rounded-[24px] border border-gold-accent/30",children:[e.jsxs("div",{className:"flex items-center justify-center gap-2 text-green-600",children:[e.jsx("svg",{className:"w-5 h-5",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z",clipRule:"evenodd"})}),e.jsx("span",{className:"text-sm font-bold",children:a("Position confirmée")})]}),v&&e.jsx("div",{className:"w-full px-4 py-3 bg-white border border-gray-border/50 rounded-[16px] text-center",children:e.jsx("p",{className:"text-sm text-gray-700 font-medium",children:v})}),e.jsx("div",{className:"rounded-[24px] overflow-hidden border border-gray-border relative",children:P?e.jsx(Q,{mapContainerStyle:H,center:k||O,zoom:12,onClick:B,options:{disableDefaultUI:!0,zoomControl:!1,styles:[{featureType:"all",elementType:"geometry",stylers:[{color:"#f5f5f5"}]}]},children:k&&e.jsxs(e.Fragment,{children:[e.jsx(Y,{position:k,draggable:!0,onDragEnd:B}),e.jsx(J,{center:k,radius:n*1e3,options:{strokeColor:"#C57B67",strokeOpacity:1,strokeWeight:3,fillColor:"#C57B67",fillOpacity:.2,clickable:!1,editable:!1,draggable:!1}},`circle-${n}`)]})}):e.jsx("div",{className:"w-full h-[300px] bg-gray-100 flex items-center justify-center italic text-gray-400",children:F?"Error loading maps":"Loading map..."})}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"block text-sm font-bold text-primary-black",children:[a("Rayon de découverte:")," ",e.jsxs("span",{className:"text-gold-accent",children:[n," km"]})]}),e.jsx("input",{type:"range",min:"5",max:"50",value:n,onChange:o=>N(parseInt(o.target.value)),className:"w-full h-2 bg-gray-200 rounded-full appearance-none cursor-pointer slider",style:{background:`linear-gradient(to right, #C57B67 0%, #C57B67 ${(n-5)/45*100}%, #E5E5E5 ${(n-5)/45*100}%, #E5E5E5 100%)`}}),e.jsxs("div",{className:"flex justify-between text-xs text-gray-muted font-medium",children:[e.jsx("span",{children:"5 km"}),e.jsx("span",{children:"50 km"})]})]})]})]})}function be({user:b,role:d}){const{t:i}=D(),[f,C]=t.useState(null),{data:a,setData:s,post:j,processing:c,errors:m}=Z({method:"gps",location_lat:null,location_lng:null,zip_code:null,location_address:null,discovery_radius_km:10}),n=t.useCallback(l=>{C(l),s(h=>({...h,...l}))},[s]),N=l=>{l.preventDefault(),j(route("auth.complete-location.store"))};return e.jsxs(W,{heroImage:"/images/illustrations/login-hero.svg",bgAccentClass:"bg-cream-accent",children:[e.jsx(U,{title:i("Localisation")}),e.jsx("div",{className:"flex items-center mb-8",children:e.jsx(te,{href:route("auth.select-role"),className:"text-sm",children:i("Back")})}),e.jsxs("form",{onSubmit:N,className:"space-y-8",children:[e.jsx(se,{role:d||b?.role_type,onLocationSelect:n,defaultRadius:10}),m.location_lat&&e.jsx(G,{message:m.location_lat}),m.zip_code&&e.jsx(G,{message:m.zip_code}),e.jsx(ee,{type:"submit",className:"w-full",disabled:c||!f,processing:c,children:i("Confirmer ma zone")})]}),e.jsx("div",{className:"mt-6 p-4 bg-gold-accent/5 rounded-[24px] border border-gold-accent/20",children:e.jsx("p",{className:"text-xs text-gray-muted text-center",children:i("Votre position est utilisée uniquement pour vous connecter avec des opportunités locales.")})})]})}export{be as default};
