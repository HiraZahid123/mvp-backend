<!DOCTYPE html>
<html lang="fr-CH">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1.0"/>
  <title>Oflem — Et si vous n'aviez pas à tout faire seul ?</title>
  <meta name="description" content="Quelqu'un près de chez vous peut s'en charger. Publiez gratuitement, recevez des offres de prestataires vérifiés en Suisse romande.">
  <meta name="theme-color" content="#FF6B35">
  <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><circle cx='50' cy='50' r='50' fill='%23FF6B35'/><text x='50' y='68' text-anchor='middle' font-size='58' font-weight='900' font-family='Inter,sans-serif' fill='white'>O</text></svg>">
  <meta property="og:title" content="Oflem — Et si vous n'aviez pas à tout faire seul ?">
  <meta property="og:description" content="Quelqu'un près de chez vous peut s'en charger. Prestataires vérifiés, paiement protégé, Suisse romande.">
  <meta property="og:type" content="website">
  <link rel="preconnect" href="https://fonts.bunny.net">
  <link href="https://fonts.bunny.net/css?family=inter:400,500,600,700,800,900" rel="stylesheet">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <noscript><style>.noscript-msg{display:flex!important}</style></noscript>
<style>
*,*::before,*::after{margin:0;padding:0;box-sizing:border-box}
html{scroll-behavior:smooth;font-size:16px}
body{font-family:'Inter',-apple-system,BlinkMacSystemFont,'Segoe UI',sans-serif;line-height:1.6;color:#2d3748;background:#fff;overflow-x:hidden}
.noscript-msg{display:none;position:fixed;inset:0;z-index:99999;background:#fff;align-items:center;justify-content:center;flex-direction:column;gap:16px;padding:40px;text-align:center}
.noscript-msg h1{font-size:28px;font-weight:900;color:#1A1D3F}
:root{
  --o:#FF6B35;--ol:#ff8c5a;--og:rgba(255,107,53,0.25);
  --n:#1A1D3F;--nl:#2d3748;--g:#10b981;
  --g50:#f7fafc;--g100:#edf2f7;--g300:#e2e8f0;--g500:#718096;--g700:#4a5568;
  --r:14px;--rs:10px;--rl:20px;
  --sh:0 8px 30px rgba(0,0,0,0.10);--sho:0 8px 30px rgba(255,107,53,0.30);
}
.skip-link{position:absolute;top:-50px;left:0;background:var(--o);color:#fff;padding:10px 20px;text-decoration:none;font-weight:700;z-index:10000;transition:top .2s}
.skip-link:focus{top:0}
.sr-only{position:absolute;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0,0,0,0);white-space:nowrap;border:0}

/* Pages */
.oflem-page{display:block}.oflem-page.hidden{display:none!important}
.oflem-page.page-enter{animation:pgIn .3s ease both}
@keyframes pgIn{from{opacity:0;transform:translateY(8px)}to{opacity:1;transform:translateY(0)}}

/* Header */
.header{background:rgba(255,255,255,0.92);backdrop-filter:saturate(200%) blur(20px);-webkit-backdrop-filter:saturate(200%) blur(20px);padding:16px 0;border-bottom:1px solid rgba(0,0,0,0.05);position:sticky;top:0;z-index:100;transition:box-shadow .3s}
.header.scrolled{box-shadow:0 4px 20px rgba(0,0,0,0.08)}
.container{max-width:1200px;margin:0 auto;padding:0 24px}
.nav{display:flex;justify-content:space-between;align-items:center}
.logo{font-size:30px;font-weight:900;color:var(--n);letter-spacing:-.8px;text-decoration:none;display:inline-flex;align-items:baseline;transition:transform .3s;cursor:pointer}
.logo:hover{transform:scale(1.04)}.logo-dot{color:var(--o)}
.nav-links{display:flex;gap:22px;align-items:center}
.nav-links a{text-decoration:none;color:var(--g700);font-weight:500;font-size:15px;transition:color .25s;padding:4px 0;cursor:pointer}
.nav-links a:hover{color:var(--o)}
.lang-sep{width:1px;height:20px;background:var(--g300);margin:0 8px}
.lang-opt{font-size:13px;font-weight:700;color:var(--g500);padding:5px 9px;border-radius:6px;text-decoration:none;transition:all .25s}
.lang-opt.active{background:#fff5f0;color:var(--o)}
.lang-opt.disabled{opacity:.4;cursor:not-allowed;pointer-events:none}

/* Buttons */
.btn{display:inline-block;padding:11px 24px;border-radius:var(--rs);font-weight:700;font-size:15px;text-decoration:none;text-align:center;cursor:pointer;border:none;transition:all .3s cubic-bezier(.4,0,.2,1);user-select:none;-webkit-tap-highlight-color:transparent}
.btn:active{transform:scale(.97)!important}
.btn-primary{background:linear-gradient(135deg,var(--o),var(--ol));color:#fff;box-shadow:0 4px 14px var(--og)}
.btn-primary:hover{background:linear-gradient(135deg,#e85d2d,var(--o));transform:translateY(-2px);box-shadow:var(--sho);color:#fff}
.btn-outline{background:#fff;color:var(--n);border:2px solid rgba(26,29,63,.30);box-shadow:0 2px 8px rgba(0,0,0,.10)}
.btn-outline:hover{background:var(--n);color:#fff;border-color:var(--n);transform:translateY(-2px)}
.btn-secondary{background:#fff;color:var(--n);border:2px solid var(--n)}
.btn-secondary:hover{background:var(--n);color:#fff;transform:translateY(-2px)}
.btn-sm{padding:8px 18px;font-size:13px}
.btn-danger{background:#e53e3e;color:#fff}
.btn-danger:hover{background:#c53030;transform:translateY(-2px)}
.btn-success{background:var(--g);color:#fff}
.btn-success:hover{background:#059669;transform:translateY(-2px)}
.btn-loading{pointer-events:none;opacity:.7;position:relative}
.btn-loading::after{content:'';position:absolute;width:16px;height:16px;border:2px solid rgba(255,255,255,.4);border-top-color:#fff;border-radius:50%;animation:spin .6s linear infinite;right:16px;top:50%;margin-top:-8px}
@keyframes spin{to{transform:rotate(360deg)}}
.nav-btn-login{padding:9px 20px;font-size:14px;background:#fff;color:var(--n);border:1.5px solid rgba(26,29,63,.30);border-radius:10px;box-shadow:0 2px 8px rgba(0,0,0,.08);text-decoration:none;font-weight:700;transition:all .25s;display:inline-block;cursor:pointer}
.nav-btn-login:hover{border-color:rgba(26,29,63,.40);transform:translateY(-1px)}
.nav-btn-signup{padding:9px 20px;font-size:14px;background:linear-gradient(135deg,var(--o),var(--ol));color:#fff;border:1.5px solid transparent;border-radius:10px;box-shadow:0 4px 14px rgba(26,29,63,.25);text-decoration:none;font-weight:700;transition:all .25s;display:inline-block;cursor:pointer}
.nav-btn-signup:hover{background:var(--n);border-color:var(--o);transform:translateY(-1px);color:#fff}

.mobile-menu-btn{display:none;background:none;border:none;color:var(--n);cursor:pointer;padding:8px;border-radius:8px}
@media(max-width:968px){
  .mobile-menu-btn{display:block}
  .nav-links{display:none}
  .nav-links.open{display:flex;flex-direction:column;position:absolute;top:72px;left:0;right:0;background:#fff;padding:20px 24px;box-shadow:0 10px 30px rgba(0,0,0,.12);z-index:99;animation:slideD .25s ease-out}
  .nav-links.open a{padding:12px 0;border-bottom:1px solid var(--g50)}
  @keyframes slideD{from{opacity:0;transform:translateY(-8px)}to{opacity:1;transform:translateY(0)}}
}
/* Hero */
.hero{background:linear-gradient(160deg,var(--g50) 0%,#fff 60%);padding:100px 0 90px;position:relative;overflow:hidden}
.hero-orb{position:absolute;border-radius:50%;filter:blur(80px);pointer-events:none}
.hero-orb-1{width:600px;height:600px;top:-200px;right:-150px;background:radial-gradient(circle,rgba(255,107,53,.12) 0%,transparent 70%);animation:of1 12s ease-in-out infinite}
.hero-orb-2{width:400px;height:400px;bottom:-100px;left:-100px;background:radial-gradient(circle,rgba(102,126,234,.08) 0%,transparent 70%);animation:of2 15s ease-in-out infinite}
@keyframes of1{0%,100%{transform:translate(0,0) scale(1)}50%{transform:translate(-30px,-20px) scale(1.05)}}
@keyframes of2{0%,100%{transform:translate(0,0) scale(1)}50%{transform:translate(20px,15px) scale(1.03)}}
.hero-grid{display:grid;grid-template-columns:1.1fr .9fr;gap:60px;align-items:center;position:relative;z-index:1}
.hero-eyebrow{display:inline-flex;align-items:center;gap:8px;background:#fff5f0;border:1px solid rgba(255,107,53,.25);border-radius:999px;padding:7px 16px;font-size:13px;font-weight:800;color:var(--o);margin-bottom:24px;opacity:0;animation:hfu .6s ease forwards .1s}
.hero-eyebrow-dot{width:6px;height:6px;border-radius:50%;background:var(--g);animation:pulse 2s infinite}
@keyframes pulse{0%,100%{opacity:1;transform:scale(1)}50%{opacity:.6;transform:scale(1.2)}}
.hero-h1{font-size:56px;line-height:1.1;font-weight:900;color:var(--n);letter-spacing:-1.5px;margin-bottom:8px}
.hero-h1 .line{display:block;overflow:hidden}
.hero-h1 .line span{display:block;opacity:0;transform:translateY(40px);animation:hlu .7s cubic-bezier(.22,1,.36,1) forwards}
.hero-h1 .line:nth-child(1) span{animation-delay:.25s}
.hero-h1 .line:nth-child(2) span{animation-delay:.38s}
.hero-h1 .line:nth-child(3) span{animation-delay:.51s;color:var(--o)}
.hero-orange{color:var(--o);font-style:normal}
@keyframes hlu{to{opacity:1;transform:translateY(0)}}
@keyframes hfu{from{opacity:0;transform:translateY(12px)}to{opacity:1;transform:translateY(0)}}
.hero-mantra{display:inline-block;font-size:13px;font-weight:900;color:var(--g500);letter-spacing:2px;text-transform:uppercase;margin-bottom:20px;margin-top:6px;opacity:0;animation:hfu .6s ease forwards .65s}
.hero-mantra span{color:var(--n)}
.hero-sub{font-size:19px;color:var(--g700);line-height:1.7;max-width:560px;margin-bottom:36px;opacity:0;animation:hfu .6s ease forwards .55s}
.hero-sub strong{color:var(--n);font-weight:800}

/* Pub bar */
.pub-bar-wrap{opacity:0;animation:hfu .6s ease forwards .7s;margin-bottom:16px}
.pub-bar{display:flex;background:#fff;border-radius:var(--r);border:2.5px solid var(--g300);box-shadow:0 8px 32px rgba(26,29,63,.10);transition:all .3s;overflow:hidden;align-items:stretch}
.pub-bar:hover{border-color:rgba(255,107,53,.4);box-shadow:0 12px 40px rgba(255,107,53,.15);transform:translateY(-2px)}
.pub-bar:focus-within{border-color:var(--o);box-shadow:0 12px 40px rgba(255,107,53,.20),0 0 0 4px rgba(255,107,53,.08);transform:translateY(-2px)}
.pub-bar-icon{display:flex;align-items:center;padding:0 20px;color:#c0ccd8;flex-shrink:0;transition:color .3s}
.pub-bar:focus-within .pub-bar-icon{color:var(--o)}
.pub-bar-input{flex:1;border:none;outline:none;background:transparent;font-size:17px;font-weight:500;color:var(--n);padding:22px 12px 22px 0;min-width:0}
.pub-bar-input::placeholder{color:#b0bec5;font-weight:400;font-size:16px}
.pub-bar-btn{margin:8px;padding:16px 26px;background:linear-gradient(135deg,var(--o),var(--ol));color:#fff;border:none;border-radius:var(--rs);font-size:15px;font-weight:800;cursor:pointer;transition:all .3s;white-space:nowrap;flex-shrink:0;box-shadow:0 4px 16px var(--og)}
.pub-bar-btn:hover{transform:scale(1.03);box-shadow:var(--sho)}
.pub-bar-hint{font-size:12px;color:var(--g500);margin-top:10px;display:flex;align-items:center;gap:16px;flex-wrap:wrap}
.pub-hint-check{color:var(--g);font-weight:900;font-size:13px}
.hero-actions{display:flex;gap:14px;margin-top:20px;flex-wrap:wrap;opacity:0;animation:hfu .6s ease forwards .8s}
.trust-row{display:flex;flex-wrap:wrap;gap:20px;margin-top:32px;opacity:0;animation:hfu .6s ease forwards .9s}
.trust-item{display:flex;align-items:center;gap:10px}
.trust-icon-wrap{width:40px;height:40px;border-radius:50%;border:2px solid var(--n);display:flex;align-items:center;justify-content:center;font-size:13px;font-weight:900;color:var(--n);transition:all .3s;flex-shrink:0}
.trust-icon-wrap svg{width:18px;height:18px;stroke:var(--n);stroke-width:2.5}
.trust-item:hover .trust-icon-wrap{border-color:var(--o);color:var(--o)}
.trust-item:hover .trust-icon-wrap svg{stroke:var(--o)}
.trust-label{font-size:12px;font-weight:800;color:#2d3748;line-height:1.3}

/* Phone mockup */
.phone-wrap{display:flex;justify-content:center;align-items:center;opacity:0;animation:hfu .8s ease forwards .4s}
.phone-mockup{background:#fff;border-radius:44px;box-shadow:0 20px 60px rgba(0,0,0,.14),0 0 0 1px rgba(0,0,0,.05);padding:12px;width:320px;border:10px solid var(--n);position:relative;animation:pf 6s ease-in-out infinite}
@keyframes pf{0%,100%{transform:translateY(0)}50%{transform:translateY(-10px)}}
.phone-notch{position:absolute;top:12px;left:50%;transform:translateX(-50%);width:120px;height:26px;background:var(--n);border-radius:0 0 18px 18px;z-index:10}
.phone-screen{background:var(--g50);border-radius:32px;padding:36px 14px 18px;height:560px;overflow:hidden}
.phone-topbar{display:flex;justify-content:space-between;align-items:center;margin-bottom:16px}
.phone-logo-sm{font-size:20px;font-weight:900;color:var(--n)}
.phone-logo-dot{color:var(--o)}
.live-badge{background:var(--g);color:#fff;font-size:9px;font-weight:900;padding:3px 8px;border-radius:10px;animation:pulse 2s infinite}
.offers-scroll{position:relative;height:290px;overflow:hidden}
.offers-scroll::before,.offers-scroll::after{content:'';position:absolute;left:0;right:0;height:50px;z-index:5;pointer-events:none}
.offers-scroll::before{top:0;background:linear-gradient(to bottom,var(--g50),transparent)}
.offers-scroll::after{bottom:0;background:linear-gradient(to top,var(--g50),transparent)}
.offers-scroll-inner{display:flex;flex-direction:column;gap:10px;padding-top:8px;animation:sUp 22s linear infinite}
@keyframes sUp{0%{transform:translateY(0)}100%{transform:translateY(-50%)}}
.offers-scroll:hover .offers-scroll-inner{animation-play-state:paused}
.offer-card{display:flex;justify-content:space-between;align-items:center;padding:10px;background:var(--g50);border-radius:8px;border:2px solid transparent;position:relative;min-height:58px}
.offer-card.top{background:#fff8f5;border-color:var(--o)}
.offer-badge-sm{position:absolute;top:6px;right:8px;font-size:9px;font-weight:900;padding:2px 7px;border-radius:8px;color:#fff;text-transform:uppercase}
.offer-badge-sm.orange{background:var(--o)}.offer-badge-sm.green{background:var(--g)}.offer-badge-sm.purple{background:#667eea}
.offer-left-sm{display:flex;align-items:center;gap:8px}
.offer-av{width:34px;height:34px;border-radius:50%;background:linear-gradient(135deg,var(--n),#4a5568);color:#fff;display:flex;align-items:center;justify-content:center;font-size:11px;font-weight:800}
.offer-name{font-size:13px;font-weight:800;color:var(--n)}
.offer-stars-sm{font-size:10px;color:#FFD23F}
.offer-dist{font-size:10px;color:var(--g500)}
.offer-price-sm{font-size:16px;font-weight:900;color:var(--n)}
.offer-card.top .offer-price-sm{color:var(--o)}
.choose-btn{display:block;width:100%;padding:11px;background:var(--o);color:#fff;border:none;border-radius:10px;font-weight:900;font-size:13px;text-align:center;margin-top:10px;cursor:pointer;box-shadow:0 4px 12px var(--og);transition:transform .2s}

/* Sections */
.section{padding:90px 0}
.section-gray{background:var(--g50)}.section-white{background:#fff}
.section-head{text-align:center;margin-bottom:56px}
.section-label{display:inline-block;font-size:15px;font-weight:900;text-transform:uppercase;letter-spacing:2px;color:var(--o);margin-bottom:14px}
.section-title{font-size:48px;font-weight:900;color:var(--n);letter-spacing:-1.5px;margin-bottom:18px;line-height:1.1}
.section-sub{font-size:19px;color:var(--g700);line-height:1.7;max-width:700px;margin:0 auto}

/* Cards */
.pillar-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:28px;max-width:1100px;margin:0 auto}
.pillar-card{background:#fff;border-radius:var(--rl);padding:44px 36px;text-align:center;box-shadow:0 2px 8px rgba(0,0,0,.06);border:1px solid var(--g100);transition:transform .35s,box-shadow .35s;position:relative;overflow:hidden}
.pillar-card:hover{transform:translateY(-6px);box-shadow:0 20px 50px rgba(0,0,0,.10)}
.pillar-icon-wrap{width:72px;height:72px;border-radius:50%;display:flex;align-items:center;justify-content:center;margin:0 auto 28px;box-shadow:0 10px 30px rgba(0,0,0,.15)}
.pillar-card[style*="text-align:left"] .pillar-icon-wrap{margin-left:0}
.pillar-title{font-size:22px;font-weight:900;color:var(--n);margin-bottom:12px}
.pillar-text{font-size:16px;color:var(--g700);line-height:1.75}

/* How */
.how-grid{display:grid;grid-template-columns:1fr 1fr;gap:64px;align-items:center;max-width:1100px;margin:0 auto}
.steps{display:flex;flex-direction:column;gap:36px}
.step{display:flex;gap:20px}.step-num{width:52px;height:52px;border-radius:50%;background:linear-gradient(135deg,var(--n),var(--nl));color:#fff;display:flex;align-items:center;justify-content:center;font-size:22px;font-weight:900;flex-shrink:0;box-shadow:0 4px 14px rgba(26,29,63,.20);transition:all .35s}
.step:hover .step-num{background:linear-gradient(135deg,var(--o),var(--ol));transform:scale(1.1) rotate(5deg)}
.step-title{font-size:20px;font-weight:900;color:var(--n);margin-bottom:6px}
.step-desc{font-size:15px;color:var(--g700);line-height:1.75}
.map-mock{background:#fff;border-radius:var(--rl);box-shadow:var(--sh);padding:24px}
.map-inner{background:linear-gradient(135deg,#e8f4f8,#d9ebf1);border-radius:var(--r);height:500px;position:relative;overflow:hidden}
.map-grid-overlay{position:absolute;inset:0;opacity:.07;background-image:repeating-linear-gradient(0deg,transparent,transparent 50px,rgba(26,29,63,.15) 50px,rgba(26,29,63,.15) 51px),repeating-linear-gradient(90deg,transparent,transparent 50px,rgba(26,29,63,.15) 50px,rgba(26,29,63,.15) 51px)}
.radar-ring{position:absolute;top:50%;left:50%;width:200px;height:200px;border:2px solid var(--o);border-radius:50%;animation:rp 3s ease-out infinite}
.radar-ring:nth-child(2){animation-delay:1s}.radar-ring:nth-child(3){animation-delay:2s}
@keyframes rp{0%{transform:translate(-50%,-50%) scale(0);opacity:.7}100%{transform:translate(-50%,-50%) scale(3.2);opacity:0}}
.map-center{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);z-index:10;background:#fff;padding:16px 20px;border-radius:var(--rs);box-shadow:0 10px 30px rgba(0,0,0,.20);border:3px solid var(--o);text-align:center;min-width:210px}
.map-center-title{font-size:16px;font-weight:900;color:var(--n);margin-bottom:4px}
.map-center-meta{font-size:13px;color:var(--g500)}
.map-card{position:absolute;background:#fff;border-radius:12px;padding:12px 16px;box-shadow:0 8px 25px rgba(0,0,0,.14);min-width:170px}
.map-card.best{border:3px solid var(--g)}.map-card.normal{border:3px solid var(--g300)}
.map-card-badge{position:absolute;top:-8px;right:-4px;background:var(--g);color:#fff;font-size:10px;font-weight:900;padding:4px 10px;border-radius:8px}
.map-card-name{font-size:15px;font-weight:900;color:var(--n);margin-bottom:4px}
.map-card-sub{font-size:12px;color:var(--g500);margin-bottom:6px}
.map-card-price{font-size:22px;font-weight:900}
.map-card.best .map-card-price{color:var(--g)}.map-card.normal .map-card-price{color:var(--o)}
.map-card-avail{font-size:11px;font-weight:800;background:var(--g50);padding:5px 9px;border-radius:6px;margin-top:6px;color:var(--g700)}
.map-caption{text-align:center;margin-top:20px}
.map-caption-title{font-size:22px;font-weight:900;color:var(--n);margin-bottom:6px}
.map-caption-sub{font-size:15px;color:var(--g700);line-height:1.7}

/* Emotional */
.emotional-strip{background:linear-gradient(135deg,var(--n) 0%,#2d3748 100%);padding:72px 0;text-align:center;position:relative;overflow:hidden}
.emotional-strip::before{content:'';position:absolute;inset:0;background:radial-gradient(ellipse at 20% 50%,rgba(255,107,53,.12),transparent 50%),radial-gradient(ellipse at 80% 50%,rgba(102,126,234,.08),transparent 50%);pointer-events:none}
.emotional-quote{font-size:38px;font-weight:900;color:#fff;letter-spacing:-.5px;line-height:1.3;max-width:820px;margin:0 auto 20px;position:relative}
.emotional-quote em{color:var(--o);font-style:normal}
.emotional-sub{font-size:17px;color:rgba(255,255,255,.55);position:relative}

/* Tabs */
.tabs-wrap{max-width:1100px;margin:0 auto;background:#fff;border:1px solid var(--g300);border-radius:var(--rl);box-shadow:var(--sh);overflow:hidden}
.tabs-head{display:flex;gap:10px;padding:14px;background:linear-gradient(to bottom,#fff,var(--g50));border-bottom:1px solid var(--g300)}
.tab-btn{flex:1;padding:13px;border-radius:var(--rs);border:2px solid rgba(26,29,63,.10);background:rgba(255,255,255,.8);color:var(--n);font-weight:900;cursor:pointer;transition:all .25s;font-size:15px;display:flex;justify-content:center;align-items:center;gap:8px}
.tab-btn[aria-selected="true"]{background:linear-gradient(135deg,var(--o),var(--ol));color:#fff;border-color:transparent;box-shadow:0 8px 20px var(--og)}
.tabs-body{padding:28px}
.tab-panel{display:none}.tab-panel.active{display:block;animation:fi .3s ease}
@keyframes fi{from{opacity:0}to{opacity:1}}
.tab-grid{display:grid;grid-template-columns:1.1fr .9fr;gap:24px;align-items:start}
.card{background:#fff;border:1px solid var(--g300);border-radius:var(--r);padding:24px;box-shadow:0 2px 8px rgba(0,0,0,.06)}
.card h3{font-size:20px;font-weight:900;color:var(--n);margin-bottom:10px}
.pill{display:inline-flex;align-items:center;gap:6px;padding:7px 13px;border-radius:999px;font-size:12px;font-weight:800;border:1px solid var(--g300);background:var(--g50);color:var(--n);margin-bottom:12px}
.bullets{list-style:none;margin-top:14px}
.bullets li{display:flex;gap:10px;padding:9px 0;border-bottom:1px solid #edf2f7;color:var(--g700);font-size:14px}
.bullets li:last-child{border-bottom:none}
.bullets li::before{content:"\2713";color:var(--o);font-weight:900;flex-shrink:0}
.mini-testi{background:var(--g50);border:1px solid var(--g300);border-radius:12px;padding:14px;margin-top:12px}
.mini-testi-head{display:flex;justify-content:space-between;align-items:center;margin-bottom:8px}
.mini-testi-name{font-weight:900;color:var(--n);font-size:14px}
.mini-testi-loc{font-size:12px;color:var(--g500)}
.mini-testi-stars{color:#FFD23F;font-size:11px}
.mini-testi p{font-size:13px;color:var(--g700);line-height:1.7}

/* Missions */
.missions-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(280px,1fr));gap:20px}
.mission-card{background:#fff;border:2px solid var(--g300);border-radius:var(--r);padding:22px;position:relative;overflow:hidden;transition:all .35s}
.mission-card::before{content:'';position:absolute;top:0;left:0;right:0;height:4px;background:linear-gradient(90deg,var(--o),var(--ol))}
.mission-card:hover{border-color:var(--o);box-shadow:0 10px 30px rgba(255,107,53,.15);transform:translateY(-5px)}
.mission-tag-sm{display:inline-block;font-size:10px;font-weight:900;padding:4px 10px;border-radius:10px;margin-bottom:10px;text-transform:uppercase;letter-spacing:.5px}
.mission-tag-sm.default{background:var(--g50);color:var(--g700)}
.mission-tag-sm.remote{background:#ebf8ff;color:#2c5282}
.mission-tag-sm.premium{background:#fef3e2;color:#975a16}
.mission-title-sm{font-size:16px;font-weight:900;color:var(--n);margin-bottom:8px;line-height:1.4}
.mission-desc-sm{font-size:13px;color:var(--g700);line-height:1.65;margin-bottom:14px}
.mission-foot{display:flex;justify-content:space-between;align-items:center;padding-top:12px;border-top:1px solid var(--g100)}
.mission-loc{font-size:12px;color:var(--g500)}
.mission-price{font-size:20px;font-weight:900;color:var(--g)}

/* FAQ */
.faq-wrap{max-width:860px;margin:0 auto}
.faq-item{background:#fff;border:1px solid var(--g300);border-radius:var(--rs);margin-bottom:12px;overflow:hidden;box-shadow:0 2px 8px rgba(0,0,0,.06);transition:all .25s}
.faq-item:hover{border-color:rgba(255,107,53,.35);transform:translateY(-2px)}
.faq-q{width:100%;background:transparent;border:none;padding:18px 20px;display:flex;justify-content:space-between;align-items:center;gap:16px;cursor:pointer;text-align:left}
.faq-q strong{font-size:16px;color:var(--n);font-weight:900}
.faq-chev{width:36px;height:36px;border-radius:8px;flex-shrink:0;display:flex;align-items:center;justify-content:center;background:var(--g50);border:1px solid var(--g300);transition:all .25s}
.faq-item.open .faq-chev{transform:rotate(180deg);background:#fff5f0;border-color:rgba(255,107,53,.3)}
.faq-a{max-height:0;overflow:hidden;transition:max-height .35s ease}
.faq-item.open .faq-a{border-top:1px solid var(--g100)}
.faq-a-inner{padding:16px 20px 20px;font-size:14px;color:var(--g700);line-height:1.8}

/* Cookie */
.cookie-bar{position:fixed;bottom:0;left:0;right:0;background:rgba(26,29,63,.97);backdrop-filter:blur(12px);color:#fff;padding:20px 24px;z-index:9999;transform:translateY(100%);transition:transform .4s cubic-bezier(.4,0,.2,1)}
.cookie-bar.show{transform:translateY(0)}
.cookie-bar-inner{max-width:1200px;margin:0 auto;display:flex;gap:20px;align-items:center;justify-content:space-between;flex-wrap:wrap}
.cookie-text{flex:1;min-width:220px;font-size:13px;line-height:1.6;color:rgba(255,255,255,.8)}
.cookie-text a{color:var(--o)}
.cookie-actions{display:flex;gap:10px}
.cookie-btn{padding:10px 22px;border-radius:8px;font-weight:700;font-size:13px;cursor:pointer;border:none;transition:all .2s}
.cookie-accept{background:var(--o);color:#fff}.cookie-accept:hover{background:#e85d2d}
.cookie-decline{background:transparent;color:rgba(255,255,255,.6);border:1px solid rgba(255,255,255,.2)}.cookie-decline:hover{border-color:rgba(255,255,255,.5);color:#fff}
/* Launch Banner */

/* Progress Bar */
.progress-bar-wrap{display:flex;gap:8px;align-items:center;justify-content:center;margin-bottom:32px}
.progress-step-item{display:flex;flex-direction:column;align-items:center;gap:4px;flex:1;max-width:140px}
.progress-step-circle{width:32px;height:32px;border-radius:50%;border:2.5px solid var(--g300);background:#fff;display:flex;align-items:center;justify-content:center;font-size:12px;font-weight:900;color:var(--g500);transition:all .3s}
.progress-step-circle.active{border-color:var(--o);background:var(--o);color:#fff;box-shadow:0 4px 12px var(--og)}
.progress-step-circle.done{border-color:var(--g);background:var(--g);color:#fff}
.progress-step-label{font-size:11px;font-weight:700;color:var(--g500);text-align:center}
.progress-step-label.active{color:var(--o)}
.progress-connector{flex:1;height:2px;background:var(--g300);margin-bottom:16px;transition:background .3s;max-width:60px}
.progress-connector.done{background:var(--g)}

/* Demo Disclaimer */
.demo-banner{background:#fffbeb;border:2px dashed #fbbf24;border-radius:var(--rs);padding:12px 20px;margin-bottom:24px;display:flex;align-items:center;gap:10px;font-size:13px;color:#92400e;font-weight:700}
.demo-banner svg{flex-shrink:0;color:#f59e0b}

/* Moderation error */
.moderation-error{display:none;background:#fef2f2;border:1.5px solid #fca5a5;border-radius:var(--rs);padding:12px 16px;margin-top:10px;font-size:13px;color:#991b1b;font-weight:700;animation:pgIn .3s ease both}

.mobile-cta{display:none}
@media(max-width:768px){
  .mobile-cta{display:block;position:fixed;bottom:80px;left:20px;right:20px;z-index:900;border-radius:var(--rs);box-shadow:var(--sho)}
  .hero-grid,.how-grid{grid-template-columns:1fr;gap:40px}
  .hero-h1{font-size:38px}.section-title{font-size:36px}
  .pub-bar{flex-direction:column;border-radius:var(--rs)}
  .pub-bar-input{padding:16px 16px 0}.pub-bar-btn{margin:10px;width:calc(100% - 20px)}
  .pillar-grid{grid-template-columns:1fr!important}.tabs-head{flex-direction:column}.tab-grid{grid-template-columns:1fr}
  .emotional-quote{font-size:28px}.footer-grid{grid-template-columns:1fr}
  .phone-wrap{display:none}
}

/* Footer */
.footer{background:var(--g50);padding:64px 0 32px}
.footer-grid{display:grid;grid-template-columns:repeat(4,1fr);gap:48px;margin-bottom:48px}
.footer-col h4{font-size:15px;font-weight:900;color:var(--n);margin-bottom:16px}
.footer-col a{display:block;color:var(--g700);font-size:14px;text-decoration:none;margin-bottom:10px;transition:all .25s;cursor:pointer}
.footer-col a:hover{color:var(--o);transform:translateX(3px)}
.footer-bottom{border-top:1px solid var(--g300);padding-top:28px;display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap;gap:14px;color:var(--g500);font-size:13px}
.footer-swiss{display:flex;gap:10px;flex-wrap:wrap}
.footer-badge{padding:5px 12px;border:1px solid var(--g300);border-radius:999px;background:#fff;font-size:12px;color:var(--g500);transition:all .25s}
.footer-badge:hover{border-color:var(--o);color:var(--o);transform:translateY(-2px)}

/* Reveal */
.reveal{opacity:0;transform:translateY(24px);transition:opacity .7s ease,transform .7s ease}
.reveal.visible{opacity:1;transform:translateY(0)}
a:focus-visible,button:focus-visible,input:focus-visible{outline:3px solid rgba(255,107,53,.5);outline-offset:3px;border-radius:6px}
@media(prefers-reduced-motion:reduce){*,*::before,*::after{animation-duration:.01ms!important;transition-duration:.01ms!important}.reveal{opacity:1;transform:none}}
/* ═══════ DASHBOARD ═══════ */
.db-wrap{display:flex;min-height:100vh}
.db-sidebar{width:250px;background:var(--n);padding:24px 0;flex-shrink:0;position:sticky;top:0;height:100vh;overflow-y:auto;display:flex;flex-direction:column}
.db-logo{padding:0 24px 24px}
.db-logo a{font-size:24px;font-weight:900;color:#fff;text-decoration:none;cursor:pointer}
.db-logo .logo-dot{color:var(--o)}
.db-nav{list-style:none;flex:1}
.db-nav li a{display:flex;align-items:center;gap:10px;padding:12px 24px;color:rgba(255,255,255,.6);text-decoration:none;font-size:14px;font-weight:600;transition:all .2s;border-left:3px solid transparent;cursor:pointer}
.db-nav li a:hover{background:rgba(255,255,255,.05);color:#fff}
.db-nav li a.active{background:rgba(255,255,255,.08);color:#fff;border-left-color:var(--o)}
.db-nav .badge{background:var(--o);color:#fff;font-size:10px;font-weight:900;padding:2px 7px;border-radius:10px;margin-left:auto}
.db-main{flex:1;background:var(--g50);padding:32px;min-width:0}
.db-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:32px;flex-wrap:wrap;gap:12px}
.db-title{font-size:28px;font-weight:900;color:var(--n)}
.db-mobile-header{display:none;background:var(--n);padding:14px 20px;align-items:center;justify-content:space-between;position:sticky;top:0;z-index:50}
.db-hamburger{background:none;border:none;color:#fff;cursor:pointer;padding:6px}
.db-sidebar-overlay{display:none;position:fixed;inset:0;background:rgba(0,0,0,.5);z-index:998}
@media(max-width:768px){
  .db-sidebar{display:none;position:fixed;top:0;left:0;z-index:999;height:100vh;width:260px}
  .db-sidebar.open{display:flex}
  .db-sidebar-overlay.open{display:block}
  .db-mobile-header{display:flex}
  .db-main{padding:20px}
}

/* ═══════ CHAT ═══════ */
.chat-container{display:flex;flex-direction:column;height:calc(100vh - 180px);max-height:700px;background:#fff;border:1px solid var(--g300);border-radius:var(--rl);overflow:hidden;box-shadow:var(--sh)}
.chat-header{background:var(--n);color:#fff;padding:16px 24px;display:flex;justify-content:space-between;align-items:center}
.chat-header-info{display:flex;align-items:center;gap:12px}
.chat-avatar{width:40px;height:40px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-weight:800;font-size:14px;color:#fff}
.chat-header-name{font-weight:900;font-size:16px}
.chat-header-status{font-size:12px;color:rgba(255,255,255,.6)}
.chat-messages{flex:1;overflow-y:auto;padding:20px;display:flex;flex-direction:column;gap:12px;background:var(--g50)}
.chat-msg{max-width:75%;padding:12px 16px;border-radius:16px;font-size:14px;line-height:1.6;position:relative;animation:msgIn .3s ease}
@keyframes msgIn{from{opacity:0;transform:translateY(8px)}to{opacity:1;transform:translateY(0)}}
.chat-msg.sent{background:var(--o);color:#fff;border-bottom-right-radius:4px;align-self:flex-end}
.chat-msg.received{background:#fff;color:var(--n);border:1px solid var(--g300);border-bottom-left-radius:4px;align-self:flex-start}
.chat-msg.system{background:#fef3c7;color:#92400e;border:1px solid #fcd34d;border-radius:10px;align-self:center;font-size:12px;font-weight:700;text-align:center;max-width:90%;padding:10px 16px}
.chat-msg .chat-time{font-size:10px;opacity:.7;margin-top:4px;display:block}
.chat-input-wrap{border-top:1px solid var(--g300);padding:16px;display:flex;gap:10px;background:#fff}
.chat-input{flex:1;padding:12px 16px;border:2px solid var(--g300);border-radius:var(--rs);font-size:14px;font-family:inherit;resize:none;outline:none;transition:border-color .25s;min-height:44px;max-height:120px}
.chat-input:focus{border-color:var(--o)}
.chat-send{padding:12px 24px;background:var(--o);color:#fff;border:none;border-radius:var(--rs);font-weight:800;font-size:14px;cursor:pointer;transition:all .2s;white-space:nowrap}
.chat-send:hover{background:#e85d2d}
.chat-send:disabled{opacity:.5;cursor:not-allowed}

/* ═══════ ESCROW ═══════ */
.escrow-card{background:#fff;border:2px solid var(--g300);border-radius:var(--rl);overflow:hidden}
.escrow-header{background:linear-gradient(135deg,var(--n),#2d3748);color:#fff;padding:24px;text-align:center}
.escrow-amount{font-size:42px;font-weight:900;margin:8px 0}
.escrow-status{display:inline-flex;align-items:center;gap:6px;padding:6px 16px;border-radius:999px;font-size:13px;font-weight:800}
.escrow-status.blocked{background:rgba(255,107,53,.2);color:var(--ol)}
.escrow-status.released{background:rgba(16,185,129,.2);color:#34d399}
.escrow-status.pending{background:rgba(255,255,255,.15);color:rgba(255,255,255,.8)}
.escrow-body{padding:24px}
.escrow-timeline{position:relative;padding-left:30px}
.escrow-timeline::before{content:'';position:absolute;left:11px;top:0;bottom:0;width:2px;background:var(--g300)}
.escrow-step{position:relative;padding-bottom:24px;padding-left:20px}
.escrow-step:last-child{padding-bottom:0}
.escrow-step::before{content:'';position:absolute;left:-22px;top:4px;width:16px;height:16px;border-radius:50%;border:3px solid var(--g300);background:#fff;z-index:1}
.escrow-step.done::before{border-color:var(--g);background:var(--g)}
.escrow-step.active::before{border-color:var(--o);background:var(--o);box-shadow:0 0 0 4px rgba(255,107,53,.2)}
.escrow-step.done::after{content:'✓';position:absolute;left:-19px;top:3px;color:#fff;font-size:10px;font-weight:900;z-index:2}
.escrow-step-title{font-size:14px;font-weight:900;color:var(--n)}
.escrow-step-desc{font-size:12px;color:var(--g500);margin-top:2px}
.escrow-step-date{font-size:11px;color:var(--g500);font-style:italic;margin-top:2px}

/* ═══════ OFFERS TABLE ═══════ */
.offer-row{background:#fff;border:2px solid var(--g300);border-radius:var(--r);padding:20px;margin-bottom:12px;transition:all .25s;display:grid;grid-template-columns:auto 1fr auto;gap:16px;align-items:center}
.offer-row:hover{border-color:rgba(255,107,53,.3);box-shadow:0 8px 24px rgba(0,0,0,.06);transform:translateY(-2px)}
.offer-row.accepted{border-color:var(--g);background:#f0fdf4}
.offer-avatar{width:50px;height:50px;border-radius:50%;background:linear-gradient(135deg,var(--n),#4a5568);color:#fff;display:flex;align-items:center;justify-content:center;font-weight:900;font-size:16px;flex-shrink:0}
.offer-info h4{font-size:16px;font-weight:900;color:var(--n);margin-bottom:4px}
.offer-info p{font-size:13px;color:var(--g500);line-height:1.5}
.offer-right{text-align:right}
.offer-amount{font-size:24px;font-weight:900;color:var(--o);margin-bottom:8px}
.offer-actions{display:flex;gap:8px;justify-content:flex-end;flex-wrap:wrap}

/* ═══════ REVIEW MODAL ═══════ */
.modal-overlay{position:fixed;inset:0;background:rgba(0,0,0,.5);z-index:9998;display:flex;align-items:center;justify-content:center;padding:20px;opacity:0;pointer-events:none;transition:opacity .3s}
.modal-overlay.show{opacity:1;pointer-events:all}
.modal{background:#fff;border-radius:var(--rl);max-width:500px;width:100%;max-height:90vh;overflow-y:auto;box-shadow:0 20px 60px rgba(0,0,0,.2);transform:scale(.95);transition:transform .3s}
.modal-overlay.show .modal{transform:scale(1)}
.modal-header{padding:24px 24px 0;display:flex;justify-content:space-between;align-items:center}
.modal-header h3{font-size:20px;font-weight:900;color:var(--n)}
.modal-close{width:36px;height:36px;border-radius:50%;border:none;background:var(--g50);cursor:pointer;display:flex;align-items:center;justify-content:center;font-size:18px;transition:all .2s}
.modal-close:hover{background:var(--g100)}
.modal-body{padding:24px}
.stars-input{display:flex;gap:4px;margin:12px 0}
.stars-input span{font-size:32px;cursor:pointer;color:var(--g300);transition:color .15s}
.stars-input span.active{color:#FFD23F}

/* ═══════ LEGAL PAGES ═══════ */
.legal-content{max-width:800px;margin:0 auto}
.legal-content h2{font-size:24px;font-weight:900;color:var(--n);margin:32px 0 12px;padding-top:16px;border-top:1px solid var(--g100)}
.legal-content h2:first-child{border-top:none;margin-top:0}
.legal-content h3{font-size:18px;font-weight:800;color:var(--n);margin:20px 0 8px}
.legal-content p{font-size:14px;color:var(--g700);line-height:1.9;margin-bottom:12px}
.legal-content ul{margin:8px 0 16px 20px;font-size:14px;color:var(--g700);line-height:1.9}
.legal-content ul li{margin-bottom:6px}
.legal-nav{display:flex;gap:10px;flex-wrap:wrap;margin-bottom:32px;justify-content:center}
.legal-nav a{padding:8px 18px;border-radius:999px;font-size:13px;font-weight:700;border:1px solid var(--g300);color:var(--g700);text-decoration:none;transition:all .2s;cursor:pointer}
.legal-nav a:hover,.legal-nav a.active{background:var(--o);color:#fff;border-color:var(--o)}

/* ═══════ PROVIDER SIGNUP ═══════ */
.ps-step-dot{width:10px;height:10px;border-radius:50%;transition:all .3s}
.provider-bens{list-style:none;margin:22px 0}
.provider-bens li{padding:12px 0 12px 28px;font-size:15px;color:#2d3748;border-bottom:1px solid var(--g100);position:relative;transition:all .25s}
.provider-bens li::before{content:"\2192";position:absolute;left:0;color:var(--o);font-weight:900;font-size:17px}
.provider-bens li:last-child{border-bottom:none}
.scroll-hint{text-align:center;margin-top:48px;opacity:.4;animation:bounce 2s ease-in-out infinite}
@keyframes bounce{0%,100%{transform:translateY(0)}50%{transform:translateY(8px)}}

/* ═══════ MISSIONS SAUVAGES ═══════ */
.msv-section{background:#fff;padding:80px 0 60px}
.msv-grid{display:grid;grid-template-columns:repeat(4,1fr);gap:0;max-width:1100px;margin:0 auto;border:1px solid var(--g100);border-radius:var(--rl);overflow:hidden;box-shadow:0 4px 24px rgba(0,0,0,.06)}
.msv-item{padding:28px 24px;border-right:1px solid var(--g100);border-bottom:1px solid var(--g100);transition:all .3s;cursor:default;background:#fff;position:relative}
.msv-item:nth-child(4n){border-right:none}
.msv-item:nth-last-child(-n+4){border-bottom:none}
.msv-item:hover{background:#fff8f5;z-index:1}
.msv-item:hover .msv-icon-wrap{transform:scale(1.1);background:var(--og)}
.msv-icon-wrap{width:46px;height:46px;border-radius:12px;background:var(--g50);display:flex;align-items:center;justify-content:center;font-size:22px;margin-bottom:14px;transition:all .3s;flex-shrink:0}
.msv-title{font-size:14px;font-weight:900;color:var(--n);margin-bottom:6px;line-height:1.4}
.msv-desc{font-size:12px;color:var(--g500);line-height:1.65}
.msv-cta-wrap{text-align:center;margin-top:40px}
.msv-cta-text{font-size:18px;font-weight:900;color:var(--n);margin-bottom:8px}
.msv-cta-sub{font-size:14px;color:var(--o);font-weight:700}

/* ═══════ AUDIENCE SIMPLIFIED ═══════ */
.audience-split{display:grid;grid-template-columns:1fr 1fr;gap:24px;max-width:1000px;margin:0 auto}
.audience-card{background:#fff;border:2px solid var(--g100);border-radius:var(--rl);padding:40px 36px;transition:all .35s;position:relative;overflow:hidden}
.audience-card::before{content:'';position:absolute;top:0;left:0;right:0;height:5px}
.audience-card.client::before{background:linear-gradient(90deg,var(--o),var(--ol))}
.audience-card.provider::before{background:linear-gradient(90deg,var(--n),#4a5568)}
.audience-card:hover{border-color:rgba(255,107,53,.3);box-shadow:0 16px 48px rgba(0,0,0,.08);transform:translateY(-4px)}
.audience-card h3{font-size:24px;font-weight:900;color:var(--n);margin-bottom:12px}
.audience-card p{font-size:15px;color:var(--g700);line-height:1.7;margin-bottom:20px}
.aud-bullets{list-style:none;margin-bottom:28px}
.aud-bullets li{font-size:14px;color:var(--g700);padding:8px 0;border-bottom:1px solid var(--g50);display:flex;align-items:center;gap:10px}
.aud-bullets li:last-child{border-bottom:none}
.aud-bullets li::before{content:'→';color:var(--o);font-weight:900;flex-shrink:0}
.aud-tag{display:inline-flex;align-items:center;gap:6px;padding:6px 14px;border-radius:999px;font-size:12px;font-weight:800;margin-bottom:20px}
.aud-tag.client-tag{background:#fff5f0;color:var(--o);border:1px solid rgba(255,107,53,.25)}
.aud-tag.provider-tag{background:#f0f1f8;color:var(--n);border:1px solid rgba(26,29,63,.15)}
@media(max-width:768px){
  .msv-grid{grid-template-columns:1fr 1fr}
  .msv-item:nth-child(4n){border-right:1px solid var(--g100)}
  .msv-item:nth-child(2n){border-right:none}
  .msv-item:nth-last-child(-n+4){border-bottom:1px solid var(--g100)}
  .msv-item:nth-last-child(-n+2){border-bottom:none}
  .msv-item:last-child{border-bottom:none}
  .audience-split{grid-template-columns:1fr}
}
/* ═══════ NOTIFICATION TOAST ═══════ */
.toast{position:fixed;top:24px;right:24px;z-index:9990;background:#fff;border-radius:var(--r);padding:16px 20px;box-shadow:0 12px 40px rgba(0,0,0,.15);border-left:4px solid var(--o);transform:translateX(120%);transition:transform .4s cubic-bezier(.4,0,.2,1);max-width:380px;display:flex;gap:12px;align-items:flex-start}
.toast.show{transform:translateX(0)}
.toast-icon{font-size:20px;flex-shrink:0}
.toast-text h4{font-size:14px;font-weight:900;color:var(--n);margin-bottom:2px}
.toast-text p{font-size:12px;color:var(--g500);line-height:1.5}

/* ═══════════════════════════════════════════════
   DESIGN POLISH — ALIGNMENT & PREMIUM FINISH
   ═══════════════════════════════════════════════ */

/* ── Hero stamp (was missing CSS) ── */
.hero-stamp {
  display: inline-flex;
  align-items: center;
  gap: 8px;
  margin-top: 24px;
  font-size: 12px;
  font-weight: 600;
  color: var(--g500);
  letter-spacing: .3px;
}
.hero-stamp-ch {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  width: 22px;
  height: 22px;
  border-radius: 50%;
  background: var(--n);
  color: #fff;
  font-size: 9px;
  font-weight: 900;
  flex-shrink: 0;
}

/* ── Pillar cards — left-aligned variant ── */
.pillar-card.left-align .pillar-icon-wrap,
.pillar-card[style*="text-align:left"] .pillar-icon-wrap,
.pillar-card[style*="text-align: left"] .pillar-icon-wrap {
  margin-left: 0;
  margin-right: 0;
}

/* ── Section head refinements ── */
.section-label {
  font-size: 12px;
  letter-spacing: 2.5px;
}
.section-title {
  letter-spacing: -1.8px;
}
.section-sub {
  font-size: 18px;
  color: var(--g700);
  opacity: .85;
}

/* ── Hero typography tightening ── */
.hero-h1 {
  letter-spacing: -2px;
  margin-bottom: 12px;
}
.hero-sub {
  font-size: 18px;
  color: #4a5568;
}
.hero-mantra {
  margin-bottom: 24px;
}

/* ── Pub bar premium feel ── */
.pub-bar {
  border-width: 2px;
  border-color: var(--g300);
  box-shadow: 0 4px 20px rgba(26,29,63,.07);
}
.pub-bar-input {
  font-size: 16px;
  letter-spacing: -.1px;
}
.pub-bar-hint {
  gap: 20px;
  font-size: 12.5px;
  color: #718096;
  margin-top: 12px;
}

/* ── Trust row ── */
.trust-row {
  gap: 24px;
  margin-top: 36px;
  padding: 20px 0 0;
  border-top: 1px solid var(--g300);
}
.trust-item {
  gap: 12px;
}
.trust-label {
  font-size: 11.5px;
  font-weight: 700;
  color: var(--g700);
  letter-spacing: .1px;
}

/* ── Pillar cards premium ── */
.pillar-card {
  padding: 40px 32px;
  border: 1.5px solid var(--g100);
  transition: transform .3s cubic-bezier(.4,0,.2,1), box-shadow .3s cubic-bezier(.4,0,.2,1), border-color .3s;
}
.pillar-card:hover {
  border-color: rgba(255,107,53,.2);
  transform: translateY(-5px);
  box-shadow: 0 24px 56px rgba(0,0,0,.09);
}
.pillar-icon-wrap {
  width: 64px;
  height: 64px;
  margin-bottom: 24px;
  box-shadow: 0 8px 24px rgba(0,0,0,.12);
}
.pillar-title {
  font-size: 20px;
  letter-spacing: -.3px;
  margin-bottom: 10px;
}
.pillar-text {
  font-size: 15px;
  line-height: 1.7;
  color: #4a5568;
}

/* ── How-it-works steps ── */
.step-num {
  width: 48px;
  height: 48px;
  font-size: 20px;
}
.step-title {
  font-size: 18px;
  letter-spacing: -.2px;
}
.step-desc {
  font-size: 14.5px;
  color: #4a5568;
}

/* ── MSV grid fix: last row border ── */
.msv-grid {
  border-radius: 18px;
}
.msv-item {
  padding: 28px 26px;
}
.msv-item:nth-child(n+5):nth-child(-n+8) {
  border-bottom: none;
}
.msv-item:nth-child(8) {
  border-right: none;
}

/* ── Audience cards ── */
.audience-card {
  padding: 40px 36px;
}
.audience-card h3 {
  font-size: 22px;
  letter-spacing: -.4px;
  margin-bottom: 10px;
}
.audience-card p {
  font-size: 14.5px;
  line-height: 1.75;
  margin-bottom: 22px;
}
.aud-bullets li {
  font-size: 13.5px;
  padding: 9px 0;
}

/* ── Emotional strip ── */
.emotional-strip {
  padding: 80px 0;
}
.emotional-quote {
  font-size: 36px;
  letter-spacing: -.5px;
  line-height: 1.35;
  max-width: 760px;
}
.emotional-sub {
  font-size: 16px;
  margin-top: 20px;
  color: rgba(255,255,255,.5);
}

/* ── FAQ refinements ── */
.faq-q strong {
  font-size: 15px;
  letter-spacing: -.1px;
}
.faq-a-inner {
  font-size: 14.5px;
  line-height: 1.85;
  color: #4a5568;
}

/* ── Footer refinements ── */
.footer-col h4 {
  letter-spacing: -.1px;
}
.footer-col a {
  font-size: 13.5px;
  color: #4a5568;
}
.footer-bottom {
  font-size: 12.5px;
}

/* ── Tabs ── */
.tab-btn {
  font-size: 14.5px;
  letter-spacing: -.1px;
}
.tabs-body {
  padding: 32px;
}

/* ── Category tiles ── */
.cat-grid{display:grid;grid-template-columns:repeat(4,1fr);gap:16px}
@media(max-width:1024px){.cat-grid{grid-template-columns:repeat(2,1fr)}}
@media(max-width:600px){.cat-grid{grid-template-columns:repeat(2,1fr);gap:12px}}
.cat-tile{background:#fff;border:1.5px solid var(--g300);border-radius:18px;padding:28px 22px;cursor:pointer;transition:all .25s cubic-bezier(.4,0,.2,1);text-align:left;opacity:0;transform:translateY(20px);animation:catIn .5s cubic-bezier(.22,1,.36,1) forwards}
@keyframes catIn{to{opacity:1;transform:translateY(0)}}
.cat-tile:nth-child(1){animation-delay:.05s}.cat-tile:nth-child(2){animation-delay:.10s}.cat-tile:nth-child(3){animation-delay:.15s}.cat-tile:nth-child(4){animation-delay:.20s}.cat-tile:nth-child(5){animation-delay:.25s}.cat-tile:nth-child(6){animation-delay:.30s}.cat-tile:nth-child(7){animation-delay:.35s}.cat-tile:nth-child(8){animation-delay:.40s}
.cat-tile:hover{border-color:var(--o);transform:translateY(-5px);box-shadow:0 14px 36px rgba(255,107,53,.14)}
.cat-tile-cta{background:#fff;border:2px solid var(--o)}
.cat-tile-cta:hover{transform:translateY(-5px);box-shadow:0 14px 36px rgba(255,107,53,.18);border-color:var(--o)}
.cat-tile-cta .cat-title{color:var(--o)}
.cat-tile-cta .cat-sub{color:var(--g500)}
.cat-tile-cta .cat-icon{filter:none}
.cat-icon{font-size:30px;margin-bottom:14px;display:block;transition:transform .3s}
.cat-tile:hover .cat-icon{transform:scale(1.15) rotate(-3deg)}
.cat-title{font-size:15px;font-weight:800;color:var(--n);margin-bottom:6px;line-height:1.3}
.cat-sub{font-size:12px;color:var(--g500);line-height:1.5}

/* ── Card headings ── */
.card h3 {
  font-size: 18px;
  letter-spacing: -.2px;
}

/* ── Offer rows ── */
.offer-info h4 {
  letter-spacing: -.2px;
}

/* ── Dashboard title ── */
.db-title {
  letter-spacing: -.5px;
}

/* ── Form inputs global consistency ── */
input[type="text"],
input[type="email"],
input[type="tel"],
input[type="password"],
select,
textarea {
  transition: border-color .2s, box-shadow .2s;
}
input[type="text"]:focus,
input[type="email"]:focus,
input[type="tel"]:focus,
input[type="password"]:focus,
select:focus,
textarea:focus {
  outline: none;
  border-color: var(--o) !important;
  box-shadow: 0 0 0 3px rgba(255,107,53,.1);
}

/* ── Pillar grid spacing ── */
.pillar-grid {
  gap: 24px;
}

/* ── How grid layout ── */
.how-grid {
  gap: 60px;
}

/* ── Section bottom call-to-action block ── */
section .container > [style*="background:var(--g50)"],
section .container > div[style*="background:var(--g50)"] {
  border-radius: 16px;
}

/* ── Mobile fixes ── */
@media(max-width: 768px) {
  .trust-row {
    gap: 16px;
    padding-top: 16px;
  }
  .hero-stamp {
    display: none;
  }
  .pillar-card {
    padding: 32px 24px;
  }
  .audience-card {
    padding: 32px 28px;
  }
}

/* ── Footer trust badges (was missing CSS) ── */
.footer-trust {
  display: flex;
  flex-direction: column;
  gap: 8px;
  margin-top: 4px;
}
.footer-trust-badge {
  display: inline-flex;
  align-items: center;
  font-size: 12px;
  font-weight: 600;
  color: var(--g500);
  gap: 4px;
  line-height: 1.4;
}

/* ── Providers section description text ── */
.providers-desc {
  font-size: 16.5px;
  color: var(--g700);
  line-height: 1.8;
  margin-bottom: 32px;
}

/* ── Scroll hint ── */
.scroll-hint {
  margin-top: 40px;
}

/* ── Section label spacing ── */
.section-head .section-label {
  margin-bottom: 12px;
}
.section-head .section-title {
  margin-bottom: 16px;
}

/* ── Pub bar hint item spacing ── */
.pub-bar-hint span {
  display: inline-flex;
  align-items: center;
  gap: 5px;
}
</style>
</head>
<body>
<div class="noscript-msg"><h1>JavaScript requis</h1><p>Oflem nécessite JavaScript pour fonctionner.</p></div>
<a href="#main-content" class="skip-link">Aller au contenu principal</a>

<!-- COOKIE -->
<div class="cookie-bar" id="cookieBar" role="dialog" aria-label="Cookies">
<div class="cookie-bar-inner"><p class="cookie-text">Oflem utilise des cookies essentiels. <a onclick="oflemNav('legal-cookies')">En savoir plus</a></p><div class="cookie-actions"><button class="cookie-btn cookie-accept" id="cookieAcceptBtn">Accepter</button><button class="cookie-btn cookie-decline" id="cookieDeclineBtn">Refuser</button></div></div></div>

<!-- TOAST -->
<div class="toast" id="toast"><span class="toast-icon">●</span><div class="toast-text"><h4 id="toast-title">Notification</h4><p id="toast-msg">Message</p></div></div>

<!-- MODAL -->
<div class="modal-overlay" id="modalOverlay" onclick="if(event.target===this)closeModal()">
<div class="modal" id="modalContent"></div>
</div>

<!-- ═══ HOME ═══ -->
<div id="oflem-home" class="oflem-page">
<header class="header"><div class="container"><nav class="nav">
<a class="logo" onclick="oflemNav('home')">Oflem<span class="logo-dot">.</span></a>
<button class="mobile-menu-btn" onclick="toggleMobileMenu()" aria-label="Menu" aria-expanded="false" id="mobileMenuBtn"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round"><line x1="3" y1="6" x2="21" y2="6"/><line x1="3" y1="12" x2="21" y2="12"/><line x1="3" y1="18" x2="21" y2="18"/></svg></button>
<div class="nav-links" id="navLinks">
<a href="#how-it-works">Comment ça marche</a><a href="#petites-missions">Missions</a><a href="#audience">Clients & Prestataires</a><a href="#faq">FAQ</a>
<div class="lang-sep"></div>
<a class="nav-btn-login" onclick="oflemNav('login')">Se connecter</a>
<a class="nav-btn-signup" onclick="oflemNav('provider-signup')">Devenir prestataire</a>
</div></nav></div></header>

<section class="hero" id="main-content">
<div class="hero-orb hero-orb-1"></div><div class="hero-orb hero-orb-2"></div>
<div class="container"><div class="hero-grid"><div>
<div class="hero-eyebrow"><span class="hero-eyebrow-dot"></span> Plateforme suisse</div>
<h1 class="hero-h1"><span class="line"><span>Et si vous n'aviez pas</span></span><span class="line"><span>à tout faire <em class="hero-orange">vous-même ?</em></span></span></h1>
<div class="hero-mantra">Quelqu'un près de chez vous <span>peut s'en charger.</span></div>
<p class="hero-sub">Promenade de chien, montage de meubles, jardinage, aide administrative, grand chantier ou petite urgence du quotidien, publiez votre besoin gratuitement. Des personnes sérieuses et vérifiées, proches de chez vous, vous répondent. Paiement <strong>protégé par séquestre</strong>.</p>
<div class="pub-bar-wrap"><form class="pub-bar" onsubmit="publishRequest(event)">
<div class="pub-bar-icon"><svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/></svg></div>
<input type="text" class="pub-bar-input" id="heroInput" placeholder="Ex: Courses urgentes, promener mon chien, monter un meuble…" required>
<button type="submit" class="pub-bar-btn">Publier ma demande →</button>
</form><div class="pub-bar-hint"><span><span class="pub-hint-check">✓</span> Gratuit</span><span><span class="pub-hint-check">✓</span> Sans engagement</span><span><span class="pub-hint-check">✓</span> Commission affichée avant paiement</span></div></div>
<div class="hero-actions"><a class="btn btn-outline" onclick="oflemNav('provider-signup')" style="display:inline-flex;flex-direction:column;align-items:center;gap:3px;padding:13px 26px;line-height:1.2"><span style="font-size:15px;font-weight:800">Je suis prestataire →</span><span style="font-size:11px;font-weight:500;opacity:.55;font-style:italic">Gagnez de l'argent avec vos compétences</span></a></div>
<div class="trust-row">
<div class="trust-item"><div class="trust-icon-wrap"><svg viewBox="0 0 24 24" fill="none"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/></svg></div><span class="trust-label">Paiement<br>sécurisé</span></div>
<div class="trust-item"><div class="trust-icon-wrap"><svg viewBox="0 0 24 24" fill="none"><path d="M22 11.08V12a10 10 0 11-5.93-9.14"/><polyline points="22 4 12 14.01 9 11.01"/></svg></div><span class="trust-label">Prestataires<br>vérifiés</span></div>
<div class="trust-item"><div class="trust-icon-wrap">CH</div><span class="trust-label">Données<br>en Suisse</span></div>
</div>
<div class="hero-stamp"><span class="hero-stamp-ch">CH</span> Développé en Suisse romande · Données hébergées chez Infomaniak · <a onclick="oflemNav('legal-about')" style="color:var(--o);text-decoration:underline;cursor:pointer">À propos de nous</a></div></div>

<div class="phone-wrap"><div class="phone-mockup"><div class="phone-notch"></div><div class="phone-screen">
<div class="phone-topbar"><span class="phone-logo-sm">Oflem<span class="phone-logo-dot">.</span></span><span style="font-size:9px;font-weight:800;color:var(--g);letter-spacing:1px">● EN LIGNE</span></div>
<div style="background:#fff;border-radius:12px;padding:14px;box-shadow:0 2px 8px rgba(0,0,0,.06);">
<div style="background:#fff5f0;border:1px solid rgba(255,107,53,.3);border-radius:8px;padding:10px;margin-bottom:12px;">
<div style="font-size:9px;font-weight:900;color:var(--o);text-transform:uppercase;letter-spacing:1px;margin-bottom:4px;">Votre demande</div>
<div style="font-size:14px;font-weight:900;color:var(--n);margin-bottom:4px;">Courses urgentes — couches bébé</div>
<div style="font-size:11px;color:var(--g500);">Lausanne · Avant 18h30</div>
<div style="font-size:10px;font-weight:800;color:var(--n);margin-top:4px;">Budget : CHF 25.–</div>
</div>
<div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:10px;"><span style="font-size:12px;font-weight:900;color:var(--n);background:var(--g50);padding:8px 10px;border-radius:8px;">3 offres reçues</span></div>
<div class="offers-scroll"><div class="offers-scroll-inner">
<div class="offer-card top"><span class="offer-badge-sm orange">Le plus proche</span><div class="offer-left-sm"><div class="offer-av">LC</div><div><div class="offer-name">Léa C.</div><div class="offer-stars-sm">★★★★★</div><div class="offer-dist">800 m</div></div></div><div class="offer-price-sm">CHF 20.–</div></div>
<div class="offer-card"><span class="offer-badge-sm green">Rapide</span><div class="offer-left-sm"><div class="offer-av">NT</div><div><div class="offer-name">Noah T.</div><div class="offer-stars-sm">★★★★★</div><div class="offer-dist">1.2 km</div></div></div><div class="offer-price-sm">CHF 25.–</div></div>
<div class="offer-card"><span class="offer-badge-sm purple">Disponible</span><div class="offer-left-sm"><div class="offer-av">SM</div><div><div class="offer-name">Sara M.</div><div class="offer-stars-sm">★★★★☆</div><div class="offer-dist">2.1 km</div></div></div><div class="offer-price-sm">CHF 22.–</div></div>
<div class="offer-card top"><span class="offer-badge-sm orange">Le plus proche</span><div class="offer-left-sm"><div class="offer-av">LC</div><div><div class="offer-name">Léa C.</div><div class="offer-stars-sm">★★★★★</div><div class="offer-dist">800 m</div></div></div><div class="offer-price-sm">CHF 20.–</div></div>
<div class="offer-card"><span class="offer-badge-sm green">Rapide</span><div class="offer-left-sm"><div class="offer-av">NT</div><div><div class="offer-name">Noah T.</div><div class="offer-stars-sm">★★★★★</div><div class="offer-dist">1.2 km</div></div></div><div class="offer-price-sm">CHF 25.–</div></div>
</div></div>
<button class="choose-btn" onclick="oflemNav('signup')">Choisir Léa C. →</button>
</div></div></div></div>
</div>
<div class="scroll-hint"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="#c0ccd8" stroke-width="2" stroke-linecap="round"><polyline points="6 9 12 15 18 9"/></svg></div>
</div></section>

<!-- ═══ CATÉGORIES CLIQUABLES ═══ -->
<section class="msv-section reveal" id="categories">
<div class="container">
<div class="section-head" style="margin-bottom:48px">
  <div class="section-label">Ce que les gens peuvent publier sur Oflem</div>
  <h2 class="section-title" style="font-size:42px">Vous allez peut-être vous reconnaître.</h2>
  <p class="section-sub">Ce n'est pas une liste figée. Oflem n'est pas une plateforme spécialisée dans un seul type de service, mais un espace où vous décrivez librement votre besoin.</p>
</div>
<div class="cat-grid">
  <div class="cat-tile" onclick="startWithCategory('Promenade et animaux')">
    <div class="cat-icon">🐕</div>
    <div class="cat-title">Promenade & animaux</div>
    <div class="cat-sub">Votre chien a besoin de sortir. Vous, pas forcément.</div>
  </div>
  <div class="cat-tile" onclick="startWithCategory('Montage et bricolage')">
    <div class="cat-icon">🔧</div>
    <div class="cat-title">Montage & bricolage</div>
    <div class="cat-sub">Ce meuble en kit qui attend depuis trop longtemps.</div>
  </div>
  <div class="cat-tile" onclick="startWithCategory('Nettoyage et entretien')">
    <div class="cat-icon">🧹</div>
    <div class="cat-title">Nettoyage & entretien</div>
    <div class="cat-sub">Parce que rentrer dans un espace propre, ça change tout.</div>
  </div>
  <div class="cat-tile" onclick="startWithCategory('Jardinage et extérieur')">
    <div class="cat-icon">🌿</div>
    <div class="cat-title">Jardinage & extérieur</div>
    <div class="cat-sub">Herbes hautes, feuilles partout, petit rafraîchissement.</div>
  </div>
  <div class="cat-tile" onclick="startWithCategory('Aide quotidienne')">
    <div class="cat-icon">📦</div>
    <div class="cat-title">Aide quotidienne</div>
    <div class="cat-sub">Récupérer un colis, faire une course, passer à la déchetterie.</div>
  </div>
  <div class="cat-tile" onclick="startWithCategory('Aide administrative')">
    <div class="cat-icon">📋</div>
    <div class="cat-title">Aide administrative</div>
    <div class="cat-sub">Impôts, courriers officiels, démarches suisses : un humain qui comprend votre situation.</div>
  </div>
  <div class="cat-tile" onclick="startWithCategory('Mission à distance')">
    <div class="cat-icon">🖥️</div>
    <div class="cat-title">Missions à distance</div>
    <div class="cat-sub">Traductions, documents, organisation, rédaction. Tout se fait depuis chez vous.</div>
  </div>
  <div class="cat-tile cat-tile-cta" onclick="scrollToHero()">
    <div class="cat-icon">✦</div>
    <div class="cat-title">Autre chose ?</div>
    <div class="cat-sub">Si c'est légal et que ça vous simplifie la vie, publiez-le.</div>
  </div>
</div>
</div>
</section>

<!-- ═══ COMMENT ÇA MARCHE ═══ -->
<section class="section section-white reveal" id="how-it-works"><div class="container">
<div class="section-head"><div class="section-label">Comment ça marche</div><h2 class="section-title">Trois étapes. Pas plus.</h2></div>
<div class="how-grid">
<div class="steps">
<div class="step"><div class="step-num">1</div><div>
<h3 class="step-title">Décrivez ce qu'il vous faut</h3>
<p class="step-desc">Une phrase suffit. "Aide pour ma déclaration d'impôts vaudoise" ou "Quelqu'un pour monter une armoire samedi matin à Montreux". Indiquez votre budget. La publication est gratuite et sans engagement.</p>
</div></div>
<div class="step"><div class="step-num">2</div><div>
<h3 class="step-title">Des prestataires vérifiés vous répondent</h3>
<p class="step-desc">Des personnes près de chez vous, vérifiées par Oflem, consultent votre demande et vous font une proposition. Vous comparez, vous choisissez, sans pression.</p>
</div></div>
<div class="step"><div class="step-num">3</div><div>
<h3 class="step-title">Vous payez uniquement quand tout est terminé</h3>
<p class="step-desc">Le montant est mis de côté en sécurité. Le prestataire est payé uniquement après validation de votre part. En cas de souci, notre équipe intervient.</p>
</div></div>
</div>
<div class="map-mock"><div class="map-inner"><div class="map-grid-overlay"></div><div class="radar-ring"></div><div class="radar-ring"></div><div class="radar-ring"></div>
<div class="map-center"><div class="map-center-title">Votre demande</div><div class="map-center-meta">Lausanne · Rayon 15 km</div></div>
<div class="map-card best" style="top:15%;left:12%"><span class="map-card-badge">La plus proche</span><div class="map-card-name">Léa C.</div><div class="map-card-sub">★★★★★ · Courses et livraison</div><div class="map-card-price">CHF 20.–</div><div class="map-card-avail">Disponible maintenant</div></div>
<div class="map-card normal" style="top:60%;right:10%"><div class="map-card-name">Noah T.</div><div class="map-card-sub">★★★★★ · Multi-services</div><div class="map-card-price">CHF 25.–</div><div class="map-card-avail">Dans 30 minutes</div></div>
</div><div class="map-caption"><div class="map-caption-title">Comment les offres arrivent</div><div class="map-caption-sub">Les prestataires proches de chez vous sont notifiés instantanément.</div></div></div>
</div></div></section>

<!-- Why Oflem -->
<section class="section section-gray reveal" id="why-oflem"><div class="container">
<div class="section-head"><div class="section-label">Pourquoi Oflem</div><h2 class="section-title">Poster une annonce, ça peut marcher.<br>Sauf quand ça se passe mal.</h2><p class="section-sub">Poster une annonce entre particuliers ou appeler l'ami d'un ami, ça peut marcher. Mais quand ça se passe mal, vous êtes seul. Oflem, c'est la fiabilité en plus.</p></div>
<div class="pillar-grid" style="grid-template-columns:repeat(2,1fr);max-width:900px">
<div class="pillar-card" style="text-align:left"><div class="pillar-icon-wrap" style="background:linear-gradient(135deg,var(--o),var(--ol))"><svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="#fff" stroke-width="2" stroke-linecap="round"><path d="M22 11.08V12a10 10 0 11-5.93-9.14"/><polyline points="22 4 12 14.01 9 11.01"/></svg></div><h3 class="pillar-title">Prestataires vérifiés</h3><p class="pillar-text">Pièce d'identité, droit de travailler en Suisse, qualifications vérifiées si nécessaire. Pas un inconnu sans historique : quelqu'un que la plateforme a validé.</p></div>
<div class="pillar-card" style="text-align:left"><div class="pillar-icon-wrap" style="background:linear-gradient(135deg,var(--g),#34d399)"><svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="#fff" stroke-width="2" stroke-linecap="round"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/></svg></div><h3 class="pillar-title">Argent protégé par séquestre</h3><p class="pillar-text">Vous ne payez pas à l'avance dans le vide. Les fonds sont bloqués et ne partent que lorsque vous avez confirmé que le travail est fait. Ni avance. Ni mauvaise surprise.</p></div>
<div class="pillar-card" style="text-align:left"><div class="pillar-icon-wrap" style="background:linear-gradient(135deg,#667eea,#764ba2)"><svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="#fff" stroke-width="2" stroke-linecap="round"><circle cx="12" cy="12" r="10"/><line x1="2" y1="12" x2="22" y2="12"/><path d="M12 2a15.3 15.3 0 014 10 15.3 15.3 0 01-4 10 15.3 15.3 0 01-4-10 15.3 15.3 0 014-10z"/></svg></div><h3 class="pillar-title">Toujours quelqu'un près de chez vous</h3><p class="pillar-text">Chaque prestataire qui répond à votre demande vit dans votre région. Pas quelqu'un à 200 km. Pas une plateforme étrangère. Une personne proche, disponible, qui connaît votre coin.</p></div>
<div class="pillar-card" style="text-align:left"><div class="pillar-icon-wrap" style="background:linear-gradient(135deg,#f6ad55,#ed8936)"><svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="#fff" stroke-width="2" stroke-linecap="round"><path d="M17 21v-2a4 4 0 00-4-4H5a4 4 0 00-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M23 21v-2a4 4 0 00-3-3.87"/><path d="M16 3.13a4 4 0 010 7.75"/></svg></div><h3 class="pillar-title">Médiation en cas de litige</h3><p class="pillar-text">Quand quelque chose se passe mal (et ça arrive), vous n'êtes pas seul face à un inconnu. Notre équipe intervient, les fonds restent bloqués jusqu'à résolution.</p></div>
</div>
<!-- ══ COMMISSION BLOCK ══ -->
<div class="commission-wrap">
  <!-- Intro -->
  <div style="text-align:center;max-width:600px;margin:0 auto 28px">
    <div class="section-label" style="margin-bottom:10px">Tarification</div>
    <h3 style="font-size:26px;font-weight:900;color:var(--n);margin-bottom:12px">Une commission simple, affichée avant paiement</h3>
    <p style="font-size:15px;color:var(--g500);line-height:1.75">Publier est gratuit. Quand vous acceptez une offre, vous payez le prix du prestataire plus la commission Oflem, visible avant de confirmer.</p>
  </div>

  <!-- Tiers -->
  <div class="commission-tiers">
    <div class="ctier ctier-sm">
      <div class="ctier-bar"></div>
      <div class="ctier-label">Petites missions</div>
      <div class="ctier-rate">25<span>%</span></div>
      <div class="ctier-range">Jusqu'à CHF 149</div>
      <div class="ctier-example">Prestataire : CHF 40 → <strong>Vous payez : CHF 50</strong></div>
    </div>
    <div class="ctier ctier-md">
      <div class="ctier-bar"></div>
      <div class="ctier-badge">Le plus courant</div>
      <div class="ctier-label">Missions courantes</div>
      <div class="ctier-rate">20<span>%</span></div>
      <div class="ctier-range">CHF 150 à CHF 499</div>
      <div class="ctier-example">Prestataire : CHF 200 → <strong>Vous payez : CHF 240</strong></div>
    </div>
    <div class="ctier ctier-lg">
      <div class="ctier-bar"></div>
      <div class="ctier-badge ctier-badge-g">Meilleur taux</div>
      <div class="ctier-label">Grands projets</div>
      <div class="ctier-rate">12<span>%</span></div>
      <div class="ctier-range">Dès CHF 500</div>
      <div class="ctier-example">Prestataire : CHF 600 → <strong>Vous payez : CHF 672</strong></div>
    </div>
  </div>

  <!-- Note bas -->
  <div style="display:grid;grid-template-columns:1fr 1fr;gap:16px;max-width:780px;margin:20px auto 0">
    <div style="background:var(--g50);border-radius:14px;padding:18px 20px;border:1px solid var(--g100)">
      <div style="font-size:13px;font-weight:900;color:var(--n);margin-bottom:5px">Pour les prestataires</div>
      <p style="font-size:13px;color:var(--g500);line-height:1.65;margin:0">Le prestataire reçoit 100% de ce qu'il a proposé. La commission est côté client : sa rémunération est nette, dès le départ.</p>
    </div>
    <div style="background:var(--g50);border-radius:14px;padding:18px 20px;border:1px solid var(--g100)">
      <div style="font-size:13px;font-weight:900;color:var(--n);margin-bottom:5px">À quoi elle sert</div>
      <p style="font-size:13px;color:var(--g500);line-height:1.65;margin:0">Vérification des prestataires, protection du paiement par séquestre, support en cas de litige. Pas un simple mur d'annonces.</p>
    </div>
  </div>
</div>

<style>
.commission-wrap{max-width:960px;margin:40px auto 0}
.commission-tiers{display:grid;grid-template-columns:repeat(3,1fr);gap:16px;margin-bottom:16px}
.ctier{background:#fff;border-radius:18px;padding:26px 22px;position:relative;overflow:hidden;display:flex;flex-direction:column;gap:8px;border:2px solid var(--g300)}
.ctier-md{border-color:rgba(255,107,53,.35);box-shadow:0 12px 32px rgba(255,107,53,.10)}
.ctier-lg{border-color:rgba(16,185,129,.35);box-shadow:0 12px 32px rgba(16,185,129,.08)}
.ctier-bar{position:absolute;top:0;left:0;right:0;height:4px}
.ctier-sm .ctier-bar{background:linear-gradient(90deg,#a0aec0,#cbd5e0)}
.ctier-md .ctier-bar{background:linear-gradient(90deg,var(--o),var(--ol))}
.ctier-lg .ctier-bar{background:linear-gradient(90deg,var(--g),#34d399)}
.ctier-badge{position:absolute;top:14px;right:14px;font-size:9px;font-weight:900;padding:3px 9px;border-radius:8px;letter-spacing:.5px;text-transform:uppercase;background:var(--o);color:#fff}
.ctier-badge-g{background:var(--g)}
.ctier-label{font-size:11px;font-weight:800;color:var(--g500);text-transform:uppercase;letter-spacing:1.5px;margin-top:6px}
.ctier-rate{font-size:52px;font-weight:900;letter-spacing:-2px;line-height:1}
.ctier-sm .ctier-rate{color:var(--n)}
.ctier-md .ctier-rate{color:var(--o)}
.ctier-lg .ctier-rate{color:var(--g)}
.ctier-rate span{font-size:26px;font-weight:700}
.ctier-range{font-size:13px;color:var(--g500);font-weight:600}
.ctier-example{background:var(--g50);border-radius:10px;padding:10px 13px;font-size:12.5px;color:var(--g700);line-height:1.5}
.ctier-md .ctier-example{background:#fff5f0}
.ctier-lg .ctier-example{background:#f0fdf4}
.commission-note{font-size:13px;color:var(--g500);text-align:center;line-height:1.7}
.commission-note strong{color:var(--n)}
@media(max-width:640px){.commission-tiers{grid-template-columns:1fr}}
</style>
<!-- ══ / COMMISSION BLOCK ══ -->
</div></section>

<!-- How it works -->
<section class="section section-white reveal" id="how-it-works-legacy" style="display:none"></section>

<!-- Audience -->
<section class="section section-white reveal" id="audience"><div class="container">
<div class="section-head"><div class="section-label">Pour qui</div><h2 class="section-title">Oflem s'adresse à tout le monde.<br>Et on le dit sans sourire gêné.</h2></div>
<div class="audience-split">
  <div class="audience-card client">
    <span class="aud-tag client-tag">👤 Vous avez un besoin</span>
    <h3>Un coup de main. Sans complication.</h3>
    <p>Il y a des jours où déléguer n'est pas un luxe, mais simplement pratique. Qu'il s'agisse d'un petit service ou d'un vrai coup de main, vous êtes aidé par quelqu'un de fiable, près de chez vous.</p>
    <ul class="aud-bullets">
      <li>Publication gratuite, sans engagement</li>
      <li>Prestataires vérifiés dans votre région</li>
      <li>Argent protégé jusqu'à validation</li>
      <li>Assistance en cas de besoin</li>
    </ul>
    <a class="btn btn-primary" style="width:100%;display:block;font-size:16px;padding:15px" onclick="scrollToHero()">Publier ma demande, c'est gratuit</a>
  </div>
  <div class="audience-card provider">
    <span class="aud-tag provider-tag">🛠️ Vous avez des compétences</span>
    <h3>Votre talent mérite d'être payé.</h3>
    <p>Vous avez un savoir-faire, une compétence, ou simplement du temps. Autour de vous, des personnes cherchent exactement ce que vous savez faire, au quotidien comme pour des projets plus conséquents.</p>
    <ul class="aud-bullets">
      <li>Inscription gratuite</li>
      <li>Vous recevez 100% du montant de votre offre</li>
      <li>Paiement garanti avant de commencer</li>
      <li>Votre page personnelle Oflem à partager</li>
    </ul>
    <a class="btn btn-secondary" style="width:100%;display:block;font-size:16px;padding:15px" onclick="oflemNav('provider-signup')">Créer mon profil prestataire</a>
  </div>
</div>
</div></section>

<!-- ═══ MISSIONS À DISTANCE ═══ -->
<section class="section section-gray reveal" id="remote">
<div class="container">
<div class="section-head">
  <div class="section-label">Missions à distance</div>
  <h2 class="section-title">Certaines choses n'ont pas besoin de déplacement.</h2>
  <p class="section-sub">Déclaration d'impôts, traduction de documents, aide pour comprendre un courrier officiel, relecture d'un dossier, mise en page professionnelle. Ces missions se font intégralement en ligne.</p>
</div>

<!-- Exemples de missions -->
<div class="remote-grid">
  <div class="remote-example">
    <p><span class="remote-quote">"</span>Aide pour ma déclaration d'impôts vaudoise, régime indépendant<span class="remote-quote">"</span></p>
  </div>
  <div class="remote-example">
    <p><span class="remote-quote">"</span>Traduction d'un contrat allemand vers le français<span class="remote-quote">"</span></p>
  </div>
  <div class="remote-example">
    <p><span class="remote-quote">"</span>Révision de mon CV pour un poste en Suisse alémanique<span class="remote-quote">"</span></p>
  </div>
  <div class="remote-example">
    <p><span class="remote-quote">"</span>M'expliquer mon décompte de caisse maladie<span class="remote-quote">"</span></p>
  </div>
</div>

<!-- Deux colonnes info -->
<div class="remote-info-grid">
  <div class="remote-info-card remote-info-client">
    <div class="remote-info-icon">👤</div>
    <h4>Vous avez un besoin à distance</h4>
    <p>Décrivez votre demande librement. Un prestataire qualifié travaille depuis chez lui et vous livre le résultat. Paiement protégé, comme pour toute mission Oflem.</p>
    <a class="btn btn-primary btn-sm" style="margin-top:auto" onclick="startWithCategory('Mission à distance')">Publier une mission à distance</a>
  </div>
  <div class="remote-info-card remote-info-provider">
    <div class="remote-info-icon">🖥️</div>
    <h4>Vous proposez vos compétences à distance</h4>
    <p>Les prestataires "remote only" passent par un contrôle d'identité allégé. En contrepartie, ils n'accèdent qu'aux missions à distance. Pour tout contact direct avec un client, la vérification complète est obligatoire.</p>
    <div class="remote-checks">
      <div><span class="rcheck green">✓</span> Inscription simplifiée, identité seule</div>
      <div><span class="rcheck green">✓</span> Missions depuis chez vous, à votre rythme</div>
      <div><span class="rcheck green">✓</span> 100% de votre offre vous revient</div>
      <div><span class="rcheck muted">○</span> Accès limité aux missions à distance uniquement</div>
    </div>
    <a class="btn btn-secondary btn-sm" style="margin-top:auto" onclick="oflemNav('provider-signup')">Créer mon profil prestataire</a>
  </div>
</div>
</div>
</section>

<style>
.remote-grid{display:grid;grid-template-columns:repeat(4,1fr);gap:14px;margin-bottom:40px}
@media(max-width:900px){.remote-grid{grid-template-columns:repeat(2,1fr)}}
.remote-example{background:#fff;border:1.5px solid var(--g300);border-radius:14px;padding:22px;display:flex;align-items:center}
.remote-example p{font-size:13px;color:var(--g700);line-height:1.6;margin:0;font-style:italic}
.remote-quote{color:var(--o);font-style:normal;font-weight:900;font-size:18px;line-height:1}
.remote-info-grid{display:grid;grid-template-columns:1fr 1fr;gap:24px}
@media(max-width:768px){.remote-info-grid{grid-template-columns:1fr}}
.remote-info-card{background:#fff;border:1.5px solid var(--g300);border-radius:20px;padding:32px;display:flex;flex-direction:column;gap:14px}
.remote-info-client{border-top:3px solid var(--o)}
.remote-info-provider{border-top:3px solid var(--n)}
.remote-info-icon{font-size:28px}
.remote-info-card h4{font-size:18px;font-weight:900;color:var(--n);line-height:1.3}
.remote-info-card p{font-size:14px;color:var(--g700);line-height:1.7}
.remote-checks{display:flex;flex-direction:column;gap:8px}
.remote-checks div{font-size:13px;color:var(--g700);display:flex;align-items:center;gap:8px}
.rcheck{font-size:15px;font-weight:900;flex-shrink:0}
.rcheck.green{color:var(--g)}
.rcheck.muted{color:var(--g500)}
</style>

<!-- FAQ -->
<!-- FAQ -->
<section class="section section-gray reveal" id="faq"><div class="container">
<div class="section-head"><div class="section-label">FAQ</div><h2 class="section-title">Questions fréquentes</h2><p class="section-sub">Tout ce que vous devez savoir avant de commencer.</p></div>

<!-- Clients + Prestataires côte à côte : 5 questions chacun -->
<div style="display:grid;grid-template-columns:1fr 1fr;gap:40px;max-width:1100px;margin:0 auto 48px;align-items:start">

<div>
<p style="font-size:11px;font-weight:900;color:var(--o);text-transform:uppercase;letter-spacing:2.5px;margin-bottom:16px;padding:8px 0;border-bottom:2px solid var(--g100)">Pour les clients</p>
<div class="faq-item"><button class="faq-q" onclick="toggleFaq(this)" aria-expanded="false"><strong>Comment fonctionne le séquestre ?</strong><span class="faq-chev"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round"><polyline points="6 9 12 15 18 9"/></svg></span></button><div class="faq-a"><div class="faq-a-inner">Imaginez que vous confiez votre argent à un arbitre de confiance. Il le garde en sécurité jusqu'à ce que le travail soit fait et que vous soyez content. Si tout se passe bien, il le remet au prestataire. Si quelque chose cloche, il attend qu'on trouve une solution. Simple.</div></div></div>
<div class="faq-item"><button class="faq-q" onclick="toggleFaq(this)" aria-expanded="false"><strong>Combien ça coûte pour un client ?</strong><span class="faq-chev"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round"><polyline points="6 9 12 15 18 9"/></svg></span></button><div class="faq-a"><div class="faq-a-inner">Publier une demande est gratuit. Quand vous acceptez une offre, vous payez le montant proposé par le prestataire, plus la commission Oflem, clairement affichée avant validation. Pas de frais cachés, pas de petites lignes.<br><br>La commission est dégressive : <strong>25%</strong> jusqu'à CHF 149 · <strong>20%</strong> entre CHF 150 et 499 · <strong>12%</strong> dès CHF 500. Elle couvre la vérification des prestataires, la protection de votre paiement par séquestre, et notre accompagnement si quelque chose se passe mal. En clair : vous ne payez pas juste pour une mise en relation, vous payez pour un cadre sécurisé.</div></div></div>
<div class="faq-item"><button class="faq-q" onclick="toggleFaq(this)" aria-expanded="false"><strong>Je peux publier n'importe quelle mission ?</strong><span class="faq-chev"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round"><polyline points="6 9 12 15 18 9"/></svg></span></button><div class="faq-a"><div class="faq-a-inner">Absolument. Promenade de chien, colis à récupérer, meuble à monter, déclaration d'impôts. Tout ce qui est légal et vous simplifie la vie peut être publié. Oflem n'est pas réservé aux grands travaux.</div></div></div>
<div class="faq-item"><button class="faq-q" onclick="toggleFaq(this)" aria-expanded="false"><strong>Comment sont vérifiés les prestataires ?</strong><span class="faq-chev"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round"><polyline points="6 9 12 15 18 9"/></svg></span></button><div class="faq-a"><div class="faq-a-inner">Pour les prestataires terrain, nous vérifions la pièce d'identité, le droit de travailler en Suisse, et les qualifications si la mission l'exige. Pour les prestataires à distance, aucun document n'est requis : un email vérifié et un profil complet suffisent.</div></div></div>
<div class="faq-item"><button class="faq-q" onclick="toggleFaq(this)" aria-expanded="false"><strong>Que faire si je ne suis pas satisfait ?</strong><span class="faq-chev"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round"><polyline points="6 9 12 15 18 9"/></svg></span></button><div class="faq-a"><div class="faq-a-inner">Vous n'avez pas à valider la mission si le travail n'est pas conforme. Les fonds restent bloqués tant que le litige n'est pas résolu. Notre équipe de médiation intervient sous 24h ouvrés.</div></div></div>
</div>

<div>
<p style="font-size:11px;font-weight:900;color:var(--n);text-transform:uppercase;letter-spacing:2.5px;margin-bottom:16px;padding:8px 0;border-bottom:2px solid var(--g100)">Pour les prestataires</p>
<div class="faq-item"><button class="faq-q" onclick="toggleFaq(this)" aria-expanded="false"><strong>Comment fonctionne le paiement ?</strong><span class="faq-chev"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round"><polyline points="6 9 12 15 18 9"/></svg></span></button><div class="faq-a"><div class="faq-a-inner">Le client bloque le montant en séquestre avant que vous commenciez. Une fois la mission validée, vous recevez 100% de votre offre sous 2 à 3 jours ouvrés. La commission Oflem est ajoutée au prix côté client. Elle ne diminue jamais ce que vous percevez.</div></div></div>
<div class="faq-item"><button class="faq-q" onclick="toggleFaq(this)" aria-expanded="false"><strong>Combien ça coûte pour un prestataire ?</strong><span class="faq-chev"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round"><polyline points="6 9 12 15 18 9"/></svg></span></button><div class="faq-a"><div class="faq-a-inner">L'inscription est gratuite. Aucun abonnement, aucun frais fixe. Vous proposez un prix, vous recevez 100% de ce montant. Point.<br><br>La commission Oflem (25% · 20% · 12% selon la mission) est ajoutée côté client, jamais prélevée sur votre gain. C'est ce qui permet d'attirer des clients sérieux, avec un paiement garanti avant même que vous commenciez.</div></div></div>
<div class="faq-item"><button class="faq-q" onclick="toggleFaq(this)" aria-expanded="false"><strong>Faut-il être artisan ou indépendant ?</strong><span class="faq-chev"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round"><polyline points="6 9 12 15 18 9"/></svg></span></button><div class="faq-a"><div class="faq-a-inner">Non. Oflem est ouvert aux artisans, indépendants, étudiants et particuliers motivés. Pour les petites missions du quotidien, aucune qualification spécifique n'est requise. Pour les travaux techniques, nous vérifions vos qualifications.</div></div></div>
<div class="faq-item"><button class="faq-q" onclick="toggleFaq(this)" aria-expanded="false"><strong>Je choisis mes missions librement ?</strong><span class="faq-chev"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round"><polyline points="6 9 12 15 18 9"/></svg></span></button><div class="faq-a"><div class="faq-a-inner">Oui. Vous consultez les demandes autour de vous et répondez uniquement à celles qui vous intéressent. Pas d'obligation de volume, pas de pénalité si vous ne postulez pas. Vous travaillez quand vous voulez, comme vous voulez.</div></div></div>
<div class="faq-item"><button class="faq-q" onclick="toggleFaq(this)" aria-expanded="false"><strong>Que se passe-t-il en cas de litige avec un client ?</strong><span class="faq-chev"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round"><polyline points="6 9 12 15 18 9"/></svg></span></button><div class="faq-a"><div class="faq-a-inner">Notre équipe de médiation intervient sous 24h ouvrés. Les fonds restent bloqués en séquestre pendant la résolution. Si vous avez réalisé le travail conformément à ce qui était demandé, vous êtes protégé.</div></div></div>
</div>

</div>

<!-- Questions générales : 2 côte à côte -->
<div style="max-width:1100px;margin:0 auto">
<p style="font-size:11px;font-weight:900;color:#6366f1;text-transform:uppercase;letter-spacing:2.5px;margin-bottom:20px;padding:8px 0;border-bottom:2px solid var(--g100)">Général</p>
<div style="display:grid;grid-template-columns:1fr 1fr;gap:24px">
<div class="faq-item"><button class="faq-q" onclick="toggleFaq(this)" aria-expanded="false"><strong>Dans quelles régions êtes-vous disponibles ?</strong><span class="faq-chev"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round"><polyline points="6 9 12 15 18 9"/></svg></span></button><div class="faq-a"><div class="faq-a-inner">Suisse romande : Genève, Vaud, Fribourg, Neuchâtel, Valais et Jura. Extension vers la Suisse alémanique prévue prochainement.</div></div></div>
<div class="faq-item"><button class="faq-q" onclick="toggleFaq(this)" aria-expanded="false"><strong>Quelle est la relation juridique entre les parties ?</strong><span class="faq-chev"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round"><polyline points="6 9 12 15 18 9"/></svg></span></button><div class="faq-a"><div class="faq-a-inner">Oflem est un intermédiaire de mise en relation (courtier au sens de l'art. 412 CO). Aucun lien de subordination n'existe entre le client et le prestataire. Le prestataire exerce en tant qu'indépendant ou entreprise.</div></div></div>
<div class="faq-item"><button class="faq-q" onclick="toggleFaq(this)" aria-expanded="false"><strong>À quoi sert concrètement la commission ?</strong><span class="faq-chev"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round"><polyline points="6 9 12 15 18 9"/></svg></span></button><div class="faq-a"><div class="faq-a-inner">Elle finance trois choses précises.<br><br><strong>1. La vérification des prestataires</strong> : pièce d'identité et droit de travail pour les prestataires terrain, profil et email pour les prestataires à distance. Avant même votre première demande, le tri est fait.<br><br><strong>2. La protection du paiement</strong> : votre argent est mis en séquestre et libéré uniquement une fois la mission terminée et validée par vous.<br><br><strong>3. L'accompagnement en cas de problème</strong> : si quelque chose ne va pas, les fonds restent bloqués et notre équipe intervient pour trouver une solution.<br><br>Sans commission, Oflem serait une simple petite annonce. Avec, c'est un cadre.</div></div></div>
<div class="faq-item"><button class="faq-q" onclick="toggleFaq(this)" aria-expanded="false"><strong>25% c'est beaucoup pour une petite mission ?</strong><span class="faq-chev"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round"><polyline points="6 9 12 15 18 9"/></svg></span></button><div class="faq-a"><div class="faq-a-inner">Sur une mission à CHF 40, ça représente CHF 10. En échange, vous avez : un prestataire vérifié, un paiement protégé, et une équipe disponible si ça se passe mal. Même pour une promenade de chien ou une course urgente, vous confiez quelque chose — votre temps, votre animal, vos clés. Ce cadre a un coût, et il est le même quelle que soit la taille de la mission.</div></div></div>
</div>
</div>

</div></section>
<style>
@media(max-width:768px){
  #faq .section-head + div[style*="grid-template-columns:1fr 1fr"]{grid-template-columns:1fr!important;gap:0!important}
  #faq div[style*="grid-template-columns:1fr 1fr"]{grid-template-columns:1fr!important}
}
</style>

<!-- CTA Final / Clôture -->
<section class="section reveal" style="background:linear-gradient(135deg,var(--n) 0%,#2d3748 100%);padding:90px 0;position:relative;overflow:hidden">
<div style="position:absolute;inset:0;pointer-events:none">
  <div style="position:absolute;width:500px;height:500px;top:-150px;right:-100px;border-radius:50%;background:radial-gradient(circle,rgba(255,107,53,.15) 0%,transparent 70%);animation:of1 12s ease-in-out infinite"></div>
  <div style="position:absolute;width:350px;height:350px;bottom:-100px;left:-80px;border-radius:50%;background:radial-gradient(circle,rgba(255,107,53,.10) 0%,transparent 70%);animation:of2 15s ease-in-out infinite"></div>
</div>
<div class="container" style="max-width:860px;text-align:center;position:relative;z-index:1">
  <div style="display:inline-flex;align-items:center;gap:8px;background:rgba(255,107,53,.2);border:1px solid rgba(255,107,53,.4);border-radius:999px;padding:7px 18px;font-size:12px;font-weight:800;color:var(--o);letter-spacing:1px;text-transform:uppercase;margin-bottom:36px">
    <span style="width:6px;height:6px;border-radius:50%;background:var(--o);display:inline-block;animation:pulse 2s infinite"></span>
    Prêt à commencer ?
  </div>
  <p style="font-size:42px;font-weight:900;color:#fff;line-height:1.2;letter-spacing:-.8px;margin-bottom:8px">Votre temps compte.</p>
  <p style="font-size:42px;font-weight:900;color:var(--o);line-height:1.2;letter-spacing:-.8px;margin-bottom:8px">Votre énergie aussi.</p>
  <p style="font-size:32px;font-weight:700;color:rgba(255,255,255,.80);line-height:1.3;letter-spacing:-.3px;margin-bottom:28px">Laissez Oflem s'occuper du reste.</p>
  <p style="font-size:17px;color:rgba(255,255,255,.55);line-height:1.75;margin-bottom:44px">Et si vous avez une compétence, un talent, ou simplement l'envie d'aider :<br>quelqu'un, près de chez vous, en a besoin.</p>
  <div style="display:flex;gap:16px;justify-content:center;flex-wrap:wrap">
    <a class="btn btn-primary" style="font-size:17px;padding:16px 40px" onclick="scrollToHero()">Publier ma demande, c'est gratuit</a>
    <a class="btn" style="font-size:17px;padding:16px 40px;background:rgba(255,255,255,.1);color:#fff;border:1.5px solid rgba(255,255,255,.25);border-radius:var(--rs)" onclick="oflemNav('provider-signup')">Devenir prestataire</a>
  </div>
</div>
</section>

<!-- Footer -->
<footer class="footer"><div class="container"><div class="footer-grid">
<div class="footer-col"><a class="logo" style="margin-bottom:14px;display:inline-block;font-size:26px" onclick="oflemNav('home')">Oflem<span class="logo-dot">.</span></a><p style="font-size:14px;color:var(--g500);line-height:1.7;max-width:260px;margin-bottom:14px">La plateforme suisse pour déléguer, du coup de main express à l'artisan qualifié.</p>
<div class="footer-trust">
<span class="footer-trust-badge">🔒 Paiement sécurisé par séquestre</span>
<span class="footer-trust-badge">🇨🇭 Données hébergées en Suisse</span>
<span class="footer-trust-badge">📍 Basé à Lausanne</span>
<span class="footer-trust-badge">✓ Conforme nLPD</span>
</div>
</div>
<div class="footer-col"><h4>Plateforme</h4><a onclick="scrollToHero()">Publier une demande</a><a onclick="oflemNav('provider-signup')">Devenir prestataire</a><a href="#how-it-works">Comment ça marche</a><a href="#petites-missions">Exemples de missions</a><a href="#faq">FAQ</a></div>
<div class="footer-col"><h4>Entreprise</h4><a onclick="oflemNav('legal-about')">À propos</a><a href="/cdn-cgi/l/email-protection#93f0fcfde7f2f0e7d3fcf5fff6febdf0fb">Nous contacter</a></div>
<div class="footer-col"><h4>Légal</h4><a onclick="oflemNav('legal-mentions')">Mentions légales</a><a onclick="oflemNav('legal-cgu')">CGU</a><a onclick="oflemNav('legal-privacy')">Protection des données</a><a onclick="oflemNav('legal-cookies')">Politique de cookies</a></div>
</div><div class="footer-bottom"><span>© 2026 Oflem · Suisse</span><div class="footer-swiss"><span class="footer-badge">Made in Switzerland</span><span class="footer-badge">Données hébergées en Suisse</span><span class="footer-badge">Conforme nLPD</span></div></div></div></footer>

<div class="mobile-cta"><a class="btn btn-primary" style="display:block;text-align:center;font-size:16px;padding:16px" onclick="scrollToHero()">Publier une demande →</a></div>
</div><!-- /home -->

<!-- ═══ LOGIN PAGE ═══ -->
<div id="oflem-login" class="oflem-page hidden">
<style>
.login-bg{min-height:100vh;background:linear-gradient(135deg,#0f1117 0%,#1a1d3f 50%,#0f1117 100%);display:flex;align-items:center;justify-content:center;padding:40px 20px;position:relative;overflow:hidden}
.login-bg::before{content:'';position:absolute;inset:0;background:radial-gradient(ellipse 80% 60% at 50% 0%,rgba(255,107,53,.12),transparent),radial-gradient(ellipse 60% 50% at 80% 100%,rgba(102,126,234,.1),transparent);pointer-events:none}
.login-lines{position:absolute;inset:0;overflow:hidden;pointer-events:none}
.login-line{position:absolute;width:1px;background:linear-gradient(180deg,transparent,rgba(255,255,255,.06),transparent);animation:loginLineFlow 8s ease-in-out infinite}
.login-line:nth-child(1){left:15%;height:60%;top:20%;animation-delay:0s}
.login-line:nth-child(2){left:35%;height:40%;top:30%;animation-delay:1.5s}
.login-line:nth-child(3){left:65%;height:50%;top:15%;animation-delay:3s}
.login-line:nth-child(4){left:80%;height:35%;top:40%;animation-delay:2s}
@keyframes loginLineFlow{0%,100%{opacity:0;transform:translateY(-20px)}30%,70%{opacity:1;transform:translateY(0)}}
.login-card{background:rgba(255,255,255,.04);border:1px solid rgba(255,255,255,.1);backdrop-filter:blur(40px);border-radius:24px;padding:56px 48px;max-width:460px;width:100%;position:relative;animation:loginCardIn .7s cubic-bezier(.22,1,.36,1) forwards;opacity:0;transform:translateY(24px)}
@keyframes loginCardIn{to{opacity:1;transform:translateY(0)}}
.login-logo{font-size:32px;font-weight:900;color:#fff;letter-spacing:-.8px;margin-bottom:40px;display:block}
.login-logo span{color:var(--o)}
.login-greeting{font-size:28px;font-weight:900;color:#fff;line-height:1.2;margin-bottom:8px;letter-spacing:-.5px}
.login-sub{font-size:15px;color:rgba(255,255,255,.5);line-height:1.6;margin-bottom:40px}
.login-choice{display:grid;grid-template-columns:1fr 1fr;gap:12px;margin-bottom:32px}
.login-choice-btn{padding:20px 16px;border-radius:16px;border:1.5px solid rgba(255,255,255,.1);background:rgba(255,255,255,.04);cursor:pointer;transition:all .3s cubic-bezier(.4,0,.2,1);text-align:center;position:relative;overflow:hidden}
.login-choice-btn::before{content:'';position:absolute;inset:0;opacity:0;transition:opacity .3s;border-radius:14px}
.login-choice-btn.client-choice::before{background:linear-gradient(135deg,rgba(255,107,53,.15),rgba(255,107,53,.05))}
.login-choice-btn.provider-choice::before{background:linear-gradient(135deg,rgba(102,126,234,.15),rgba(102,126,234,.05))}
.login-choice-btn:hover::before{opacity:1}
.login-choice-btn:hover{border-color:rgba(255,255,255,.25);transform:translateY(-2px)}
.login-choice-icon{width:40px;height:40px;border-radius:12px;margin:0 auto 12px;display:flex;align-items:center;justify-content:center}
.login-choice-title{font-size:15px;font-weight:800;color:#fff;margin-bottom:4px}
.login-choice-sub{font-size:12px;color:rgba(255,255,255,.4);line-height:1.4}
.login-divider{display:flex;align-items:center;gap:12px;margin-bottom:28px}
.login-divider-line{flex:1;height:1px;background:rgba(255,255,255,.08)}
.login-divider-text{font-size:12px;color:rgba(255,255,255,.3);font-weight:600}
.login-field{margin-bottom:16px}
.login-field label{display:block;font-size:12px;font-weight:700;color:rgba(255,255,255,.5);text-transform:uppercase;letter-spacing:1.5px;margin-bottom:8px}
.login-field input{width:100%;padding:16px 18px;background:rgba(255,255,255,.06);border:1.5px solid rgba(255,255,255,.1);border-radius:12px;color:#fff;font-size:15px;font-family:inherit;transition:all .25s}
.login-field input::placeholder{color:rgba(255,255,255,.25)}
.login-field input:focus{outline:none;border-color:rgba(255,107,53,.5);background:rgba(255,255,255,.08)}
.login-submit{width:100%;padding:18px;background:linear-gradient(135deg,var(--o),var(--ol));color:#fff;border:none;border-radius:12px;font-size:16px;font-weight:800;cursor:pointer;transition:all .3s;margin-top:8px;letter-spacing:.3px}
.login-submit:hover{transform:translateY(-2px);box-shadow:0 8px 24px rgba(255,107,53,.4)}
.login-back{display:block;text-align:center;margin-top:24px;font-size:13px;color:rgba(255,255,255,.3);cursor:pointer;transition:color .2s}
.login-back:hover{color:rgba(255,255,255,.6)}
.login-trust{display:flex;gap:20px;justify-content:center;margin-top:32px}
.login-trust-item{font-size:11px;color:rgba(255,255,255,.2);display:flex;align-items:center;gap:5px}
.login-trust-dot{width:5px;height:5px;border-radius:50%;background:rgba(255,255,255,.2)}
</style>
<div class="login-bg">
  <div class="login-lines">
    <div class="login-line"></div><div class="login-line"></div><div class="login-line"></div><div class="login-line"></div>
  </div>
  <div class="login-card">
    <a class="login-logo" onclick="oflemNav('home')">Oflem<span>.</span></a>
    
    <!-- Step 1: greeting + choice (shown by default) -->
    <div id="login-step-choice">
      <div class="login-greeting" id="login-greeting-text">Ravi de vous revoir.</div>
      <p class="login-sub">Continuez là où vous en étiez, votre tableau de bord vous attend.</p>
      
      <div class="login-choice">
        <div class="login-choice-btn client-choice" onclick="loginAs('client')">
          <div class="login-choice-icon" style="background:rgba(255,107,53,.15)">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="rgba(255,107,53,1)" stroke-width="2" stroke-linecap="round"><path d="M20 21v-2a4 4 0 00-4-4H8a4 4 0 00-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>
          </div>
          <div class="login-choice-title">Espace client</div>
          <div class="login-choice-sub">Gérer mes missions et offres reçues</div>
        </div>
        <div class="login-choice-btn provider-choice" onclick="loginAs('provider')">
          <div class="login-choice-icon" style="background:rgba(102,126,234,.15)">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="rgba(102,126,234,1)" stroke-width="2" stroke-linecap="round"><path d="M14.7 6.3a1 1 0 00 0 1.4l1.6 1.6a1 1 0 001.4 0l3-3a1 1 0 000-1.4l-1.6-1.6a1 1 0 00-1.4 0z"/><path d="M5 1v1m0 8v1m4-5h1M9 5H8M7 3L6 4M3 7l-1 1m5-1 1 1"/><path d="M2 12a5 5 0 005 5l4 4 4-4a5 5 0 000-7"/></svg>
          </div>
          <div class="login-choice-title">Espace prestataire</div>
          <div class="login-choice-sub">Voir mes opportunités et revenus</div>
        </div>
      </div>

      <div class="login-divider"><div class="login-divider-line"></div><div class="login-divider-text">ou connectez-vous manuellement</div><div class="login-divider-line"></div></div>
      
      <div class="login-field">
        <label>Adresse email</label>
        <input type="email" id="login-email" placeholder="votre@email.ch" autocomplete="email">
      </div>
      <div class="login-field">
        <label>Mot de passe</label>
        <input type="password" id="login-password" placeholder="Votre mot de passe">
      </div>
      <button class="login-submit" onclick="loginSubmit()">Continuer</button>
    </div>

    <a class="login-back" onclick="oflemNav('home')">← Retour à l'accueil</a>
    
    <div class="login-trust">
      <div class="login-trust-item"><div class="login-trust-dot"></div>Connexion chiffrée</div>
      <div class="login-trust-item"><div class="login-trust-dot"></div>Données en Suisse</div>
      <div class="login-trust-item"><div class="login-trust-dot"></div>Conforme nLPD</div>
    </div>
  </div>
</div>
</div>

<!-- ═══ CONFIRM ═══ -->
<div id="oflem-confirm" class="oflem-page hidden">
<header class="header"><div class="container"><nav class="nav"><a class="logo" onclick="oflemNav('home')">Oflem<span class="logo-dot">.</span></a><a class="nav-btn-login" onclick="oflemNav('home')">← Retour</a></nav></div></header>
<section class="section" style="padding-top:50px"><div class="container" style="max-width:680px">

<!-- Auto-save restore banner -->
<div id="autosave-banner" style="display:none;background:linear-gradient(135deg,#fff8e7,#fffbf0);border:1.5px solid #fbbf24;border-radius:14px;padding:14px 18px;margin-bottom:24px;align-items:center;gap:12px">
  <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="#d97706" stroke-width="2" stroke-linecap="round" style="flex-shrink:0"><path d="M19 21H5a2 2 0 01-2-2V5a2 2 0 012-2h11l5 5v14a2 2 0 01-2 2z"/><polyline points="17 21 17 13 7 13 7 21"/><polyline points="7 3 7 8 15 8"/></svg>
  <div style="flex:1"><p style="font-size:13px;font-weight:700;color:#92400e;margin-bottom:2px">Brouillon sauvegardé retrouvé</p><p style="font-size:12px;color:#b45309">Nous avons récupéré votre dernière saisie. Voulez-vous la restaurer ?</p></div>
  <button onclick="restoreDraft()" style="padding:8px 16px;background:#fbbf24;border:none;border-radius:8px;font-size:13px;font-weight:700;color:#fff;cursor:pointer;white-space:nowrap">Restaurer</button>
  <button onclick="discardDraft()" style="padding:4px 10px;background:transparent;border:none;color:#b45309;cursor:pointer;font-size:20px;line-height:1">×</button>
</div>

<div style="text-align:center;margin-bottom:40px">
<div class="progress-bar-wrap">
  <div class="progress-step-item"><div class="progress-step-circle active">1</div><div class="progress-step-label active">Votre demande</div></div>
  <div class="progress-connector"></div>
  <div class="progress-step-item"><div class="progress-step-circle">2</div><div class="progress-step-label">Votre compte</div></div>
  <div class="progress-connector"></div>
  <div class="progress-step-item"><div class="progress-step-circle">3</div><div class="progress-step-label">Vérification</div></div>
</div>
<h2 class="section-title" style="font-size:36px">Configurez votre demande</h2><p style="color:var(--g500);font-size:15px">Plus c'est précis, meilleures sont les offres.</p></div>
<form onsubmit="submitConfirm(event)" style="background:#fff;border:1px solid var(--g300);border-radius:var(--rl);padding:36px;box-shadow:var(--sh)">
<div style="margin-bottom:24px"><label for="confirm-service" style="font-size:14px;font-weight:900;color:var(--n);display:block;margin-bottom:8px">Votre besoin</label><input type="text" id="confirm-service" readonly style="width:100%;padding:14px 16px;border:2px solid var(--g300);border-radius:var(--rs);font-size:16px;font-weight:600;color:var(--n);background:var(--g50)"></div>
<div id="domestic-nudge" style="display:none;margin-bottom:24px;padding:16px 20px;background:#fffbeb;border:1.5px solid #fbbf24;border-radius:var(--rs);animation:pgIn .3s ease both">
<div style="display:flex;gap:12px;align-items:flex-start">
<span style="font-size:14px;flex-shrink:0;margin-top:2px;font-weight:900;color:#92400e">!</span>
<div>
<h4 style="font-size:14px;font-weight:900;color:#92400e;margin-bottom:6px">Obligation légale — Économie domestique</h4>
<p style="font-size:13px;color:#78350f;line-height:1.7;margin-bottom:8px">En Suisse, le nettoyage et les services à domicile sont soumis aux cotisations sociales (AVS/LAA). <strong>En tant que client, vous pouvez être considéré comme employeur.</strong></p>
<p style="font-size:13px;color:#78350f;line-height:1.7;margin-bottom:10px">Nous vous recommandons l'utilisation du <strong>Chèque-emploi</strong> de votre canton pour simplifier vos déclarations et vous mettre en conformité.</p>
<div style="display:flex;gap:8px;flex-wrap:wrap;margin-bottom:14px">
<a href="https://www.chequeemploi.ch" target="_blank" rel="noopener" style="display:inline-flex;align-items:center;gap:6px;padding:6px 14px;background:#fef3c7;border:1px solid #f59e0b;border-radius:8px;font-size:12px;font-weight:800;color:#92400e;text-decoration:none;transition:all .2s" onmouseover="this.style.background='#fde68a'" onmouseout="this.style.background='#fef3c7'">→ chequeemploi.ch</a>
<a onclick="oflemNav('legal-cgu')" style="display:inline-flex;align-items:center;gap:6px;padding:6px 14px;background:transparent;border:1px solid #d97706;border-radius:8px;font-size:12px;font-weight:700;color:#92400e;cursor:pointer;transition:all .2s">Art. 6 de nos CGU</a>
</div>
<!-- Checkbox d'acceptation obligatoire -->
<label id="domestic-ack-label" style="display:flex;gap:10px;align-items:flex-start;cursor:pointer;padding:12px 14px;background:#fff;border:2px solid #fbbf24;border-radius:10px;transition:border-color .2s" onclick="domesticAckChange()">
  <input type="checkbox" id="domestic-ack" style="margin-top:2px;accent-color:#d97706;width:18px;height:18px;flex-shrink:0;cursor:pointer">
  <span style="font-size:13px;font-weight:700;color:#78350f;line-height:1.55">J'ai lu et compris mes obligations légales en matière d'économie domestique (AVS/LAA). Je reconnais que je peux être considéré comme employeur pour ce service.</span>
</label>
<p id="domestic-ack-error" style="display:none;font-size:12px;color:#dc2626;font-weight:700;margin-top:6px;padding-left:2px">⚠ Veuillez cocher cette case pour continuer.</p>
</div>
</div>
</div>
<div style="display:grid;grid-template-columns:1fr 1fr;gap:16px;margin-bottom:24px"><div><label for="confirm-firstName" style="font-size:14px;font-weight:900;color:var(--n);display:block;margin-bottom:8px">Prénom</label><input type="text" id="confirm-firstName" required placeholder="Votre prénom" style="width:100%;padding:14px 16px;border:2px solid var(--g300);border-radius:var(--rs);font-size:15px"></div><div><label for="confirm-city" style="font-size:14px;font-weight:900;color:var(--n);display:block;margin-bottom:8px">Ville</label><select id="confirm-city" required style="width:100%;padding:14px 16px;border:2px solid var(--g300);border-radius:var(--rs);font-size:15px;background:#fff"><option value="">Sélectionner…</option><option>Genève</option><option>Lausanne</option><option>Fribourg</option><option>Neuchâtel</option><option>Sion</option><option>Montreux</option><option>Nyon</option><option>Morges</option><option>Vevey</option><option>Yverdon-les-Bains</option></select></div></div>
<div style="margin-bottom:24px"><label for="confirm-desc" style="font-size:14px;font-weight:900;color:var(--n);display:block;margin-bottom:8px">Description détaillée</label><textarea id="confirm-desc" rows="4" placeholder="Décrivez ce dont vous avez besoin : quoi, où, quand, contraintes éventuelles…" style="width:100%;padding:14px 16px;border:2px solid var(--g300);border-radius:var(--rs);font-size:15px;resize:vertical;font-family:inherit;line-height:1.6" oninput="checkDomesticDesc();checkModeration(this,'confirm-desc-mod-error')"></textarea>
<div id="confirm-desc-mod-error" class="moderation-error">⛔ Ce type de contenu n'est pas autorisé sur Oflem. Veuillez modifier votre description.</div>
<button type="button" onclick="simulatePhotoUpload()" style="margin-top:10px;display:inline-flex;align-items:center;gap:8px;padding:10px 18px;background:var(--g50);border:1.5px dashed var(--g300);border-radius:var(--rs);color:var(--g700);font-size:13px;font-weight:700;cursor:pointer;transition:all .2s;width:100%;justify-content:center" onmouseover="this.style.borderColor='var(--o)';this.style.color='var(--o)'" onmouseout="this.style.borderColor='var(--g300)';this.style.color='var(--g700)'" id="photo-upload-btn">Ajouter des photos (optionnel mais recommandé)</button>
<div id="photo-preview" style="display:none;margin-top:10px;padding:12px;background:var(--g50);border-radius:var(--rs);border:1px solid var(--g100)"></div>
<p style="font-size:11px;color:var(--g500);margin-top:6px">Les photos aident les prestataires à estimer plus précisément le coût des travaux.</p>
</div>
<div style="margin-bottom:24px">
  <label style="font-size:14px;font-weight:900;color:var(--n);display:block;margin-bottom:6px">Votre budget (CHF)</label>
  
  <!-- Prix conseillé selon le service -->
  <div id="price-advice" style="display:none;background:linear-gradient(135deg,#f0fdf4,#ecfdf5);border:1px solid rgba(16,185,129,.2);border-radius:10px;padding:12px 16px;margin-bottom:12px;font-size:13px;color:#047857"></div>
  
  <!-- Input libre -->
  <div style="position:relative">
    <span style="position:absolute;left:16px;top:50%;transform:translateY(-50%);font-size:16px;font-weight:900;color:var(--g500)">CHF</span>
    <input type="number" id="confirm-budget" min="5" max="50000" step="5" value="200" placeholder="Entrez votre budget" style="width:100%;padding:16px 16px 16px 56px;border:2px solid var(--g300);border-radius:var(--rs);font-size:18px;font-weight:900;color:var(--n)" oninput="updateCommissionPreview()">
  </div>
  
  <!-- Aperçu commission -->
  <div id="commission-preview" style="margin-top:12px;padding:14px 16px;background:#fff8f5;border:1px solid rgba(255,107,53,.15);border-radius:10px;display:none">
    <div style="font-size:11px;font-weight:900;text-transform:uppercase;letter-spacing:1.5px;color:var(--o);margin-bottom:10px">Récapitulatif du paiement</div>
    <div style="display:flex;flex-direction:column;gap:6px">
      <div style="display:flex;justify-content:space-between;font-size:13px;color:var(--g700)"><span>Prix de la mission (offre prestataire)</span><span id="cp-offer" style="font-weight:700">CHF 200.–</span></div>
      <div style="display:flex;justify-content:space-between;font-size:13px;color:var(--o)">
        <span>+ Commission Oflem <span id="cp-rate">(20%)</span></span>
        <span id="cp-commission" style="font-weight:700">+CHF 40.–</span>
      </div>
      <div style="height:1px;background:rgba(255,107,53,.1);margin:4px 0"></div>
      <div style="display:flex;justify-content:space-between;font-size:15px;font-weight:900;color:var(--n)"><span>Total que vous payez</span><span id="cp-total">CHF 240.–</span></div>
    </div>
    <p style="font-size:11px;color:var(--g500);margin-top:8px;line-height:1.5">La commission finance le maintien de la plateforme, le mécanisme de séquestre et la vérification des identités des prestataires.</p>
  </div>
</div>

<div style="display:grid;grid-template-columns:1fr 1fr;gap:16px;margin-bottom:24px">
  <div>
    <label for="confirm-date" style="font-size:14px;font-weight:900;color:var(--n);display:block;margin-bottom:8px">Date souhaitée</label>
    <input type="date" id="confirm-date" style="width:100%;padding:14px 16px;border:2px solid var(--g300);border-radius:var(--rs);font-size:15px;color:var(--n);background:#fff">
  </div>
  <div>
    <label for="confirm-time" style="font-size:14px;font-weight:900;color:var(--n);display:block;margin-bottom:8px">Heure souhaitée</label>
    <select id="confirm-time" style="width:100%;padding:14px 16px;border:2px solid var(--g300);border-radius:var(--rs);font-size:15px;background:#fff;color:var(--n)">
      <option value="">Flexible</option>
      <option>08:00</option><option>09:00</option><option>10:00</option>
      <option>11:00</option><option>12:00</option><option>13:00</option>
      <option>14:00</option><option>15:00</option><option>16:00</option>
      <option>17:00</option><option>18:00</option><option>19:00</option>
      <option>20:00</option>
    </select>
  </div>
</div>
<button type="submit" class="btn btn-primary" style="width:100%;font-size:17px;padding:18px" id="confirmBtn">Étape suivante →</button>
<p style="text-align:center;font-size:12px;color:var(--g500);margin-top:14px">Gratuit · Sans engagement</p>
</form></div></section></div>

<!-- ═══ SIGNUP ═══ -->
<div id="oflem-signup" class="oflem-page hidden">
<header class="header"><div class="container"><nav class="nav"><a class="logo" onclick="oflemNav('home')">Oflem<span class="logo-dot">.</span></a><a class="nav-btn-login" onclick="goBackFromSignup()">← Retour</a></nav></div></header>
<section class="section" style="padding-top:50px"><div class="container" style="max-width:480px">
<div style="text-align:center;margin-bottom:40px">
<div class="progress-bar-wrap">
  <div class="progress-step-item"><div class="progress-step-circle done">✓</div><div class="progress-step-label">Votre demande</div></div>
  <div class="progress-connector done"></div>
  <div class="progress-step-item"><div class="progress-step-circle active">2</div><div class="progress-step-label active">Votre compte</div></div>
  <div class="progress-connector"></div>
  <div class="progress-step-item"><div class="progress-step-circle">3</div><div class="progress-step-label">Vérification</div></div>
</div>
<h2 class="section-title" style="font-size:36px">Créez votre compte</h2></div>
<form onsubmit="oflemSignup(event)" style="background:#fff;border:1px solid var(--g300);border-radius:var(--rl);padding:36px;box-shadow:var(--sh)">
<div style="margin-bottom:20px"><label for="signup-email" style="font-size:14px;font-weight:900;color:var(--n);display:block;margin-bottom:8px">Email</label><input type="email" id="signup-email" required placeholder="votre@email.ch" style="width:100%;padding:16px;border:2px solid var(--g300);border-radius:var(--rs);font-size:16px"><span id="signup-email-error" style="font-size:12px;color:#e53e3e;display:none;margin-top:6px">Email invalide.</span></div>
<div style="margin-bottom:20px"><label for="signup-phone" style="font-size:14px;font-weight:900;color:var(--n);display:block;margin-bottom:8px">Téléphone</label><div style="display:flex;align-items:center"><span style="padding:16px 12px;background:var(--g50);border:2px solid var(--g300);border-right:none;border-radius:var(--rs) 0 0 var(--rs);font-size:15px;font-weight:700;color:var(--g500);white-space:nowrap">🇨🇭 +41</span><input type="tel" id="signup-phone" required placeholder="79 123 45 67" pattern="[0-9\s]{9,12}" maxlength="14" style="flex:1;padding:16px;border:2px solid var(--g300);border-left:none;border-radius:0 var(--rs) var(--rs) 0;font-size:16px;min-width:0"></div><p style="font-size:11px;color:var(--g500);margin-top:4px">Utilisé uniquement pour vérifier votre compte.</p></div>
<div style="margin-bottom:24px"><label for="signup-password" style="font-size:14px;font-weight:900;color:var(--n);display:block;margin-bottom:8px">Mot de passe</label><input type="password" id="signup-password" required minlength="8" placeholder="8 caractères minimum" style="width:100%;padding:16px;border:2px solid var(--g300);border-radius:var(--rs);font-size:16px"></div>
<div style="margin-bottom:20px"><label style="display:flex;gap:10px;align-items:flex-start;cursor:pointer"><input type="checkbox" id="signup-age" required style="margin-top:3px;accent-color:var(--o);width:18px;height:18px;flex-shrink:0"><span style="font-size:13px;color:var(--g700);line-height:1.5">Je confirme avoir <strong>18 ans révolus</strong> et être juridiquement capable de contracter en Suisse.</span></label></div>
<button type="submit" class="btn btn-primary" style="width:100%;font-size:17px;padding:18px" id="signupBtn">Créer mon compte →</button>
<p style="text-align:center;font-size:12px;color:var(--g500);margin-top:14px">En créant un compte, vous acceptez nos <a onclick="oflemNav('legal-cgu')" style="color:var(--o);cursor:pointer;text-decoration:underline">CGU</a> et <a onclick="oflemNav('legal-privacy')" style="color:var(--o);cursor:pointer;text-decoration:underline">Politique de confidentialité</a>.</p>
</form></div></section></div>

<!-- ═══ OTP ═══ -->
<div id="oflem-otp" class="oflem-page hidden">
<header class="header"><div class="container"><nav class="nav"><a class="logo" onclick="oflemNav('home')">Oflem<span class="logo-dot">.</span></a><a class="nav-btn-login" onclick="oflemNav('signup')">← Retour</a></nav></div></header>
<section class="section" style="padding-top:50px"><div class="container" style="max-width:480px;text-align:center">
<div style="width:72px;height:72px;border-radius:50%;background:linear-gradient(135deg,var(--o),var(--ol));display:flex;align-items:center;justify-content:center;margin:0 auto 20px;box-shadow:0 10px 30px var(--og)"><svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="#fff" stroke-width="2.5" stroke-linecap="round"><rect x="2" y="4" width="20" height="16" rx="2"/><polyline points="22 4 12 13 2 4"/></svg></div>
<div class="progress-bar-wrap" style="margin-bottom:16px">
  <div class="progress-step-item"><div class="progress-step-circle done">✓</div><div class="progress-step-label">Votre demande</div></div>
  <div class="progress-connector done"></div>
  <div class="progress-step-item"><div class="progress-step-circle done">✓</div><div class="progress-step-label">Votre compte</div></div>
  <div class="progress-connector done"></div>
  <div class="progress-step-item"><div class="progress-step-circle active">3</div><div class="progress-step-label active">Vérification</div></div>
</div><h2 class="section-title" style="font-size:32px">Vérifiez votre email</h2>
<p style="color:var(--g500);font-size:15px;margin-bottom:30px">Code envoyé à <strong id="otp-email-display" style="color:var(--n)">…</strong></p>
<form onsubmit="verifyOtp(event)" style="background:#fff;border:1px solid var(--g300);border-radius:var(--rl);padding:36px;box-shadow:var(--sh)">
<div style="display:flex;gap:10px;justify-content:center;margin-bottom:24px" id="otp-inputs">
<input type="text" maxlength="1" class="otp-digit" inputmode="numeric" style="width:52px;height:62px;text-align:center;font-size:24px;font-weight:900;border:2px solid var(--g300);border-radius:var(--rs)" oninput="otpAutoTab(this)">
<input type="text" maxlength="1" class="otp-digit" inputmode="numeric" style="width:52px;height:62px;text-align:center;font-size:24px;font-weight:900;border:2px solid var(--g300);border-radius:var(--rs)" oninput="otpAutoTab(this)">
<input type="text" maxlength="1" class="otp-digit" inputmode="numeric" style="width:52px;height:62px;text-align:center;font-size:24px;font-weight:900;border:2px solid var(--g300);border-radius:var(--rs)" oninput="otpAutoTab(this)">
<input type="text" maxlength="1" class="otp-digit" inputmode="numeric" style="width:52px;height:62px;text-align:center;font-size:24px;font-weight:900;border:2px solid var(--g300);border-radius:var(--rs)" oninput="otpAutoTab(this)">
<input type="text" maxlength="1" class="otp-digit" inputmode="numeric" style="width:52px;height:62px;text-align:center;font-size:24px;font-weight:900;border:2px solid var(--g300);border-radius:var(--rs)" oninput="otpAutoTab(this)">
<input type="text" maxlength="1" class="otp-digit" inputmode="numeric" style="width:52px;height:62px;text-align:center;font-size:24px;font-weight:900;border:2px solid var(--g300);border-radius:var(--rs)" oninput="otpAutoTab(this)">
</div>
<button type="submit" class="btn btn-primary" style="width:100%;font-size:17px;padding:18px" id="otpBtn">Vérifier →</button>
<p style="text-align:center;margin-top:18px;font-size:13px;color:var(--g500)">Pas reçu ? <a style="color:var(--o);font-weight:700;cursor:pointer" onclick="showToast('','Code renvoyé','Un nouveau code a été envoyé.')">Renvoyer le code</a></p>
</form></div></section></div>

<!-- ═══ SUCCESS ═══ -->
<div id="oflem-success" class="oflem-page hidden">
<header class="header"><div class="container"><nav class="nav"><a class="logo" onclick="oflemNav('home')">Oflem<span class="logo-dot">.</span></a></nav></div></header>
<section class="section" style="padding-top:80px"><div class="container" style="max-width:560px;text-align:center">
<div style="width:100px;height:100px;border-radius:50%;background:linear-gradient(135deg,var(--g),#34d399);display:flex;align-items:center;justify-content:center;margin:0 auto 28px;box-shadow:0 16px 40px rgba(16,185,129,.30);animation:sPop .5s cubic-bezier(.175,.885,.32,1.275)"><svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="#fff" stroke-width="3" stroke-linecap="round"><polyline points="20 6 9 17 4 12"/></svg></div>
<style>@keyframes sPop{0%{transform:scale(0)}100%{transform:scale(1)}}</style>
<h2 class="section-title" style="font-size:38px">Demande publiée !</h2>
<p style="font-size:18px;color:var(--g700);line-height:1.7;margin-bottom:16px">Votre demande est en ligne ! Nous alertons les prestataires vérifiés autour de chez vous.</p>
<p style="font-size:15px;color:var(--g500);line-height:1.7;margin-bottom:36px">Vous recevrez une notification dès la première offre reçue.</p>
<a class="btn btn-primary" style="font-size:17px;padding:16px 40px" onclick="oflemNav('dashboard')">Voir mon tableau de bord →</a>
</div></section></div>

<!-- ═══ PROVIDER SIGNUP ═══ -->
<div id="oflem-provider-signup" class="oflem-page hidden">
<header class="header"><div class="container"><nav class="nav"><a class="logo" onclick="oflemNav('home')">Oflem<span class="logo-dot">.</span></a><a class="nav-btn-login" onclick="oflemNav('home')">← Retour</a></nav></div></header>
<section class="section" style="padding-top:50px"><div class="container" style="max-width:620px">

<!-- Header dynamique -->
<div style="text-align:center;margin-bottom:36px">
  <div class="section-label">Inscription prestataire</div>
  <h2 class="section-title" style="font-size:34px" id="ps-main-title">Rejoignez Oflem</h2>
  <p style="color:var(--g500);font-size:15px;max-width:480px;margin:0 auto" id="ps-main-sub">Choisissez d'abord comment vous souhaitez proposer vos services.</p>
</div>

<!-- STEP 0 : Choix du mode -->
<div id="ps-step-0" style="background:#fff;border:1px solid var(--g300);border-radius:var(--rl);padding:36px;box-shadow:var(--sh)">
  <h3 style="font-size:18px;font-weight:900;color:var(--n);margin-bottom:8px;text-align:center">Quel type de prestataire êtes-vous ?</h3>
  <p style="font-size:14px;color:var(--g500);text-align:center;margin-bottom:28px;line-height:1.6">Votre choix détermine les missions accessibles et les documents requis.</p>

  <div style="display:grid;grid-template-columns:1fr 1fr;gap:16px">

    <!-- Standard — Variante A -->
    <div class="ps-mode-card" id="ps-mode-standard" onclick="selectProviderMode('standard')"
      style="border:2px solid var(--g300);border-radius:20px;padding:28px 22px;cursor:pointer;transition:all .25s;display:flex;flex-direction:column;gap:14px"
      onmouseover="this.style.borderColor='var(--o)';this.style.boxShadow='0 8px 24px rgba(255,107,53,.12)'"
      onmouseout="this.style.borderColor='var(--g300)';this.style.boxShadow='none'">
      <div style="width:56px;height:56px;border-radius:14px;background:linear-gradient(135deg,#fff5f0,#fed7c3);display:flex;align-items:center;justify-content:center">
        <svg width="26" height="26" viewBox="0 0 24 24" fill="none" stroke="#ff6b35" stroke-width="2" stroke-linecap="round">
          <path d="M14.7 6.3a1 1 0 000 1.4l1.6 1.6a1 1 0 001.4 0l3-3a1 1 0 000-1.4l-1.6-1.6a1 1 0 00-1.4 0z"/>
          <path d="M2 17l7 5 7-7-5-7-9 9z"/>
        </svg>
      </div>
      <div>
        <div style="font-size:16px;font-weight:900;color:var(--n)">Prestataire terrain</div>
        <div style="font-size:12.5px;color:var(--g500);line-height:1.65;margin-top:5px">Vous vous déplacez chez vos clients. Bricolage, ménage, jardinage, livraisons…</div>
      </div>
      <div style="height:1px;background:var(--g100)"></div>
      <ul style="list-style:none;display:flex;flex-direction:column;gap:7px;margin:0">
        <li style="font-size:12.5px;display:flex;gap:8px"><span style="color:var(--g);font-weight:900;flex-shrink:0">✓</span> Toutes les catégories</li>
        <li style="font-size:12.5px;display:flex;gap:8px"><span style="color:var(--g);font-weight:900;flex-shrink:0">✓</span> Missions locales et à distance</li>
        <li style="font-size:12.5px;display:flex;gap:8px;color:var(--g500)"><span style="flex-shrink:0">○</span> ID + domicile + IBAN requis</li>
      </ul>
      <button style="background:var(--n);color:#fff;border:none;border-radius:12px;padding:13px 20px;font-size:14px;font-weight:800;cursor:pointer;width:100%;margin-top:auto;transition:background .2s"
        onmouseover="this.style.background='var(--o)'" onmouseout="this.style.background='var(--n)'">Choisir ce profil →</button>
    </div>

    <!-- Remote — Variante A -->
    <div class="ps-mode-card" id="ps-mode-remote" onclick="selectProviderMode('remote')"
      style="border:2px solid #bfdbfe;border-radius:20px;padding:28px 22px;cursor:pointer;transition:all .25s;display:flex;flex-direction:column;gap:14px;box-shadow:0 8px 24px rgba(59,130,246,.1)"
      onmouseover="this.style.borderColor='#3b82f6';this.style.boxShadow='0 12px 32px rgba(59,130,246,.18)'"
      onmouseout="this.style.borderColor='#bfdbfe';this.style.boxShadow='0 8px 24px rgba(59,130,246,.1)'">
      <div style="width:56px;height:56px;border-radius:14px;background:linear-gradient(135deg,#eff6ff,#bfdbfe);display:flex;align-items:center;justify-content:center">
        <svg width="26" height="26" viewBox="0 0 24 24" fill="none" stroke="#3b82f6" stroke-width="2" stroke-linecap="round">
          <rect x="2" y="3" width="20" height="14" rx="2"/>
          <path d="M8 21h8m-4-4v4"/>
        </svg>
      </div>
      <div>
        <div style="font-size:16px;font-weight:900;color:var(--n)">Prestataire à distance</div>
        <div style="font-size:12.5px;color:var(--g500);line-height:1.65;margin-top:5px">Vous travaillez depuis chez vous. Traduction, aide administrative, rédaction…</div>
      </div>
      <div style="height:1px;background:var(--g100)"></div>
      <ul style="list-style:none;display:flex;flex-direction:column;gap:7px;margin:0">
        <li style="font-size:12.5px;display:flex;gap:8px"><span style="color:var(--g);font-weight:900;flex-shrink:0">✓</span> Inscription simplifiée</li>
        <li style="font-size:12.5px;display:flex;gap:8px"><span style="color:var(--g);font-weight:900;flex-shrink:0">✓</span> Travaillez depuis partout</li>
        <li style="font-size:12.5px;display:flex;gap:8px;color:var(--g500)"><span style="flex-shrink:0">○</span> Missions à distance uniquement</li>
        <li style="font-size:12.5px;display:flex;gap:8px;color:var(--g500)"><span style="flex-shrink:0">○</span> Aucun document requis</li>
      </ul>
      <button style="background:linear-gradient(135deg,#3b82f6,#6366f1);color:#fff;border:none;border-radius:12px;padding:13px 20px;font-size:14px;font-weight:800;cursor:pointer;width:100%;margin-top:auto">Choisir ce profil →</button>
    </div>

  </div>

  <!-- Disclaimer remote -->
  <div style="margin-top:20px;padding:14px 16px;background:#eff6ff;border:1.5px solid #bfdbfe;border-radius:12px">
    <p style="font-size:12px;color:#1e40af;line-height:1.65;margin:0"><strong>Prestataire à distance :</strong> vous n'accédez qu'aux missions qui se font entièrement en ligne — sans rencontre physique avec le client. Si vous souhaitez un jour proposer des services sur le terrain, vous pourrez compléter votre vérification depuis votre espace.</p>
  </div>
</div>

<!-- Progress dots (cachés jusqu'au choix) -->
<div style="display:flex;justify-content:center;gap:8px;margin-bottom:32px;display:none" id="ps-dots">
  <div class="ps-step-dot" style="width:28px;height:10px;border-radius:5px;background:var(--o)"></div>
  <div class="ps-step-dot" style="width:10px;height:10px;border-radius:50%;background:var(--g300)"></div>
  <div class="ps-step-dot" style="width:10px;height:10px;border-radius:50%;background:var(--g300)"></div>
  <div class="ps-step-dot" style="width:10px;height:10px;border-radius:50%;background:var(--g300)"></div>
</div>

<!-- STEP 1: Infos de base -->
<div id="ps-step-1" style="display:none;background:#fff;border:1px solid var(--g300);border-radius:var(--rl);padding:36px;box-shadow:var(--sh)">

<!-- Badge mode -->
<div id="ps-mode-badge" style="margin-bottom:20px;text-align:center"></div>

<div style="display:flex;align-items:center;gap:12px;margin-bottom:24px">
  <div style="width:36px;height:36px;border-radius:50%;background:linear-gradient(135deg,var(--o),var(--ol));color:#fff;display:flex;align-items:center;justify-content:center;font-size:14px;font-weight:900;flex-shrink:0">1</div>
  <h3 style="font-size:20px;font-weight:900;color:var(--n)">Vos informations</h3>
</div>
<div style="display:grid;grid-template-columns:1fr 1fr;gap:16px;margin-bottom:20px">
  <div><label style="font-size:13px;font-weight:900;color:var(--n);display:block;margin-bottom:6px">Prénom</label><input type="text" id="ps-firstname" required placeholder="Prénom" style="width:100%;padding:14px;border:2px solid var(--g300);border-radius:var(--rs);font-size:15px"></div>
  <div><label style="font-size:13px;font-weight:900;color:var(--n);display:block;margin-bottom:6px">Nom</label><input type="text" id="ps-lastname" required placeholder="Nom" style="width:100%;padding:14px;border:2px solid var(--g300);border-radius:var(--rs);font-size:15px"></div>
</div>
<div style="margin-bottom:20px"><label style="font-size:13px;font-weight:900;color:var(--n);display:block;margin-bottom:6px">Email</label><input type="email" id="ps-email" required placeholder="votre@email.ch" style="width:100%;padding:14px;border:2px solid var(--g300);border-radius:var(--rs);font-size:15px"></div>
<div style="margin-bottom:20px"><label style="font-size:13px;font-weight:900;color:var(--n);display:block;margin-bottom:6px">Téléphone</label><div style="display:flex;align-items:center"><span style="padding:14px 12px;background:var(--g50);border:2px solid var(--g300);border-right:none;border-radius:var(--rs) 0 0 var(--rs);font-size:15px;font-weight:700;color:var(--g500);white-space:nowrap">🇨🇭 +41</span><input type="tel" id="ps-phone" required placeholder="79 123 45 67" pattern="[0-9\s]{9,12}" maxlength="14" style="flex:1;padding:14px;border:2px solid var(--g300);border-left:none;border-radius:0 var(--rs) var(--rs) 0;font-size:15px;min-width:0"></div><p style="font-size:11px;color:var(--g500);margin-top:4px">Utilisé uniquement pour la vérification de votre compte.</p></div>
<!-- Ville : uniquement pour prestataires terrain -->
<div id="ps-city-wrap" style="margin-bottom:24px"><label style="font-size:13px;font-weight:900;color:var(--n);display:block;margin-bottom:6px">Ville d'intervention principale</label><select id="ps-city" style="width:100%;padding:14px;border:2px solid var(--g300);border-radius:var(--rs);font-size:15px;background:#fff"><option value="">Sélectionner…</option><option>Genève</option><option>Lausanne</option><option>Fribourg</option><option>Neuchâtel</option><option>Sion</option><option>Montreux</option><option>Nyon</option><option>Morges</option><option>Vevey</option><option>Yverdon-les-Bains</option></select></div>
<button type="button" class="btn btn-primary" style="width:100%;font-size:16px;padding:16px" onclick="psNext(1)">Continuer →</button>
</div>

<!-- STEP 2: Services, bio, tags -->
<div id="ps-step-2" style="display:none;background:#fff;border:1px solid var(--g300);border-radius:var(--rl);padding:36px;box-shadow:var(--sh)">
<div style="display:flex;align-items:center;gap:12px;margin-bottom:24px">
  <div style="width:36px;height:36px;border-radius:50%;background:linear-gradient(135deg,var(--o),var(--ol));color:#fff;display:flex;align-items:center;justify-content:center;font-size:14px;font-weight:900;flex-shrink:0">2</div>
  <h3 style="font-size:20px;font-weight:900;color:var(--n)">Vos services & compétences</h3>
</div>

<div style="margin-bottom:20px">
  <label style="font-size:13px;font-weight:900;color:var(--n);display:block;margin-bottom:6px">Catégorie principale</label>

  <!-- Catégories TERRAIN (standard) -->
  <select id="ps-category-standard" style="width:100%;padding:14px;border:2px solid var(--g300);border-radius:var(--rs);font-size:15px;background:#fff" onchange="checkDomesticProvider(this.value);updateTagSuggestions()">
    <option value="">Sélectionner…</option>
    <optgroup label="Services du quotidien"><option>Courses & livraison</option><option>Promenade d'animaux</option><option>Aide à la personne</option><option>Nettoyage</option></optgroup>
    <optgroup label="Artisanat & technique"><option>Peinture</option><option>Plomberie</option><option>Électricité</option><option>Menuiserie</option><option>Jardinage</option><option>Rénovation</option></optgroup>
    <optgroup label="Logistique"><option>Déménagement</option><option>Montage meubles</option><option>Transport & manutention</option></optgroup>
    <optgroup label="Autre"><option>Multi-services</option><option>Autre (préciser dans la bio)</option></optgroup>
  </select>

  <!-- Catégories REMOTE uniquement -->
  <select id="ps-category-remote" style="display:none;width:100%;padding:14px;border:2px solid var(--g300);border-radius:var(--rs);font-size:15px;background:#fff" onchange="updateTagSuggestions()">
    <option value="">Sélectionner…</option>
    <optgroup label="Administratif & juridique">
      <option>Aide déclaration d'impôts</option>
      <option>Rédaction de courriers officiels</option>
      <option>Explication de documents administratifs</option>
      <option>Assistance démarches en ligne</option>
    </optgroup>
    <optgroup label="Traduction & rédaction">
      <option>Traduction (FR ↔ DE / EN / IT)</option>
      <option>Relecture et correction de textes</option>
      <option>Rédaction professionnelle</option>
      <option>Mise en page de documents</option>
    </optgroup>
    <optgroup label="Carrière & formation">
      <option>Révision de CV</option>
      <option>Préparation lettre de motivation</option>
      <option>Coaching entretien d'embauche</option>
      <option>Cours particuliers (soutien scolaire)</option>
    </optgroup>
    <optgroup label="Digital & tech">
      <option>Aide informatique à distance</option>
      <option>Création site web simple</option>
      <option>Gestion réseaux sociaux</option>
      <option>Comptabilité & facturation</option>
    </optgroup>
    <optgroup label="Autre">
      <option>Conseil & accompagnement</option>
      <option>Autre (préciser dans la bio)</option>
    </optgroup>
  </select>

  <div id="ps-domestic-nudge" style="display:none;margin-top:12px;padding:14px 16px;background:#fffbeb;border:1.5px solid #fbbf24;border-radius:var(--rs)">
    <p style="font-size:12px;color:#78350f;line-height:1.6;margin-bottom:4px"><strong>Info :</strong> Le nettoyage à domicile relève de l'économie domestique. Vos clients seront informés de leurs obligations AVS/LAA. Cela ne change rien pour vous en tant que prestataire indépendant.</p>
    <a onclick="oflemNav('legal-cgu')" style="font-size:11px;font-weight:700;color:#92400e;cursor:pointer;text-decoration:underline">Voir art. 6 CGU</a>
  </div>
</div>

<div style="margin-bottom:20px"><label style="font-size:13px;font-weight:900;color:var(--n);display:block;margin-bottom:6px">Expérience</label><select id="ps-experience" style="width:100%;padding:14px;border:2px solid var(--g300);border-radius:var(--rs);font-size:15px;background:#fff"><option>Moins de 2 ans</option><option>2–5 ans</option><option>5–10 ans</option><option>Plus de 10 ans</option></select></div>

<!-- Rayon d'intervention : terrain seulement -->
<div id="ps-radius-wrap" style="margin-bottom:20px"><label style="font-size:13px;font-weight:900;color:var(--n);display:block;margin-bottom:6px">Rayon d'intervention</label><input type="range" id="ps-radius" min="5" max="50" step="5" value="15" oninput="document.getElementById('ps-radius-val').textContent=this.value+' km'" style="width:100%;accent-color:var(--o)"><div style="text-align:center;font-size:14px;font-weight:900;color:var(--o)" id="ps-radius-val">15 km</div></div>

<div style="margin-bottom:20px">
  <label style="font-size:13px;font-weight:900;color:var(--n);display:block;margin-bottom:6px">Bio professionnelle</label>
  <textarea id="ps-bio" rows="4" placeholder="Décrivez votre activité, vos points forts, ce qui vous différencie…" style="width:100%;padding:14px;border:2px solid var(--g300);border-radius:var(--rs);font-size:15px;resize:vertical;font-family:inherit;line-height:1.6" oninput="checkModeration(this,'ps-bio-mod-error');debounceBioTags()"></textarea>
  <div id="ps-bio-mod-error" class="moderation-error">⛔ Ce type de contenu n'est pas autorisé sur Oflem.</div>
  <button type="button" style="margin-top:8px;padding:8px 16px;background:#fff5f0;border:1px solid rgba(255,107,53,.3);border-radius:8px;color:var(--o);font-size:12px;font-weight:700;cursor:pointer" onclick="generateBio()" id="ps-bio-gen-btn">Générer une bio avec l'IA</button>
</div>

<!-- Tags compétences -->
<div style="margin-bottom:24px">
  <label style="font-size:13px;font-weight:900;color:var(--n);display:block;margin-bottom:4px">Compétences (tags)</label>
  <p style="font-size:12px;color:var(--g500);margin-bottom:12px">Sélectionnez les tags qui correspondent à vos compétences.</p>
  <div id="ps-tag-suggestions" style="display:flex;flex-wrap:wrap;gap:8px;margin-bottom:12px"></div>
  <div id="ps-tag-selected" style="display:flex;flex-wrap:wrap;gap:6px;min-height:36px;padding:10px 12px;border:2px dashed var(--g300);border-radius:10px;margin-bottom:8px;transition:border-color .2s"></div>
  <div style="display:flex;gap:8px;align-items:center">
    <span style="font-size:11px;color:var(--g500)">Tags sélectionnés :</span>
    <span id="ps-tag-count" style="font-size:11px;font-weight:700;color:var(--o)">0</span>
  </div>
  <button type="button" id="ps-ai-tags-btn" style="margin-top:10px;padding:8px 16px;background:linear-gradient(135deg,#667eea,#764ba2);border:none;border-radius:8px;color:#fff;font-size:12px;font-weight:700;cursor:pointer;display:none" onclick="generateAiTags()">Générer des tags avec l'IA</button>
</div>

<div style="display:flex;gap:12px">
  <button type="button" class="btn btn-secondary" style="flex:1;padding:16px" onclick="psBack(2)">← Retour</button>
  <button type="button" class="btn btn-primary" style="flex:2;padding:16px" onclick="psNext(2)">Continuer →</button>
</div>
</div>

<!-- STEP 3: Documents -->
<div id="ps-step-3" style="display:none;background:#fff;border:1px solid var(--g300);border-radius:var(--rl);padding:36px;box-shadow:var(--sh)">
<div style="display:flex;align-items:center;gap:12px;margin-bottom:20px">
  <div style="width:36px;height:36px;border-radius:50%;background:linear-gradient(135deg,var(--o),var(--ol));color:#fff;display:flex;align-items:center;justify-content:center;font-size:14px;font-weight:900;flex-shrink:0">3</div>
  <h3 style="font-size:20px;font-weight:900;color:var(--n)" id="ps-step3-title">Vérification d'identité</h3>
</div>

<!-- Message rassurant TERRAIN -->
<div id="ps-docs-standard-msg" style="background:linear-gradient(135deg,#f0fdf4,#ecfdf5);border:1.5px solid rgba(16,185,129,.2);border-radius:14px;padding:18px 20px;margin-bottom:28px">
  <div style="font-size:14px;font-weight:900;color:#065f46;margin-bottom:8px">Pourquoi nous demandons ces documents</div>
  <p style="font-size:13px;color:#047857;line-height:1.7;margin-bottom:0">Ces informations confirment votre identité et votre droit de travailler en Suisse — pour garantir un environnement sûr à l'ensemble de la communauté Oflem.</p>
  <div style="margin-top:12px;padding-top:12px;border-top:1px solid rgba(16,185,129,.15)">
    <p style="font-size:12px;color:#047857;margin:0;line-height:1.6">Vos données sont <strong>stockées en Suisse</strong>, chiffrées, et ne sont <strong>jamais partagées</strong> avec des tiers.</p>
  </div>
</div>

<!-- Message simplifié REMOTE -->
<div id="ps-docs-remote-msg" style="display:none;background:linear-gradient(135deg,#eff6ff,#dbeafe);border:1.5px solid rgba(59,130,246,.2);border-radius:14px;padding:18px 20px;margin-bottom:28px">
  <div style="font-size:14px;font-weight:900;color:#1e40af;margin-bottom:8px">🖥️ Inscription simplifiée — prestataire à distance</div>
  <p style="font-size:13px;color:#1d4ed8;line-height:1.7;margin:0">Comme vous travaillez entièrement à distance, aucun document d'identité n'est requis. Votre email et votre numéro de téléphone suffisent pour activer votre compte.</p>
</div>

<!-- Photo de profil -->
<div style="margin-bottom:24px">
  <label style="font-size:13px;font-weight:900;color:var(--n);display:block;margin-bottom:6px">Photo de profil <span style="color:var(--o)">*</span></label>
  <p style="font-size:12px;color:var(--g500);margin-bottom:10px">Une vraie photo de vous — elle rassure les clients et augmente vos chances d'être choisi.</p>
  <div id="ps-photo-preview" style="display:flex;align-items:center;gap:16px">
    <div id="ps-photo-circle" style="width:80px;height:80px;border-radius:50%;background:var(--g100);border:3px dashed var(--g300);display:flex;align-items:center;justify-content:center;flex-shrink:0;transition:all .3s">
      <svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="var(--g500)" stroke-width="1.5" stroke-linecap="round"><path d="M20 21v-2a4 4 0 00-4-4H8a4 4 0 00-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>
    </div>
    <div>
      <button type="button" style="padding:10px 20px;background:var(--g50);border:2px dashed var(--g300);border-radius:10px;color:var(--g700);font-size:13px;font-weight:700;cursor:pointer" onclick="simulateDocUpload('photo')">Télécharger une photo</button>
      <p style="font-size:11px;color:var(--g500);margin-top:6px">JPG ou PNG · Max 5 MB</p>
    </div>
  </div>
  <div id="ps-photo-status" style="display:none;margin-top:8px;font-size:12px;font-weight:700;color:var(--g)">Photo téléchargée</div>
</div>

<!-- Pièce d'identité (terrain seulement) -->
<div id="ps-id-wrap" style="margin-bottom:24px">
  <label style="font-size:13px;font-weight:900;color:var(--n);display:block;margin-bottom:6px">Pièce d'identité <span style="color:var(--o)">*</span></label>
  <p style="font-size:12px;color:var(--g500);margin-bottom:10px">Carte d'identité, passeport ou permis de conduire en cours de validité.</p>
  <div style="border:2px dashed var(--g300);border-radius:10px;padding:20px;text-align:center;cursor:pointer;transition:all .25s" onclick="simulateDocUpload('id')" onmouseover="this.style.borderColor='var(--o)'" onmouseout="this.style.borderColor='var(--g300)'" id="ps-id-drop">
    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="var(--g500)" stroke-width="1.5" stroke-linecap="round" style="margin-bottom:8px"><rect x="2" y="5" width="20" height="14" rx="2"/><line x1="2" y1="10" x2="22" y2="10"/></svg>
    <div style="font-size:13px;font-weight:700;color:var(--g700)">Cliquez pour télécharger</div>
    <div style="font-size:11px;color:var(--g500);margin-top:4px">JPG, PNG ou PDF · Max 10 MB</div>
  </div>
  <div id="ps-id-status" style="display:none;margin-top:8px;padding:10px 14px;background:#ecfdf5;border-radius:8px;border:1px solid rgba(16,185,129,.2);font-size:12px;font-weight:700;color:var(--g)">Document téléchargé et en attente de vérification</div>
</div>

<!-- Domicile + Permis : terrain seulement -->
<div id="ps-docs-extra" style="display:grid;grid-template-columns:1fr 1fr;gap:16px;margin-bottom:24px">
  <div>
    <label style="font-size:13px;font-weight:900;color:var(--n);display:block;margin-bottom:6px">Preuve de domicile <span style="color:var(--o)">*</span></label>
    <p style="font-size:11px;color:var(--g500);margin-bottom:10px">Facture, avis de taxation, bail — document récent.</p>
    <div style="border:2px dashed var(--g300);border-radius:10px;padding:16px;text-align:center;cursor:pointer;transition:all .25s" onclick="simulateDocUpload('domicile')" onmouseover="this.style.borderColor='var(--o)'" onmouseout="this.style.borderColor='var(--g300)'" id="ps-dom-drop">
      <div style="font-size:12px;font-weight:700;color:var(--g700)">Télécharger</div>
    </div>
    <div id="ps-dom-status" style="display:none;margin-top:6px;font-size:11px;font-weight:700;color:var(--g)">Téléchargé</div>
  </div>
  <div>
    <label style="font-size:13px;font-weight:900;color:var(--n);display:block;margin-bottom:6px">Permis de travail CH <span style="font-size:11px;color:var(--g500);font-weight:600">(si applicable)</span></label>
    <p style="font-size:11px;color:var(--g500);margin-bottom:10px">Permis B, C, G ou L pour les ressortissants non-suisses.</p>
    <div style="border:2px dashed var(--g300);border-radius:10px;padding:16px;text-align:center;cursor:pointer;transition:all .25s" onclick="simulateDocUpload('permit')" onmouseover="this.style.borderColor='var(--o)'" onmouseout="this.style.borderColor='var(--g300)'" id="ps-permit-drop">
      <div style="font-size:12px;font-weight:700;color:var(--g700)">Télécharger</div>
    </div>
    <div id="ps-permit-status" style="display:none;margin-top:6px;font-size:11px;font-weight:700;color:var(--g)">Téléchargé</div>
  </div>
</div>

<!-- IBAN -->
<div style="margin-bottom:24px">
  <label style="font-size:13px;font-weight:900;color:var(--n);display:block;margin-bottom:6px">IBAN suisse (coordonnées de paiement)</label>
  <input type="text" id="ps-iban" required placeholder="CH56 0483 5012 3456 7800 9" maxlength="26" style="width:100%;padding:14px;border:2px solid var(--g300);border-radius:var(--rs);font-size:15px;font-family:monospace">
  <p style="font-size:11px;color:var(--g500);margin-top:4px">Votre IBAN suisse — utilisé uniquement pour virer vos gains. Stocké de façon chiffrée, conforme aux normes FINMA.</p>
</div>

<div style="display:flex;gap:12px">
  <button type="button" class="btn btn-secondary" style="flex:1;padding:16px" onclick="psBack(3)">← Retour</button>
  <button type="button" class="btn btn-primary" style="flex:2;padding:16px" onclick="psNext(3)">Continuer →</button>
</div>
</div>

<!-- STEP 4: Finalisation -->
<div id="ps-step-4" style="display:none;background:#fff;border:1px solid var(--g300);border-radius:var(--rl);padding:36px;box-shadow:var(--sh)">
<div style="display:flex;align-items:center;gap:12px;margin-bottom:20px">
  <div style="width:36px;height:36px;border-radius:50%;background:linear-gradient(135deg,var(--o),var(--ol));color:#fff;display:flex;align-items:center;justify-content:center;font-size:14px;font-weight:900;flex-shrink:0">4</div>
  <h3 style="font-size:20px;font-weight:900;color:var(--n)">Finalisation</h3>
</div>

<div style="background:var(--g50);border-radius:var(--rs);padding:20px;margin-bottom:20px">
  <h4 style="font-size:14px;font-weight:900;color:var(--n);margin-bottom:10px">Récapitulatif</h4>
  <div id="ps-summary" style="font-size:13px;color:var(--g700);line-height:1.8"></div>
</div>

<div style="margin-bottom:20px">
  <label style="font-size:13px;font-weight:900;color:var(--n);display:block;margin-bottom:6px">Mot de passe</label>
  <input type="password" id="ps-password" required minlength="8" placeholder="8 caractères minimum" style="width:100%;padding:14px;border:2px solid var(--g300);border-radius:var(--rs);font-size:15px">
</div>

<div style="margin-bottom:24px">
  <label style="display:flex;gap:10px;align-items:flex-start;cursor:pointer">
    <input type="checkbox" id="ps-terms" required style="margin-top:3px;accent-color:var(--o);width:18px;height:18px">
    <span style="font-size:13px;color:var(--g700);line-height:1.5">J'accepte les <a onclick="oflemNav('legal-cgu')" style="color:var(--o);cursor:pointer;text-decoration:underline">CGU</a> et la <a onclick="oflemNav('legal-privacy')" style="color:var(--o);cursor:pointer;text-decoration:underline">Politique de confidentialité</a>. Je confirme exercer en tant qu'indépendant ou entreprise (art. 412 CO).</span>
  </label>
</div>

<div style="background:var(--g50);border-radius:10px;padding:14px 16px;margin-bottom:20px;border:1px solid var(--g100)">
  <p style="font-size:12px;color:var(--g500);line-height:1.6;margin:0">Votre profil sera <strong>examiné par notre équipe</strong> sous 24–48h. Vous recevrez un email de confirmation dès la validation. En attendant, vous pouvez déjà explorer la plateforme.</p>
</div>

<div style="display:flex;gap:12px">
  <button type="button" class="btn btn-secondary" style="flex:1;padding:16px" onclick="psBack(4)">← Retour</button>
  <button type="button" class="btn btn-primary" style="flex:2;padding:16px" onclick="psSubmit()" id="psSubmitBtn">Créer mon profil →</button>
</div>
</div>

</div></section></div>

<!-- ═══ CLIENT DASHBOARD ═══ -->
<div id="oflem-dashboard" class="oflem-page hidden">
<div class="db-mobile-header"><a style="font-size:22px;font-weight:900;color:#fff;text-decoration:none;cursor:pointer" onclick="oflemNav('home')">Oflem<span style="color:var(--o)">.</span></a><button class="db-hamburger" onclick="toggleSidebar('db')"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><line x1="3" y1="6" x2="21" y2="6"/><line x1="3" y1="12" x2="21" y2="12"/><line x1="3" y1="18" x2="21" y2="18"/></svg></button></div>
<div class="db-sidebar-overlay" id="db-overlay" onclick="toggleSidebar('db')"></div>
<div class="db-wrap">
<aside class="db-sidebar" id="db-sidebar">
<div class="db-logo"><a onclick="oflemNav('home')">Oflem<span class="logo-dot">.</span></a></div>
<!-- Role badge -->
<div style="margin:0 16px 20px;padding:10px 14px;background:rgba(255,107,53,.12);border:1px solid rgba(255,107,53,.25);border-radius:10px;text-align:center">
  <div style="font-size:10px;font-weight:900;text-transform:uppercase;letter-spacing:2px;color:rgba(255,255,255,.5);margin-bottom:3px">Espace</div>
  <div style="font-size:14px;font-weight:900;color:var(--o)">Dashboard Client</div>
</div>
<ul class="db-nav" id="db-nav">
<li><a class="active" onclick="dbView('missions')">Ma demande</a></li>
<li><a onclick="dbView('offers')">Offres reçues <span class="badge" id="db-offers-badge">3</span></a></li>
<li><a onclick="dbView('chat')">Messages <span class="badge" id="db-chat-badge" style="display:none">1</span></a></li>
<li><a onclick="dbView('escrow')">Séquestre</a></li>
<li><a onclick="dbView('history')">Historique</a></li>
<li><a onclick="dbView('profile')">Mon profil</a></li>
<li style="margin-top:auto;padding-top:24px;border-top:1px solid rgba(255,255,255,.08)">
  <a onclick="switchToProvider()" style="color:rgba(255,255,255,.55);font-size:13px;display:flex;align-items:center;gap:8px">
    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"><path d="M14.7 6.3a1 1 0 000 1.4l1.6 1.6a1 1 0 001.4 0l3-3a1 1 0 000-1.4l-1.6-1.6a1 1 0 00-1.4 0z"/><path d="M5 1v3m0 4v3m4-5h3m-5 0H4"/><path d="M2 12a5 5 0 005 5l4 4 4-4a5 5 0 000-7"/></svg>
    Passer en mode prestataire
  </a>
  <a onclick="oflemNav('home')" style="color:rgba(255,255,255,.3);margin-top:12px;font-size:12px">← Retour au site</a>
</li>
</ul></aside>
<main class="db-main">
<div class="demo-banner"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><circle cx="12" cy="12" r="10"/><line x1="12" y1="8" x2="12" y2="12"/><line x1="12" y1="16" x2="12.01" y2="16"/></svg> Aperçu démo — Vos vraies données apparaîtront ici une fois votre compte activé.</div>
<div class="db-header"><h1 class="db-title" id="db-title">Ma demande</h1><a class="btn btn-primary btn-sm" onclick="scrollToHero();oflemNav('home')">+ Nouvelle demande</a></div>
<div id="db-content"></div>
</main></div></div>

<!-- ═══ PROVIDER DASHBOARD ═══ -->
<div id="oflem-provider-dashboard" class="oflem-page hidden">
<style>
</style>
<div class="db-mobile-header" style="background:#0f3d2a"><a style="font-size:22px;font-weight:900;color:#fff;text-decoration:none;cursor:pointer" onclick="oflemNav('home')">Oflem<span style="color:#34d399">.</span></a><button class="db-hamburger" onclick="toggleSidebar('pd')"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><line x1="3" y1="6" x2="21" y2="6"/><line x1="3" y1="12" x2="21" y2="12"/><line x1="3" y1="18" x2="21" y2="18"/></svg></button></div>
<div class="db-sidebar-overlay" id="pd-overlay" onclick="toggleSidebar('pd')"></div>
<div class="db-wrap">
<aside class="db-sidebar" id="pd-sidebar">
<div class="db-logo"><a onclick="oflemNav('home')">Oflem<span class="logo-dot">.</span></a></div>
<!-- Role badge -->
<div style="margin:0 16px 20px;padding:10px 14px;background:rgba(16,185,129,.12);border:1px solid rgba(16,185,129,.25);border-radius:10px;text-align:center">
  <div style="font-size:10px;font-weight:900;text-transform:uppercase;letter-spacing:2px;color:rgba(255,255,255,.5);margin-bottom:3px">Espace</div>
  <div style="font-size:14px;font-weight:900;color:var(--g)">Dashboard Prestataire</div>
</div>
<ul class="db-nav" id="pd-nav">
<li><a class="active" onclick="pdView('opportunities')" style="color:rgba(255,255,255,.9)">Opportunités</a></li>
<li><a onclick="pdView('my-offers')" style="color:rgba(255,255,255,.7)">Mes offres</a></li>
<li><a onclick="pdView('chat')" style="color:rgba(255,255,255,.7)">Messages <span class="badge" id="pd-chat-badge" style="display:none">1</span></a></li>
<li><a onclick="pdView('earnings')" style="color:rgba(255,255,255,.7)">Revenus & Séquestre</a></li>
<li><a onclick="pdView('profile')" style="color:rgba(255,255,255,.7)">Mon profil</a></li>
<li style="margin-top:auto;padding-top:24px;border-top:1px solid rgba(255,255,255,.08)">
  <a onclick="switchToClient()" style="color:rgba(255,255,255,.55);font-size:13px;display:flex;align-items:center;gap:8px">
    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"><path d="M20 21v-2a4 4 0 00-4-4H8a4 4 0 00-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>
    Passer en mode client
  </a>
  <a onclick="oflemNav('home')" style="color:rgba(255,255,255,.3);margin-top:12px;font-size:12px">← Retour au site</a>
</li>
</ul></aside>
<main class="db-main">
<div class="demo-banner" style="background:rgba(16,185,129,.1);border-color:rgba(16,185,129,.2);color:#047857"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><circle cx="12" cy="12" r="10"/><line x1="12" y1="8" x2="12" y2="12"/><line x1="12" y1="16" x2="12.01" y2="16"/></svg> Aperçu démo — Vos vraies missions apparaîtront ici une fois votre profil activé.</div>
<div class="db-header"><h1 class="db-title" id="pd-title">Opportunités</h1><span style="display:inline-flex;align-items:center;gap:6px;background:#ecfdf5;padding:6px 14px;border-radius:var(--rs);font-size:13px;font-weight:700;color:var(--g)"><span style="width:6px;height:6px;border-radius:50%;background:var(--g);animation:pulse 2s infinite"></span> Profil actif</span></div>
<div id="pd-content"></div>
</main></div></div>

<!-- ═══ LEGAL PAGES ═══ -->
<!-- Each legal page shares the same shell but different content -->

<!-- CGU -->
<div id="oflem-legal-cgu" class="oflem-page hidden">
<header class="header"><div class="container"><nav class="nav"><a class="logo" onclick="oflemNav('home')">Oflem<span class="logo-dot">.</span></a><a class="nav-btn-login" onclick="oflemNav('home')">← Retour</a></nav></div></header>
<section class="section" style="padding-top:40px"><div class="container">
<div style="text-align:center;margin-bottom:24px"><div class="section-label">Légal</div><h2 class="section-title" style="font-size:36px">Conditions Générales d'Utilisation</h2><p style="color:var(--g500);font-size:13px">Dernière mise à jour : 1er février 2026</p></div>
<div class="legal-nav"><a class="active" onclick="oflemNav('legal-cgu')">CGU</a><a onclick="oflemNav('legal-mentions')">Mentions légales</a><a onclick="oflemNav('legal-privacy')">Protection des données</a><a onclick="oflemNav('legal-cookies')">Cookies</a><a onclick="oflemNav('legal-about')">À propos</a></div>
<div class="legal-content" style="background:#fff;border:1px solid var(--g300);border-radius:var(--rl);padding:40px;box-shadow:0 2px 8px rgba(0,0,0,.06)">
<h2>1. Objet et champ d'application</h2>
<p>Les présentes Conditions Générales d'Utilisation (ci-après « CGU ») régissent l'accès et l'utilisation de la plateforme Oflem (ci-après « la Plateforme »), accessible à l'adresse oflem.ch, exploitée par Oflem SA (en cours de constitution), société de droit suisse.</p>
<p>Oflem est une plateforme de mise en relation entre des personnes recherchant des services (ci-après « Clients ») et des prestataires indépendants ou entreprises proposant leurs services (ci-après « Prestataires »). <strong>Oflem agit exclusivement en qualité de courtier au sens des articles 412 et suivants du Code des obligations suisse (CO)</strong>.</p>

<h2>2. Rôle d'Oflem et absence de lien de subordination</h2>
<p>Oflem est un intermédiaire technique de mise en relation. <strong>Oflem n'est pas partie au contrat de service conclu entre le Client et le Prestataire.</strong></p>
<p>Les Prestataires inscrits sur la Plateforme exercent leur activité en tant que travailleurs indépendants au sens de l'art. 12 LAVS ou en tant qu'entreprises inscrites au registre du commerce. Aucun lien de subordination (art. 319 CO) n'existe entre Oflem et les Prestataires. Notamment :</p>
<ul>
<li>Oflem ne fixe pas les prix des prestations — le Prestataire détermine librement ses tarifs ;</li>
<li>Oflem ne donne aucune instruction sur la méthode, le lieu ou l'horaire d'exécution du travail ;</li>
<li>Oflem ne fournit pas d'outils ni de matériaux pour l'exécution des prestations ;</li>
<li>Le Prestataire est libre d'accepter ou de refuser toute mission proposée sur la Plateforme ;</li>
<li>Le Prestataire peut exercer son activité pour d'autres plateformes ou clients simultanément.</li>
</ul>
<p>Le Prestataire est seul responsable de ses obligations fiscales (TVA, impôt sur le revenu), sociales (AVS/AI/APG, assurance-accidents) et administratives (autorisation de travail, inscription au registre du commerce si nécessaire).</p>

<h2>3. Inscription et obligations des utilisateurs</h2>
<h3>3.1 Conditions d'inscription</h3>
<p>L'inscription est ouverte à toute personne physique majeure (18 ans révolus) ou personne morale domiciliée en Suisse. L'utilisateur garantit l'exactitude des informations fournies.</p>
<h3>3.2 Obligations du Client</h3>
<p>Le Client s'engage à fournir une description précise et honnête de sa demande, à respecter les délais convenus avec le Prestataire, et à valider ou contester le travail dans un délai de 5 jours ouvrés après notification d'achèvement.</p>
<h3>3.3 Obligations du Prestataire</h3>
<p>Le Prestataire s'engage à disposer des qualifications nécessaires, à fournir un travail conforme aux termes convenus, et à respecter le droit suisse applicable, notamment la LTr (loi sur le travail) s'il emploie du personnel.</p>

<h2>4. Fonctionnement du séquestre</h2>
<p>Le paiement est sécurisé par un mécanisme de séquestre :</p>
<ul>
<li><strong>Blocage</strong> : le montant convenu est bloqué sur un compte séquestre dès l'acceptation de l'offre par le Client ;</li>
<li><strong>Notification</strong> : le Prestataire est informé du blocage des fonds et peut commencer le travail ;</li>
<li><strong>Libération</strong> : à l'achèvement du travail, le Client valide et les fonds sont libérés au Prestataire, déduction faite de la commission Oflem ;</li>
<li><strong>Litige</strong> : en cas de désaccord, les fonds restent bloqués pendant la procédure de médiation (cf. art. 7).</li>
</ul>
<p>Les fonds en séquestre sont gérés par un <strong>prestataire de services de paiement agréé</strong> (ci-après « le Partenaire financier »), en conformité avec la législation suisse sur les services financiers. <strong>Oflem ne détient jamais directement les fonds des utilisateurs.</strong> Le Partenaire financier (ex. : Stripe Connect ou équivalent) est soumis aux régulations applicables et assure la séparation des fonds conformément aux exigences de la FINMA.</p>

<h2>5. Commission et tarification</h2>
<p>La publication d'une demande par un Client est gratuite. Le Client ne paie aucun frais de service additionnel en dehors de la commission Oflem décrite ci-dessous.</p>
<p>La commission Oflem est <strong>ajoutée au prix proposé par le Prestataire</strong> et facturée au Client. Le Prestataire reçoit <strong>100% du montant de son offre</strong>. La commission est dégressive selon le montant de la mission :</p>
<ul>
<li><strong>25% (hors TVA)</strong> — missions jusqu'à CHF 149.–</li>
<li><strong>20% (hors TVA)</strong> — missions de CHF 150.– à CHF 499.–</li>
<li><strong>12% (hors TVA)</strong> — missions à partir de CHF 500.–</li>
</ul>
<p>La commission est prélevée automatiquement lors du paiement par le Client, avant le blocage des fonds en séquestre. Le montant total affiché au Client inclut toujours la commission Oflem.</p>
<p>Oflem se réserve le droit de modifier ses tarifs avec un préavis de 30 jours, notifié par email aux utilisateurs concernés.</p>

<h2>6. Services d'économie domestique</h2>
<p>Certains services proposés sur la Plateforme, notamment le <strong>nettoyage, le repassage, la garde d'enfants et l'aide à domicile</strong>, relèvent de l'économie domestique au sens du droit suisse du travail.</p>
<p><strong>Pour ces services, le Client reconnaît qu'il peut acquérir le statut d'employeur au sens de l'art. 319 CO et de la LAVS</strong>, même si la prestation est ponctuelle. À ce titre, le Client s'engage à :</p>
<ul>
<li>Procéder aux déclarations obligatoires auprès de la caisse de compensation AVS de son canton ;</li>
<li>S'acquitter des cotisations sociales (AVS/AI/APG/AC) et de l'assurance-accidents (LAA) conformément à la législation en vigueur ;</li>
<li>Utiliser, le cas échéant, le <strong>système de chèque-emploi</strong> proposé par son canton, qui simplifie ces démarches.</li>
</ul>
<p>Oflem met à disposition un outil de mise en relation et un mécanisme de séquestre pour sécuriser les paiements. <strong>Oflem n'assume aucune responsabilité en cas de non-déclaration du travail par le Client ou le Prestataire.</strong> Les parties sont seules responsables du respect de leurs obligations légales en matière de droit du travail et de sécurité sociale.</p>
<p>Un rappel informatif est affiché lors de la publication d'une demande relevant de l'économie domestique.</p>

<h2>7. Protection des communications</h2>
<p>La messagerie intégrée à la Plateforme est le canal de communication officiel entre Client et Prestataire. <strong>L'échange de coordonnées personnelles (numéro de téléphone, adresse email, adresse postale) via la messagerie est interdit</strong> avant la conclusion et le paiement de la mission, afin de garantir la traçabilité et la protection des deux parties.</p>
<p>Tout contournement de cette règle pourra entraîner la suspension du compte concerné.</p>

<h2>8. Médiation et résolution des litiges</h2>
<p>En cas de litige entre un Client et un Prestataire, les parties s'engagent à recourir en premier lieu à la procédure de médiation proposée par Oflem, gratuite pour les deux parties. Le médiateur rend un avis non contraignant dans un délai de 5 jours ouvrés.</p>
<p>À défaut d'accord, les parties conservent l'intégralité de leurs droits de recours selon le droit suisse. Le for juridique est fixé au siège social d'Oflem SA, sauf dispositions impératives contraires (art. 32 CPC pour les consommateurs).</p>

<h2>9. Responsabilité</h2>
<p>Oflem ne garantit pas la qualité, la ponctualité ou la conformité des prestations fournies par les Prestataires. Le contrat de service est conclu directement entre le Client et le Prestataire.</p>
<p>La responsabilité d'Oflem est limitée au bon fonctionnement technique de la Plateforme et au mécanisme de séquestre, dans les limites permises par le droit suisse.</p>

<h2>10. Droit applicable et for</h2>
<p>Les présentes CGU sont régies par le droit suisse. Le for exclusif est fixé au siège social d'Oflem SA, sous réserve des dispositions impératives du droit de la consommation suisse.</p>
</div></div></section></div>

<!-- MENTIONS LÉGALES -->
<div id="oflem-legal-mentions" class="oflem-page hidden">
<header class="header"><div class="container"><nav class="nav"><a class="logo" onclick="oflemNav('home')">Oflem<span class="logo-dot">.</span></a><a class="nav-btn-login" onclick="oflemNav('home')">← Retour</a></nav></div></header>
<section class="section" style="padding-top:40px"><div class="container">
<div style="text-align:center;margin-bottom:24px"><div class="section-label">Légal</div><h2 class="section-title" style="font-size:36px">Mentions légales</h2></div>
<div class="legal-nav"><a onclick="oflemNav('legal-cgu')">CGU</a><a class="active" onclick="oflemNav('legal-mentions')">Mentions légales</a><a onclick="oflemNav('legal-privacy')">Protection des données</a><a onclick="oflemNav('legal-cookies')">Cookies</a><a onclick="oflemNav('legal-about')">À propos</a></div>
<div class="legal-content" style="background:#fff;border:1px solid var(--g300);border-radius:var(--rl);padding:40px;box-shadow:0 2px 8px rgba(0,0,0,.06)">
<h2>Éditeur du site</h2>
<p>Oflem SA (en cours de constitution)<br>Forme juridique : Société anonyme de droit suisse<br>Siège social : Suisse romande<br>Contact : <a href="/cdn-cgi/l/email-protection#70131f1e04111304301f161c151d5e1318" style="color:var(--o)"><span class="__cf_email__" data-cfemail="a9cac6c7ddc8cadde9c6cfc5ccc487cac1">[email&#160;protected]</span></a></p>

<h2>Hébergement</h2>
<p>Le site est hébergé en Suisse, conformément aux exigences de la nLPD en matière de localisation des données.</p>

<h2>Propriété intellectuelle</h2>
<p>L'ensemble du contenu du site (textes, images, graphismes, logo, icônes) est la propriété exclusive d'Oflem SA ou de ses partenaires. Toute reproduction, représentation ou diffusion, même partielle, est interdite sans autorisation préalable écrite (art. 2 LDA).</p>

<h2>Responsabilité éditoriale</h2>
<p>Oflem SA s'efforce d'assurer l'exactitude des informations publiées sur le site. Toutefois, Oflem SA ne saurait être tenue responsable d'omissions, d'inexactitudes ou de carences dans la mise à jour de ces informations.</p>
<p>Les avis et évaluations publiés par les utilisateurs relèvent de leur seule responsabilité. Oflem SA se réserve le droit de modérer ou supprimer tout contenu contraire aux CGU ou au droit suisse.</p>
</div></div></section></div>

<!-- PRIVACY -->
<div id="oflem-legal-privacy" class="oflem-page hidden">
<header class="header"><div class="container"><nav class="nav"><a class="logo" onclick="oflemNav('home')">Oflem<span class="logo-dot">.</span></a><a class="nav-btn-login" onclick="oflemNav('home')">← Retour</a></nav></div></header>
<section class="section" style="padding-top:40px"><div class="container">
<div style="text-align:center;margin-bottom:24px"><div class="section-label">Légal</div><h2 class="section-title" style="font-size:36px">Protection des données</h2><p style="color:var(--g500);font-size:13px">Conforme à la nLPD (RS 235.1) entrée en vigueur le 1er septembre 2023</p></div>
<div class="legal-nav"><a onclick="oflemNav('legal-cgu')">CGU</a><a onclick="oflemNav('legal-mentions')">Mentions légales</a><a class="active" onclick="oflemNav('legal-privacy')">Protection des données</a><a onclick="oflemNav('legal-cookies')">Cookies</a><a onclick="oflemNav('legal-about')">À propos</a></div>
<div class="legal-content" style="background:#fff;border:1px solid var(--g300);border-radius:var(--rl);padding:40px;box-shadow:0 2px 8px rgba(0,0,0,.06)">
<h2>1. Responsable du traitement</h2>
<p>Oflem SA (en cours de constitution), Suisse romande.<br>Conseiller à la protection des données : <a href="/cdn-cgi/l/email-protection#88f8fae1fee9ebf1c8e7eee4ede5a6ebe0" style="color:var(--o)"><span class="__cf_email__" data-cfemail="1666647f6077756f5679707a737b38757e">[email&#160;protected]</span></a></p>

<h2>2. Données collectées</h2>
<p>Nous collectons les données suivantes dans le cadre de l'utilisation de la Plateforme :</p>
<ul>
<li><strong>Données d'identification</strong> : nom, prénom, adresse email, numéro de téléphone ;</li>
<li><strong>Données professionnelles</strong> (Prestataires) : catégorie de service, expérience, zone d'intervention, bio professionnelle ;</li>
<li><strong>Données de transaction</strong> : montants, dates, statut des paiements ;</li>
<li><strong>Données de communication</strong> : messages échangés via la messagerie intégrée ;</li>
<li><strong>Données techniques</strong> : adresse IP, type de navigateur, pages consultées, cookies essentiels.</li>
</ul>

<h2>3. Finalités du traitement</h2>
<p>Les données sont traitées pour : l'exécution du contrat de service (art. 31 al. 2 let. a nLPD), la gestion du séquestre, la prévention des fraudes, l'amélioration de la Plateforme, et le respect de nos obligations légales.</p>

<h2>4. Base juridique</h2>
<p>Le traitement repose sur : l'exécution du contrat (art. 31 al. 2 let. a nLPD), le consentement de l'utilisateur lorsque nécessaire (art. 6 al. 6 nLPD), et les intérêts légitimes d'Oflem (prévention de la fraude, amélioration du service).</p>

<h2>5. Durée de conservation</h2>
<p>Les données personnelles sont conservées pendant la durée de la relation contractuelle, puis pendant 10 ans conformément aux obligations comptables suisses (art. 958f CO). Les données de communication sont conservées 2 ans après la clôture de la mission.</p>

<h2>6. Transfert de données</h2>
<p><strong>Aucune donnée personnelle n'est transférée hors de Suisse</strong>. Toutes les données sont hébergées sur des serveurs situés en Suisse.</p>
<p>En cas de nécessité future de transfert vers un pays tiers, celui-ci ne sera effectué que vers un pays offrant un niveau de protection adéquat au sens de l'art. 16 nLPD, ou moyennant des garanties appropriées (art. 16 al. 2 nLPD).</p>

<h2>7. Droits des personnes concernées</h2>
<p>Conformément à la nLPD, vous disposez des droits suivants :</p>
<ul>
<li><strong>Droit d'accès</strong> (art. 25 nLPD) : obtenir confirmation du traitement et une copie de vos données ;</li>
<li><strong>Droit de rectification</strong> : corriger les données inexactes ;</li>
<li><strong>Droit à l'effacement</strong> : demander la suppression de vos données (sous réserve des obligations légales de conservation) ;</li>
<li><strong>Droit à la portabilité</strong> (art. 28 nLPD) : recevoir vos données dans un format structuré et lisible ;</li>
<li><strong>Droit d'opposition</strong> : vous opposer au traitement à des fins de marketing.</li>
</ul>
<p>Pour exercer vos droits : <a href="/cdn-cgi/l/email-protection#0f7f7d66796e6c764f6069636a62216c67" style="color:var(--o)"><span class="__cf_email__" data-cfemail="e797958e9186849ea788818b828ac9848f">[email&#160;protected]</span></a>. Réponse dans un délai de 30 jours.</p>

<h2>8. Sécurité</h2>
<p>Oflem met en œuvre des mesures techniques et organisationnelles appropriées (art. 8 nLPD) : chiffrement TLS/SSL, hachage des mots de passe, contrôle d'accès, journalisation des accès, sauvegardes régulières.</p>

<h2>9. Violation de données</h2>
<p>En cas de violation de la sécurité des données présentant un risque élevé pour les personnes concernées, Oflem notifiera le Préposé fédéral à la protection des données (PFPDT) dans les meilleurs délais (art. 24 nLPD) et, si nécessaire, les personnes concernées.</p>
</div></div></section></div>

<!-- COOKIES -->
<div id="oflem-legal-cookies" class="oflem-page hidden">
<header class="header"><div class="container"><nav class="nav"><a class="logo" onclick="oflemNav('home')">Oflem<span class="logo-dot">.</span></a><a class="nav-btn-login" onclick="oflemNav('home')">← Retour</a></nav></div></header>
<section class="section" style="padding-top:40px"><div class="container">
<div style="text-align:center;margin-bottom:24px"><div class="section-label">Légal</div><h2 class="section-title" style="font-size:36px">Politique de cookies</h2></div>
<div class="legal-nav"><a onclick="oflemNav('legal-cgu')">CGU</a><a onclick="oflemNav('legal-mentions')">Mentions légales</a><a onclick="oflemNav('legal-privacy')">Protection des données</a><a class="active" onclick="oflemNav('legal-cookies')">Cookies</a><a onclick="oflemNav('legal-about')">À propos</a></div>
<div class="legal-content" style="background:#fff;border:1px solid var(--g300);border-radius:var(--rl);padding:40px;box-shadow:0 2px 8px rgba(0,0,0,.06)">
<h2>Qu'est-ce qu'un cookie ?</h2>
<p>Un cookie est un petit fichier texte déposé sur votre appareil lors de la visite d'un site web. Il permet de mémoriser certaines informations pour faciliter votre navigation.</p>

<h2>Cookies utilisés par Oflem</h2>
<h3>Cookies strictement nécessaires</h3>
<p>Ces cookies sont indispensables au fonctionnement de la Plateforme et ne peuvent pas être désactivés :</p>
<ul>
<li><strong>oflem_session</strong> : identifiant de session, durée : session du navigateur ;</li>
<li><strong>oflem_cookies</strong> : mémorisation de votre choix concernant les cookies, durée : 12 mois ;</li>
<li><strong>oflem_csrf</strong> : protection contre les attaques CSRF, durée : session.</li>
</ul>

<h3>Cookies analytiques (optionnels)</h3>
<p>Ces cookies nous permettent de mesurer l'audience et d'améliorer la Plateforme. Ils ne sont activés qu'avec votre consentement :</p>
<ul>
<li><strong>Outil d'analyse</strong> : solution hébergée en Suisse, sans transfert de données vers l'étranger, données anonymisées.</li>
</ul>

<h2>Aucun cookie publicitaire</h2>
<p>Oflem n'utilise <strong>aucun cookie publicitaire ou de ciblage</strong>. Aucune donnée n'est transmise à des réseaux publicitaires tiers.</p>

<h2>Gestion de vos préférences</h2>
<p>Vous pouvez à tout moment modifier vos préférences en matière de cookies via les paramètres de votre navigateur. La désactivation des cookies essentiels peut toutefois affecter le fonctionnement de la Plateforme.</p>
</div></div></section></div>

<!-- ABOUT -->
<div id="oflem-legal-about" class="oflem-page hidden">
<header class="header"><div class="container"><nav class="nav"><a class="logo" onclick="oflemNav('home')">Oflem<span class="logo-dot">.</span></a><a class="nav-btn-login" onclick="oflemNav('home')">← Retour</a></nav></div></header>
<section class="section" style="padding-top:40px"><div class="container">
<div style="text-align:center;margin-bottom:24px"><div class="section-label">Entreprise</div><h2 class="section-title" style="font-size:36px">À propos d'Oflem</h2></div>
<div class="legal-nav"><a onclick="oflemNav('legal-cgu')">CGU</a><a onclick="oflemNav('legal-mentions')">Mentions légales</a><a onclick="oflemNav('legal-privacy')">Protection des données</a><a onclick="oflemNav('legal-cookies')">Cookies</a><a class="active" onclick="oflemNav('legal-about')">À propos</a></div>
<div class="legal-content" style="background:#fff;border:1px solid var(--g300);border-radius:var(--rl);padding:40px;box-shadow:0 2px 8px rgba(0,0,0,.06)">
<h2>Notre mission</h2>
<p>Oflem est né d'un constat simple : trouver un prestataire de confiance en Suisse reste compliqué. Entre les recommandations de bouche à oreille sans garantie et les plateformes étrangères inadaptées au marché local, il manquait une solution transparente, sécurisée et ancrée en Suisse.</p>
<p>Nous avons créé Oflem pour connecter les particuliers aux bons prestataires — avec un paiement protégé par séquestre, une vérification sérieuse, et une transparence totale sur les prix.</p>

<h2>Qui sommes-nous</h2>
<p>Oflem est un projet fondé et développé en Suisse romande, ancré à Lausanne. Nous ne sommes pas une grande structure. Nous sommes des gens qui connaissent la région, ses usages et ses attentes. Nous préférons construire quelque chose de solide et fiable à l'échelle de la Suisse romande plutôt que de promettre une expansion mondiale en six mois.</p>

<h2>Pourquoi la Suisse ?</h2>
<p>Parce que la qualité de service, la confiance et la protection des données sont des valeurs auxquelles nous tenons. Toutes nos données sont hébergées en Suisse chez Infomaniak. Notre plateforme est conforme à la nLPD. Et notre modèle de séquestre est conçu pour le marché suisse.</p>

<h2>Notre modèle économique</h2>
<p>La publication est gratuite pour les clients. Les prestataires s'inscrivent gratuitement et perçoivent 100% du montant de leur offre. Notre commission (12% à 25% selon la mission) est ajoutée côté client et est toujours affichée avant tout paiement. Pas de surprise, pas d'abonnement caché.</p>

<h2>Nous contacter</h2>
<p>Email : <a href="/cdn-cgi/l/email-protection#97f4f8f9e3f6f4e3d7f8f1fbf2fab9f4ff" style="color:var(--o)"><span class="__cf_email__" data-cfemail="f1929e9f85909285b19e979d949cdf9299">[email&#160;protected]</span></a><br>Pour les prestataires : <a href="/cdn-cgi/l/email-protection#0a7a78654a656c666f67246962" style="color:var(--o)"><span class="__cf_email__" data-cfemail="7000021f301f161c151d5e1318">[email&#160;protected]</span></a><br>Protection des données : <a href="/cdn-cgi/l/email-protection#c2b2b0abb4a3a1bb82ada4aea7afeca1aa" style="color:var(--o)"><span class="__cf_email__" data-cfemail="d8a8aab1aeb9bba198b7beb4bdb5f6bbb0">[email&#160;protected]</span></a></p>
</div></div></section></div>

<script data-cfasync="false" src="/cdn-cgi/scripts/5c5dd728/cloudflare-static/email-decode.min.js"></script><script>
(function(){
'use strict';

// ═══════════════════════════════════════════════════
// STATE
// ═══════════════════════════════════════════════════
var S = {
  request: {service:'',firstName:'',city:'',desc:'',budget:200,date:'',time:'', expiresAt:null},
  user: {email:'',type:'',loggedIn:false},
  provider: {firstName:'',lastName:'',email:'',city:'',category:'',bio:'',tags:[],docs:{}, publicSlug:''},
  hasProviderProfile: false,
  _switchingToProvider: false,
  referralCode: 'OFLEM-' + Math.random().toString(36).substr(2,6).toUpperCase(),
  referralCredit: 0,
  // Simulation state
  offerAccepted: false,
  acceptedOffer: null,
  escrowState: 'none',
  beforePhoto: false,
  afterPhoto: false,
  chatMessages: [],
  providerOfferSent: false,
  providerOfferAccepted: false,
  currentView: 'home',
  contractGenerated: false,
  counterOffer: null,  // {price, date, msg}
  missions: []  // archived missions
};

// Profils fictifs pour la simulation interactive (aucune donnée réelle)
function fCHF(n){var s=Number(n);if(s>=1000){var t=Math.floor(s/1000);var r=s%1000;return 'CHF '+t+"'"+r.toString().padStart(3,'0')+'.–'}return 'CHF '+s+'.–'}
var OFFERS = [
  {id:1,name:'Marco R.',initials:'MR',rating:5,reviews:23,distance:'2.3 km',price:850,available:'Cette semaine',badge:'Meilleur prix',badgeColor:'var(--o)',bio:'Peintre professionnel depuis 8 ans. Spécialisé dans les finitions soignées.',response:'1h'},
  {id:2,name:'Sophie B.',initials:'SB',rating:5,reviews:41,distance:'4.1 km',price:980,available:'Lundi prochain',badge:'Top évalué',badgeColor:'var(--g)',bio:'Artisan peintre, +10 ans d\'expérience. Travail méticuleux et respectueux.',response:'3h'},
  {id:3,name:'Laurent K.',initials:'LK',rating:4,reviews:12,distance:'5.8 km',price:1100,available:'Flexible',badge:'Rapide',badgeColor:'#667eea',bio:'Disponible rapidement. Rénovation complète et peinture.',response:'30min'}
];

// ═══════════════════════════════════════════════════
// NAVIGATION
// ═══════════════════════════════════════════════════
window.oflemNav = function(page) {
  document.querySelectorAll('.oflem-page').forEach(function(p){p.classList.add('hidden');p.classList.remove('page-enter')});
  var target = document.getElementById('oflem-'+page);
  if(!target){
    // Try partial match for legal pages
    if(page.indexOf('legal')===0) target = document.getElementById('oflem-'+page);
    if(!target){target=document.getElementById('oflem-home');page='home';}
  }
  target.classList.remove('hidden');
  void target.offsetWidth;
  target.classList.add('page-enter');
  S.currentView = page;

  // Init hooks
  switch(page){
    case 'confirm':
      var s=document.getElementById('confirm-service');
      if(s&&S.request.service)s.value=S.request.service;
      // Domestic economy nudge
      var nudge=document.getElementById('domestic-nudge');
      if(nudge){
        var svcLower=(S.request.service||'').toLowerCase();
        var domesticKeywords=['nettoyage','ménage','menage','repassage','garde d\'enfant','garde enfant','aide à domicile','aide domestique','femme de ménage','homme de ménage','babysit','cleaning','nanny','gouvernante','auxiliaire de vie'];
        var isDomestic=domesticKeywords.some(function(kw){return svcLower.indexOf(kw)!==-1});
        nudge.style.display=isDomestic?'block':'none';
        // Reset ack state
        var ack=document.getElementById('domestic-ack');
        var ackLabel=document.getElementById('domestic-ack-label');
        var ackErr=document.getElementById('domestic-ack-error');
        if(ack)ack.checked=false;
        if(ackErr)ackErr.style.display='none';
        if(ackLabel){ackLabel.style.borderColor='#fbbf24';ackLabel.style.background='#fff';}
      }
      break;
    case 'otp':
      var ed=document.getElementById('otp-email-display');
      if(ed&&S.user.email)ed.textContent=S.user.email;
      var fd=document.querySelector('#otp-inputs .otp-digit');
      if(fd)setTimeout(function(){fd.focus()},300);
      break;
    case 'dashboard': initClientDashboard(); break;
    case 'provider-dashboard': initProviderDashboard(); break;
  }
  window.scrollTo({top:0,behavior:'smooth'});
};

window.startWithCategory = function(cat){
  const bar = document.getElementById('heroInput');
  if(bar){
    const rect = bar.getBoundingClientRect();
    const offset = window.scrollY + rect.top - 80;
    window.scrollTo({top: offset, behavior: 'smooth'});
    setTimeout(()=>{bar.value=cat+' : ';bar.focus();},400);
  }
};
window.scrollToHero = function(){
  oflemNav('home');
  setTimeout(function(){
    var h=document.getElementById('heroInput');
    if(h){h.focus();window.scrollTo({top:0,behavior:'smooth'});}
  },100);
};

// ═══════════════════════════════════════════════════
// CLIENT FLOW
// ═══════════════════════════════════════════════════
window.publishRequest = function(e){
  if(e)e.preventDefault();
  var inp=document.getElementById('heroInput');
  var v=inp?inp.value.trim():'';
  if(!v){inp.focus();inp.style.borderColor='#e53e3e';setTimeout(function(){inp.style.borderColor=''},2000);return;}
  // Quick moderation check on hero input
  var violation=containsBlockedContent(v);
  if(violation){
    inp.style.borderColor='#f87171';
    showToast('⛔','Publication bloquée','Ce type de contenu ('+violation+') n\'est pas autorisé sur Oflem.');
    setTimeout(function(){inp.style.borderColor=''},3000);
    return;
  }
  S.request.service=v;
  oflemNav('confirm');
};

window.submitConfirm = function(e){
  e.preventDefault();
  // Content moderation check
  if(!fieldPassesMod('confirm-desc','confirm-desc-mod-error'))return;
  // Domestic acknowledgement check
  var nudge=document.getElementById('domestic-nudge');
  if(nudge&&nudge.style.display!=='none'){
    var ack=document.getElementById('domestic-ack');
    var ackErr=document.getElementById('domestic-ack-error');
    if(!ack.checked){
      ackErr.style.display='block';
      document.getElementById('domestic-ack-label').style.borderColor='#dc2626';
      document.getElementById('domestic-ack-label').scrollIntoView({behavior:'smooth',block:'center'});
      return;
    }
  }
  var btn=document.getElementById('confirmBtn');
  btnLoad(btn,'Traitement...');
  S.request.firstName=document.getElementById('confirm-firstName').value.trim();
  S.request.city=document.getElementById('confirm-city').value;
  S.request.desc=document.getElementById('confirm-desc').value.trim();
  S.request.budget=document.getElementById('confirm-budget').value||200;
  S.request.date=document.getElementById('confirm-date').value;
  S.request.time=document.getElementById('confirm-time').value;
  setTimeout(function(){btnReset(btn,'Continuer → Créer mon compte');oflemNav('signup')},600);
};

window.oflemSignup = function(e){
  e.preventDefault();
  var em=document.getElementById('signup-email'),email=em.value.trim(),err=document.getElementById('signup-email-error');
  if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email)){err.style.display='block';em.style.borderColor='#e53e3e';em.focus();return;}
  err.style.display='none';em.style.borderColor='';
  if(!document.getElementById('signup-age').checked){alert('Veuillez confirmer que vous avez 18 ans révolus.');return;}
  var btn=document.getElementById('signupBtn');btnLoad(btn,'Création...');
  S.user.email=email;S.user.type='client';
  setTimeout(function(){btnReset(btn,'Créer mon compte →');oflemNav('otp')},800);
};

window.goBackFromSignup = function(){oflemNav(S.request.service?'confirm':'home')};

window.otpAutoTab = function(el){if(el.value.length===1){var n=el.nextElementSibling;if(n&&n.classList.contains('otp-digit'))n.focus()}};

window.verifyOtp = function(e){
  e.preventDefault();
  var ds=document.querySelectorAll('#otp-inputs .otp-digit'),code='';
  ds.forEach(function(d){code+=d.value});
  if(code.length<6){ds.forEach(function(d){d.style.borderColor='#e53e3e'});setTimeout(function(){ds.forEach(function(d){d.style.borderColor=''})},2000);return}
  var btn=document.getElementById('otpBtn');btnLoad(btn,'Vérification...');
  setTimeout(function(){btnReset(btn,'Vérifier →');oflemNav('success')},1000);
};

// ═══════════════════════════════════════════════════
// PROVIDER SIGNUP
// ═══════════════════════════════════════════════════
// ── Provider mode (standard | remote) ──
var psMode = 'standard';

window.selectProviderMode = function(mode){
  psMode = mode;
  var isRemote = (mode === 'remote');
  // Show mode badge on step 1
  var badge = document.getElementById('ps-mode-badge');
  if(badge) badge.innerHTML = isRemote
    ? '<div style="display:inline-flex;align-items:center;gap:8px;background:#eff6ff;border:1.5px solid #bfdbfe;border-radius:999px;padding:5px 14px;font-size:12px;font-weight:800;color:#1e40af">🖥️ Mode à distance — inscription simplifiée</div>'
    : '<div style="display:inline-flex;align-items:center;gap:8px;background:#fff5f0;border:1.5px solid rgba(255,107,53,.3);border-radius:999px;padding:5px 14px;font-size:12px;font-weight:800;color:var(--o)">🛠️ Mode terrain — vérification complète</div>';
  // Update page header
  var title = document.getElementById('ps-main-title');
  var sub = document.getElementById('ps-main-sub');
  if(title) title.textContent = isRemote ? 'Inscription prestataire à distance' : 'Inscription prestataire terrain';
  if(sub) sub.textContent = isRemote ? '3 étapes. Juste votre identité et vos compétences.' : 'Profil vérifié, missions ciblées, paiement garanti.';
  // Show/hide categories
  var catStd = document.getElementById('ps-category-standard');
  var catRem = document.getElementById('ps-category-remote');
  if(catStd) catStd.style.display = isRemote ? 'none' : 'block';
  if(catRem) catRem.style.display = isRemote ? 'block' : 'none';
  // Show/hide radius
  var rw = document.getElementById('ps-radius-wrap');
  if(rw) rw.style.display = isRemote ? 'none' : 'block';
  // Show/hide city
  var cw = document.getElementById('ps-city-wrap');
  if(cw) cw.style.display = isRemote ? 'none' : 'block';
  // Show/hide extra docs (domicile + permis)
  var extras = document.getElementById('ps-docs-extra');
  if(extras) extras.style.display = isRemote ? 'none' : 'grid';
  var idWrap = document.getElementById('ps-id-wrap');
  if(idWrap) idWrap.style.display = isRemote ? 'none' : 'block';
  // Show right doc message
  var msgStd = document.getElementById('ps-docs-standard-msg');
  var msgRem = document.getElementById('ps-docs-remote-msg');
  if(msgStd) msgStd.style.display = isRemote ? 'none' : 'block';
  if(msgRem) msgRem.style.display = isRemote ? 'block' : 'none';
  // Navigate to step 1
  document.getElementById('ps-step-0').style.display = 'none';
  var dots = document.getElementById('ps-dots');
  if(dots){ dots.style.display = 'flex'; }
  var s1 = document.getElementById('ps-step-1');
  s1.style.display = 'block'; s1.style.opacity = '0'; s1.style.transform = 'translateY(12px)';
  requestAnimationFrame(function(){ s1.style.transition='opacity .3s,transform .3s'; s1.style.opacity='1'; s1.style.transform='translateY(0)'; });
  updatePsDots(1);
};

window.psNext = function(step){
  var el=document.getElementById('ps-step-'+step);
  if(!el)return;
  var isRemote = (psMode === 'remote');
  var inputs=el.querySelectorAll('input[required],select[required]');
  var valid=true;
  inputs.forEach(function(i){if(!i.value.trim()){i.style.borderColor='#e53e3e';valid=false;setTimeout(function(){i.style.borderColor=''},2000)}});
  if(!valid)return;
  if(step===2){ if(!fieldPassesMod('ps-bio','ps-bio-mod-error'))return; }
  if(step===3){
    var sm=document.getElementById('ps-summary');
    var tags=S.provider.tags||[];
    var cat = isRemote
      ? document.getElementById('ps-category-remote').value
      : document.getElementById('ps-category-standard').value;
    var cityLine = isRemote ? '' : ' · ' + gv('ps-city');
    var radiusLine = isRemote ? '' : '<br>Rayon : '+document.getElementById('ps-radius').value+' km';
    if(sm)sm.innerHTML='<strong>'+gv('ps-firstname')+' '+gv('ps-lastname')+'</strong><br>'+
      gv('ps-email')+cityLine+'<br>'+
      'Mode : '+(isRemote?'🖥️ À distance':'🛠️ Terrain')+'<br>'+
      'Catégorie : '+cat+' · '+gv('ps-experience')+radiusLine+'<br>'+
      (tags.length?'Tags : '+tags.join(', '):'');
  }
  el.style.display='none';
  var nx=document.getElementById('ps-step-'+(step+1));
  if(nx){nx.style.display='block';nx.style.opacity='0';nx.style.transform='translateY(12px)';requestAnimationFrame(function(){nx.style.transition='opacity .3s,transform .3s';nx.style.opacity='1';nx.style.transform='translateY(0)'})}
  updatePsDots(step+1);
};
window.psBack = function(step){
  document.getElementById('ps-step-'+step).style.display='none';
  if(step===1){
    document.getElementById('ps-step-0').style.display='block';
    var dots = document.getElementById('ps-dots');
    if(dots) dots.style.display = 'none';
  } else {
    document.getElementById('ps-step-'+(step-1)).style.display='block';
    updatePsDots(step-1);
  }
};
function updatePsDots(active){
  var dots=document.querySelectorAll('#ps-dots .ps-step-dot');
  dots.forEach(function(d,i){var s=i+1;d.style.background=s<=active?'var(--o)':'var(--g300)';d.style.width=s===active?'28px':'10px';d.style.borderRadius=s===active?'5px':'50%'});
}
window.psSubmit = function(){
  if(!document.getElementById('ps-terms').checked){alert('Veuillez accepter les conditions.');return}
  var pw=document.getElementById('ps-password');
  if(pw.value.length<8){pw.style.borderColor='#e53e3e';pw.focus();return}
  var btn=document.getElementById('psSubmitBtn');btnLoad(btn,'Création...');
  var isRemote = (psMode === 'remote');
  S.provider.firstName=gv('ps-firstname');S.provider.lastName=gv('ps-lastname');
  S.provider.email=gv('ps-email');S.provider.city=gv('ps-city');
  S.provider.category = isRemote
    ? document.getElementById('ps-category-remote').value
    : document.getElementById('ps-category-standard').value;
  S.provider.bio=gv('ps-bio');
  S.provider.mode = psMode;
  S.user.type='provider';
  S.hasProviderProfile = true;
  if(S._switchingToProvider){ S._switchingToProvider = false; }
  setTimeout(function(){btnReset(btn,'Créer mon profil →');oflemNav('provider-dashboard')},1200);
};
window.generateBio = function(){
  var btn=document.getElementById('ps-bio-gen-btn'),bio=document.getElementById('ps-bio');

window.checkDomesticProvider = function(val){
  var nudge=document.getElementById('ps-domestic-nudge');
  if(nudge)nudge.style.display=(val==='Nettoyage')?'block':'none';
};

window.simulatePhotoUpload = function(){
  var btn=document.getElementById('photo-upload-btn');
  var preview=document.getElementById('photo-preview');
  btn.innerHTML='⏳ Téléchargement…';btn.style.pointerEvents='none';
  setTimeout(function(){
    preview.style.display='block';
    preview.innerHTML='<div style="display:flex;gap:10px;flex-wrap:wrap">'+
      '<div style="width:80px;height:80px;border-radius:8px;background:linear-gradient(135deg,#e2e8f0,#edf2f7);display:flex;align-items:center;justify-content:center;font-size:24px;border:1px solid var(--g300);position:relative">img️<span style="position:absolute;top:-4px;right:-4px;background:var(--g);color:#fff;width:16px;height:16px;border-radius:50%;font-size:9px;display:flex;align-items:center;justify-content:center">✓</span></div>'+
      '<div style="width:80px;height:80px;border-radius:8px;background:linear-gradient(135deg,#e2e8f0,#edf2f7);display:flex;align-items:center;justify-content:center;font-size:24px;border:1px solid var(--g300);position:relative">–<span style="position:absolute;top:-4px;right:-4px;background:var(--g);color:#fff;width:16px;height:16px;border-radius:50%;font-size:9px;display:flex;align-items:center;justify-content:center">✓</span></div>'+
      '<div onclick="simulatePhotoUpload()" style="width:80px;height:80px;border-radius:8px;border:2px dashed var(--g300);display:flex;align-items:center;justify-content:center;font-size:24px;cursor:pointer;color:var(--g500);transition:all .2s" onmouseover="this.style.borderColor=\'var(--o)\'" onmouseout="this.style.borderColor=\'var(--g300)\'">+</div></div>'+
      '<p style="font-size:11px;color:var(--g500);margin-top:8px">2 photos ajoutées (simulation)</p>';
    btn.innerHTML='Ajouter d\'autres photos';btn.style.pointerEvents='auto';
    showToast('','Photos ajoutées','2 photos téléchargées avec succès.');
  },1200);
};

window.checkDomesticDesc = function(){
  var desc=(document.getElementById('confirm-desc').value||'').toLowerCase();
  var svcLower=(S.request.service||'').toLowerCase();
  var combined=svcLower+' '+desc;
  var domesticKeywords=['nettoyage','ménage','menage','repassage','garde d\'enfant','garde enfant','aide à domicile','aide domestique','femme de ménage','homme de ménage','babysit','cleaning','nanny','gouvernante','auxiliaire de vie'];
  var isDomestic=domesticKeywords.some(function(kw){return combined.indexOf(kw)!==-1});
  var nudge=document.getElementById('domestic-nudge');
  if(nudge){
    nudge.style.display=isDomestic?'block':'none';
    if(!isDomestic){
      // Reset checkbox when nudge is hidden
      var ack=document.getElementById('domestic-ack');
      var ackErr=document.getElementById('domestic-ack-error');
      var ackLabel=document.getElementById('domestic-ack-label');
      if(ack)ack.checked=false;
      if(ackErr)ackErr.style.display='none';
      if(ackLabel)ackLabel.style.borderColor='#fbbf24';
    }
  }
};

window.domesticAckChange = function(){
  setTimeout(function(){
    var ack=document.getElementById('domestic-ack');
    var ackErr=document.getElementById('domestic-ack-error');
    var ackLabel=document.getElementById('domestic-ack-label');
    if(!ack||!ackLabel)return;
    if(ack.checked){
      ackLabel.style.borderColor='#16a34a';
      ackLabel.style.background='#f0fdf4';
      if(ackErr)ackErr.style.display='none';
    } else {
      ackLabel.style.borderColor='#fbbf24';
      ackLabel.style.background='#fff';
    }
  },0);
};
  var isRem = (typeof psMode !== 'undefined' && psMode === 'remote');
  var catEl = document.getElementById(isRem ? 'ps-category-remote' : 'ps-category-standard');
  var name=gv('ps-firstname')||'Professionnel', cat=(catEl&&catEl.value)||'services', city=isRem?'Suisse romande':(gv('ps-city')||'Suisse romande'), exp=gv('ps-experience')||'plusieurs années';
  btn.textContent='⏳ Génération...';btn.disabled=true;
  setTimeout(function(){
    bio.value=name+', professionnel en '+cat.toLowerCase()+' basé à '+city+'. Fort de '+exp.toLowerCase()+' d\'expérience, je m\'engage à fournir un travail soigné et ponctuel. Contactez-moi pour discuter de votre projet.';
    btn.textContent='Générer une bio';btn.disabled=false;
  },1500);
};

function gv(id){var e=document.getElementById(id);return e?e.value.trim():''}

// ═══════════════════════════════════════════════════
// CLIENT DASHBOARD
// ═══════════════════════════════════════════════════
function initClientDashboard(){dbView('missions')}

window.dbView = function(view){
  var titles={missions:'Ma demande',offers:'Offres reçues',chat:'Messages',escrow:'Séquestre',history:'Historique',profile:'Mon profil'};
  document.getElementById('db-title').textContent=titles[view]||view;
  // Update nav
  document.querySelectorAll('#db-nav a').forEach(function(a){a.classList.remove('active')});
  var navItems=document.querySelectorAll('#db-nav a');
  navItems.forEach(function(a){if(a.onclick&&a.onclick.toString().indexOf("'"+view+"'")!==-1)a.classList.add('active')});
  var c=document.getElementById('db-content');

  switch(view){
    case 'missions': c.innerHTML=renderMission(); break;
    case 'offers': c.innerHTML=renderOffers(); break;
    case 'chat': c.innerHTML=renderClientChat(); initChat('client'); break;
    case 'escrow': c.innerHTML=renderClientEscrow(); break;
    case 'history': c.innerHTML=renderHistory('client'); break;
    case 'profile': c.innerHTML=renderProfile('client'); break;
  }
};

function renderMission(){
  // Animated welcome strip for empty state
  if(!S.request.service){
    return '<div style="animation:pgIn .5s ease both">' +
    '<div style="background:linear-gradient(135deg,#fff8f5,#fff);border:1px solid rgba(255,107,53,.12);border-radius:var(--rl);padding:48px 36px;text-align:center;margin-bottom:20px">'+
    '<div style="width:72px;height:72px;border-radius:50%;background:linear-gradient(135deg,var(--o),var(--ol));display:flex;align-items:center;justify-content:center;margin:0 auto 20px;box-shadow:0 8px 24px var(--og)"><svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="#fff" stroke-width="2.5" stroke-linecap="round"><circle cx="11" cy="11" r="8"/><path d="m21 21-4.35-4.35"/></svg></div>'+
    '<h3 style="font-size:22px;font-weight:900;color:var(--n);margin-bottom:8px">Publiez votre première mission</h3>'+
    '<p style="font-size:15px;color:var(--g500);line-height:1.7;max-width:400px;margin:0 auto 24px">Des prestataires vérifiés près de chez vous attendent vos demandes. De la petite course au grand chantier.</p>'+
    '<a class="btn btn-primary" style="font-size:16px;padding:14px 32px" onclick="scrollToHero();oflemNav(\'home\')">Publier ma première demande →</a></div>'+
    // Value props animated cards
    '<div style="display:grid;grid-template-columns:repeat(3,1fr);gap:12px">' +
    ['Paiement sécurisé par séquestre — votre argent ne part que quand vous êtes satisfait.', 'Prestataires vérifiés — identité, qualifications et avis réels.', 'Médiation gratuite — en cas de litige, on est là sous 24h ouvrés.'].map(function(t,i){
      return '<div style="background:#fff;border:1px solid var(--g100);border-radius:14px;padding:20px;animation:pgIn .5s ease both;animation-delay:'+(i*0.12)+'s;opacity:0"><div style="width:10px;height:10px;border-radius:50%;background:var(--o);margin-bottom:12px"></div><p style="font-size:13px;color:var(--g700);line-height:1.6;margin:0">'+t+'</p></div>';
    }).join('') +
    '</div></div>';
  }

  var svc=S.request.service;
  var city=S.request.city||'Suisse romande';
  var budget=S.request.budget||200;
  var dateStr=S.request.date?new Date(S.request.date).toLocaleDateString('fr-CH',{day:'numeric',month:'long',year:'numeric'}):'Flexible';
  var timeStr=S.request.time||'';

  // Expiry logic: missions auto-close after 7 days
  if(!S.request.expiresAt) S.request.expiresAt = Date.now() + 7*24*60*60*1000;
  var now = Date.now();
  var msLeft = S.request.expiresAt - now;
  var daysLeft = Math.max(0, Math.ceil(msLeft / (1000*60*60*24)));
  var expired = msLeft <= 0;
  var expiryColor = daysLeft <= 1 ? '#e53e3e' : daysLeft <= 3 ? '#d97706' : '#047857';
  var expiryBg = daysLeft <= 1 ? '#fff5f5' : daysLeft <= 3 ? '#fffbeb' : '#f0fdf4';
  var expiryBorder = daysLeft <= 1 ? 'rgba(229,62,62,.2)' : daysLeft <= 3 ? '#fbbf24' : 'rgba(16,185,129,.2)';
  return '<div style="animation:pgIn .4s ease both">'+
    (expired?'<div style="background:#fff5f5;border:1.5px solid rgba(229,62,62,.3);border-radius:14px;padding:16px 20px;margin-bottom:16px;display:flex;align-items:center;gap:12px"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="#e53e3e" stroke-width="2.5" stroke-linecap="round"><circle cx="12" cy="12" r="10"/><line x1="12" y1="8" x2="12" y2="12"/><line x1="12" y1="16" x2="12.01" y2="16"/></svg><div style="flex:1"><p style="font-size:13px;font-weight:700;color:#c53030;margin-bottom:2px">Demande expirée</p><p style="font-size:12px;color:#e53e3e">Cette demande a été archivée automatiquement après 7 jours.</p></div><button class="btn btn-primary btn-sm" onclick="scrollToHero();oflemNav(\'home\')">Republier →</button></div>':'')+ 
    '<div style="background:#fff;border:1px solid var(--g300);border-radius:var(--rl);padding:32px;box-shadow:0 2px 8px rgba(0,0,0,.06);margin-bottom:16px">'+
    '<div style="display:flex;justify-content:space-between;align-items:flex-start;flex-wrap:wrap;gap:16px;margin-bottom:20px">'+
    '<div><div style="font-size:10px;font-weight:900;color:var(--o);text-transform:uppercase;letter-spacing:1px;margin-bottom:6px">Demande '+(expired?'archivée':'active')+'</div>'+
    '<h3 style="font-size:22px;font-weight:900;color:var(--n);margin-bottom:4px">'+svc+'</h3>'+
    '<p style="font-size:14px;color:var(--g500)">'+city+' · '+dateStr+(timeStr?' à '+timeStr:'')+' · '+fCHF(budget)+'</p></div>'+
    '<div style="display:flex;flex-direction:column;gap:8px;align-items:flex-end">'+
    '<div style="display:inline-flex;align-items:center;gap:6px;background:'+(expired?'#fff5f5':'#ecfdf5')+';padding:6px 14px;border-radius:var(--rs);font-size:13px;font-weight:700;color:'+(expired?'#e53e3e':'var(--g)')+'"><span style="width:6px;height:6px;border-radius:50%;background:'+(expired?'#e53e3e':'var(--g)')+(expired?'':';animation:pulse 2s infinite')+'">'+'</span> '+(expired?'Expirée':'En ligne')+'</div>'+
    (!expired?'<div style="display:inline-flex;align-items:center;gap:5px;background:'+expiryBg+';border:1px solid '+expiryBorder+';padding:4px 10px;border-radius:8px;font-size:11px;font-weight:700;color:'+expiryColor+'">⏱ '+daysLeft+'j restants</div>':'')+
    '</div></div>'+
    (S.request.desc?'<p style="font-size:14px;color:var(--g700);line-height:1.7;margin-bottom:20px;padding:16px;background:var(--g50);border-radius:var(--rs)">'+S.request.desc+'</p>':'')+
    '<div style="display:flex;gap:10px;flex-wrap:wrap">'+
    (!expired?'<a class="btn btn-primary btn-sm" onclick="dbView(\'offers\')">Voir les offres (3) →</a>':'')+
    '<a class="btn btn-outline btn-sm" onclick="openEditMissionModal()">Modifier la demande</a>'+
    '</div></div>'+
    // Assurance strip
    '<div style="padding:14px 18px;background:linear-gradient(135deg,#f0fdf4,#ecfdf5);border-radius:12px;border:1px solid rgba(16,185,129,.15);display:flex;align-items:center;gap:12px">'+
    '<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="var(--g)" stroke-width="2" stroke-linecap="round"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/></svg>'+
    '<p style="font-size:12px;color:#047857;margin:0;line-height:1.5">Votre paiement ne sera demandé qu\'après avoir choisi un prestataire. Les fonds restent bloqués en séquestre jusqu\'à votre validation du travail.</p>'+
    '</div></div>';
}

function renderOffers(){
  var html='';
  OFFERS.forEach(function(o){
    var isAccepted=S.offerAccepted&&S.acceptedOffer===o.id;
    var isOther=S.offerAccepted&&S.acceptedOffer!==o.id;
    html+='<div class="offer-row'+(isAccepted?' accepted':'')+(isOther?' style="opacity:.5"':'')+'" id="offer-'+o.id+'">'+
      '<div class="offer-avatar">'+o.initials+'</div>'+
      '<div class="offer-info"><h4>'+o.name+(isAccepted?' <span style="color:var(--g);font-size:12px">✓ Acceptée</span>':'')+'</h4>'+
      '<p>'+o.bio+'<br>⭐ '+o.rating+'/5 ('+o.reviews+' avis) · '+o.distance+' · ⏱️ Réponse en '+o.response+'</p></div>'+
      '<div class="offer-right"><div class="offer-amount">'+fCHF(o.price)+'</div>'+
      '<div class="offer-actions">';
    if(isAccepted){
      html+='<a class="btn btn-success btn-sm" onclick="dbView(\'chat\')">Contacter</a>'+
            '<a class="btn btn-primary btn-sm" onclick="dbView(\'escrow\')">Payer (séquestre)</a>';
    }else if(!S.offerAccepted){
      html+='<a class="btn btn-primary btn-sm" onclick="acceptOffer('+o.id+')">Accepter →</a>';
    }
    html+='</div></div></div>';
  });
  return html;
}

window.acceptOffer = function(id){
  S.offerAccepted=true;
  S.acceptedOffer=id;
  var offer=OFFERS.find(function(o){return o.id===id});
  S.chatMessages=[];
  showToast('','Offre acceptée !','Vous avez accepté l\'offre de '+offer.name+' pour '+fCHF(offer.price)+'.');
  document.getElementById('db-chat-badge').style.display='inline';
  dbView('offers');
};

// ═══════════════════════════════════════════════════
// CONTENT MODERATION SYSTEM
// ═══════════════════════════════════════════════════

// Normalize text to catch leet-speak and obfuscation
// Two normalizers: one for leet-speak (s3x), one "stripped" that removes ALL non-letters (s*e*x*e, s.e.x.e)
function normalizeText(t){
  return t.toLowerCase()
    .replace(/[*@€£$!¡|]/g,'a')
    .replace(/0/g,'o').replace(/3/g,'e').replace(/1/g,'i').replace(/4/g,'a')
    .replace(/5/g,'s').replace(/7/g,'t').replace(/[-_.\s]/g,'');
}
function normalizeStripped(t){
  // Remove ALL non-alphabetic characters to catch s*e*x*e, s.e.x, s-e-x-e etc.
  return t.toLowerCase().replace(/[^a-zàâäéèêëîïôùûüç]/g,'');
}

var CONTENT_VIOLATIONS = [
  // Sexual content — direct + obfuscated
  {label:'contenu sexuel', test:function(raw,norm){
    var stripped = normalizeStripped(raw);
    return /s[e3*€@\.\-_]?[e3*€@\.\-_]?x[e3*€@\.\-_]?[e3*€@\.\-_]?/i.test(raw) ||
           /p[o0]rn[o0]?/i.test(raw) ||
           /escort/i.test(raw) ||
           /prostitut/i.test(raw) ||
           /massag[e3].*(intime|érotique|sexy|nude)/i.test(raw) ||
           /nude|naked/i.test(raw) ||
           /onlyfan/i.test(raw) ||
           /cam\s*(girl|show)/i.test(raw) ||
           /rencontre.*(intime|adulte|hot)/i.test(raw) ||
           /\bsexe?\b/i.test(raw) || // direct "sex" or "sexe"
           /sex/.test(norm) ||        // leet "s3x" etc.
           /sex/.test(stripped);      // obfuscated "s*e*x*e", "s.e.x"
  }},
  // Alcohol — blocked outright (not a legal service on Oflem)
  {label:'alcool', test:function(raw,norm){
    var stripped = normalizeStripped(raw);
    return /\balcool\b/i.test(raw) ||
           /\balcohol\b/i.test(raw) ||
           /\bbière\b/i.test(raw) ||
           /\bwhisky\b/i.test(raw) ||
           /\bvodka\b/i.test(raw) ||
           /\brhum\b/i.test(raw) ||
           /\bspiritueux\b/i.test(raw) ||
           /(livr|vend|achet|apport|procur).*(vin\b|bière|alcool|alcoolisé)/i.test(raw);
  }},
  // Drugs
  {label:'substances illicites', test:function(raw,norm){
    var stripped = normalizeStripped(raw);
    return /\b(cannabis|weed|hasch|cocaïne|cocaine|héroïne|heroine|mdma|ecstasy|lsd|ketamine|crack|fentanyl)\b/i.test(raw) ||
           /\b(drogue|stup[eé]fiant|deals?|dealer)\b/i.test(raw) ||
           /\bwee+d\b/i.test(raw) ||
           /cannabis/.test(stripped) ||
           /cocaine/.test(stripped) ||
           /heroine/.test(stripped) ||
           /heroin/.test(stripped) ||
           /(acheter|trouver|livrer|procurer|fournir).*(pilule|pill|médoc|substance).*(marché|marche)/i.test(raw);
  }},
  // Violence / weapons
  {label:'contenu violent ou armes', test:function(raw,norm){
    return /\b(arme[s]?|pistolet|fusil|couteau\s+menaçant|blesser|frapper)\b/i.test(raw) &&
           /(acheter|vendre|livrer|procurer|trouver)/i.test(raw);
  }}
];

var BLOCKED_PATTERNS = [
  {regex:/(\+?\d{2,3}[\s.-]?\d{2,3}[\s.-]?\d{2,4}[\s.-]?\d{2,4}[\s.-]?\d{0,4})/g, label:'numéro de téléphone'},
  {regex:/\b[A-Za-z0-9._%+-]+@[A-Za-z0-9.-]+\.[A-Z|a-z]{2,}\b/g, label:'adresse email'},
  {regex:/\b(rue|avenue|chemin|route|boulevard|place|impasse)\s+[A-Za-zÀ-ÿ\s]+\d+/gi, label:'adresse postale'},
  {regex:/\b\d{4}\s+[A-Za-zÀ-ÿ\-]+\b/g, label:'code postal et ville'}
];

function containsBlockedContent(text){
  var norm = normalizeText(text);
  // Check content violations first
  for(var i=0;i<CONTENT_VIOLATIONS.length;i++){
    if(CONTENT_VIOLATIONS[i].test(text,norm))return CONTENT_VIOLATIONS[i].label;
  }
  // Then contact info
  for(var j=0;j<BLOCKED_PATTERNS.length;j++){
    BLOCKED_PATTERNS[j].regex.lastIndex=0;
    if(BLOCKED_PATTERNS[j].regex.test(text))return BLOCKED_PATTERNS[j].label;
  }
  return false;
}

// Called on textarea oninput for mission/bio fields
window.checkModeration = function(el, errorId){
  var err = document.getElementById(errorId);
  if(!err) return;
  var violation = containsBlockedContent(el.value);
  if(violation){
    err.textContent = '⛔ Ce type de contenu (' + violation + ') n\'est pas autorisé sur Oflem. Veuillez modifier votre texte.';
    err.style.display = 'block';
    el.style.borderColor = '#f87171';
  } else {
    err.style.display = 'none';
    el.style.borderColor = '';
  }
};

// Returns true if field passes moderation (no violation)
function fieldPassesMod(fieldId, errorId){
  var el = document.getElementById(fieldId);
  if(!el) return true;
  var violation = containsBlockedContent(el.value);
  var err = document.getElementById(errorId);
  if(violation){
    if(err){err.textContent='⛔ Contenu interdit ('+violation+'). Publication bloquée.';err.style.display='block';}
    el.style.borderColor='#f87171';
    el.focus();
    return false;
  }
  return true;
}



function renderClientChat(){
  if(!S.offerAccepted)return '<div style="background:#fff;border:1px solid var(--g300);border-radius:var(--rl);padding:40px;text-align:center"><p style="color:var(--g500)">Acceptez une offre pour accéder à la messagerie.</p><a class="btn btn-primary btn-sm" onclick="dbView(\'offers\')">Voir les offres →</a></div>';
  var offer=OFFERS.find(function(o){return o.id===S.acceptedOffer});
  return '<div class="chat-container" id="chat-box">'+
    '<div class="chat-header"><div class="chat-header-info"><div class="chat-avatar" style="background:linear-gradient(135deg,var(--o),var(--ol))">'+offer.initials+'</div><div><div class="chat-header-name">'+offer.name+'</div><div class="chat-header-status">En ligne · '+offer.category+' '+offer.distance+'</div></div></div><div style="font-size:11px;color:rgba(255,255,255,.5)">Mission: '+(S.request.service||'Service')+'</div></div>'+
    '<div class="chat-messages" id="chat-messages"></div>'+
    '<div class="chat-input-wrap"><textarea class="chat-input" id="chat-input" placeholder="Écrivez votre message..." rows="1" onkeydown="if(event.key===\'Enter\'&&!event.shiftKey){event.preventDefault();sendMessage(\'client\')}"></textarea><button class="chat-send" onclick="sendMessage(\'client\')">Envoyer</button></div>'+
    '</div>';
}

function renderProviderChat(){
  if(!S.providerOfferAccepted)return '<div style="background:#fff;border:1px solid var(--g300);border-radius:var(--rl);padding:40px;text-align:center"><p style="color:var(--g500)">Vos messages apparaîtront ici une fois qu\'un client accepte votre offre.</p></div>';
  return '<div class="chat-container" id="chat-box">'+
    '<div class="chat-header"><div class="chat-header-info"><div class="chat-avatar" style="background:linear-gradient(135deg,var(--n),#4a5568)">'+S.request.firstName.charAt(0).toUpperCase()+'</div><div><div class="chat-header-name">'+(S.request.firstName||'Client')+'</div><div class="chat-header-status">Client · '+(S.request.city||'Lausanne')+'</div></div></div><div style="font-size:11px;color:rgba(255,255,255,.5)">Mission: '+(S.request.service||'Service')+'</div></div>'+
    '<div class="chat-messages" id="chat-messages"></div>'+
    '<div class="chat-input-wrap"><textarea class="chat-input" id="chat-input" placeholder="Écrivez votre message..." rows="1" onkeydown="if(event.key===\'Enter\'&&!event.shiftKey){event.preventDefault();sendMessage(\'provider\')}"></textarea><button class="chat-send" onclick="sendMessage(\'provider\')">Envoyer</button></div>'+
    '</div>';
}

function initChat(role){
  var box=document.getElementById('chat-messages');
  if(!box)return;
  box.innerHTML='';
  // System message
  addChatMsg(box,'system','Pour votre sécurité, les échanges de coordonnées personnelles (téléphone, email, adresse) sont interdits via la messagerie. Toutes les transactions doivent passer par le séquestre Oflem.');

  if(S.chatMessages.length===0){
    // Simulate initial messages
    if(role==='client'){
      setTimeout(function(){
        var offer=OFFERS.find(function(o){return o.id===S.acceptedOffer});
        addChatMsg(box,'received','Bonjour '+(S.request.firstName||'')+' ! Merci d\'avoir accepté mon offre. Je suis disponible '+(offer?offer.available.toLowerCase():'bientôt')+' pour commencer. Pouvez-vous me préciser la surface exacte et l\'état actuel des murs ?');
        S.chatMessages.push({role:'received',text:'Message initial prestataire'});
      },800);
    } else {
      setTimeout(function(){
        addChatMsg(box,'received','Bonjour ! J\'ai bien reçu votre offre à CHF 900.–. Quand seriez-vous disponible pour un premier passage ?');
        S.chatMessages.push({role:'received',text:'Message initial client'});
      },800);
    }
  } else {
    // Reload existing messages
    S.chatMessages.forEach(function(m){
      if(m.role!=='system')addChatMsg(box,m.role,m.text);
    });
  }
}

function addChatMsg(container,role,text){
  if(!container)container=document.getElementById('chat-messages');
  if(!container)return;
  var now=new Date();
  var time=now.getHours().toString().padStart(2,'0')+':'+now.getMinutes().toString().padStart(2,'0');
  var div=document.createElement('div');
  div.className='chat-msg '+role;
  div.innerHTML=text+(role!=='system'?'<span class="chat-time">'+time+'</span>':'');
  container.appendChild(div);
  container.scrollTop=container.scrollHeight;
}

window.sendMessage = function(role){
  var input=document.getElementById('chat-input');
  var text=input.value.trim();
  if(!text)return;

  // Check for blocked content
  var blocked=containsBlockedContent(text);
  if(blocked){
    var box=document.getElementById('chat-messages');
    var isContact = ['numéro de téléphone','adresse email','adresse postale','code postal et ville'].indexOf(blocked)>=0;
    var msg = isContact
      ? '⛔ Message bloqué — échange de coordonnées interdit (art. 6 CGU). Toutes les communications doivent rester sur Oflem.'
      : '⛔ Message bloqué — contenu non autorisé sur Oflem (' + blocked + ').';
    addChatMsg(box,'system',msg);
    input.value='';
    return;
  }

  var box=document.getElementById('chat-messages');
  addChatMsg(box,'sent',text);
  S.chatMessages.push({role:'sent',text:text});
  input.value='';

  // Simulate response
  setTimeout(function(){
    var responses=[
      'D\'accord, c\'est noté. Je prépare mon matériel en conséquence.',
      'Parfait, je vous tiendrai informé de l\'avancement.',
      'Très bien ! N\'hésitez pas si vous avez d\'autres questions.',
      'Je confirme, je serai là à l\'heure convenue. À bientôt !',
      'Merci pour ces précisions. Je vais ajuster mon planning.',
      'Entendu. Le séquestre me rassure aussi, c\'est un bon système.'
    ];
    var resp=responses[Math.floor(Math.random()*responses.length)];
    addChatMsg(box,'received',resp);
    S.chatMessages.push({role:'received',text:resp});
  },1500+Math.random()*2000);
};

// ═══════════════════════════════════════════════════
// ESCROW (CLIENT SIDE)
// ═══════════════════════════════════════════════════
function renderClientEscrow(){
  if(!S.offerAccepted)return '<div style="background:#fff;border:1px solid var(--g300);border-radius:var(--rl);padding:40px;text-align:center"><p style="color:var(--g500)">Le séquestre sera activé après acceptation d\'une offre et paiement.</p><a class="btn btn-primary btn-sm" onclick="dbView(\'offers\')">Voir les offres →</a></div>';
  var offer=OFFERS.find(function(o){return o.id===S.acceptedOffer});
  var amount=offer?offer.price:0;
  var state=S.escrowState;

  var statusHtml='';
  if(state==='none')statusHtml='<div class="escrow-status pending">⏳ En attente de paiement</div>';
  else if(state==='blocked')statusHtml='<div class="escrow-status blocked">Fonds bloqués en séquestre</div>';
  else if(state==='released')statusHtml='<div class="escrow-status released">Fonds libérés au prestataire</div>';

  var html='<div class="escrow-card">'+
    '<div class="escrow-header"><div style="font-size:14px;font-weight:600;opacity:.7">Montant de la mission</div><div class="escrow-amount">'+fCHF(amount)+'</div>'+statusHtml+'</div>'+
    '<div class="escrow-body"><div class="escrow-timeline">'+
    '<div class="escrow-step '+(state!=='none'?'done':'active')+'"><div class="escrow-step-title">Offre acceptée</div><div class="escrow-step-desc">'+offer.name+' — '+fCHF(amount)+'</div><div class="escrow-step-date">Aujourd\'hui</div></div>'+
    '<div class="escrow-step '+(state==='blocked'||state==='released'?'done':state==='none'?'':'active')+'"><div class="escrow-step-title">Paiement en séquestre</div><div class="escrow-step-desc">Fonds bloqués sur compte suisse sécurisé</div>'+(state!=='none'?'<div class="escrow-step-date">Aujourd\'hui</div>':'')+'</div>'+
    '<div class="escrow-step '+(state==='released'?'done':state==='blocked'?'active':'')+'"><div class="escrow-step-title">Travail en cours</div><div class="escrow-step-desc">Le prestataire est informé et peut commencer</div></div>'+
    '<div class="escrow-step '+(state==='released'?'done':'')+'"><div class="escrow-step-title">Validation & libération</div><div class="escrow-step-desc">Validez le travail pour libérer les fonds</div>'+(state==='released'?'<div class="escrow-step-date">Aujourd\'hui</div>':'')+'</div>'+
    '</div>';

  if(state==='none'){
    html+='<div style="margin-top:28px;padding:20px;background:#fff5f0;border-radius:var(--rs);border:1px solid rgba(255,107,53,.2)">'+
      '<h4 style="font-size:15px;font-weight:900;color:var(--n);margin-bottom:8px">Simuler le paiement</h4>'+
      '<p style="font-size:13px;color:var(--g500);margin-bottom:12px">Les fonds sont sécurisés par notre partenaire financier agréé. <strong>Oflem ne détient jamais vos fonds directement.</strong></p>'+
      '<div style="display:flex;align-items:center;gap:8px;padding:8px 14px;background:var(--g50);border-radius:8px;margin-bottom:14px;border:1px solid var(--g100)"><span style="font-size:13px;font-weight:900;color:var(--g)">●</span><span style="font-size:11px;color:var(--g500)">Paiement traité par Stripe Connect · Conforme FINMA · Fonds séparés</span></div>'+
      '<div style="background:#fff;border:1px solid var(--g300);border-radius:var(--rs);padding:16px;margin-bottom:16px">'+
      '<div style="display:grid;grid-template-columns:1fr 1fr;gap:12px;margin-bottom:12px"><div><label style="font-size:11px;font-weight:700;color:var(--g500);display:block;margin-bottom:4px">Numéro de carte</label><input type="text" value="4242 4242 4242 4242" disabled style="width:100%;padding:10px;border:1px solid var(--g300);border-radius:8px;font-size:14px;background:var(--g50);color:var(--g500)"></div><div><label style="font-size:11px;font-weight:700;color:var(--g500);display:block;margin-bottom:4px">Expiration</label><input type="text" value="12/27" disabled style="width:100%;padding:10px;border:1px solid var(--g300);border-radius:8px;font-size:14px;background:var(--g50);color:var(--g500)"></div></div>'+
      '<p style="font-size:11px;color:var(--g500);text-align:center">Simulation, aucune carte réelle n\'est débitée</p></div>'+
      '<button class="btn btn-primary" style="width:100%;font-size:16px;padding:16px" onclick="simulatePayment()">Bloquer '+fCHF(amount)+' en séquestre →</button></div>';
  }
  if(state==='blocked'){
    html+='<div style="margin-top:28px">'+
      // Photos optionnelles
      '<div style="background:#fff;border:1.5px solid var(--g300);border-radius:var(--rs);padding:20px;margin-bottom:16px">'+
      '<div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:12px">'+
      '<h4 style="font-size:15px;font-weight:900;color:var(--n)">Photos de preuve</h4>'+
      '<span style="font-size:11px;color:var(--g500);background:var(--g50);padding:4px 10px;border-radius:20px;font-weight:600">Optionnel</span>'+
      '</div>'+
      '<p style="font-size:13px;color:var(--g500);line-height:1.6;margin-bottom:16px">Vous pouvez ajouter des photos avant et après le travail. Utile en cas de litige, mais pas obligatoire pour libérer les fonds.</p>'+
      '<div style="display:grid;grid-template-columns:1fr 1fr;gap:12px;margin-bottom:8px">'+
      '<div onclick="simulatePhotoUpload(\'before\')" style="border:2px dashed '+(S.beforePhoto?'var(--g)':'var(--g300)')+';border-radius:10px;padding:16px;text-align:center;cursor:pointer;transition:all .25s;background:'+(S.beforePhoto?'#f0fdf4':'var(--g50)')+'">'+
      (S.beforePhoto?'<div style="font-size:24px;margin-bottom:4px">✅</div><div style="font-size:11px;font-weight:700;color:var(--g)">AVANT ajoutée</div>':'<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="var(--g500)" stroke-width="1.5" stroke-linecap="round" style="margin-bottom:6px"><rect x="3" y="3" width="18" height="18" rx="2"/><circle cx="8.5" cy="8.5" r="1.5"/><polyline points="21 15 16 10 5 21"/></svg><div style="font-size:11px;font-weight:700;color:var(--g700)">Photo AVANT</div><div style="font-size:10px;color:var(--g500);margin-top:2px">État initial</div>')+
      '</div>'+
      '<div onclick="simulatePhotoUpload(\'after\')" style="border:2px dashed '+(S.afterPhoto?'var(--g)':'var(--g300)')+';border-radius:10px;padding:16px;text-align:center;cursor:pointer;transition:all .25s;background:'+(S.afterPhoto?'#f0fdf4':'var(--g50)')+'">'+
      (S.afterPhoto?'<div style="font-size:24px;margin-bottom:4px">✅</div><div style="font-size:11px;font-weight:700;color:var(--g)">APRÈS ajoutée</div>':'<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="var(--g500)" stroke-width="1.5" stroke-linecap="round" style="margin-bottom:6px"><rect x="3" y="3" width="18" height="18" rx="2"/><circle cx="8.5" cy="8.5" r="1.5"/><polyline points="21 15 16 10 5 21"/></svg><div style="font-size:11px;font-weight:700;color:var(--g700)">Photo APRÈS</div><div style="font-size:10px;color:var(--g500);margin-top:2px">Résultat final</div>')+
      '</div></div>'+
      '</div>'+
      '<div style="padding:20px;background:#ecfdf5;border-radius:var(--rs);border:1px solid rgba(16,185,129,.2)">'+
      '<h4 style="font-size:15px;font-weight:900;color:var(--n);margin-bottom:8px">Le travail est-il terminé ?</h4>'+
      '<p style="font-size:13px;color:var(--g500);margin-bottom:16px">Lorsque le prestataire a terminé et que vous êtes satisfait, libérez les fonds. En cas de problème, ouvrez un litige.</p>'+
      '<div style="display:flex;gap:12px"><button class="btn btn-success" style="flex:2;font-size:15px;padding:14px" onclick="releaseEscrow()">✅ Valider et libérer '+fCHF(amount)+'</button>'+
      '<button class="btn btn-danger btn-sm" style="flex:1" onclick="showToast(\'⚠️\',\'Litige ouvert\',\'Notre équipe de médiation vous contactera sous 24h ouvrés.\')">Ouvrir un litige</button></div>'+
      '</div></div>';
  }
  if(state==='released'){
    html+='<div style="margin-top:28px;padding:20px;background:#ecfdf5;border-radius:var(--rs);border:1px solid rgba(16,185,129,.2);text-align:center">'+
      '<div style="font-size:32px;font-weight:900;margin-bottom:8px">Bravo !</div>'+
      '<h4 style="font-size:18px;font-weight:900;color:var(--n);margin-bottom:8px">Mission terminée !</h4>'+
      '<p style="font-size:14px;color:var(--g500);margin-bottom:16px">Les fonds ont été libérés à '+offer.name+'. Merci de votre confiance !</p>'+
      '<div style="display:flex;gap:10px;justify-content:center;flex-wrap:wrap">'+
      '<button class="btn btn-primary btn-sm" onclick="openReviewModal(\''+offer.name+'\',\''+offer.initials+'\')">⭐ Laisser un avis</button>'+
      '<button class="btn btn-outline btn-sm" onclick="downloadContractPDF()">📄 Télécharger le contrat</button>'+
      '<button class="btn btn-outline btn-sm" onclick="downloadFiscalExport()">📊 Export fiscal</button>'+
      '</div></div>';
  }
  html+='</div></div>';
  return html;
}

window.simulatePayment = function(){
  S.escrowState='blocked';
  showToast('','Paiement sécurisé','Les fonds sont bloqués en séquestre. Le prestataire est notifié.');
  dbView('escrow');
  // Also notify provider side
  S.providerOfferAccepted=true;
};

window.releaseEscrow = function(){
  S.escrowState='released';
  showToast('','Fonds libérés !','Le prestataire recevra '+fCHF((OFFERS.find(function(o){return o.id===S.acceptedOffer})||{price:0}).price)+' sous 24h.');
  dbView('escrow');
};

// ═══════════════════════════════════════════════════
// PROVIDER DASHBOARD
// ═══════════════════════════════════════════════════
function initProviderDashboard(){
  var isRemote = (typeof psMode !== 'undefined' && psMode === 'remote');
  // Update badge
  var badge = document.querySelector('#pd-sidebar [style*="Dashboard Prestataire"]');
  if(badge){
    badge.textContent = isRemote ? '🖥️ Prestataire à distance' : '🛠️ Prestataire terrain';
    badge.style.color = isRemote ? '#60a5fa' : '#34d399';
  }
  var badgeWrap = badge && badge.parentElement;
  if(badgeWrap && isRemote){
    badgeWrap.style.background = 'rgba(96,165,250,.15)';
    badgeWrap.style.border = '1px solid rgba(96,165,250,.3)';
  }
  // Filter opportunities nav label
  var oppLink = document.querySelector('#pd-nav a[onclick*="opportunities"]');
  if(oppLink) oppLink.textContent = isRemote ? 'Missions à distance' : 'Opportunités';
  // Add remote filter badge under nav if remote
  if(isRemote){
    var existing = document.getElementById('pd-remote-notice');
    if(!existing){
      var notice = document.createElement('div');
      notice.id = 'pd-remote-notice';
      notice.style.cssText = 'margin:0 16px 16px;padding:10px 12px;background:rgba(96,165,250,.1);border:1px solid rgba(96,165,250,.2);border-radius:8px;font-size:11px;color:rgba(255,255,255,.55);line-height:1.6';
      notice.innerHTML = '🔒 Vous voyez uniquement les missions à distance.';
      var nav = document.getElementById('pd-nav');
      if(nav && nav.parentNode) nav.parentNode.insertBefore(notice, nav.nextSibling);
    }
  }
  pdView('opportunities');
}

window.pdView = function(view){
  var titles={opportunities:'Opportunités','my-offers':'Mes offres',chat:'Messages',earnings:'Revenus & Séquestre',profile:'Mon profil'};
  document.getElementById('pd-title').textContent=titles[view]||view;
  document.querySelectorAll('#pd-nav a').forEach(function(a){a.classList.remove('active')});
  document.querySelectorAll('#pd-nav a').forEach(function(a){if(a.onclick&&a.onclick.toString().indexOf("'"+view+"'")!==-1)a.classList.add('active')});
  var c=document.getElementById('pd-content');

  switch(view){
    case 'opportunities': c.innerHTML=renderOpportunities(); break;
    case 'my-offers': c.innerHTML=renderMyOffers(); break;
    case 'chat': c.innerHTML=renderProviderChat(); initChat('provider'); break;
    case 'earnings': c.innerHTML=renderProviderEscrow(); break;
    case 'profile': c.innerHTML=renderProfile('provider'); break;
  }
};

function renderOpportunities(){
  var isRemote = (typeof psMode !== 'undefined' && psMode === 'remote');
  var svc=S.request.service||'Mission en cours';
  var city=S.request.city||'Lausanne';
  var budget=S.request.budget||'800 – 1\'200';

  // Remote-only missions
  if(isRemote){
    return '<div style="margin-bottom:16px;padding:10px 14px;background:rgba(96,165,250,.1);border:1px solid rgba(96,165,250,.25);border-radius:10px;font-size:12px;font-weight:700;color:#60a5fa">🖥️ Missions à distance uniquement — correspondant à votre profil</div>'+
    '<div style="display:grid;gap:16px">'+
    '<div style="background:#fff;border:2px solid rgba(255,107,53,.3);border-radius:var(--r);padding:24px;position:relative">'+
    '<span style="position:absolute;top:12px;right:12px;background:var(--o);color:#fff;font-size:10px;font-weight:900;padding:4px 10px;border-radius:8px">NOUVEAU</span>'+
    '<h3 style="font-size:18px;font-weight:900;color:var(--n);margin-bottom:6px">'+svc+'</h3>'+
    '<p style="font-size:13px;color:var(--g500);margin-bottom:6px">À distance · '+(S.request.when||'Flexible')+'</p>'+
    (S.request.desc?'<p style="font-size:13px;color:var(--g700);margin-bottom:10px;padding:10px;background:var(--g50);border-radius:8px">'+S.request.desc+'</p>':'')+
    '<div style="font-size:20px;font-weight:900;color:var(--g);margin-bottom:14px">'+fCHF(budget)+'</div>'+
    (S.providerOfferSent?
      '<div style="padding:12px;background:#ecfdf5;border-radius:var(--rs);border:1px solid rgba(16,185,129,.2)"><p style="font-size:13px;font-weight:700;color:var(--g)">✅ Offre envoyée — CHF 900.–</p>'+(S.providerOfferAccepted?'<p style="font-size:12px;color:var(--g);margin-top:4px">Offre acceptée par le client !</p>':'<p style="font-size:12px;color:var(--g500);margin-top:4px">En attente de réponse du client…</p>')+'</div>':
      '<div style="display:flex;gap:8px;flex-wrap:wrap"><button class="btn btn-primary btn-sm" onclick="openSendOfferModal()">Envoyer une offre →</button></div>'
    )+
    '</div>'+
    '<div style="background:#fff;border:1px solid var(--g300);border-radius:var(--r);padding:24px">'+
    '<h3 style="font-size:18px;font-weight:900;color:var(--n);margin-bottom:6px">Aide déclaration d\'impôts — indépendant VD</h3>'+
    '<p style="font-size:13px;color:var(--g500);margin-bottom:12px">À distance · Avant fin mars</p>'+
    '<div style="font-size:20px;font-weight:900;color:var(--g);margin-bottom:14px">CHF 80.– à 150.–</div>'+
    '<button class="btn btn-primary btn-sm" onclick="showToast(\'\',\'Offre envoyée\',\'Votre offre a été envoyée.\')">Envoyer une offre →</button></div>'+
    '<div style="background:#fff;border:1px solid var(--g300);border-radius:var(--r);padding:24px">'+
    '<h3 style="font-size:18px;font-weight:900;color:var(--n);margin-bottom:6px">Traduction contrat DE → FR (2 pages)</h3>'+
    '<p style="font-size:13px;color:var(--g500);margin-bottom:12px">À distance · Urgent</p>'+
    '<div style="font-size:20px;font-weight:900;color:var(--g);margin-bottom:14px">CHF 60.– à 100.–</div>'+
    '<button class="btn btn-primary btn-sm" onclick="showToast(\'\',\'Offre envoyée\',\'Votre offre a été envoyée.\')">Envoyer une offre →</button></div>'+
    '<div style="background:#fff;border:1px solid var(--g300);border-radius:var(--r);padding:24px">'+
    '<h3 style="font-size:18px;font-weight:900;color:var(--n);margin-bottom:6px">Révision CV — poste finance Zurich</h3>'+
    '<p style="font-size:13px;color:var(--g500);margin-bottom:12px">À distance · Cette semaine</p>'+
    '<div style="font-size:20px;font-weight:900;color:var(--g);margin-bottom:14px">CHF 50.– à 80.–</div>'+
    '<button class="btn btn-primary btn-sm" onclick="showToast(\'\',\'Offre envoyée\',\'Votre offre a été envoyée.\')">Envoyer une offre →</button></div>'+
    '</div>';
  }

  // Standard (terrain) missions
  return '<div style="display:grid;gap:16px">'+
    '<div style="background:#fff;border:2px solid rgba(255,107,53,.3);border-radius:var(--r);padding:24px;position:relative">'+
    '<span style="position:absolute;top:12px;right:12px;background:var(--o);color:#fff;font-size:10px;font-weight:900;padding:4px 10px;border-radius:8px">NOUVEAU</span>'+
    '<h3 style="font-size:18px;font-weight:900;color:var(--n);margin-bottom:6px">'+svc+'</h3>'+
    '<p style="font-size:13px;color:var(--g500);margin-bottom:6px">'+city+' · '+(S.request.when||'Flexible')+'</p>'+
    (S.request.desc?'<p style="font-size:13px;color:var(--g700);margin-bottom:10px;padding:10px;background:var(--g50);border-radius:8px">'+S.request.desc+'</p>':'')+
    '<div style="font-size:20px;font-weight:900;color:var(--g);margin-bottom:14px">'+fCHF(budget)+'</div>'+
    (S.providerOfferSent?
      '<div style="padding:12px;background:#ecfdf5;border-radius:var(--rs);border:1px solid rgba(16,185,129,.2)"><p style="font-size:13px;font-weight:700;color:var(--g)">✅ Offre envoyée — CHF 900.–</p>'+(S.providerOfferAccepted?'<p style="font-size:12px;color:var(--g);margin-top:4px">Offre acceptée par le client !</p>':'<p style="font-size:12px;color:var(--g500);margin-top:4px">En attente de réponse du client…</p>')+'</div>':
      (S.counterOffer?'<div style="padding:10px 12px;background:#fff8f0;border-radius:8px;border:1px solid rgba(255,107,53,.2);margin-bottom:10px"><p style="font-size:12px;font-weight:700;color:var(--o)">Contre-offre envoyée : CHF '+S.counterOffer.price+'.– · '+S.counterOffer.date+'</p></div>':'')+
      '<div style="display:flex;gap:8px;flex-wrap:wrap"><button class="btn btn-primary btn-sm" onclick="openSendOfferModal()">Envoyer une offre →</button><button class="btn btn-outline btn-sm" onclick="openCounterOfferModal()">Proposer autre date/prix ↔</button></div>'
    )+
    '</div>'+
    '<div style="background:#fff;border:1px solid var(--g300);border-radius:var(--r);padding:24px">'+
    '<h3 style="font-size:18px;font-weight:900;color:var(--n);margin-bottom:6px">Courses urgentes — médicaments</h3>'+
    '<p style="font-size:13px;color:var(--g500);margin-bottom:12px">Lausanne · Avant 19h</p>'+
    '<div style="font-size:20px;font-weight:900;color:var(--g);margin-bottom:14px">CHF 20.– à 30.–</div>'+
    '<button class="btn btn-primary btn-sm" onclick="showToast(\'\',\'Offre envoyée\',\'Votre offre pour les courses a été envoyée.\')">Envoyer une offre →</button></div>'+
    '<div style="background:#fff;border:1px solid var(--g300);border-radius:var(--r);padding:24px">'+
    '<h3 style="font-size:18px;font-weight:900;color:var(--n);margin-bottom:6px">Promener un chien — 45 min</h3>'+
    '<p style="font-size:13px;color:var(--g500);margin-bottom:12px">Genève · Demain matin</p>'+
    '<div style="font-size:20px;font-weight:900;color:var(--g);margin-bottom:14px">CHF 20.– à 25.–</div>'+
    '<button class="btn btn-primary btn-sm" onclick="showToast(\'\',\'Offre envoyée\',\'Votre offre pour la promenade a été envoyée.\')">Envoyer une offre →</button></div>'+
    '</div>';
}

function renderMyOffers(){
  var html='<div style="display:grid;gap:12px">';
  if(S.providerOfferSent){
    html+='<div class="offer-row'+(S.providerOfferAccepted?' accepted':'')+'"><div class="offer-avatar" style="background:linear-gradient(135deg,var(--n),#4a5568)">'+(S.request.firstName?S.request.firstName.charAt(0).toUpperCase():'C')+'</div>'+
    '<div class="offer-info"><h4>'+(S.request.service||'Mission')+(S.providerOfferAccepted?' <span style="color:var(--g);font-size:12px">✓ Acceptée</span>':'')+'</h4><p>Client : '+(S.request.firstName||'Client')+' · '+(S.request.city||'Lausanne')+'</p></div>'+
    '<div class="offer-right"><div class="offer-amount">CHF 900.–</div><div class="offer-actions">';
    if(S.providerOfferAccepted){
      html+='<a class="btn btn-success btn-sm" onclick="pdView(\'chat\')">Contacter</a>'+
            '<a class="btn btn-primary btn-sm" onclick="pdView(\'earnings\')">Séquestre</a>';
    } else {
      html+='<span style="font-size:12px;color:var(--g500)">En attente…</span>';
    }
    html+='</div></div></div>';
  }
  html+='</div>';
  if(!S.providerOfferSent)html='<div style="background:#fff;border:1px solid var(--g300);border-radius:var(--rl);padding:40px;text-align:center"><p style="color:var(--g500)">Vous n\'avez pas encore envoyé d\'offre.</p><a class="btn btn-primary btn-sm" onclick="pdView(\'opportunities\')">Voir les opportunités →</a></div>';
  return html;
}

function renderProviderEscrow(){
  if(!S.providerOfferAccepted)return '<div style="background:#fff;border:1px solid var(--g300);border-radius:var(--rl);padding:40px;text-align:center"><p style="color:var(--g500)">Les informations de paiement apparaîtront ici une fois qu\'un client paie via le séquestre.</p></div>';

  var offerAmount=900;
  var commissionRate=offerAmount>=500?0.12:offerAmount>=150?0.20:0.25;
  var commissionLabel=offerAmount>=500?'12%':offerAmount>=150?'20%':'25%';
  var commission=Math.round(offerAmount*commissionRate);
  var clientTotal=offerAmount+commission;
  var state=S.escrowState;

  var statusHtml='';
  if(state==='blocked')statusHtml='<div class="escrow-status blocked">Fonds bloqués, en attente de validation</div>';
  else if(state==='released')statusHtml='<div class="escrow-status released">Fonds libérés, virement en cours</div>';
  else statusHtml='<div class="escrow-status pending">⏳ En attente du paiement client</div>';

  var releaseBtn = state!=='released'
    ? '<div style="margin-top:24px;padding:20px;background:linear-gradient(135deg,#f0fdf4,#ecfdf5);border:1.5px solid rgba(16,185,129,.25);border-radius:16px">'+
      '<div style="font-size:14px;font-weight:900;color:#065f46;margin-bottom:6px">Mission terminée ?</div>'+
      '<p style="font-size:13px;color:#047857;line-height:1.6;margin-bottom:14px">Quand votre prestation est terminée, cliquez ici pour déclencher votre virement. Le client recevra une confirmation.</p>'+
      '<button class="btn btn-success" style="width:100%;font-size:15px;padding:14px;border-radius:12px;letter-spacing:.3px" onclick="releaseEscrow()">Libérer le séquestre et recevoir '+fCHF(offerAmount)+'</button>'+
      '</div>'
    : '<div style="margin-top:24px;padding:20px;background:#ecfdf5;border-radius:16px;border:1px solid rgba(16,185,129,.2);text-align:center">'+
      '<div style="font-size:32px;font-weight:900;margin-bottom:8px">Bravo !</div>'+
      '<h4 style="font-size:18px;font-weight:900;color:var(--n)">Paiement confirmé !</h4>'+
      '<p style="font-size:14px;color:var(--g500)">'+fCHF(offerAmount)+' seront versés sur votre compte sous 1 à 2 jours ouvrés.</p>'+
      '</div>';

  return '<div class="escrow-card"><div class="escrow-header">'+
    '<div style="font-size:13px;font-weight:600;opacity:.65;margin-bottom:4px">Vous recevez, 100% de votre offre</div>'+
    '<div class="escrow-amount">'+fCHF(offerAmount)+'</div>'+statusHtml+
    '<div style="font-size:12px;opacity:.55;margin-top:10px;line-height:1.6">Commission Oflem ('+commissionLabel+') : +'+fCHF(commission)+' ajoutés au prix client<br>Total payé par le client : '+fCHF(clientTotal)+'</div>'+
    '</div><div class="escrow-body">'+
    '<div class="escrow-timeline">'+
    '<div class="escrow-step '+(state!=='none'?'done':'active')+'"><div class="escrow-step-title">Offre acceptée</div></div>'+
    '<div class="escrow-step '+(state==='blocked'||state==='released'?'done':'')+'"><div class="escrow-step-title">Client a payé, fonds en séquestre</div><div class="escrow-step-desc">'+fCHF(clientTotal)+' bloqués, dont '+fCHF(offerAmount)+' pour vous</div></div>'+
    '<div class="escrow-step '+(state==='blocked'?'active':state==='released'?'done':'')+'"><div class="escrow-step-title">Travail en cours</div><div class="escrow-step-desc">Réalisez la prestation convenue</div></div>'+
    '<div class="escrow-step '+(state==='released'?'done':'')+'"><div class="escrow-step-title">Fonds libérés</div><div class="escrow-step-desc">Virement de '+fCHF(offerAmount)+' sous 1 à 2 jours ouvrés</div></div>'+
    '</div>'+
    releaseBtn+
    '</div></div>';
}

// ═══════════════════════════════════════════════════
// AUTO-SAVE BROUILLON (16)
// ═══════════════════════════════════════════════════
var DRAFT_KEY = 'oflem_mission_draft';

function autosaveDraft(){
  try{
    var draft = {
      service: document.getElementById('confirm-service') ? document.getElementById('confirm-service').value : S.request.service,
      firstName: document.getElementById('confirm-firstName') ? document.getElementById('confirm-firstName').value : '',
      city: document.getElementById('confirm-city') ? document.getElementById('confirm-city').value : '',
      desc: document.getElementById('confirm-desc') ? document.getElementById('confirm-desc').value : '',
      budget: document.getElementById('confirm-budget') ? document.getElementById('confirm-budget').value : 200,
      date: document.getElementById('confirm-date') ? document.getElementById('confirm-date').value : '',
      time: document.getElementById('confirm-time') ? document.getElementById('confirm-time').value : '',
      savedAt: Date.now()
    };
    localStorage.setItem(DRAFT_KEY, JSON.stringify(draft));
  }catch(e){}
}

function checkDraftExists(){
  try{
    var raw = localStorage.getItem(DRAFT_KEY);
    if(!raw) return false;
    var d = JSON.parse(raw);
    // Only show if draft is less than 48h old and has some content
    return d && d.service && (Date.now() - d.savedAt < 48*3600*1000);
  }catch(e){return false}
}

window.restoreDraft = function(){
  try{
    var d = JSON.parse(localStorage.getItem(DRAFT_KEY));
    if(!d) return;
    var fields = {
      'confirm-firstName': d.firstName,
      'confirm-city': d.city,
      'confirm-desc': d.desc,
      'confirm-budget': d.budget,
      'confirm-date': d.date,
      'confirm-time': d.time
    };
    Object.keys(fields).forEach(function(id){
      var el = document.getElementById(id);
      if(el && fields[id]) el.value = fields[id];
    });
    updateCommissionPreview();
    hideDraftBanner();
    showToast('','Brouillon restauré','Votre dernière saisie a été récupérée.');
  }catch(e){}
};

window.discardDraft = function(){
  try{localStorage.removeItem(DRAFT_KEY);}catch(e){}
  hideDraftBanner();
};

function hideDraftBanner(){
  var b = document.getElementById('autosave-banner');
  if(b){b.style.opacity='0';b.style.transition='opacity .3s';setTimeout(function(){b.style.display='none'},300);}
}

// Hook autosave to confirm form inputs
function hookAutosave(){
  var ids = ['confirm-firstName','confirm-city','confirm-desc','confirm-budget','confirm-date','confirm-time'];
  ids.forEach(function(id){
    var el = document.getElementById(id);
    if(el) el.addEventListener('input', function(){
      clearTimeout(window._autosaveTimer);
      window._autosaveTimer = setTimeout(autosaveDraft, 800);
    });
  });
  // Show restore banner if draft exists
  if(checkDraftExists()){
    var b = document.getElementById('autosave-banner');
    if(b){b.style.display='flex';b.style.animation='pgIn .4s ease both';}
  }
}
// Auto-hook when confirm page is shown
var _origOflemNav = window.oflemNav;
window.oflemNav = function(view){
  _origOflemNav(view);
  if(view === 'confirm') setTimeout(hookAutosave, 200);
};

// ═══════════════════════════════════════════════════
// QR CODE GENERATOR (22)
// ═══════════════════════════════════════════════════
function generateQRSVG(data){
  // Simple visual QR-like pattern using deterministic hash of data
  // (Decorative — real QR via API in production)
  var hash = 0;
  for(var i=0;i<data.length;i++) hash = ((hash<<5)-hash)+data.charCodeAt(i);
  hash = Math.abs(hash);

  var cells = 9; // 9x9 grid
  var size = 64;
  var cellSize = size/cells;
  var svg = '<svg width="'+size+'" height="'+size+'" viewBox="0 0 '+size+' '+size+'" xmlns="http://www.w3.org/2000/svg" style="display:block">';
  svg += '<rect width="'+size+'" height="'+size+'" fill="#fff"/>';

  // Corner finder patterns (always fixed)
  [[0,0],[0,6],[6,0]].forEach(function(pos){
    var x=pos[0]*cellSize, y=pos[1]*cellSize, cs=cellSize;
    svg += '<rect x="'+x+'" y="'+y+'" width="'+(3*cs)+'" height="'+(3*cs)+'" fill="#1a1d3f" rx="2"/>';
    svg += '<rect x="'+(x+cs*.3)+'" y="'+(y+cs*.3)+'" width="'+(3*cs*.467)+'" height="'+(3*cs*.467)+'" fill="#fff" rx="1"/>';
    svg += '<rect x="'+(x+cs*.6)+'" y="'+(y+cs*.6)+'" width="'+(3*cs*.267)+'" height="'+(3*cs*.267)+'" fill="#1a1d3f" rx="1"/>';
  });

  // Data cells (pseudo-random based on hash)
  for(var r=0;r<cells;r++){
    for(var c=0;c<cells;c++){
      // Skip corner areas
      if((r<3&&c<3)||(r<3&&c>5)||(r>5&&c<3)) continue;
      var bit = (hash >> ((r*cells+c)%32)) & 1;
      if(bit){
        svg += '<rect x="'+(c*cellSize+.5)+'" y="'+(r*cellSize+.5)+'" width="'+(cellSize-.8)+'" height="'+(cellSize-.8)+'" fill="#1a1d3f" rx=".5"/>';
      }
    }
  }
  svg += '</svg>';
  return svg;
}

// ═══════════════════════════════════════════════════
// PHOTO UPLOAD SIMULATION (23)
// ═══════════════════════════════════════════════════
window.simulatePhotoUpload = function(type){
  if(type === 'before') S.beforePhoto = true;
  else if(type === 'after') S.afterPhoto = true;
  showToast('','Photo reçue','Photo '+(type==='before'?'avant':'après')+' ajoutée avec succès.');
  // Re-render escrow to update state
  setTimeout(function(){ dbView('escrow'); }, 400);
};

// ═══════════════════════════════════════════════════
// CONTRAT PDF (33) & EXPORT FISCAL (34)
// ═══════════════════════════════════════════════════
window.downloadContractPDF = function(){
  try{
    var jsPDF = window.jspdf && window.jspdf.jsPDF;
    if(!jsPDF){ showToast('','PDF généré','Contrat téléchargé (simulation).'); return; }

    var doc = new jsPDF();
    var offer = OFFERS.find(function(o){return o.id===S.acceptedOffer}) || OFFERS[0];
    var today = new Date().toLocaleDateString('fr-CH',{day:'numeric',month:'long',year:'numeric'});
    var contractRef = 'OFL-'+Date.now().toString(36).toUpperCase().substr(-8);

    // Header
    doc.setFillColor(26,29,63);
    doc.rect(0,0,210,22,'F');
    doc.setTextColor(255,255,255);
    doc.setFontSize(18);doc.setFont('helvetica','bold');
    doc.text('OFLEM',15,14);
    doc.setFontSize(10);doc.setFont('helvetica','normal');
    doc.text('Plateforme suisse de services',60,14);
    doc.text('oflem.ch',180,14,'right');

    // Title
    doc.setTextColor(26,29,63);
    doc.setFontSize(16);doc.setFont('helvetica','bold');
    doc.text('QUITTANCE DE MISSION', 105, 38, 'center');
    doc.setFontSize(10);doc.setFont('helvetica','normal');
    doc.setTextColor(113,128,150);
    doc.text('Référence : '+contractRef+' · Date : '+today, 105, 46, 'center');

    // Divider
    doc.setDrawColor(226,232,240);
    doc.line(15,52,195,52);

    // Parties
    doc.setFontSize(11);doc.setFont('helvetica','bold');doc.setTextColor(26,29,63);
    doc.text('PARTIES', 15, 64);
    doc.setFont('helvetica','normal');doc.setFontSize(10);doc.setTextColor(74,85,104);
    doc.text('Client :  '+(S.request.firstName||'Client')+'  ·  '+(S.request.city||'Lausanne'), 15, 74);
    doc.text('Prestataire :  '+(offer.name||'Prestataire')+'  ·  Profil vérifié Oflem', 15, 83);

    // Mission
    doc.setFontSize(11);doc.setFont('helvetica','bold');doc.setTextColor(26,29,63);
    doc.text('MISSION', 15, 98);
    doc.setFont('helvetica','normal');doc.setFontSize(10);doc.setTextColor(74,85,104);
    doc.text('Service :  '+(S.request.service||'Prestation de service'), 15, 108);
    doc.text('Localité :  '+(S.request.city||'Suisse romande'), 15, 117);
    doc.text('Date :  '+(S.request.date?new Date(S.request.date).toLocaleDateString('fr-CH',{day:'numeric',month:'long',year:'numeric'}):'–'), 15, 126);

    // Payment
    doc.setFontSize(11);doc.setFont('helvetica','bold');doc.setTextColor(26,29,63);
    doc.text('RÈGLEMENT', 15, 141);
    var amt = offer.price;
    var rate = amt>=500?0.12:amt>=150?0.20:0.25;
    var commission = Math.round(amt*rate);
    var total = amt+commission;

    doc.setDrawColor(226,232,240);doc.setFillColor(247,250,252);
    doc.roundedRect(15,147,180,42,3,3,'FD');
    doc.setFont('helvetica','normal');doc.setFontSize(10);doc.setTextColor(74,85,104);
    doc.text('Prix prestataire', 20, 158);
    doc.text('CHF '+(amt)+'.–', 185, 158,'right');
    doc.text('Commission Oflem ('+(rate*100)+'%)', 20, 168);
    doc.setTextColor(255,107,53);
    doc.text('+CHF '+commission+'.–', 185, 168,'right');
    doc.setDrawColor(226,232,240);doc.line(20,172,185,172);
    doc.setFont('helvetica','bold');doc.setFontSize(12);doc.setTextColor(26,29,63);
    doc.text('Total payé par le client', 20, 182);
    doc.text('CHF '+total+'.–', 185, 182,'right');

    // Legal
    doc.setFont('helvetica','normal');doc.setFontSize(8);doc.setTextColor(113,128,150);
    doc.text('Oflem SA agit en qualité d\'intermédiaire de mise en relation (art. 412 CO). Le paiement a été', 15, 202);
    doc.text('traité via séquestre sécurisé. Les fonds ont été libérés après validation du client.', 15, 209);
    doc.text('Données protégées selon la loi fédérale sur la protection des données (nLPD) · Siège : Lausanne', 15, 216);

    // Footer
    doc.setFillColor(247,250,252);
    doc.rect(0,272,210,25,'F');
    doc.setFontSize(8);doc.setTextColor(113,128,150);
    doc.text('Oflem SA · oflem.ch · support@oflem.ch · Document généré le '+today, 105, 283, 'center');

    doc.save('oflem-contrat-'+contractRef+'.pdf');
    showToast('','Contrat téléchargé','Le PDF a été sauvegardé sur votre appareil.');
  }catch(e){
    console.error(e);
    showToast('','Contrat généré','Fichier disponible en simulation.');
  }
};

window.downloadFiscalExport = function(role){
  try{
    var jsPDF = window.jspdf && window.jspdf.jsPDF;
    if(!jsPDF){ showToast('','Export fiscal','PDF téléchargé (simulation).'); return; }

    var doc = new jsPDF();
    var year = new Date().getFullYear();
    var today = new Date().toLocaleDateString('fr-CH',{day:'numeric',month:'long',year:'numeric'});
    var offer = OFFERS.find(function(o){return o.id===S.acceptedOffer}) || OFFERS[0];
    var isProvider = role==='provider';
    var income = isProvider ? Math.round(offer.price*0.88) : offer.price;

    // Header
    doc.setFillColor(26,29,63);
    doc.rect(0,0,210,22,'F');
    doc.setTextColor(255,255,255);
    doc.setFontSize(18);doc.setFont('helvetica','bold');doc.text('OFLEM',15,14);
    doc.setFontSize(10);doc.setFont('helvetica','normal');
    doc.text('Récapitulatif fiscal '+year, 60, 14);
    doc.text('oflem.ch',180,14,'right');

    doc.setTextColor(26,29,63);
    doc.setFontSize(15);doc.setFont('helvetica','bold');
    doc.text('RÉCAPITULATIF FISCAL '+year, 105, 36, 'center');
    doc.setFontSize(10);doc.setFont('helvetica','normal');doc.setTextColor(113,128,150);
    doc.text('Généré le '+today+' · À conserver pour votre déclaration d\'impôts', 105, 44, 'center');

    doc.setDrawColor(226,232,240);doc.line(15,50,195,50);

    // Identity
    doc.setFontSize(11);doc.setFont('helvetica','bold');doc.setTextColor(26,29,63);
    doc.text('TITULAIRE DU COMPTE', 15, 62);
    doc.setFont('helvetica','normal');doc.setFontSize(10);doc.setTextColor(74,85,104);
    var name = isProvider ? (S.provider.firstName||'Prestataire')+' '+(S.provider.lastName||'') : (S.request.firstName||'Client');
    var email = isProvider ? (S.provider.email||'pro@email.ch') : (S.user.email||'client@email.ch');
    var city = isProvider ? (S.provider.city||'Lausanne') : (S.request.city||'Lausanne');
    doc.text(name+' · '+email+' · '+city, 15, 72);

    // Summary table
    doc.setFontSize(11);doc.setFont('helvetica','bold');doc.setTextColor(26,29,63);
    doc.text('RÉCAPITULATIF DES TRANSACTIONS', 15, 88);

    // Table header
    doc.setFillColor(247,250,252);doc.setDrawColor(226,232,240);
    doc.roundedRect(15,94,180,12,2,2,'FD');
    doc.setFontSize(9);doc.setFont('helvetica','bold');doc.setTextColor(113,128,150);
    doc.text('N°',20,102);doc.text('Service',40,102);doc.text('Date',110,102);doc.text('Partenaire',140,102);doc.text('Montant',185,102,'right');

    // Row 1
    doc.setFont('helvetica','normal');doc.setFontSize(9);doc.setTextColor(74,85,104);
    doc.setDrawColor(226,232,240);doc.line(15,115,195,115);
    doc.text('001',20,112);
    doc.text((S.request.service||'Mission').substr(0,25),40,112);
    doc.text(today,110,112);
    doc.text((isProvider?S.request.firstName||'Client':offer.name).substr(0,18),140,112);
    doc.setFont('helvetica','bold');doc.setTextColor(16,185,129);
    doc.text((isProvider?'+':'−')+' CHF '+income+'.–',185,112,'right');

    // Totals
    doc.setFillColor(247,250,252);doc.setDrawColor(226,232,240);
    doc.roundedRect(15,124,180,30,3,3,'FD');
    doc.setFont('helvetica','normal');doc.setFontSize(10);doc.setTextColor(74,85,104);
    doc.text(isProvider?'Total encaissé (hors cotisations)':'Total dépensé via Oflem', 20, 135);
    doc.setFont('helvetica','bold');doc.setFontSize(14);doc.setTextColor(26,29,63);
    doc.text('CHF '+income+'.–', 185, 148, 'right');

    // Legal notice
    doc.setFontSize(9);doc.setFont('helvetica','normal');doc.setTextColor(113,128,150);
    doc.text('Ce document est fourni à titre informatif. Oflem ne fournit pas de conseil fiscal.', 15, 170);
    if(isProvider) doc.text('En qualité d\'indépendant, vous êtes responsable de déclarer vos revenus à l\'AFC.', 15, 178);
    doc.text('Pour toute question : comptabilité.oflem.ch', 15, isProvider?186:178);

    doc.save('oflem-fiscal-'+year+'-'+role+'.pdf');
    showToast('','Export fiscal téléchargé','Le récapitulatif '+year+' a été sauvegardé.');
  }catch(e){
    showToast('','Export fiscal','Fichier généré (simulation).');
  }
};

window.downloadFiscalExportCSV = function(role){
  var year = new Date().getFullYear();
  var offer = OFFERS.find(function(o){return o.id===S.acceptedOffer}) || OFFERS[0];
  var income = role==='provider' ? Math.round(offer.price*0.88) : offer.price;
  var today = new Date().toLocaleDateString('fr-CH');
  var csv = 'Référence,Service,Date,Partenaire,Montant CHF,Statut\n';
  csv += 'OFL-001,"'+(S.request.service||'Mission')+'",'+today+','+(role==='provider'?(S.request.firstName||'Client'):offer.name)+','+income+',Terminée\n';
  var blob = new Blob([csv],{type:'text/csv;charset=utf-8;'});
  var url = URL.createObjectURL(blob);
  var a = document.createElement('a');
  a.href=url;a.download='oflem-fiscal-'+year+'-'+role+'.csv';a.click();
  URL.revokeObjectURL(url);
  showToast('','CSV téléchargé','Fichier CSV prêt pour votre comptable.');
};

// ═══════════════════════════════════════════════════
// CONTRE-OFFRE PRESTATAIRE (17)
// ═══════════════════════════════════════════════════
window.openCounterOfferModal = function(){
  var mc = document.getElementById('modalContent');
  var todayStr = new Date().toISOString().split('T')[0];
  mc.innerHTML = '<div class="modal-header"><h3>Proposer une contre-offre</h3><button class="modal-close" onclick="closeModal()">✕</button></div>'+
    '<div class="modal-body">'+
    '<p style="font-size:13px;color:var(--g500);margin-bottom:20px;padding:12px 14px;background:var(--g50);border-radius:8px;line-height:1.5">Proposez un prix différent ou une nouvelle date. Le client recevra votre contre-offre et pourra l\'accepter ou négocier à son tour.</p>'+
    '<div style="margin-bottom:16px"><label style="font-size:13px;font-weight:700;color:var(--n);display:block;margin-bottom:6px">Votre prix proposé (CHF)</label>'+
    '<div style="position:relative"><span style="position:absolute;left:14px;top:50%;transform:translateY(-50%);font-weight:900;color:var(--g500)">CHF</span>'+
    '<input type="number" id="counter-price" min="5" placeholder="Ex: 850" style="width:100%;padding:14px 14px 14px 50px;border:2px solid var(--g300);border-radius:var(--rs);font-size:18px;font-weight:900"></div></div>'+
    '<div style="margin-bottom:16px"><label style="font-size:13px;font-weight:700;color:var(--n);display:block;margin-bottom:6px">Date que vous proposez</label>'+
    '<input type="date" id="counter-date" value="'+todayStr+'" style="width:100%;padding:14px;border:2px solid var(--g300);border-radius:var(--rs);font-size:15px"></div>'+
    '<div style="margin-bottom:20px"><label style="font-size:13px;font-weight:700;color:var(--n);display:block;margin-bottom:6px">Message au client</label>'+
    '<textarea id="counter-msg" rows="3" placeholder="Expliquez pourquoi vous proposez ces conditions…" style="width:100%;padding:14px;border:2px solid var(--g300);border-radius:var(--rs);font-size:14px;font-family:inherit;resize:vertical"></textarea></div>'+
    '<button class="btn btn-primary" style="width:100%;font-size:16px;padding:16px" onclick="submitCounterOffer()">Envoyer la contre-offre →</button>'+
    '</div>';
  document.getElementById('modalOverlay').classList.add('show');
};

window.submitCounterOffer = function(){
  var price = document.getElementById('counter-price').value;
  var date = document.getElementById('counter-date').value;
  var msg = document.getElementById('counter-msg').value;
  if(!price){showToast('','Prix requis','Entrez un montant pour votre contre-offre.');return;}
  S.counterOffer = {price:price, date:new Date(date).toLocaleDateString('fr-CH',{day:'numeric',month:'short'}), msg:msg};
  closeModal();
  showToast('','Contre-offre envoyée','Le client sera notifié de votre proposition.');
  pdView('opportunities');
};

// ═══════════════════════════════════════════════════
// PROFIL PUBLIC & PARRAINAGE (31, 32)
// ═══════════════════════════════════════════════════
window.copyPublicURL = function(url){
  try{
    navigator.clipboard.writeText('https://'+url).then(function(){
      showToast('','Lien copié','Partagez ce lien pour trouver des clients directement.');
    });
  }catch(e){
    showToast('','Lien copié','https://'+url);
  }
};

window.copyReferral = function(){
  try{
    navigator.clipboard.writeText(S.referralCode).then(function(){
      showToast('','Code copié','Partagez ce code avec vos amis pour leur offrir CHF 10.');
    });
  }catch(e){
    showToast('','Code copié',S.referralCode);
  }
};
window.loginAs = function(role){
  S.user.type = role;
  S.user.loggedIn = true;
  if(role === 'client'){
    oflemNav('dashboard');
  } else {
    // If provider profile exists, go to provider dashboard; otherwise signup
    if(S.hasProviderProfile){
      oflemNav('provider-dashboard');
    } else {
      oflemNav('provider-signup');
    }
  }
};

window.loginSubmit = function(){
  var email = document.getElementById('login-email').value.trim();
  var password = document.getElementById('login-password').value;
  if(!email || !password){
    showToast('','Champs requis','Veuillez remplir email et mot de passe.');
    return;
  }
  // Simulate login - in prod: API call
  S.user.email = email;
  S.user.loggedIn = true;
  // Default to client dashboard in demo
  S.user.type = 'client';
  oflemNav('dashboard');
};

// ═══════════════════════════════════════════════════
// SWITCH BETWEEN CLIENT / PROVIDER
// ═══════════════════════════════════════════════════
window.switchToProvider = function(){
  if(S.hasProviderProfile){
    S.user.type = 'provider';
    oflemNav('provider-dashboard');
  } else {
    // First time: need to create provider profile
    showToast('','Devenez prestataire','Créez votre profil pour accéder à l\'espace prestataire.');
    S._switchingToProvider = true;
    oflemNav('provider-signup');
  }
};

window.switchToClient = function(){
  S.user.type = 'client';
  oflemNav('dashboard');
};

// ═══════════════════════════════════════════════════
// EDIT MISSION MODAL (7)
// ═══════════════════════════════════════════════════
window.openEditMissionModal = function(){
  var mc = document.getElementById('modalContent');
  var todayStr = new Date().toISOString().split('T')[0];
  mc.innerHTML = '<div class="modal-header"><h3>Modifier ma demande</h3><button class="modal-close" onclick="closeModal()">✕</button></div>'+
    '<div class="modal-body">'+
    '<div style="margin-bottom:16px"><label style="font-size:13px;font-weight:700;color:var(--n);display:block;margin-bottom:6px">Description du besoin</label>'+
    '<input type="text" id="edit-service" value="'+(S.request.service||'')+'" style="width:100%;padding:14px;border:2px solid var(--g300);border-radius:var(--rs);font-size:15px;font-weight:600;color:var(--n)"></div>'+
    '<div style="margin-bottom:16px"><label style="font-size:13px;font-weight:700;color:var(--n);display:block;margin-bottom:6px">Ville</label>'+
    '<select id="edit-city" style="width:100%;padding:14px;border:2px solid var(--g300);border-radius:var(--rs);font-size:15px;background:#fff">'+
    ['Genève','Lausanne','Fribourg','Neuchâtel','Sion','Montreux','Nyon','Morges','Vevey','Yverdon-les-Bains'].map(function(c){return '<option'+(c===S.request.city?' selected':'')+'>'+c+'</option>'}).join('')+
    '</select></div>'+
    '<div style="display:grid;grid-template-columns:1fr auto;gap:12px;margin-bottom:16px;align-items:end"><div><label style="font-size:13px;font-weight:700;color:var(--n);display:block;margin-bottom:6px">Budget (CHF)</label>'+
    '<div style="position:relative"><span style="position:absolute;left:14px;top:50%;transform:translateY(-50%);font-weight:900;color:var(--g500)">CHF</span>'+
    '<input type="number" id="edit-budget" value="'+(S.request.budget||200)+'" min="5" max="50000" style="width:100%;padding:14px 14px 14px 50px;border:2px solid var(--g300);border-radius:var(--rs);font-size:16px;font-weight:900"></div></div></div>'+
    '<div style="display:grid;grid-template-columns:1fr 1fr;gap:12px;margin-bottom:16px">'+
    '<div><label style="font-size:13px;font-weight:700;color:var(--n);display:block;margin-bottom:6px">Date</label><input type="date" id="edit-date" value="'+(S.request.date||todayStr)+'" style="width:100%;padding:14px;border:2px solid var(--g300);border-radius:var(--rs);font-size:15px"></div>'+
    '<div><label style="font-size:13px;font-weight:700;color:var(--n);display:block;margin-bottom:6px">Heure</label><select id="edit-time" style="width:100%;padding:14px;border:2px solid var(--g300);border-radius:var(--rs);font-size:15px;background:#fff">'+
    ['','08:00','09:00','10:00','11:00','12:00','13:00','14:00','15:00','16:00','17:00','18:00','19:00','20:00'].map(function(t){return '<option'+(t===S.request.time?' selected':'')+' value="'+t+'">'+(t||'Flexible')+'</option>'}).join('')+
    '</select></div></div>'+
    '<button class="btn btn-primary" style="width:100%;font-size:16px;padding:16px" onclick="saveEditMission()">Enregistrer les modifications →</button>'+
    '</div>';
  document.getElementById('modalOverlay').classList.add('show');
};

window.saveEditMission = function(){
  S.request.service = document.getElementById('edit-service').value.trim() || S.request.service;
  S.request.city = document.getElementById('edit-city').value;
  S.request.budget = document.getElementById('edit-budget').value;
  S.request.date = document.getElementById('edit-date').value;
  S.request.time = document.getElementById('edit-time').value;
  closeModal();
  showToast('','Demande mise à jour','Vos modifications ont été enregistrées.');
  dbView('missions');
};

// ═══════════════════════════════════════════════════
// COMMISSION PREVIEW (12)
// ═══════════════════════════════════════════════════
window.updateCommissionPreview = function(){
  var amt = parseInt(document.getElementById('confirm-budget').value) || 0;
  var preview = document.getElementById('commission-preview');
  if(!preview) return;
  if(amt < 5){preview.style.display='none';return;}
  
  var rate = amt >= 500 ? 0.12 : amt >= 150 ? 0.20 : 0.25;
  var rateLabel = amt >= 500 ? '12%' : amt >= 150 ? '20%' : '25%';
  var commission = Math.round(amt * rate);
  var total = amt + commission;
  
  document.getElementById('cp-offer').textContent = fCHF(amt);
  document.getElementById('cp-rate').textContent = '(' + rateLabel + ')';
  document.getElementById('cp-commission').textContent = '+' + fCHF(commission);
  document.getElementById('cp-total').textContent = fCHF(total);
  preview.style.display = 'block';
  
  // Price advice based on service
  updatePriceAdvice(amt);
};

function updatePriceAdvice(amt){
  var svc = (S.request.service || '').toLowerCase();
  var advice = document.getElementById('price-advice');
  if(!advice) return;
  
  var suggestions = {
    'promenade': {min:15, max:30, label:'promenade d\'animaux'},
    'animaux': {min:15, max:30, label:'promenade d\'animaux'},
    'courses': {min:15, max:40, label:'courses'},
    'nettoyage': {min:40, max:120, label:'nettoyage'},
    'ménage': {min:40, max:120, label:'ménage'},
    'peinture': {min:200, max:1500, label:'peinture'},
    'jardinage': {min:60, max:200, label:'jardinage'},
    'déménagement': {min:300, max:1200, label:'déménagement'},
    'plomberie': {min:150, max:600, label:'plomberie'},
    'montage': {min:50, max:150, label:'montage meubles'},
    'électricité': {min:150, max:500, label:'travaux électriques'}
  };
  
  var found = null;
  for(var key in suggestions){
    if(svc.indexOf(key) !== -1){found = suggestions[key]; break;}
  }
  
  if(found){
    var msg = 'Pour une prestation de ' + found.label + ', le marché suisse romand se situe généralement entre CHF ' + found.min + '.– et CHF ' + found.max + '.–';
    if(amt < found.min) msg += '. Votre budget semble bas. Les prestataires pourraient proposer des prix plus élevés.';
    else if(amt > found.max) msg += '. Votre budget est généreux. Vous devriez recevoir de bonnes offres rapidement.';
    advice.textContent = msg;
    advice.style.display = 'block';
  } else {
    advice.style.display = 'none';
  }
}

// Init commission preview on page load
setTimeout(function(){
  var b = document.getElementById('confirm-budget');
  if(b) updateCommissionPreview();
}, 500);

// ═══════════════════════════════════════════════════
// TAGS SYSTEM (3)
// ═══════════════════════════════════════════════════
var TAG_CATALOG = {
  'Courses & livraison': ['Livraison express','Courses alimentaires','Petits transports','Ponctuel','Disponible tôt'],
  'Promenade d\'animaux': ['Chiens','Chats','Petits animaux','Expérimenté animaux','Permis B'],
  'Aide à la personne': ['Personnes âgées','Mobilité réduite','Aide administrative','Empathique','Expérience médico-sociale'],
  'Nettoyage': ['Nettoyage fin de bail','Vitres','Grand ménage','Produits écologiques','Réactif'],
  'Peinture': ['Peinture intérieure','Peinture extérieure','Enduit','Finitions soignées','Devis gratuit'],
  'Plomberie': ['Fuite','Installation sanitaire','Débouchage','Urgence','Certifié'],
  'Électricité': ['Petit électricité','Installation','Dépannage','Norme NIBT','Certifié'],
  'Menuiserie': ['Mobilier','Parquet','Agencement','Sur mesure','Restauration'],
  'Jardinage': ['Tonte','Élagage','Plantation','Entretien régulier','Évacuation déchets'],
  'Rénovation': ['Carrelage','Sols','Gros œuvre','Coordination artisans','Clé en main'],
  'Déménagement': ['Camion','Emballage','Montage','Démontage','Débarras'],
  'Montage meubles': ['IKEA','Tous styles','Fixation murale','Rapide','Outils pro'],
  'Multi-services': ['Polyvalent','Flexible','Urgences','Petits travaux','Bricolage']
};

var selectedTags = [];

window.updateTagSuggestions = function(){
  var catId = (typeof psMode !== 'undefined' && psMode === 'remote') ? 'ps-category-remote' : 'ps-category-standard';
  var cat = document.getElementById(catId);
  if(!cat || !cat.value) return;
  var tags = TAG_CATALOG[cat.value] || ['Professionnel','Ponctuel','Soigneux','Réactif','Flexibilité','Certifié'];
  renderTagSuggestions(tags);
};

window.debounceBioTags = function(){
  clearTimeout(window._bioTagTimer);
  window._bioTagTimer = setTimeout(function(){
    var btn = document.getElementById('ps-ai-tags-btn');
    var bio = document.getElementById('ps-bio');
    if(btn && bio && bio.value.trim().length > 20) btn.style.display = 'block';
  }, 1000);
};

function renderTagSuggestions(tags){
  var container = document.getElementById('ps-tag-suggestions');
  if(!container) return;
  container.innerHTML = '';
  tags.forEach(function(tag){
    if(selectedTags.indexOf(tag) !== -1) return;
    var chip = document.createElement('span');
    chip.textContent = '+ ' + tag;
    chip.style.cssText = 'display:inline-flex;align-items:center;padding:6px 14px;background:#f0f4ff;border:1.5px solid rgba(102,126,234,.3);border-radius:999px;font-size:12px;font-weight:700;color:#4338ca;cursor:pointer;transition:all .2s;user-select:none';
    chip.onmouseover = function(){this.style.background='#e0e7ff';this.style.borderColor='rgba(102,126,234,.6)'};
    chip.onmouseout = function(){this.style.background='#f0f4ff';this.style.borderColor='rgba(102,126,234,.3)'};
    chip.onclick = function(){
      addTag(tag);
      chip.style.opacity='0';
      setTimeout(function(){chip.remove()},200);
    };
    container.appendChild(chip);
  });
}

function addTag(tag){
  if(selectedTags.indexOf(tag) !== -1) return;
  selectedTags.push(tag);
  S.provider.tags = selectedTags;
  renderSelectedTags();
  document.getElementById('ps-tag-count').textContent = selectedTags.length;
}

function renderSelectedTags(){
  var container = document.getElementById('ps-tag-selected');
  if(!container) return;
  container.innerHTML = '';
  if(selectedTags.length === 0){
    container.innerHTML = '<span style="font-size:12px;color:var(--g500);font-style:italic">Aucun tag sélectionné. Cliquez sur les suggestions ci-dessus</span>';
    return;
  }
  selectedTags.forEach(function(tag){
    var chip = document.createElement('span');
    chip.innerHTML = tag + ' <span style="cursor:pointer;margin-left:4px;opacity:.6">×</span>';
    chip.style.cssText = 'display:inline-flex;align-items:center;padding:5px 12px;background:linear-gradient(135deg,var(--n),#4a5568);border-radius:999px;font-size:12px;font-weight:700;color:#fff;animation:pgIn .2s ease';
    chip.querySelector('span').onclick = function(){
      selectedTags.splice(selectedTags.indexOf(tag),1);
      S.provider.tags = selectedTags;
      renderSelectedTags();
      document.getElementById('ps-tag-count').textContent = selectedTags.length;
      updateTagSuggestions();
    };
    container.appendChild(chip);
  });
}

window.generateAiTags = function(){
  var btn = document.getElementById('ps-ai-tags-btn');
  var bio = (document.getElementById('ps-bio').value || '').toLowerCase();
  btn.textContent = 'Génération…';
  btn.disabled = true;
  
  // Keyword → tag mapping
  var aiTags = [];
  var mappings = [
    [['urgent','rapide','dispo','disponible','vite'],['Disponibilité immédiate','Interventions urgentes']],
    [['soign','qualit','méticuleux','précis'],['Finitions soignées','Travail de qualité']],
    [['expérience','ans','professionnel','certif'],['Certifié','Expérimenté']],
    [['bilingue','anglais','allemand','espagnol'],['Bilingue','Plurilingue']],
    [['écolog','vert','bio','naturel'],['Produits écologiques','Éco-responsable']],
    [['voiture','véhicule','camion','transporter'],['Véhicule propre','Grandes capacités']],
    [['devis','gratuit','sans engagement'],['Devis gratuit','Sans engagement']],
    [['week','soir','nuit','flexible','week-end'],['Week-end disponible','Horaires flexibles']]
  ];
  
  setTimeout(function(){
    mappings.forEach(function(m){
      if(m[0].some(function(kw){return bio.indexOf(kw) !== -1})){
        m[1].forEach(function(t){
          if(selectedTags.indexOf(t) === -1 && aiTags.indexOf(t) === -1) aiTags.push(t);
        });
      }
    });
    
    if(aiTags.length === 0) aiTags = ['Professionnel confirmé','Attentif aux détails','À l\'écoute'];
    
    aiTags.forEach(function(t){addTag(t)});
    
    btn.textContent = aiTags.length + ' tags générés';
    btn.style.background = 'var(--g)';
    setTimeout(function(){btn.style.display='none';btn.disabled=false;btn.textContent='Générer des tags avec l\'IA';btn.style.background=''},3000);
    showToast('','Tags générés','L\'IA a ajouté ' + aiTags.length + ' tags basés sur votre bio.');
  }, 1400);
};

// ═══════════════════════════════════════════════════
// DOC UPLOADS (4)
// ═══════════════════════════════════════════════════
window.simulateDocUpload = function(type){
  var statusMap = {
    photo: 'ps-photo-status',
    id: 'ps-id-status',
    domicile: 'ps-dom-status',
    permit: 'ps-permit-status'
  };
  var statusId = statusMap[type];
  if(!statusId) return;
  
  // Simulate upload delay
  showToast('','Téléchargement…','Traitement du document en cours.');
  
  setTimeout(function(){
    var el = document.getElementById(statusId);
    if(el){el.style.display = 'block';}
    
    if(type === 'photo'){
      var circle = document.getElementById('ps-photo-circle');
      if(circle){
        circle.style.background = 'linear-gradient(135deg,var(--n),#4a5568)';
        circle.innerHTML = '<svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="#fff" stroke-width="2" stroke-linecap="round"><polyline points="20 6 9 17 4 12"/></svg>';
        circle.style.border = '3px solid var(--g)';
      }
    }
    
    S.provider.docs = S.provider.docs || {};
    S.provider.docs[type] = true;
    showToast('','Document reçu','Votre document sera vérifié sous 24–48h.');
  }, 1200);
};

// ═══════════════════════════════════════════════════
// PROVIDER OPPORTUNITIES ANIMATION
// ═══════════════════════════════════════════════════
var _origRenderOpportunities = window.renderOpportunities;
window.renderOpportunities = function(){
  // Use original if already defined
  var html = typeof _origRenderOpportunities === 'function' ? _origRenderOpportunities() : '';
  return html;
};
function renderHistory(role){
  var year = new Date().getFullYear();
  var hasHistory = S.escrowState==='released';

  if(!hasHistory){
    return '<div style="background:#fff;border:1px solid var(--g300);border-radius:var(--rl);padding:40px;text-align:center">'+
      '<p style="color:var(--g500)">Votre historique de missions apparaîtra ici une fois la première mission terminée.</p></div>';
  }

  var offer=OFFERS.find(function(o){return o.id===S.acceptedOffer})||OFFERS[0];
  var paidAmount = role==='client' ? offer.price : Math.round(900*0.88);
  var dateStr = new Date().toLocaleDateString('fr-CH',{day:'numeric',month:'long',year:'numeric'});

  return '<div style="animation:pgIn .4s ease both">'+
    // Export fiscal banner
    '<div style="background:linear-gradient(135deg,#f0f4ff,#e8eeff);border:1.5px solid rgba(102,126,234,.25);border-radius:var(--rs);padding:16px 20px;margin-bottom:20px;display:flex;align-items:center;gap:14px">'+
    '<div style="width:40px;height:40px;border-radius:10px;background:linear-gradient(135deg,#667eea,#764ba2);display:flex;align-items:center;justify-content:center;flex-shrink:0">'+
    '<svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="#fff" stroke-width="2" stroke-linecap="round"><path d="M14 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V8z"/><polyline points="14 2 14 8 20 8"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/></svg>'+
    '</div>'+
    '<div style="flex:1">'+
    '<div style="font-size:13px;font-weight:900;color:var(--n);margin-bottom:2px">Récapitulatif fiscal '+year+'</div>'+
    '<div style="font-size:12px;color:var(--g500)">Téléchargez votre résumé annuel pour votre déclaration d\'impôts.</div>'+
    '</div>'+
    '<div style="display:flex;gap:8px">'+
    '<button onclick="downloadFiscalExport(\''+role+'\')" style="padding:8px 16px;background:linear-gradient(135deg,#667eea,#764ba2);border:none;border-radius:8px;color:#fff;font-size:13px;font-weight:700;cursor:pointer;white-space:nowrap">Export PDF</button>'+
    '<button onclick="downloadFiscalExportCSV(\''+role+'\')" style="padding:8px 14px;background:#fff;border:1.5px solid rgba(102,126,234,.3);border-radius:8px;color:#667eea;font-size:13px;font-weight:700;cursor:pointer">CSV</button>'+
    '</div></div>'+
    // Mission row
    '<div style="background:#fff;border:1px solid var(--g300);border-radius:var(--r);padding:20px">'+
    '<div style="display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap;gap:12px">'+
    '<div><h4 style="font-size:16px;font-weight:900;color:var(--n)">'+(S.request.service||'Mission')+'</h4>'+
    '<p style="font-size:13px;color:var(--g500)">'+(S.request.city||'Lausanne')+' · '+dateStr+' · '+(role==='client'?offer.name:(S.request.firstName||'Client'))+'</p></div>'+
    '<div style="text-align:right">'+
    '<div style="font-size:18px;font-weight:900;color:var(--g)">'+fCHF(paidAmount)+'</div>'+
    '<span style="font-size:11px;color:var(--g);font-weight:700">Terminée</span>'+
    '</div></div>'+
    (role==='client'?'<div style="margin-top:12px;display:flex;gap:8px"><button onclick="downloadContractPDF()" class="btn btn-outline btn-sm">📄 Contrat</button></div>':
    '<div style="margin-top:12px;display:flex;gap:8px"><button onclick="downloadContractPDF()" class="btn btn-outline btn-sm">📄 Quittance</button></div>')+
    '</div></div>';
}

function renderProfile(role){
  if(role==='client'){
    // referral removed
    return '<div style="display:grid;gap:16px;animation:pgIn .4s ease both">'+
      '<div style="background:#fff;border:1px solid var(--g300);border-radius:var(--rl);padding:36px">'+
      '<div style="display:flex;align-items:center;gap:20px;margin-bottom:24px">'+
      '<div style="width:72px;height:72px;border-radius:50%;background:linear-gradient(135deg,var(--n),#4a5568);color:#fff;display:flex;align-items:center;justify-content:center;font-size:24px;font-weight:900">'+(S.request.firstName?S.request.firstName.charAt(0).toUpperCase():'C')+'</div>'+
      '<div><h3 style="font-size:22px;font-weight:900;color:var(--n)">'+(S.request.firstName||'Client')+'</h3>'+
      '<p style="font-size:14px;color:var(--g500)">'+(S.user.email||'client@email.ch')+' · '+(S.request.city||'Lausanne')+'</p></div></div>'+
      '<div style="display:grid;grid-template-columns:1fr 1fr 1fr;gap:16px;margin-bottom:0">'+
      '<div style="background:var(--g50);border-radius:var(--rs);padding:16px;text-align:center"><div style="font-size:28px;font-weight:900;color:var(--o)">1</div><div style="font-size:12px;color:var(--g500)">Demande</div></div>'+
      '<div style="background:var(--g50);border-radius:var(--rs);padding:16px;text-align:center"><div style="font-size:28px;font-weight:900;color:var(--g)">'+(S.offerAccepted?'1':'0')+'</div><div style="font-size:12px;color:var(--g500)">Mission</div></div>'+
      '<div style="background:var(--g50);border-radius:var(--rs);padding:16px;text-align:center"><div style="font-size:28px;font-weight:900;color:var(--n)">—</div><div style="font-size:12px;color:var(--g500)">Note</div></div>'+
      '</div></div>'+
      '</div>';
  }

  // PROVIDER PROFILE
  var slug = S.provider.publicSlug || ('oflem.ch/pro/'+(S.provider.firstName||'prestataire').toLowerCase().replace(/\s/g,'-')+'-'+(S.provider.city||'lausanne').toLowerCase());
  var ref2 = S.referralCode;
  return '<div style="display:grid;gap:16px;animation:pgIn .4s ease both">'+
    '<div style="background:#fff;border:1px solid var(--g300);border-radius:var(--rl);padding:36px">'+
    '<div style="display:flex;align-items:center;gap:20px;margin-bottom:24px">'+
    '<div style="width:72px;height:72px;border-radius:50%;background:linear-gradient(135deg,var(--o),var(--ol));color:#fff;display:flex;align-items:center;justify-content:center;font-size:24px;font-weight:900">'+(S.provider.firstName?S.provider.firstName.charAt(0).toUpperCase():'P')+'</div>'+
    '<div><h3 style="font-size:22px;font-weight:900;color:var(--n)">'+(S.provider.firstName||'Prestataire')+' '+(S.provider.lastName||'')+'</h3>'+
    '<p style="font-size:14px;color:var(--g500)">'+(S.provider.email||'pro@email.ch')+' · '+(S.provider.city||'Lausanne')+' · '+(S.provider.category||'Services')+'</p></div></div>'+
    (S.provider.bio?'<p style="font-size:14px;color:var(--g700);line-height:1.7;padding:16px;background:var(--g50);border-radius:var(--rs);margin-bottom:20px">'+S.provider.bio+'</p>':'')+
    '<div style="display:grid;grid-template-columns:1fr 1fr 1fr;gap:16px;margin-bottom:0">'+
    '<div style="background:var(--g50);border-radius:var(--rs);padding:16px;text-align:center"><div style="font-size:28px;font-weight:900;color:var(--o)">'+(S.providerOfferSent?'1':'0')+'</div><div style="font-size:12px;color:var(--g500)">Offres</div></div>'+
    '<div style="background:var(--g50);border-radius:var(--rs);padding:16px;text-align:center"><div style="font-size:28px;font-weight:900;color:var(--g)">'+(S.providerOfferAccepted?'1':'0')+'</div><div style="font-size:12px;color:var(--g500)">Missions</div></div>'+
    '<div style="background:var(--g50);border-radius:var(--rs);padding:16px;text-align:center"><div style="font-size:28px;font-weight:900;color:var(--n)">—</div><div style="font-size:12px;color:var(--g500)">Note</div></div>'+
    '</div></div>'+

    // Public URL card
    '<div style="background:linear-gradient(135deg,#f0fdf4,#ecfdf5);border:1.5px solid rgba(16,185,129,.2);border-radius:var(--rs);padding:20px">'+
    '<div style="display:flex;align-items:center;gap:12px;margin-bottom:14px">'+
    '<div style="width:36px;height:36px;border-radius:8px;background:linear-gradient(135deg,var(--g),#34d399);display:flex;align-items:center;justify-content:center;flex-shrink:0">'+
    '<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="#fff" stroke-width="2.5" stroke-linecap="round"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71"/><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71"/></svg>'+
    '</div>'+
    '<div><div style="font-size:14px;font-weight:900;color:#065f46">Votre profil public</div><div style="font-size:12px;color:#047857">Partagez ce lien partout pour trouver des clients directement.</div></div></div>'+
    '<div style="display:flex;gap:8px;align-items:center;margin-bottom:10px">'+
    '<div style="flex:1;padding:10px 14px;background:#fff;border:1.5px solid rgba(16,185,129,.2);border-radius:8px;font-size:13px;font-family:monospace;color:var(--n);overflow:hidden;text-overflow:ellipsis;white-space:nowrap">'+slug+'</div>'+
    '<button onclick="copyPublicURL(\''+slug+'\')" style="padding:10px 14px;background:var(--g);border:none;border-radius:8px;color:#fff;font-size:12px;font-weight:700;cursor:pointer;flex-shrink:0">Copier</button>'+
    '</div>'+
    '<p style="font-size:11px;color:#047857;margin:0">Ce lien est indexé par Google — vos clients vous trouvent sans passer par Oflem.</p></div>'+

    '</div>';
}

// ═══════════════════════════════════════════════════
// MODALS
// ═══════════════════════════════════════════════════
window.openSendOfferModal = function(){
  var mc=document.getElementById('modalContent');
  mc.innerHTML='<div class="modal-header"><h3>Envoyer une offre</h3><button class="modal-close" onclick="closeModal()">✕</button></div>'+
    '<div class="modal-body">'+
    '<p style="font-size:14px;color:var(--g500);margin-bottom:20px">Mission : <strong style="color:var(--n)">'+(S.request.service||'Service')+'</strong> · '+(S.request.city||'Lausanne')+'</p>'+
    '<div style="margin-bottom:20px"><label style="font-size:13px;font-weight:900;color:var(--n);display:block;margin-bottom:6px">Votre prix (CHF)</label><input type="number" id="modal-price" value="900" min="50" max="10000" style="width:100%;padding:14px;border:2px solid var(--g300);border-radius:var(--rs);font-size:18px;font-weight:900;text-align:center"></div>'+
    '<div style="margin-bottom:20px"><label style="font-size:13px;font-weight:900;color:var(--n);display:block;margin-bottom:6px">Message au client</label><textarea id="modal-msg" rows="3" placeholder="Présentez-vous et expliquez pourquoi vous êtes le bon prestataire..." style="width:100%;padding:14px;border:2px solid var(--g300);border-radius:var(--rs);font-size:14px;font-family:inherit;resize:vertical"></textarea></div>'+
    '<div style="margin-bottom:20px"><label style="font-size:13px;font-weight:900;color:var(--n);display:block;margin-bottom:6px">Disponibilité</label><select id="modal-avail" style="width:100%;padding:14px;border:2px solid var(--g300);border-radius:var(--rs);font-size:14px;background:#fff"><option>Cette semaine</option><option>Lundi prochain</option><option>Flexible</option></select></div>'+
    '<div style="background:linear-gradient(135deg,#f0fdf4,#ecfdf5);border:1px solid rgba(16,185,129,.2);border-radius:var(--rs);padding:14px 16px;margin-bottom:20px">'+
    '<div style="font-size:11px;font-weight:900;text-transform:uppercase;letter-spacing:1.5px;color:var(--g);margin-bottom:8px">Récapitulatif</div>'+
    '<div style="display:grid;grid-template-columns:1fr 1fr 1fr;gap:8px;text-align:center">'+
    '<div><div style="font-size:10px;color:var(--g500);margin-bottom:2px">Votre offre</div><div style="font-size:14px;font-weight:900;color:var(--n)" id="modal-offer-amt">CHF 900.–</div></div>'+
    '<div><div style="font-size:10px;color:var(--o);margin-bottom:2px">Commission client</div><div style="font-size:14px;font-weight:900;color:var(--o)" id="modal-commission">+CHF 108.–</div><div style="font-size:9px;color:var(--o)" id="modal-rate">12%</div></div>'+
    '<div><div style="font-size:10px;color:var(--g);margin-bottom:2px">Vous recevez</div><div style="font-size:14px;font-weight:900;color:var(--g)" id="modal-net">CHF 900.–</div><div style="font-size:9px;color:var(--g)">100%</div></div>'+
    '</div></div>'+
    '<button class="btn btn-primary" style="width:100%;font-size:16px;padding:16px" onclick="submitProviderOffer()">Envoyer mon offre →</button></div>';
  document.getElementById('modal-price').addEventListener('input',function(){
    var amt=parseInt(this.value||0);
    var rate=amt>=500?0.12:amt>=150?0.20:0.25;
    var rateLabel=amt>=500?'12%':amt>=150?'20%':'25%';
    var commission=Math.round(amt*rate);
    document.getElementById('modal-offer-amt').textContent=fCHF(amt);
    document.getElementById('modal-commission').textContent='+'+fCHF(commission);
    document.getElementById('modal-rate').textContent=rateLabel;
    document.getElementById('modal-net').textContent=fCHF(amt);
  });
  document.getElementById('modalOverlay').classList.add('show');
};

window.submitProviderOffer = function(){
  S.providerOfferSent=true;
  closeModal();
  showToast('','Offre envoyée !','Le client a été notifié de votre offre.');
  pdView('opportunities');
  // Simulate client accepting after 3s
  setTimeout(function(){
    S.providerOfferAccepted=true;
    document.getElementById('pd-chat-badge').style.display='inline';
    showToast('','Offre acceptée !','Le client a accepté votre offre. Rendez-vous dans les messages !');
    if(S.currentView==='provider-dashboard')pdView('opportunities');
  },3000);
};

window.openReviewModal = function(name,initials){
  var mc=document.getElementById('modalContent');
  mc.innerHTML='<div class="modal-header"><h3>Évaluer '+name+'</h3><button class="modal-close" onclick="closeModal()">✕</button></div>'+
    '<div class="modal-body" style="text-align:center">'+
    '<div style="width:60px;height:60px;border-radius:50%;background:linear-gradient(135deg,var(--o),var(--ol));color:#fff;display:flex;align-items:center;justify-content:center;font-weight:900;font-size:20px;margin:0 auto 16px">'+initials+'</div>'+
    '<div class="stars-input" id="review-stars" style="justify-content:center"><span onclick="setStars(1)">★</span><span onclick="setStars(2)">★</span><span onclick="setStars(3)">★</span><span onclick="setStars(4)">★</span><span onclick="setStars(5)">★</span></div>'+
    '<div style="margin:16px 0"><textarea id="review-text" rows="3" placeholder="Partagez votre expérience…" style="width:100%;padding:14px;border:2px solid var(--g300);border-radius:var(--rs);font-size:14px;font-family:inherit;resize:vertical"></textarea></div>'+
    '<button class="btn btn-primary" style="width:100%;font-size:16px;padding:14px" onclick="submitReview()">Publier mon avis →</button></div>';
  document.getElementById('modalOverlay').classList.add('show');
};

var reviewStars=0;
window.setStars = function(n){
  reviewStars=n;
  document.querySelectorAll('#review-stars span').forEach(function(s,i){s.classList.toggle('active',i<n)});
};

window.submitReview = function(){
  closeModal();
  showToast('⭐','Avis publié !','Merci pour votre évaluation ('+reviewStars+'/5).');
};

window.closeModal = function(){document.getElementById('modalOverlay').classList.remove('show')};

// ═══════════════════════════════════════════════════
// UI UTILITIES
// ═══════════════════════════════════════════════════
function btnLoad(btn,t){if(!btn)return;btn._t=btn.textContent;btn.textContent=t;btn.classList.add('btn-loading');btn.disabled=true}
function btnReset(btn,t){if(!btn)return;btn.textContent=t||btn._t||'OK';btn.classList.remove('btn-loading');btn.disabled=false}

window.showToast = function(icon,title,msg){
  var t=document.getElementById('toast');
  document.querySelector('.toast-icon').textContent=icon;
  document.getElementById('toast-title').textContent=title;
  document.getElementById('toast-msg').textContent=msg;
  t.classList.add('show');
  setTimeout(function(){t.classList.remove('show')},4000);
};

window.toggleMobileMenu = function(){
  var l=document.getElementById('navLinks'),b=document.getElementById('mobileMenuBtn');
  var o=l.classList.toggle('open');
  b.setAttribute('aria-expanded',o?'true':'false');
};

window.switchTab = function(tab){
  ['client','provider'].forEach(function(t){
    var b=document.getElementById('tab-'+t),p=document.getElementById('panel-'+t);
    if(t===tab){b.setAttribute('aria-selected','true');p.classList.add('active')}
    else{b.setAttribute('aria-selected','false');p.classList.remove('active')}
  });
};

window.toggleFaq = function(btn){
  var item=btn.closest('.faq-item'),a=item.querySelector('.faq-a'),isOpen=item.classList.toggle('open');
  btn.setAttribute('aria-expanded',isOpen?'true':'false');
  a.style.maxHeight=isOpen?a.scrollHeight+'px':'0';
};

window.toggleSidebar = function(prefix){
  document.getElementById(prefix+'-sidebar').classList.toggle('open');
  document.getElementById(prefix+'-overlay').classList.toggle('open');
};

// Header scroll
var hdr=document.querySelector('.header');
if(hdr)window.addEventListener('scroll',function(){hdr.classList.toggle('scrolled',window.pageYOffset>20)},{passive:true});

// Reveal on scroll
if('IntersectionObserver' in window){
  var obs=new IntersectionObserver(function(e){e.forEach(function(en){if(en.isIntersecting){en.target.classList.add('visible');obs.unobserve(en.target)}})},{threshold:.1,rootMargin:'0px 0px -40px 0px'});
  document.querySelectorAll('.reveal').forEach(function(el){obs.observe(el)});
} else document.querySelectorAll('.reveal').forEach(function(el){el.classList.add('visible')});

// Cookie banner
var cb=document.getElementById('cookieBar');
function showCookie(){try{if(!localStorage.getItem('oflem_cookies'))setTimeout(function(){cb.classList.add('show')},1500)}catch(e){setTimeout(function(){cb.classList.add('show')},1500)}}
function acceptC(){try{localStorage.setItem('oflem_cookies','accepted')}catch(e){}cb.classList.remove('show')}
function declineC(){try{localStorage.setItem('oflem_cookies','declined')}catch(e){}cb.classList.remove('show')}
document.getElementById('cookieAcceptBtn').addEventListener('click',acceptC);
document.getElementById('cookieDeclineBtn').addEventListener('click',declineC);
window.acceptCookies=acceptC;window.declineCookies=declineC;
showCookie();

// Smooth scroll
document.querySelectorAll('a[href^="#"]').forEach(function(a){
  a.addEventListener('click',function(e){
    var t=document.querySelector(this.getAttribute('href'));
    if(t){e.preventDefault();var nl=document.getElementById('navLinks');if(nl)nl.classList.remove('open');t.scrollIntoView({behavior:'smooth',block:'start'})}
  });
});

})();
</script>
</body>
</html>
